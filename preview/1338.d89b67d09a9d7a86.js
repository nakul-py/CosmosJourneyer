/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["1338"],{10425:function(e,t,r){var n=r(88280),i=r(85791),a=r(80405),s=r(72384),o=r(7126),l=r(47938);s.x.prototype.getPhysicsEngine=function(){return this._physicsEngine},s.x.prototype.enablePhysics=function(e=null,t){if(this._physicsEngine)return!0;let r=this._getComponent(a.l.NAME_PHYSICSENGINE);r||(r=new u(this),this._addComponent(r));try{if(t&&t?.getPluginVersion()!==1)if(t?.getPluginVersion()===2)this._physicsEngine=new l.T(e,t);else throw Error("Unsupported Physics plugin version.");else this._physicsEngine=new o.T(e,t);return this._physicsTimeAccumulator=0,!0}catch(e){return n.Y.Error(e.message),!1}},s.x.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},s.x.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},s.x.prototype.deleteCompoundImpostor=function(e){let t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},s.x.prototype._advancePhysicsEngineStep=function(e){if(this._physicsEngine){let t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=e;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class u{constructor(e){this.name=a.l.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new i.y$,this.scene.onAfterPhysicsObservable=new i.y$,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?1e3*this.scene._physicsEngine.getTimeStep():1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}r(65195);var c=r(27987);Object.defineProperty(c.Y.prototype,"physicsBody",{get:function(){return this._physicsBody},set:function(e){this._physicsBody!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsBody=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsBody&&(this.physicsBody.dispose(),this.physicsBody=null)})))},enumerable:!0,configurable:!0}),c.Y.prototype.getPhysicsBody=function(){return this.physicsBody},c.Y.prototype.applyImpulse=function(e,t){if(!this.physicsBody)throw Error("No Physics Body for TransformNode");return this.physicsBody.applyImpulse(e,t),this},c.Y.prototype.applyAngularImpulse=function(e){if(!this.physicsBody)throw Error("No Physics Body for TransformNode");return this.physicsBody.applyAngularImpulse(e),this}},10630:function(e,t,r){function n(e,t,r,n){let i=null,a=null,s=null,o=null,l={},u=t.find(e=>"POSITION"===e.dracoName);if(!u)throw Error("Position attribute is required for Draco encoding");if(!r){let e=u.data.length/u.size;r=new(e>65535?Uint32Array:Uint16Array)(e);for(let t=0;t<e;t++)r[t]=t}try{i=new e.Encoder,a=new e.MeshBuilder,s=new e.Mesh,a.AddFacesToMesh(s,r.length/3,r);let u=new Map([[Float32Array,(e,t,r,n,i,a)=>e.AddFloatAttribute(t,r,n,i,a)],[Uint32Array,(e,t,r,n,i,a)=>e.AddUInt32Attribute(t,r,n,i,a)],[Uint16Array,(e,t,r,n,i,a)=>e.AddUInt16Attribute(t,r,n,i,a)],[Uint8Array,(e,t,r,n,i,a)=>e.AddUInt8Attribute(t,r,n,i,a)],[Int32Array,(e,t,r,n,i,a)=>e.AddInt32Attribute(t,r,n,i,a)],[Int16Array,(e,t,r,n,i,a)=>e.AddInt16Attribute(t,r,n,i,a)],[Int8Array,(e,t,r,n,i,a)=>e.AddInt8Attribute(t,r,n,i,a)]]);for(let r of t){r.data instanceof Uint8ClampedArray&&(r.data=new Uint8Array(r.data));let t=u.get(r.data.constructor),o=r.data.length/r.size;l[r.kind]=t(a,s,e[r.dracoName],o,r.size,r.data),n.quantizationBits&&n.quantizationBits[r.dracoName]&&i.SetAttributeQuantization(e[r.dracoName],n.quantizationBits[r.dracoName])}n.method&&i.SetEncodingMethod(e[n.method]),void 0!==n.encodeSpeed&&void 0!==n.decodeSpeed&&i.SetSpeedOptions(n.encodeSpeed,n.decodeSpeed),o=new e.DracoInt8Array;let c=i.EncodeMeshToDracoBuffer(s,o);if(c<=0)throw Error("Draco encoding failed.");let d=new Int8Array(c);for(let e=0;e<c;e++)d[e]=o.GetValue(e);return{data:d,attributeIds:l}}finally{s&&e.destroy(s),a&&e.destroy(a),i&&e.destroy(i),o&&e.destroy(o)}}function i(){let e;onmessage=t=>{let r=t.data;switch(r.id){case"init":r.url&&importScripts(r.url),e=DracoEncoderModule(r.wasmBinary?{wasmBinary:r.wasmBinary}:{}),postMessage({id:"initDone"});break;case"encodeMesh":if(!e)throw Error("Draco encoder module is not available");e.then(e=>{let t=n(e,r.attributes,r.indices,r.options);postMessage({id:"encodeMeshDone",encodedMeshData:t},t?[t.data.buffer]:void 0)})}}}function a(e,t,r,n,i){let a=null,s=null,o=null;try{let l;a=new e.Decoder,(s=new e.DecoderBuffer).Init(t,t.byteLength);let u=a.GetEncodedGeometryType(s);switch(u){case e.TRIANGULAR_MESH:{let t=new e.Mesh;if(!(l=a.DecodeBufferToMesh(s,t)).ok()||0===t.ptr)throw Error(l.error_msg());let r=t.num_faces(),i=3*r,u=4*i,c=e._malloc(u);try{a.GetTrianglesUInt32Array(t,u,c);let r=new Uint32Array(i);r.set(new Uint32Array(e.HEAPF32.buffer,c,i)),n(r)}finally{e._free(c)}o=t;break}case e.POINT_CLOUD:{let t=new e.PointCloud;if(!(l=a.DecodeBufferToPointCloud(s,t)).ok()||!t.ptr)throw Error(l.error_msg());o=t;break}default:throw Error(`Invalid geometry type ${u}`)}let c=o.num_points(),d=(t,r,n,a)=>{let s=a.data_type(),o=a.num_components(),l=a.normalized(),u=a.byte_stride(),d=a.byte_offset(),h={[e.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:e.HEAPF32},[e.DT_INT8]:{typedArrayConstructor:Int8Array,heap:e.HEAP8},[e.DT_INT16]:{typedArrayConstructor:Int16Array,heap:e.HEAP16},[e.DT_INT32]:{typedArrayConstructor:Int32Array,heap:e.HEAP32},[e.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:e.HEAPU8},[e.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:e.HEAPU16},[e.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:e.HEAPU32}}[s];if(!h)throw Error(`Invalid data type ${s}`);let f=c*o,p=f*h.typedArrayConstructor.BYTES_PER_ELEMENT,_=e._malloc(p);try{t.GetAttributeDataArrayForAllPoints(r,a,s,p,_);let e=new h.typedArrayConstructor(h.heap.buffer,_,f);i(n,e.slice(),o,d,u,l)}finally{e._free(_)}};if(r)for(let e in r){let t=r[e],n=a.GetAttributeByUniqueId(o,t);d(a,o,e,n)}else{let t={position:e.POSITION,normal:e.NORMAL,color:e.COLOR,uv:e.TEX_COORD};for(let e in t){let r=a.GetAttributeId(o,t[e]);if(-1!==r){let t=a.GetAttribute(o,r);d(a,o,e,t)}}}return c}finally{o&&e.destroy(o),s&&e.destroy(s),a&&e.destroy(a)}}function s(){let e;onmessage=t=>{let r=t.data;switch(r.id){case"init":r.url&&importScripts(r.url),e=DracoDecoderModule(r.wasmBinary?{wasmBinary:r.wasmBinary}:{}),postMessage({id:"initDone"});break;case"decodeMesh":if(!e)throw Error("Draco decoder module is not available");e.then(e=>{let t=a(e,r.dataView,r.attributes,e=>{postMessage({id:"indices",data:e},[e.buffer])},(e,t,r,n,i,a)=>{postMessage({id:"attribute",kind:e,data:t,size:r,byteOffset:n,byteStride:i,normalized:a},[t.buffer])});postMessage({id:"decodeMeshDone",totalVertices:t})})}}}async function o(e,t,r){return await new Promise((n,i)=>{let a=t=>{e.removeEventListener("error",a),e.removeEventListener("message",s),i(t)},s=t=>{"initDone"===t.data.id&&(e.removeEventListener("error",a),e.removeEventListener("message",s),n(e))};if(e.addEventListener("error",a),e.addEventListener("message",s),t){let n=t.slice(0);e.postMessage({id:"init",url:r,wasmBinary:n},[n])}else e.postMessage({id:"init",url:r})})}r.d(t,{Cx:()=>n,FO:()=>a,QW:()=>o,RF:()=>i,UZ:()=>s})},10645:function(e,t,r){r.d(t,{Z:()=>s});var n=r(9787),i=r(42826),a=r(22837);class s extends a.Z{constructor(e,t){var r;super(),this.name="",this.parent=null,this.enabled=!0,this.children=new Map,this.device=null,this.processors=[],e&&"object"==typeof e&&!t&&(t=e,e=void 0);let a=t||{},{processors:s,children:o,active:l}=a,u=(0,n._T)(a,["processors","children","active"]);if(r=this,u&&Object.keys(r).forEach(e=>{e in u&&"function"!=typeof r[e]&&(r[e]=u[e])}),this.device&&this.device.on("change",()=>{this.enabled&&this.emit("change")}),s)for(let e of s)this.processors.push(e);if(o)for(let[e,t]of Array.isArray(o)||o instanceof Map?o:Object.entries(o))this.children.set(e,t);let c=e||this.read.bind(this),d=()=>(0,i.Z)(this.processors,c());this.read=()=>this.enabled?d():Object.getPrototypeOf(this).constructor.defaultValue,"function"==typeof l&&(this.active=()=>l(this));let h=this.destroy;this.destroy=()=>{h(),this.children.forEach(e=>e.destroy())}}find(e){if(!e)return this;let t=e.indexOf("/");if(t>0){let r=e.substring(0,t),n=this.children.get(r);if(n)return n.find(e.substring(t+1))}return this.children.get(e)||null}read(){return Object.getPrototypeOf(this).constructor.defaultValue}magnitude(e=this.read()){return"number"==typeof e?Math.abs(e):0}active(){return this.magnitude()>0}}s.defaultValue=0},10884:function(e,t,r){var n=r(66755);let i="instancesVertex",a=`#ifdef INSTANCES
var finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=mat4x4<f32>(
vertexInputs.previousWorld0,vertexInputs.previousWorld1,
vertexInputs.previousWorld2,vertexInputs.previousWorld3);
#endif
#ifdef THIN_INSTANCES
#if !defined(WORLD_UBO)
finalWorld=uniforms.world*finalWorld;
#else
finalWorld=mesh.world*finalWorld;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
var finalWorld=uniforms.world;
#else
var finalWorld=mesh.world;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=uniforms.previousWorld;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},11329:function(e,t,r){var n=r(61834),i=r(70162);i.P.prototype._projectOnTrianglesToRef=function(e,t,r,i,a,s){let o=n.jp.Vector3["0"],l=n.jp.Vector3["1"],u=Infinity;for(let s=this.indexStart;s<this.indexStart+this.indexCount-(3-i);s+=i){let i=r[s],c=r[s+1],d=r[s+2];if(a&&0xffffffff===d){s+=2;continue}let h=t[i],f=t[c],p=t[d];if(!h||!f||!p)continue;let _=n.P.ProjectOnTriangleToRef(e,h,f,p,l);_<u&&(o.copyFrom(l),u=_)}return s.copyFrom(o),u},i.P.prototype._projectOnUnIndexedTrianglesToRef=function(e,t,r,i){let a=n.jp.Vector3["0"],s=n.jp.Vector3["1"],o=Infinity;for(let r=this.verticesStart;r<this.verticesStart+this.verticesCount;r+=3){let i=t[r],l=t[r+1],u=t[r+2],c=n.P.ProjectOnTriangleToRef(e,i,l,u,s);c<o&&(a.copyFrom(s),o=c)}return i.copyFrom(a),o},i.P.prototype.projectToRef=function(e,t,r,n){let i=this.getMaterial();if(!i)return -1;let a=3,s=!1;switch(i.fillMode){case 3:case 5:case 6:case 8:return -1;case 7:a=1,s=!0}return 4===i.fillMode?-1:!r.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(e,t,r,n):this._projectOnTrianglesToRef(e,t,r,a,s,n)}},11349:function(e,t,r){r.d(t,{F:()=>i});var n=r(9656);class i extends n.Q{constructor(e){super(e),this.out=this._registerSignalOutput("out")}}},1183:function(e,t,r){r.r(t),r.d(t,{gaussianSplattingVertexShaderWGSL:()=>l});var n=r(66755);r(27222),r(35140),r(85116),r(57955),r(19066),r(33083);let i="gaussianSplatting",a=`fn getDataUV(index: f32,dataTextureSize: vec2f)->vec2<f32> {let y: f32=floor(index/dataTextureSize.x);let x: f32=index-y*dataTextureSize.x;return vec2f((x+0.5),(y+0.5));}
struct Splat {center: vec4f,
color: vec4f,
covA: vec4f,
covB: vec4f,
#if SH_DEGREE>0
sh0: vec4<u32>,
#endif
#if SH_DEGREE>1
sh1: vec4<u32>,
#endif
#if SH_DEGREE>2
sh2: vec4<u32>,
#endif
};fn readSplat(splatIndex: f32,dataTextureSize: vec2f)->Splat {var splat: Splat;let splatUV=getDataUV(splatIndex,dataTextureSize);let splatUVi32=vec2<i32>(i32(splatUV.x),i32(splatUV.y));splat.center=textureLoad(centersTexture,splatUVi32,0);splat.color=textureLoad(colorsTexture,splatUVi32,0);splat.covA=textureLoad(covariancesATexture,splatUVi32,0)*splat.center.w;splat.covB=textureLoad(covariancesBTexture,splatUVi32,0)*splat.center.w;
#if SH_DEGREE>0
splat.sh0=textureLoad(shTexture0,splatUVi32,0);
#endif
#if SH_DEGREE>1
splat.sh1=textureLoad(shTexture1,splatUVi32,0);
#endif
#if SH_DEGREE>2
splat.sh2=textureLoad(shTexture2,splatUVi32,0);
#endif
return splat;}
fn computeColorFromSHDegree(dir: vec3f,sh: array<vec3<f32>,16>)->vec3f
{let SH_C0: f32=0.28209479;let SH_C1: f32=0.48860251;var SH_C2: array<f32,5>=array<f32,5>(
1.092548430,
-1.09254843,
0.315391565,
-1.09254843,
0.546274215
);var SH_C3: array<f32,7>=array<f32,7>(
-0.59004358,
2.890611442,
-0.45704579,
0.373176332,
-0.45704579,
1.445305721,
-0.59004358
);var result: vec3f=/*SH_C0**/sh[0];
#if SH_DEGREE>0
let x: f32=dir.x;let y: f32=dir.y;let z: f32=dir.z;result+=-SH_C1*y*sh[1]+SH_C1*z*sh[2]-SH_C1*x*sh[3];
#if SH_DEGREE>1
let xx: f32=x*x;let yy: f32=y*y;let zz: f32=z*z;let xy: f32=x*y;let yz: f32=y*z;let xz: f32=x*z;result+=
SH_C2[0]*xy*sh[4] +
SH_C2[1]*yz*sh[5] +
SH_C2[2]*(2.0f*zz-xx-yy)*sh[6] +
SH_C2[3]*xz*sh[7] +
SH_C2[4]*(xx-yy)*sh[8];
#if SH_DEGREE>2
result+=
SH_C3[0]*y*(3.0f*xx-yy)*sh[9] +
SH_C3[1]*xy*z*sh[10] +
SH_C3[2]*y*(4.0f*zz-xx-yy)*sh[11] +
SH_C3[3]*z*(2.0f*zz-3.0f*xx-3.0f*yy)*sh[12] +
SH_C3[4]*x*(4.0f*zz-xx-yy)*sh[13] +
SH_C3[5]*z*(xx-yy)*sh[14] +
SH_C3[6]*x*(xx-3.0f*yy)*sh[15];
#endif
#endif
#endif
return result;}
fn decompose(value: u32)->vec4f
{let components : vec4f=vec4f(
f32((value ) & 255u),
f32((value>>u32( 8)) & 255u),
f32((value>>u32(16)) & 255u),
f32((value>>u32(24)) & 255u));return components*vec4f(2./255.)-vec4f(1.);}
fn computeSH(splat: Splat,dir: vec3f)->vec3f
{var sh: array<vec3<f32>,16>;sh[0]=vec3f(0.,0.,0.);
#if SH_DEGREE>0
let sh00: vec4f=decompose(splat.sh0.x);let sh01: vec4f=decompose(splat.sh0.y);let sh02: vec4f=decompose(splat.sh0.z);sh[1]=vec3f(sh00.x,sh00.y,sh00.z);sh[2]=vec3f(sh00.w,sh01.x,sh01.y);sh[3]=vec3f(sh01.z,sh01.w,sh02.x);
#endif
#if SH_DEGREE>1
let sh03: vec4f=decompose(splat.sh0.w);let sh04: vec4f=decompose(splat.sh1.x);let sh05: vec4f=decompose(splat.sh1.y);sh[4]=vec3f(sh02.y,sh02.z,sh02.w);sh[5]=vec3f(sh03.x,sh03.y,sh03.z);sh[6]=vec3f(sh03.w,sh04.x,sh04.y);sh[7]=vec3f(sh04.z,sh04.w,sh05.x);sh[8]=vec3f(sh05.y,sh05.z,sh05.w);
#endif
#if SH_DEGREE>2
let sh06: vec4f=decompose(splat.sh1.z);let sh07: vec4f=decompose(splat.sh1.w);let sh08: vec4f=decompose(splat.sh2.x);let sh09: vec4f=decompose(splat.sh2.y);let sh10: vec4f=decompose(splat.sh2.z);let sh11: vec4f=decompose(splat.sh2.w);sh[9]=vec3f(sh06.x,sh06.y,sh06.z);sh[10]=vec3f(sh06.w,sh07.x,sh07.y);sh[11]=vec3f(sh07.z,sh07.w,sh08.x);sh[12]=vec3f(sh08.y,sh08.z,sh08.w);sh[13]=vec3f(sh09.x,sh09.y,sh09.z);sh[14]=vec3f(sh09.w,sh10.x,sh10.y);sh[15]=vec3f(sh10.z,sh10.w,sh11.x); 
#endif
return computeColorFromSHDegree(dir,sh);}
fn gaussianSplatting(
meshPos: vec2<f32>,
worldPos: vec3<f32>,
scale: vec2<f32>,
covA: vec3<f32>,
covB: vec3<f32>,
worldMatrix: mat4x4<f32>,
viewMatrix: mat4x4<f32>,
projectionMatrix: mat4x4<f32>,
focal: vec2f,
invViewport: vec2f,
kernelSize: f32
)->vec4f {let modelView=viewMatrix*worldMatrix;let camspace=viewMatrix*vec4f(worldPos,1.0);let pos2d=projectionMatrix*camspace;let bounds=1.2*pos2d.w;if (pos2d.z<0. || pos2d.x<-bounds || pos2d.x>bounds || pos2d.y<-bounds || pos2d.y>bounds) {return vec4f(0.0,0.0,2.0,1.0);}
let Vrk=mat3x3<f32>(
covA.x,covA.y,covA.z,
covA.y,covB.x,covB.y,
covA.z,covB.y,covB.z
);let J=mat3x3<f32>(
focal.x/camspace.z,0.0,-(focal.x*camspace.x)/(camspace.z*camspace.z),
0.0,focal.y/camspace.z,-(focal.y*camspace.y)/(camspace.z*camspace.z),
0.0,0.0,0.0
);let invy=mat3x3<f32>(
1.0,0.0,0.0,
0.0,-1.0,0.0,
0.0,0.0,1.0
);let T=invy*transpose(mat3x3<f32>(
modelView[0].xyz,
modelView[1].xyz,
modelView[2].xyz))*J;var cov2d=transpose(T)*Vrk*T;
#if COMPENSATION
let c00: f32=cov2d[0][0];let c11: f32=cov2d[1][1];let c01: f32=cov2d[0][1];let detOrig: f32=c00*c11-c01*c01;
#endif
cov2d[0][0]+=kernelSize;cov2d[1][1]+=kernelSize;
#if COMPENSATION
let c2d: vec3f=vec3f(cov2d[0][0],c01,cov2d[1][1]);let detBlur: f32=c2d.x*c2d.z-c2d.y*c2d.y;let compensation: f32=sqrt(max(0.,detOrig/detBlur));vertexOutputs.vColor.w*=compensation;
#endif
let mid=(cov2d[0][0]+cov2d[1][1])/2.0;let radius=length(vec2<f32>((cov2d[0][0]-cov2d[1][1])/2.0,cov2d[0][1]));let lambda1=mid+radius;let lambda2=mid-radius;if (lambda2<0.0) {return vec4f(0.0,0.0,2.0,1.0);}
let diagonalVector=normalize(vec2<f32>(cov2d[0][1],lambda1-cov2d[0][0]));let majorAxis=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;let minorAxis=min(sqrt(2.0*lambda2),1024.0)*vec2<f32>(diagonalVector.y,-diagonalVector.x);let vCenter=vec2<f32>(pos2d.x,pos2d.y);return vec4f(
vCenter+((meshPos.x*majorAxis+meshPos.y*minorAxis)*invViewport*pos2d.w)*scale,
pos2d.z,
pos2d.w
);}
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a),r(31440),r(80014),r(37161);let s="gaussianSplattingVertexShader",o=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
#include<helperFunctions>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
attribute splatIndex: f32;attribute position: vec2f;uniform invViewport: vec2f;uniform dataTextureSize: vec2f;uniform focal: vec2f;uniform kernelSize: f32;uniform eyePosition: vec3f;var covariancesATexture: texture_2d<f32>;var covariancesBTexture: texture_2d<f32>;var centersTexture: texture_2d<f32>;var colorsTexture: texture_2d<f32>;
#if SH_DEGREE>0
var shTexture0: texture_2d<u32>;
#endif
#if SH_DEGREE>1
var shTexture1: texture_2d<u32>;
#endif
#if SH_DEGREE>2
var shTexture2: texture_2d<u32>;
#endif
varying vColor: vec4f;varying vPosition: vec2f;
#include<gaussianSplatting>
@vertex
fn main(input : VertexInputs)->FragmentInputs {var splat: Splat=readSplat(input.splatIndex,uniforms.dataTextureSize);var covA: vec3f=splat.covA.xyz;var covB: vec3f=vec3f(splat.covA.w,splat.covB.xy);let worldPos: vec4f=mesh.world*vec4f(splat.center.xyz,1.0);vertexOutputs.vPosition=input.position;
#if SH_DEGREE>0
let worldRot: mat3x3f= mat3x3f(mesh.world[0].xyz,mesh.world[1].xyz,mesh.world[2].xyz);let normWorldRot: mat3x3f=inverseMat3(worldRot);var dir: vec3f=normalize(normWorldRot*(worldPos.xyz-uniforms.eyePosition.xyz));dir*=vec3f(1.,1.,-1.); 
vertexOutputs.vColor=vec4f(splat.color.xyz+computeSH(splat,dir),splat.color.w);
#else
vertexOutputs.vColor=splat.color;
#endif
vertexOutputs.position=gaussianSplatting(input.position,worldPos.xyz,vec2f(1.0,1.0),covA,covB,mesh.world,scene.view,scene.projection,uniforms.focal,uniforms.invViewport,uniforms.kernelSize);
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
}
`;n.v.ShadersStoreWGSL[s]||(n.v.ShadersStoreWGSL[s]=o);let l={name:s,shader:o}},1241:function(e,t,r){var n=r(66755);let i="fogFragment",a=`#ifdef FOG
float fog=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color.rgb=mix(vFogColor,color.rgb,fog);
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},1336:function(e,t,r){var n=r(51577),i=r(31913),a=r(61834),s=r(88280),o=r(57271);n.Kj.prototype.thinInstanceAdd=function(e,t=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return s.Y.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);let r=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(let r=0;r<e.length;++r)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[r],r===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return r},n.Kj.prototype.thinInstanceAddSelf=function(e=!0){return this.thinInstanceAdd(a.y3.IdentityReadOnly,e)},n.Kj.prototype.thinInstanceRegisterAttribute=function(e,t){e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new i.o(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},n.Kj.prototype.thinInstanceSetMatrixAt=function(e,t,r=!0){if(!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;let n=this._thinInstanceDataStorage.matrixData;return t.copyToArray(n,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),r&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},n.Kj.prototype.thinInstanceSetAttributeAt=function(e,t,r,n=!0){return e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),!!this._userThinInstanceBuffersStorage&&!!this._userThinInstanceBuffersStorage.data[e]&&!(t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(r,t*this._userThinInstanceBuffersStorage.strides[e]),n&&this.thinInstanceBufferUpdated(e),!0)},Object.defineProperty(n.Kj.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){let t=this._thinInstanceDataStorage.matrixData??this.source?._thinInstanceDataStorage.matrixData;e<=(t?t.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),n.Kj.prototype._thinInstanceCreateMatrixBuffer=function(e,t,r=!0){let n=new i.l(this.getEngine(),t,!r,16,!1,!0);for(let t=0;t<4;t++)this.setVerticesBuffer(n.createVertexBuffer(e+t,4*t,4));return n},n.Kj.prototype.thinInstanceSetBuffer=function(e,t,r=0,n=!0){r=r||16,"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*r,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/r,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,n),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===e?(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,n))):(e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),null===t?this._userThinInstanceBuffersStorage?.data[e]&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=r,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new i.o(this.getEngine(),t,e,!n,!1,r,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])))},n.Kj.prototype.thinInstanceBufferUpdated=function(e){"matrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):"previousMatrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.previousMatrixBuffer?.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[e].isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0)))},n.Kj.prototype.thinInstancePartialBufferUpdate=function(e,t,r){"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,r):(e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,r))},n.Kj.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];let e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=a.y3.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},n.Kj.prototype.thinInstanceRefreshBoundingInfo=function(e=!1,t=!1,r=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;let n=this._thinInstanceDataStorage.boundingVectors;if(e||!this.rawBoundingInfo){n.length=0,this.refreshBoundingInfo(t,r);let e=this.getBoundingInfo();this.rawBoundingInfo=new o.j(e.minimum,e.maximum)}let i=this.getBoundingInfo(),s=this._thinInstanceDataStorage.matrixData;if(0===n.length)for(let e=0;e<i.boundingBox.vectors.length;++e)n.push(i.boundingBox.vectors[e].clone());a.jp.Vector3["0"].setAll(Number.POSITIVE_INFINITY),a.jp.Vector3["1"].setAll(Number.NEGATIVE_INFINITY);for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e){a.y3.FromArrayToRef(s,16*e,a.jp.Matrix["0"]);for(let e=0;e<n.length;++e)a.P.TransformCoordinatesToRef(n[e],a.jp.Matrix["0"],a.jp.Vector3["2"]),a.jp.Vector3["0"].minimizeInPlace(a.jp.Vector3["2"]),a.jp.Vector3["1"].maximizeInPlace(a.jp.Vector3["2"])}i.reConstruct(a.jp.Vector3["0"],a.jp.Vector3["1"]),this._updateBoundingInfo()},n.Kj.prototype._thinInstanceRecreateBuffer=function(e,t=!0){"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t)):"previousMatrix"===e?this._scene.needsPreviousWorldMatrices&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)):(e===i.o.ColorKind&&(e=i.o.ColorInstanceKind),this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new i.o(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!t,!1,this._userThinInstanceBuffersStorage.strides[e],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},n.Kj.prototype._thinInstanceUpdateBufferSize=function(e,t=1){e===i.o.ColorKind&&(e=i.o.ColorInstanceKind);let r="matrix"===e;if(!r&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[e]))return;let n=r?16:this._userThinInstanceBuffersStorage.strides[e],a=r?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e],s=r?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e],o=(this._thinInstanceDataStorage.instancesCount+t)*n,l=a;for(;l<o;)l*=2;if(!s||a!=l){if(s){let e=new Float32Array(l);e.set(s,0),s=e}else s=new Float32Array(l);r?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",s,!1),this._thinInstanceDataStorage.matrixData=s,this._thinInstanceDataStorage.matrixBufferSize=l,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",s,!1))):(this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.data[e]=s,this._userThinInstanceBuffersStorage.sizes[e]=l,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new i.o(this.getEngine(),s,e,!0,!1,n,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}},n.Kj.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},n.Kj.prototype._disposeThinInstanceSpecificData=function(){this._thinInstanceDataStorage?.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},13692:function(e,t,r){r.d(t,{w:()=>i});var n=r(88280);class i{constructor(e,t,r){this._record=!1,this._play=!1,this._playBundleListIndex=0,this._allBundleLists=[],this._enabled=!1,this.showDebugLogs=!1,this._engine=e,this._mode=t,this._bundleList=r}get enabled(){return this._enabled}get play(){return this._play}get record(){return this._record}set enabled(e){this._log("enabled",`activate=${e}, mode=${this._mode}`),this._allBundleLists.length=0,this._record=this._enabled=e,this._play=!1,e&&(this._modeSaved=this._mode,this._mode=0)}get mode(){return this._mode}set mode(e){this._record?this._modeSaved=e:this._mode=e}endRenderPass(e){if(!this._record&&!this._play)return!1;let t=null;return this._record?(t=this._bundleList.clone(),this._allBundleLists.push(t),this._bundleList.reset(),this._log("endRenderPass",`bundleList recorded at position #${this._allBundleLists.length-1}`)):this._playBundleListIndex>=this._allBundleLists.length?this._log("endRenderPass",`empty or out-of-sync bundleList (_allBundleLists.length=${this._allBundleLists.length}, playBundleListIndex=${this._playBundleListIndex})`):(this._log("endRenderPass",`run bundleList #${this._playBundleListIndex}`),t=this._allBundleLists[this._playBundleListIndex++]),t&&(t.run(e),1===this._mode&&this._engine._reportDrawCall(t.numDrawCalls)),!0}endFrame(){this._record&&(this._record=!1,this._play=!0,this._mode=this._modeSaved,this._log("endFrame","bundles recorded, switching to play mode")),this._playBundleListIndex=0}reset(){this._log("reset","called"),this._record&&(this._mode=this._modeSaved),this.enabled=!1,this.enabled=!0}_log(e,t){this.showDebugLogs&&n.Y.Log(`[Frame: ${this._engine.frameId}] WebGPUSnapshotRendering:${e} - ${t}`)}}},14210:function(e,t,r){r.r(t),r.d(t,{bonesDeclarationWGSL:()=>s});var n=r(66755);let i="bonesDeclaration",a=`#if NUM_BONE_INFLUENCERS>0
attribute matricesIndices : vec4<f32>;attribute matricesWeights : vec4<f32>;
#if NUM_BONE_INFLUENCERS>4
attribute matricesIndicesExtra : vec4<f32>;attribute matricesWeightsExtra : vec4<f32>;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
var boneSampler : texture_2d<f32>;uniform boneTextureWidth : f32;
#else
uniform mBones : array<mat4x4f,BonesPerMesh>;
#ifdef BONES_VELOCITY_ENABLED
uniform mPreviousBones : array<mat4x4f,BonesPerMesh>;
#endif
#endif
#ifdef BONETEXTURE
fn readMatrixFromRawSampler(smp : texture_2d<f32>,index : f32)->mat4x4f
{let offset=i32(index) *4; 
let m0=textureLoad(smp,vec2<i32>(offset+0,0),0);let m1=textureLoad(smp,vec2<i32>(offset+1,0),0);let m2=textureLoad(smp,vec2<i32>(offset+2,0),0);let m3=textureLoad(smp,vec2<i32>(offset+3,0),0);return mat4x4f(m0,m1,m2,m3);}
#endif
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},14465:function(e,t,r){var n=r(90481),i=r(88280),a=r(34504);function s(e,t,r,n){let i,a=1;1===n?i=new Float32Array(t*r*4):2===n?(i=new Uint16Array(t*r*4),a=15360):i=7===n?new Uint32Array(t*r*4):new Uint8Array(t*r*4);for(let n=0;n<t;n++)for(let s=0;s<r;s++){let r=(s*t+n)*3,o=(s*t+n)*4;i[o+0]=e[r+0],i[o+1]=e[r+1],i[o+2]=e[r+2],i[o+3]=a}return i}a.q.prototype.createRawTexture=function(e,t,r,i,a,s,o,l=null,u=0,c=0,d=!1){let h=new n.l(this,3);return h.baseWidth=t,h.baseHeight=r,h.width=t,h.height=r,h.format=i,h.generateMipMaps=a,h.samplingMode=o,h.invertY=s,h._compression=l,h.type=u,h._creationFlags=c,h._useSRGBBuffer=d,this._doNotHandleContextLost||(h._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(h,t,r,void 0,c),this.updateRawTexture(h,e,i,s,l,u,d),this._internalTexturesCache.push(h),h},a.q.prototype.updateRawTexture=function(e,t,r,n,i=null,a=0,o=!1){if(e){if(this._doNotHandleContextLost||(e._bufferView=t,e.invertY=n,e._compression=i,e._useSRGBBuffer=o),t){let i=e._hardwareTexture;4===r&&(t=s(t,e.width,e.height,a));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,i.format,0,0,n,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0}},a.q.prototype.createRawCubeTexture=function(e,t,r,a,s,o,l,u=null){let c=new n.l(this,8);return 1!==a||this._caps.textureFloatLinearFiltering?2!==a||this._caps.textureHalfFloatLinearFiltering?1!==a||this._caps.textureFloatRender?2!==a||this._caps.colorBufferFloat||(s=!1,i.Y.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(s=!1,i.Y.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(s=!1,l=1,i.Y.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(s=!1,l=1,i.Y.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")),c.isCube=!0,c._originalFormat=r,c.format=4===r?5:r,c.type=a,c.generateMipMaps=s,c.width=t,c.height=t,c.samplingMode=l,this._doNotHandleContextLost||(c._bufferViewArray=e),c.invertY=o,c._compression=u,c._cachedWrapU=0,c._cachedWrapV=0,this._textureHelper.createGPUTextureForInternalTexture(c),4===r&&(c._hardwareTexture._originalFormatIsRGB=!0),e&&this.updateRawCubeTexture(c,e,r,a,o,u),c.isReady=!0,c},a.q.prototype.updateRawCubeTexture=function(e,t,r,n,i,a=null){e._bufferViewArray=t,e.invertY=i,e._compression=a;let o=e._hardwareTexture,l=o._originalFormatIsRGB,u=[0,2,4,1,3,5],c=[];for(let r=0;r<t.length;++r){let i=t[u[r]];l&&(i=s(i,e.width,e.height,n)),c.push(new Uint8Array(i.buffer,i.byteOffset,i.byteLength))}this._textureHelper.updateCubeTextures(c,o.underlyingResource,e.width,e.height,o.format,i,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0},a.q.prototype.createRawCubeTextureFromUrl=function(e,t,r,n,i,a,o,l,u=null,c=null,d=3,h=!1){let f=this.createRawCubeTexture(null,r,n,i,!a,h,d,null);t?.addPendingData(f),f.url=e,f.isReady=!1,this._internalTexturesCache.push(f);let p=e=>{let r=f.width,a=o(e);if(a){if(l){let e=4===n,t=l(a),o=f._hardwareTexture,u=[0,1,2,3,4,5];for(let n=0;n<t.length;n++){let a=r>>n,l=[];for(let r=0;r<6;r++){let o=t[n][u[r]];e&&(o=s(o,a,a,i)),l.push(new Uint8Array(o.buffer,o.byteOffset,o.byteLength))}this._textureHelper.updateCubeTextures(l,o.underlyingResource,a,a,o.format,h,!1,0,0)}}else this.updateRawCubeTexture(f,a,n,i,h);f.isReady=!0,t?.removePendingData(f),u&&u()}};return this._loadFile(e,e=>{p(e)},void 0,t?.offlineProvider,!0,(e,r)=>{t?.removePendingData(f),c&&e&&c(e.status+" "+e.statusText,r)}),f},a.q.prototype.createRawTexture3D=function(e,t,r,i,a,s,o,l,u=null,c=0,d=0){let h=new n.l(this,10);return h.baseWidth=t,h.baseHeight=r,h.baseDepth=i,h.width=t,h.height=r,h.depth=i,h.format=a,h.type=c,h.generateMipMaps=s,h.samplingMode=l,h.is3D=!0,h._creationFlags=d,this._doNotHandleContextLost||(h._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(h,t,r,void 0,d),this.updateRawTexture3D(h,e,a,o,u,c),this._internalTexturesCache.push(h),h},a.q.prototype.updateRawTexture3D=function(e,t,r,n,i=null,a=0){if(this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=n,e._compression=i),t){let i=e._hardwareTexture;4===r&&(t=s(t,e.width,e.height,a));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,i.format,0,0,n,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0},a.q.prototype.createRawTexture2DArray=function(e,t,r,i,a,s,o,l,u=null,c=0,d=0){let h=new n.l(this,11);return h.baseWidth=t,h.baseHeight=r,h.baseDepth=i,h.width=t,h.height=r,h.depth=i,h.format=a,h.type=c,h.generateMipMaps=s,h.samplingMode=l,h.is2DArray=!0,h._creationFlags=d,this._doNotHandleContextLost||(h._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(h,t,r,i,d),this.updateRawTexture2DArray(h,e,a,o,u,c),this._internalTexturesCache.push(h),h},a.q.prototype.updateRawTexture2DArray=function(e,t,r,n,i=null,a=0){if(this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=n,e._compression=i),t){let i=e._hardwareTexture;4===r&&(t=s(t,e.width,e.height,a));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,i.format,0,0,n,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0}},14829:function(e,t,r){function n(e,t){let r=t?.jsDecoderModule||KTX2DECODER;e&&(e.wasmUASTCToASTC&&(r.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7&&(r.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM&&(r.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB&&(r.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.wasmUASTCToR8_UNORM&&(r.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=e.wasmUASTCToR8_UNORM),e.wasmUASTCToRG8_UNORM&&(r.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=e.wasmUASTCToRG8_UNORM),e.jsMSCTranscoder&&(r.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder&&(r.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),e.wasmZSTDDecoder&&(r.ZSTDDecoder.WasmModuleURL=e.wasmZSTDDecoder)),t&&(t.wasmUASTCToASTC&&(r.LiteTranscoder_UASTC_ASTC.WasmBinary=t.wasmUASTCToASTC),t.wasmUASTCToBC7&&(r.LiteTranscoder_UASTC_BC7.WasmBinary=t.wasmUASTCToBC7),t.wasmUASTCToRGBA_UNORM&&(r.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=t.wasmUASTCToRGBA_UNORM),t.wasmUASTCToRGBA_SRGB&&(r.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=t.wasmUASTCToRGBA_SRGB),t.wasmUASTCToR8_UNORM&&(r.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=t.wasmUASTCToR8_UNORM),t.wasmUASTCToRG8_UNORM&&(r.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=t.wasmUASTCToRG8_UNORM),t.jsMSCTranscoder&&(r.MSCTranscoder.JSModule=t.jsMSCTranscoder),t.wasmMSCTranscoder&&(r.MSCTranscoder.WasmBinary=t.wasmMSCTranscoder),t.wasmZSTDDecoder&&(r.ZSTDDecoder.WasmBinary=t.wasmZSTDDecoder))}function i(e){let t;void 0===e&&"undefined"!=typeof KTX2DECODER&&(e=KTX2DECODER),onmessage=r=>{if(r.data)switch(r.data.action){case"init":{let i=r.data.urls;i&&(i.jsDecoderModule&&void 0===e&&(importScripts(i.jsDecoderModule),e=KTX2DECODER),n(i)),r.data.wasmBinaries&&n(void 0,{...r.data.wasmBinaries,jsDecoderModule:e}),t=new e.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":e.KTX2Decoder.DefaultDecoderOptions=r.data.options;break;case"decode":t.decode(r.data.data,r.data.caps,r.data.options).then(e=>{let t=[];for(let r=0;r<e.mipmaps.length;++r){let n=e.mipmaps[r];n&&n.data&&t.push(n.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:e},t)}).catch(e=>{postMessage({action:"decoded",success:!1,msg:e})})}}}async function a(e,t,r){return await new Promise((n,i)=>{let a=t=>{e.removeEventListener("error",a),e.removeEventListener("message",s),i(t)},s=t=>{"init"===t.data.action&&(e.removeEventListener("error",a),e.removeEventListener("message",s),n(e))};e.addEventListener("error",a),e.addEventListener("message",s),e.postMessage({action:"init",urls:r,wasmBinaries:t})})}r.d(t,{AG:()=>i,QW:()=>a,mg:()=>n})},15386:function(e,t,r){r.d(t,{$6:()=>_,DG:()=>m,Es:()=>f,Qq:()=>p,W:()=>g,kt:()=>h,vU:()=>y});var n=r(61834),i=r(57423),a=r(51577),s=r(91149),o=r(85296),l=r(70541),u=r(65098),c=r(49087),d=r(5902);function h(e){let t,r,i=[],a=[],o=[],l=[],u=e.width||e.size||1,c=e.height||e.size||1,h=0|(e.subdivisionsX||e.subdivisions||1),f=0|(e.subdivisionsY||e.subdivisions||1);for(t=0;t<=f;t++)for(r=0;r<=h;r++){let e=new n.P(r*u/h-u/2,0,(f-t)*c/f-c/2),i=new n.P(0,1,0);a.push(e.x,e.y,e.z),o.push(i.x,i.y,i.z),l.push(r/h,d.VJ?t/f:1-t/f)}for(t=0;t<f;t++)for(r=0;r<h;r++)i.push(r+1+(t+1)*(h+1)),i.push(r+1+t*(h+1)),i.push(r+t*(h+1)),i.push(r+(t+1)*(h+1)),i.push(r+1+(t+1)*(h+1)),i.push(r+t*(h+1));let p=new s.x;return p.indices=i,p.positions=a,p.normals=o,p.uvs=l,p}function f(e){let t,r,i,a,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,l=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,u=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,c=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,d=e.subdivisions||{w:1,h:1},h=e.precision||{w:1,h:1},f=[],p=[],_=[],m=[];d.h=d.h<1?1:d.h,d.w=d.w<1?1:d.w,h.w=h.w<1?1:h.w,h.h=h.h<1?1:h.h;let g={w:(u-o)/d.w,h:(c-l)/d.h};for(i=0;i<d.h;i++)for(a=0;a<d.w;a++)!function(e,i,a,s){let o=p.length/3,l=h.w+1;for(t=0;t<h.h;t++)for(r=0;r<h.w;r++){let e=[o+r+t*l,o+(r+1)+t*l,o+(r+1)+(t+1)*l,o+r+(t+1)*l];f.push(e[1]),f.push(e[2]),f.push(e[3]),f.push(e[0]),f.push(e[1]),f.push(e[3])}let u=n.P.Zero(),c=new n.P(0,1,0);for(t=0;t<=h.h;t++)for(r=0,u.z=t*(s-i)/h.h+i;r<=h.w;r++)u.x=r*(a-e)/h.w+e,u.y=0,p.push(u.x,u.y,u.z),_.push(c.x,c.y,c.z),m.push(r/h.w,t/h.h)}(o+a*g.w,l+i*g.h,o+(a+1)*g.w,l+(i+1)*g.h);let y=new s.x;return y.indices=f,y.positions=p,y.normals=_,y.uvs=m,y}function p(e){let t,r,a=[],o=[],l=[],u=[],d=e.colorFilter||new i.Wo(.3,.59,.11),h=e.alphaFilter||0,f=!1;if(e.minHeight>e.maxHeight){f=!0;let t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(t=0;t<=e.subdivisions;t++)for(r=0;r<=e.subdivisions;r++){let i=new n.P(r*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),a=(((i.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(i.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth)*4,s=e.buffer[a]/255,p=e.buffer[a+1]/255,_=e.buffer[a+2]/255,m=e.buffer[a+3]/255;f&&(s=1-s,p=1-p,_=1-_);let g=s*d.r+p*d.g+_*d.b;m>=h?i.y=e.minHeight+(e.maxHeight-e.minHeight)*g:i.y=e.minHeight-c.kn,e.heightBuffer&&(e.heightBuffer[t*(e.subdivisions+1)+r]=i.y),o.push(i.x,i.y,i.z),l.push(0,0,0),u.push(r/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(r=0;r<e.subdivisions;r++){let n=r+1+(t+1)*(e.subdivisions+1),i=r+1+t*(e.subdivisions+1),s=r+t*(e.subdivisions+1),l=r+(t+1)*(e.subdivisions+1),u=o[3*n+1]>=e.minHeight,c=o[3*i+1]>=e.minHeight,d=o[3*s+1]>=e.minHeight;u&&c&&d&&(a.push(n),a.push(i),a.push(s)),o[3*l+1]>=e.minHeight&&u&&d&&(a.push(l),a.push(n),a.push(s))}s.x.ComputeNormals(o,a,l);let p=new s.x;return p.indices=a,p.positions=o,p.normals=l,p.uvs=u,p}function _(e,t={},r){let n=new o.E(e,r);return n._setReady(!1),n._subdivisionsX=t.subdivisionsX||t.subdivisions||1,n._subdivisionsY=t.subdivisionsY||t.subdivisions||1,n._width=t.width||1,n._height=t.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,h(t).applyToMesh(n,t.updatable),n._setReady(!0),n}function m(e,t,r=null){let n=new a.Kj(e,r);return f(t).applyToMesh(n,t.updatable),n}function g(e,t,r={},n=null){let a,s=r.width||10,c=r.height||10,d=r.subdivisions||1,h=r.minHeight||0,f=r.maxHeight||1,_=r.colorFilter||new i.Wo(.3,.59,.11),m=r.alphaFilter||0,y=r.updatable,v=r.onReady;n=n||u.l.LastCreatedScene;let b=new o.E(e,n);b._subdivisionsX=d,b._subdivisionsY=d,b._width=s,b._height=c,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ,b._setReady(!1),r.passHeightBufferInCallback&&(a=new Float32Array((d+1)*(d+1)));let x=(e,t,r)=>{p({width:s,height:c,subdivisions:d,minHeight:h,maxHeight:f,colorFilter:_,buffer:e,bufferWidth:t,bufferHeight:r,alphaFilter:m,heightBuffer:a}).applyToMesh(b,y),v&&v(b,a),b._setReady(!0)};return"string"==typeof t?l.w1.LoadImage(t,e=>{let t=e.width,r=e.height;n.isDisposed||x(n?.getEngine().resizeImageBitmap(e,t,r),t,r)},r.onError?r.onError:()=>{},n.offlineProvider):x(t.data,t.width,t.height),b}let y={CreateGround:_,CreateGroundFromHeightMap:g,CreateTiledGround:m};s.x.CreateGround=h,s.x.CreateTiledGround=f,s.x.CreateGroundFromHeightMap=p,a.Kj.CreateGround=(e,t,r,n,i,a)=>_(e,{width:t,height:r,subdivisions:n,updatable:a},i),a.Kj.CreateTiledGround=(e,t,r,n,i,a,s,o,l)=>m(e,{xmin:t,zmin:r,xmax:n,zmax:i,subdivisions:a,precision:s,updatable:l},o),a.Kj.CreateGroundFromHeightMap=(e,t,r,n,i,a,s,o,l,u,c)=>g(e,t,{width:r,height:n,subdivisions:i,minHeight:a,maxHeight:s,updatable:l,onReady:u,alphaFilter:c},o)},16042:function(e,t,r){r.d(t,{K:()=>i});var n=r(3527);class i extends n.k{constructor(e){super(!1),this._cache=e,this.reset()}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0,this._cache.setDepthBias(e))}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(e??1))}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(e??2))}reset(){super.reset(),this._cache.resetDepthCullingState()}apply(){}}},16091:function(e,t,r){r.d(t,{x:()=>a});var n=r(46363),i=r(99151);class a extends i.c{constructor(e){super(e)}getClassName(){return"DivideBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} / ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.DivideBlock",a)},1629:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexGlobal:()=>s});var n=r(66755);let i="morphTargetsVertexGlobal",a=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
float vertexID;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},16397:function(e,t,r){r.r(t),r.d(t,{clipPlaneVertexDeclaration:()=>s});var n=r(66755);let i="clipPlaneVertexDeclaration",a=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;varying float fClipDistance6;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},16628:function(e,t,r){r.d(t,{l:()=>n});class n{get animationStarted(){return this._animationStarted}get fromIndex(){return this._fromIndex}get toIndex(){return this._toIndex}get loopAnimation(){return this._loopAnimation}get delay(){return Math.max(this._delay,1)}constructor(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}playAnimation(e,t,r,n,i){this._fromIndex=e,this._toIndex=t,this._loopAnimation=r,this._delay=n||1,this._animationStarted=!0,this._onBaseAnimationEnd=i,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0}stopAnimation(){this._animationStarted=!1}_animate(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))}}},17039:function(e,t,r){r.d(t,{p:()=>l});var n=r(82961),i=r(72384),a=r(80405),s=r(45615),o=r(65098);(0,r(29257).PS)(a.l.NAME_EFFECTLAYER,(e,t,r,n)=>{if(e.effectLayers){r.effectLayers||(r.effectLayers=[]);for(let i=0;i<e.effectLayers.length;i++){let a=s.w.Parse(e.effectLayers[i],t,n);r.effectLayers.push(a)}}}),i.x.prototype.removeEffectLayer=function(e){let t=this.effectLayers.indexOf(e);return -1!==t&&this.effectLayers.splice(t,1),t},i.x.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};class l{constructor(e){if(this.name=a.l.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e||o.l.LastCreatedScene,!this.scene)return;this._engine=this.scene.getEngine()}register(){this.scene._isReadyForMeshStage.registerStep(a.l.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(a.l.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(a.l.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(a.l.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(a.l.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(a.l.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)}rebuild(){for(let e of this.scene.effectLayers)e._rebuild()}serialize(e){for(let t of(e.effectLayers=[],this.scene.effectLayers))t.serialize&&e.effectLayers.push(t.serialize())}addFromContainer(e){if(e.effectLayers)for(let t of e.effectLayers)this.scene.addEffectLayer(t)}removeFromContainer(e,t){if(e.effectLayers)for(let r of e.effectLayers)this.scene.removeEffectLayer(r),t&&r.dispose()}dispose(){let e=this.scene.effectLayers;for(;e.length;)e[0].dispose()}_isReadyForMesh(e,t){let r=this._engine.currentRenderPassId;for(let n of this.scene.effectLayers){if(!n.hasMesh(e))continue;let i=n._mainTexture;for(let a of(this._engine.currentRenderPassId=i.renderPassId,e.subMeshes))if(!n.isReady(a,t))return this._engine.currentRenderPassId=r,!1}return this._engine.currentRenderPassId=r,!0}_renderMainTexture(e){this._renderEffects=!1,this._needStencil=!1;let t=!1,r=this.scene.effectLayers;if(r&&r.length>0){for(let i of(this._previousStencilState=this._engine.getStencilBuffer(),r))if(i.shouldRender()&&(!i.camera||i.camera.cameraRigMode===n.V.RIG_MODE_NONE&&e===i.camera||i.camera.cameraRigMode!==n.V.RIG_MODE_NONE&&i.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||i.needStencil();let e=i._mainTexture;e._shouldRender()&&(this.scene.incrementRenderId(),e.render(!1,!1),t=!0)}this.scene.incrementRenderId()}return t}_setStencil(){this._needStencil&&this._engine.setStencilBuffer(!0)}_setStencilBack(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)}_draw(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);let t=this.scene.effectLayers;for(let r=0;r<t.length;r++){let n=t[r];n.renderingGroupId===e&&n.shouldRender()&&n.render()}this._engine.setDepthBuffer(!0)}}_drawCamera(){this._renderEffects&&this._draw(-1)}_drawRenderingGroup(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)}}s.w._SceneComponentInitialization=e=>{let t=e._getComponent(a.l.NAME_EFFECTLAYER);t||(t=new l(e),e._addComponent(t))}},1725:function(e,t,r){r.d(t,{S:()=>a});var n=r(46363),i=r(99151);class a extends i.c{constructor(e){super(e)}getClassName(){return"AddBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} + ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.AddBlock",a)},1812:function(e,t,r){r.d(t,{Z:()=>f});var n=r(96368),i=r(44976),a=r(81997),s=r(93014),o=r(62083);let l={leftMouseButton:{device:"mouse",index:0},touch:{device:"touch",index:0},penTip:{device:"pen",index:0},middleMouseButton:{device:"mouse",index:1},rightMouseButton:{device:"mouse",index:2},penBarrelButton:{device:"pen",index:2},mouseBackButton:{device:"mouse",index:3},mouseForwardButton:{device:"mouse",index:4},penEraser:{device:"pen",index:5}},u=[],c=new Set(Object.keys(l));c.forEach(e=>{let{device:t,index:r}=l[e];u[r]||(u[r]={}),u[r][t]=e});let d={position:{constructor:a.Z,reader:e=>[e.x,e.y]},pagePosition:{constructor:a.Z,reader:e=>[e.pageX,e.pageY]},screenPosition:{constructor:a.Z,reader:e=>[e.screenX,e.screenY]},tilt:{constructor:a.Z,reader:e=>[e.screenX/90,e.screenY/90]},contact:{constructor:a.Z,reader:e=>[e.width,e.height]},delta:{constructor:a.Z,reader:(e,t,r)=>{if(!t)return r;let n=(e.timeStamp-t.timeStamp)*.1||1;return[(e.x-t.x)/n,(e.y-t.y)/n]}},pageDelta:{constructor:a.Z,reader:(e,t,r)=>{if(!t)return r;let n=e.timeStamp-t.timeStamp||1;return[(e.pageX-t.pageX)/n,(e.pageY-t.pageY)/n]}},screenDelta:{constructor:a.Z,reader:"movementX"in MouseEvent.prototype?(e,t,r)=>e?[e.movementX,e.movementY]:r:(e,t,r)=>{if(!t)return r;let n=e.timeStamp-t.timeStamp||1;return[(e.screenX-t.screenX)/n,(e.screenY-t.screenY)/n]}}},h={constructor:i.Z,reader:e=>e.pressure||0};class f extends o.S1{constructor(e={}){super();let{updatePeriod:t=1e3/60,element:r=document.body,touch:i=!0,pen:o=!0,mouse:l=!0,touchActionStyle:f=!0}=e,{enabled:p=!0}=e,_=null,m=null,g=null,y={pen:o,mouse:l,touch:i},v=new Set,b=e=>{if(p&&e.isPrimary&&y[e.pointerType]){m&&(!_||m.timeStamp-_.timeStamp>=t)&&(_=m),m=e;for(let t=0;t<u.length;t++){let r=1<<t,n=e.buttons&r,i=function(e,t=e.button){return t>=0&&t<u.length&&e.isPrimary&&u[t][e.pointerType]||""}(e,t);n?v.add(i):v.delete(i)}this.emit("change")}},x=()=>{m=_=null},T=e=>{g=e},E=f&&r.style?r:document.body;function A(){p=!0,window.addEventListener("pointerdown",b),window.addEventListener("pointerup",b),window.addEventListener("pointermove",b),window.addEventListener("pointerout",x),window.addEventListener("wheel",T)}function S(){p=!1,_=null,m=null,g=null,f&&(E.style.touchAction=""),v.clear(),window.removeEventListener("pointerdown",b),window.removeEventListener("pointerup",b),window.removeEventListener("pointermove",b),window.removeEventListener("pointerout",x),window.removeEventListener("wheel",T)}f&&(E.style.touchAction="none"),this.getControl=(e,r={})=>{let i="pressure"===e?h:d[e];if(i){let{constructor:t,reader:n}=i;return new t(()=>m?n(m,_,t.defaultValue):t.defaultValue,Object.assign({name:e},r,{device:this}))}if(c.has(e))return new n.Z((0,s.Z)(()=>v.has(e.toLowerCase())),Object.assign({name:e},r,{device:this}));if("wheel"===e)return new a.Z(()=>(g&&performance.now()-g.timeStamp>t&&(g=null),g?[g.deltaX,g.deltaY]:a.Z.defaultValue),Object.assign({name:e},r,{device:this}));throw Error("Control not found")},this.destroy=()=>{S()},Object.defineProperties(this,{pointerType:{get:()=>m&&m.pointerType||""},connected:{enumerable:!1,configurable:!1,writable:!1,value:!0},timestamp:{get:()=>m&&m.timeStamp||0},enabled:{get:()=>p,set(e){!!e!=!!p&&(e?A():S())}}}),p&&A()}}},19066:function(e,t,r){var n=r(66755);let i="fogVertexDeclaration",a=`#ifdef FOG
varying vFogDistance: vec3f;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},19363:function(e,t,r){r.d(t,{T:()=>i});var n=r(20034);async function i(e,t){let r=t.method||"GET";return await new Promise((i,a)=>{let s=new n.g;s.addEventListener("readystatechange",()=>{if(4==s.readyState)if(200==s.status){let e={};if(t.responseHeaders)for(let r of t.responseHeaders)e[r]=s.getResponseHeader(r)||"";i({response:s.response,headerValues:e})}else a(`Unable to fetch data from ${e}. Error code: ${s.status}`)}),s.open(r,e),s.send()})}},19502:function(e,t,r){r.d(t,{Y:()=>a});var n=r(19956),i=r(20534);class a extends n.H{_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(r.e("4556").then(r.bind(r,45404)))):t.push(r.e("4820").then(r.bind(r,38774)))}constructor(e,t=null,r){super({...r,name:e,engine:t||i.D.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:a.FragmentUrl,uniforms:a.Uniforms,samplers:a.Samplers}),this.weight=1}bind(e=!1){super.bind(e),this._drawWrapper.effect.setFloat("bloomWeight",this.weight)}}a.FragmentUrl="bloomMerge",a.Uniforms=["bloomWeight"],a.Samplers=["bloomBlur"]},2037:function(e,t,r){r.r(t),r.d(t,{_KTXTextureLoader:()=>s});var n=r(23641),i=r(82238),a=r(88280);class s{constructor(){this.supportCascades=!1}loadCubeData(e,t,r,i){if(Array.isArray(e))return;t._invertVScale=!t.invertY;let a=t.getEngine(),s=new n.k(e,6),o=s.numberOfMipmapLevels>1&&t.generateMipMaps;a._unpackFlipY(!0),s.uploadLevels(t,t.generateMipMaps),t.width=s.pixelWidth,t.height=s.pixelHeight,a._setCubeMapTextureParams(t,o,s.numberOfMipmapLevels-1),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),i&&i()}loadData(e,t,r,s){if(n.k.IsValid(e)){t._invertVScale=!t.invertY;let i=new n.k(e,1),a=function(e){switch(e){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(i.glInternalFormat);a?(t.format=a,t._useSRGBBuffer=t.getEngine()._getUseSRGBBuffer(!0,t.generateMipMaps),t._gammaSpace=!0):t.format=i.glInternalFormat,r(i.pixelWidth,i.pixelHeight,t.generateMipMaps,!0,()=>{i.uploadLevels(t,t.generateMipMaps)},i.isInvalid)}else i.Z.IsValid(e)?new i.Z(t.getEngine())._uploadAsync(e,t,s).then(()=>{r(t.width,t.height,t.generateMipMaps,!0,()=>{},!1)},e=>{a.Y.Warn(`Failed to load KTX2 texture data: ${e.message}`),r(0,0,!1,!1,()=>{},!0)}):(a.Y.Error("texture missing KTX identifier"),r(0,0,!1,!1,()=>{},!0))}}},2043:function(e,t,r){r.d(t,{Z:()=>o});var n=r(81997),i=r(96368);function a(e,t,r){let[n,i]=e,a=Math.hypot(n,i),s=function(e,t=.125,r=.925){let n=Math.abs(e);return n<t?0:n>r?Math.sign(e):Math.sign(e)*(n-t)/(r-t)}(a,t,r);if(0===s)return[0,0];let o=s/a;return[n*o,i*o]}let s=[["left",0,!0],["right",0,!1],["down",1,!0],["up",1,!1]];class o extends n.Z{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null),super(e,Object.assign({processors:[a]},t)),s.forEach(([e,r,n])=>{var a=this,s=t;let o=Object.assign({},s&&s[e],{parent:a,device:a.device});a[e]=new i.Z(()=>(function(e,t,r){let n=e()[t];return Math.max(0,r?-n:n)})(a.read,r,n),o),a.children.set(e,a[e])});let r=()=>this.emit("change");this.children.forEach(e=>{e.on("change",r)})}}},20536:function(e,t,r){var n=r(66755);let i="instancesVertex",a=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,
previousWorld2,previousWorld3);
#endif
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=previousWorld*finalPreviousWorld;
#endif
#endif
#else
mat4 finalWorld=world;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=previousWorld;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},20995:function(e,t,r){r.r(t),r.d(t,{clipPlaneVertex:()=>s});var n=r(66755);let i="clipPlaneVertex",a=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},21483:function(e,t,r){r.d(t,{l:()=>i});var n=r(32160);class i extends n.x{constructor(e,t,r,i,a,s=!0,o=!1,l=3,u=0,c,d,h){if(super(null,a,!s,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=i,!this._engine)return;this._engine._caps.textureFloatLinearFiltering||1!==u||(l=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==u||(l=1),this._texture=this._engine.createRawTexture(e,t,r,i,s,o,l,null,u,c??0,d??!1),this.wrapU=n.x.CLAMP_ADDRESSMODE,this.wrapV=n.x.CLAMP_ADDRESSMODE,this._waitingForData=!!h&&!e}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();let e=new i(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return e._texture=this._texture,this._texture.incrementReferences(),e}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,1,n,a,s,o)}static CreateLuminanceAlphaTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,2,n,a,s,o)}static CreateAlphaTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,0,n,a,s,o)}static CreateRGBTexture(e,t,r,n,a=!0,s=!1,o=3,l=0,u=0,c=!1){return new i(e,t,r,4,n,a,s,o,l,u,c)}static CreateRGBATexture(e,t,r,n,a=!0,s=!1,o=3,l=0,u=0,c=!1,d=!1){return new i(e,t,r,5,n,a,s,o,l,u,c,d)}static CreateRGBAStorageTexture(e,t,r,n,a=!0,s=!1,o=3,l=0,u=!1){return new i(e,t,r,5,n,a,s,o,l,1,u)}static CreateRTexture(e,t,r,a,s=!0,o=!1,l=n.x.TRILINEAR_SAMPLINGMODE,u=1){return new i(e,t,r,6,a,s,o,l,u)}static CreateRStorageTexture(e,t,r,a,s=!0,o=!1,l=n.x.TRILINEAR_SAMPLINGMODE,u=1){return new i(e,t,r,6,a,s,o,l,u,1)}}},21567:function(e,t,r){r.d(t,{u:()=>i});var n=r(61834);class i{constructor(){this._hasHit=!1,this._hitNormal=n.P.Zero(),this._hitPoint=n.P.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(e,t,r){this._hasHit=!0,this._hitNormal.set(e.x,e.y,e.z),this._hitPoint.set(t.x,t.y,t.z),this._triangleIndex=r??-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}},2227:function(e,t,r){r.r(t),r.d(t,{_DDSTextureLoader:()=>a});var n=r(49192),i=r(20333);class a{constructor(){this.supportCascades=!0}loadCubeData(e,t,r,a){let s,o=t.getEngine(),l=!1,u=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){let n=e[r];t.width=(s=i.DDSTools.GetDDSInfo(n)).width,t.height=s.height,l=(s.isRGB||s.isLuminance||s.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(s.isCompressed),i.DDSTools.UploadDDSLevels(o,t,n,s,l,6,-1,r),s.isFourCC||1!==s.mipmapCount?u=s.mipmapCount-1:o.generateMipMapsForCubemap(t)}else t.width=(s=i.DDSTools.GetDDSInfo(e)).width,t.height=s.height,r&&(s.sphericalPolynomial=new n.i),l=(s.isRGB||s.isLuminance||s.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(s.isCompressed),i.DDSTools.UploadDDSLevels(o,t,e,s,l,6),s.isFourCC||1!==s.mipmapCount?u=s.mipmapCount-1:o.generateMipMapsForCubemap(t,!1);o._setCubeMapTextureParams(t,l,u),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),a&&a({isDDS:!0,width:t.width,info:s,data:e,texture:t})}loadData(e,t,r){let n=i.DDSTools.GetDDSInfo(e),a=(n.isRGB||n.isLuminance||n.mipmapCount>1)&&t.generateMipMaps&&Math.max(n.width,n.height)>>n.mipmapCount-1==1;r(n.width,n.height,a,n.isFourCC,()=>{i.DDSTools.UploadDDSLevels(t.getEngine(),t,e,n,a,1)})}}},22526:function(e,t,r){r.r(t),r.d(t,{fogFragmentDeclarationWGSL:()=>s});var n=r(66755);let i="fogFragmentDeclaration",a=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
const E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32
{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==uniforms.vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==uniforms.vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},22540:function(e,t,r){r.d(t,{Z:()=>a});var n=r(22837);let i={disabled:{started:["cancel","disable"],"*":["disable"]},ready:{started:["cancel","ready"],"*":["ready"]},started:{disabled:["enable","start"],"*":["start"]},complete:{disabled:["enable","start","complete"],started:["complete"],"*":["start","complete"]}};class a extends n.Z{constructor(e){if(!e)throw Error("Interaction requires an Action");super();let t=!1,r=!0,n="ready",a=0,s=e=>{if(n===e)return;let t=i[e],r=t[n]||t["*"];n=e,r.forEach(e=>this.emit(e))},o=()=>{(a=r?this.evaluate():0)<=0?s("ready"):a>=1?s("complete"):s("started")};e.on("change",o),e.on("enable",o),e.on("disable",o),this.update=o;let l=this.destroy;this.destroy=()=>{t=!0,r=!1,l()},this.destroy=()=>{e.off("change",o),e.off("enable",o),e.off("disable",o),l()},Object.defineProperties(this,{enabled:{set(e){(e=!!e)===r||t||((r=e)?s("ready"):s("disabled"))},get:()=>r},action:{get:()=>e},state:{get:()=>n}})}evaluate(){var e;return+(((null==(e=this.action.activeControl)?void 0:e.magnitude())||0)>0)}}},22837:function(e,t,r){r.d(t,{Z:()=>n});class n{constructor(){var e;let{all:t,on:r,off:n,emit:i}={all:e=e||new Map,on:function(t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])},off:function(t,r){var n=e.get(t);n&&(r?n.splice(n.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var n=e.get(t);n&&n.slice().map(function(e){e(r)}),(n=e.get("*"))&&n.slice().map(function(e){e(t,r)})}};this.on=r,this.off=n,this.emit=i,this.destroy=()=>t.clear()}}},23203:function(e,t,r){var n=r(66755);let i="logDepthFragment",a=`#ifdef LOGARITHMICDEPTH
fragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},26034:function(e,t,r){r.d(t,{s:()=>o});var n=r(76600),i=r(88280),a=r(52746),s=r(98607);class o extends a.e{constructor(){super(...arguments),this._missingVaryings=[],this._textureArrayProcessing=[],this._vertexIsGLES3=!1,this._fragmentIsGLES3=!1,this.shaderLanguage=0,this.parseGLES3=!0}_getArraySize(e,t,r){let n=0,i=e.indexOf("["),a=e.indexOf("]");if(i>0&&a>0){let t=e.substring(i+1,a);isNaN(n=+t)&&(n=+r[t.trim()]),e=e.substring(0,i)}return[e,t,n]}initializeShaders(e){this._webgpuProcessingContext=e,this._missingVaryings.length=0,this._textureArrayProcessing.length=0,this.attributeKeywordName=void 0,this.varyingVertexKeywordName=void 0,this.varyingFragmentKeywordName=void 0}preProcessShaderCode(e,t){let r=`// Internals UBO
uniform ${a.e.InternalsUBOName} {
float yFactor_;
float textureOutputHeight_;
};
`,n=-1!==e.indexOf("// Internals UBO");return t?(this._fragmentIsGLES3=-1!==e.indexOf("#version 3"),this._fragmentIsGLES3&&(this.varyingFragmentKeywordName="in"),n?e:r+"##INJECTCODE##\n"+e):(this._vertexIsGLES3=-1!==e.indexOf("#version 3"),this._vertexIsGLES3&&(this.attributeKeywordName="in",this.varyingVertexKeywordName="out"),n?e:r+e)}varyingCheck(e,t){return(t&&this._fragmentIsGLES3?/(flat\s)?\s*\bin\b/:!t&&this._vertexIsGLES3?/(flat\s)?\s*\bout\b/:/(flat\s)?\s*\bvarying\b/).test(e)}varyingProcessor(e,t,r){this._preProcessors=r;let n=(t&&this._fragmentIsGLES3?/\s*(flat)?\s*in\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm:!t&&this._vertexIsGLES3?/\s*(flat)?\s*out\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm:/\s*(flat)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!==n){let a,s=n[1]??"",o=n[2],l=n[3];t?(a=this._webgpuProcessingContext.availableVaryings[l],this._missingVaryings[a]="",void 0===a&&i.Y.Warn(`Invalid fragment shader: The varying named "${l}" is not declared in the vertex shader! This declaration will be ignored.`)):(a=this._webgpuProcessingContext.getVaryingNextLocation(o,this._getArraySize(l,o,r)[2]),this._webgpuProcessingContext.availableVaryings[l]=a,this._missingVaryings[a]=`layout(location = ${a}) ${s} in ${o} ${l};`),e=e.replace(n[0],void 0===a?"":`layout(location = ${a}) ${s} ${t?"in":"out"} ${o} ${l};`)}return e}attributeProcessor(e,t){this._preProcessors=t;let r=(this._vertexIsGLES3?/\s*in\s+(\S+)\s+(\S+)\s*;/gm:/\s*attribute\s+(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!==r){let n=r[1],i=r[2],a=this._webgpuProcessingContext.getAttributeNextLocation(n,this._getArraySize(i,n,t)[2]);this._webgpuProcessingContext.availableAttributes[i]=a,this._webgpuProcessingContext.orderedAttributes[a]=i;let s=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[i];if(void 0!==s){let t=`_int_${i}_`;e=e.replace(r[0],`layout(location = ${a}) in ${s<0?-1===s?"int":"ivec"+-s:1===s?"uint":"uvec"+s} ${t}; ${n} ${i} = ${n}(${t});`)}else e=e.replace(r[0],`layout(location = ${a}) in ${n} ${i};`)}return e}uniformProcessor(e,t,r){this._preProcessors=r;let n=/\s*uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!==n){let i=n[1],s=n[2];if(0===i.indexOf("sampler")||1===i.indexOf("sampler")){let n=0;[s,i,n]=this._getArraySize(s,i,r);let o=this._webgpuProcessingContext.availableTextures[s];if(!o){o={autoBindSampler:!0,isTextureArray:n>0,isStorageTexture:!1,textures:[],sampleType:"float"};for(let e=0;e<(n||1);++e)o.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}let l=a.e._SamplerTypeByWebGLSamplerType[i]??"sampler",u=!!a.e._IsComparisonSamplerByWebGPUSamplerType[l],c=s+"Sampler",d=this._webgpuProcessingContext.availableSamplers[c];d||(d={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:u?"comparison":"filtering"});let h="u"===i.charAt(0)?"u":"i"===i.charAt(0)?"i":"";h&&(i=i.substring(1)),o.sampleType=u?"depth":"u"===h?"uint":"i"===h?"sint":"float";let f=n>0,p=d.binding.groupIndex,_=d.binding.bindingIndex,m=a.e._SamplerFunctionByWebGLSamplerType[i],g=a.e._TextureTypeByWebGLSamplerType[i],y=a.e._GpuTextureViewDimensionByWebGPUTextureType[g];if(f){let t=[];t.push(`layout(set = ${p}, binding = ${_}) uniform ${h}${l} ${c};`),e=`
`;for(let r=0;r<n;++r){let n=o.textures[r].groupIndex,i=o.textures[r].bindingIndex;t.push(`layout(set = ${n}, binding = ${i}) uniform ${g} ${s}Texture${r};`),e+=`${r>0?"\n":""}#define ${s}${r} ${h}${m}(${s}Texture${r}, ${c})`}e=t.join("\n")+e,this._textureArrayProcessing.push(s)}else n=1,e=`layout(set = ${p}, binding = ${_}) uniform ${l} ${c};
                        layout(set = ${o.textures[0].groupIndex}, binding = ${o.textures[0].bindingIndex}) uniform ${h}${g} ${s}Texture;
                        #define ${s} ${h}${m}(${s}Texture, ${c})`;this._webgpuProcessingContext.availableTextures[s]=o,this._webgpuProcessingContext.availableSamplers[c]=d,this._addSamplerBindingDescription(c,d,!t);for(let e=0;e<n;++e)this._addTextureBindingDescription(s,o,e,y,null,!t)}else this._addUniformToLeftOverUBO(s,i,r),e=""}return e}uniformBufferProcessor(e,t){let r=/uniform\s+(\w+)/gm.exec(e);if(null!==r){let i=r[1],a=this._webgpuProcessingContext.availableBuffers[i];if(!a){let e,t=n.d.KnownUBOs[i];a={binding:t&&-1!==t.binding.groupIndex?t.binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[i]=a}this._addBufferBindingDescription(i,a,"uniform",!t),e=e.replace("uniform",`layout(set = ${a.binding.groupIndex}, binding = ${a.binding.bindingIndex}) uniform`)}return e}postProcessor(e,t,r,n,i){let a=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r){let t=e.indexOf("gl_FragCoord")>=0,r=`
                glFragCoord_ = gl_FragCoord;
                if (yFactor_ == 1.) {
                    glFragCoord_.y = textureOutputHeight_ - glFragCoord_.y;
                }
            `,n=-1!==e.search(/layout *\(location *= *0\) *out/g);if(e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/gl_FragCoord/g,"glFragCoord_"),this._fragmentIsGLES3){let t=/^\s*out\s+\S+\s+\S+\s*;/gm.exec(e);null!==t&&(e=e.substring(0,t.index)+"layout(location = 0) "+e.substring(t.index))}else e=e.replace(/void\s+?main\s*\(/g,(a||n?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(");e=(e=e.replace(/dFdy/g,"(-yFactor_)*dFdy")).replace("##INJECTCODE##",t?"vec4 glFragCoord_;\n":""),t&&(e=(0,s.e0)(e,"void main",r))}else if(e=(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex")).replace(/gl_VertexID/g,"gl_VertexIndex"),-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;if(!r){let t=e.lastIndexOf("}");e=e.substring(0,t)+"gl_Position.y *= yFactor_;\n}"}return e}_applyTextureArrayProcessing(e,t){let r=RegExp(t+"\\s*\\[(.+)?\\]","gm"),n=r.exec(e);for(;null!==n;){let i=n[1],a=+i;this._preProcessors&&isNaN(a)&&(a=+this._preProcessors[i.trim()]),e=e.replace(n[0],t+a),n=r.exec(e)}return e}_generateLeftOverUBOCode(e,t){let r=`layout(set = ${t.binding.groupIndex}, binding = ${t.binding.bindingIndex}) uniform ${e} {
    `;for(let e of this._webgpuProcessingContext.leftOverUniforms)e.length>0?r+=`    ${e.type} ${e.name}[${e.length}];
`:r+=`    ${e.type} ${e.name};
`;return r+"};\n\n"}finalizeShaders(e,t){for(let r=0;r<this._textureArrayProcessing.length;++r){let n=this._textureArrayProcessing[r];e=this._applyTextureArrayProcessing(e,n),t=this._applyTextureArrayProcessing(t,n)}for(let e=0;e<this._missingVaryings.length;++e){let r=this._missingVaryings[e];r&&r.length>0&&(t=r+"\n"+t)}let r=this._buildLeftOverUBO();return e=r+e,t=r+t,this._collectBindingNames(),this._preCreateBindGroupEntries(),this._preProcessors=null,this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}}},26362:function(e,t,r){var n=r(6838),i=r(66588),a=r(90481);i.ThinEngine.prototype.createDynamicTexture=function(e,t,r,i){let s=new a.l(this,4);return s.baseWidth=e,s.baseHeight=t,r&&(e=this.needPOTTextures?(0,n.p7)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,n.p7)(t,this._caps.maxTextureSize):t),s.width=e,s.height=t,s.isReady=!1,s.generateMipMaps=r,s.samplingMode=i,this.updateTextureSamplingMode(i,s),this._internalTexturesCache.push(s),s},i.ThinEngine.prototype.updateDynamicTexture=function(e,t,r,n=!1,i,a=!1,s=!1){if(!e)return;let o=this._gl,l=o.TEXTURE_2D,u=this._bindTextureDirectly(l,e,!0,a);this._unpackFlipY(void 0===r?e.invertY:r),n&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);let c=this._getWebGLTextureType(e.type),d=this._getInternalFormat(i||e.format),h=this._getRGBABufferInternalSizedFormat(e.type,d);o.texImage2D(l,0,h,d,c,t),e.generateMipMaps&&o.generateMipmap(l),u||this._bindTextureDirectly(l,null),n&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),i&&(e.format=i),e._dynamicTextureSource=t,e._premulAlpha=n,e.invertY=r||!1,e.isReady=!0}},26980:function(e,t,r){let n;r.d(t,{z:()=>d});var i,a,s,o,l,u,c,d={};r.r(d),r.d(d,{BRAND:()=>eF,DIRTY:()=>I,EMPTY_PATH:()=>T,INVALID:()=>S,NEVER:()=>tg,OK:()=>C,ParseStatus:()=>A,Schema:()=>F,ZodAny:()=>el,ZodArray:()=>eh,ZodBigInt:()=>er,ZodBoolean:()=>en,ZodBranded:()=>eD,ZodCatch:()=>eL,ZodDate:()=>ei,ZodDefault:()=>eO,ZodDiscriminatedUnion:()=>em,ZodEffects:()=>eR,ZodEnum:()=>eI,ZodError:()=>m,ZodFirstPartyTypeKind:()=>c,ZodFunction:()=>eT,ZodIntersection:()=>eg,ZodIssueCode:()=>p,ZodLazy:()=>eE,ZodLiteral:()=>eA,ZodMap:()=>eb,ZodNaN:()=>eN,ZodNativeEnum:()=>eC,ZodNever:()=>ec,ZodNull:()=>eo,ZodNullable:()=>eM,ZodNumber:()=>et,ZodObject:()=>ef,ZodOptional:()=>ew,ZodParsedType:()=>h,ZodPipeline:()=>eB,ZodPromise:()=>eP,ZodReadonly:()=>ek,ZodRecord:()=>ev,ZodSchema:()=>F,ZodSet:()=>ex,ZodString:()=>ee,ZodSymbol:()=>ea,ZodTransformer:()=>eR,ZodTuple:()=>ey,ZodType:()=>F,ZodUndefined:()=>es,ZodUnion:()=>ep,ZodUnknown:()=>eu,ZodVoid:()=>ed,addIssueToContext:()=>E,any:()=>eQ,array:()=>e2,bigint:()=>ez,boolean:()=>eY,coerce:()=>tm,custom:()=>eU,date:()=>eK,datetimeRegex:()=>J,defaultErrorMap:()=>g,discriminatedUnion:()=>e6,effect:()=>tl,enum:()=>ta,function:()=>tr,getErrorMap:()=>b,getParsedType:()=>f,instanceof:()=>eH,intersection:()=>e8,isAborted:()=>P,isAsync:()=>M,isDirty:()=>R,isValid:()=>w,late:()=>eV,lazy:()=>tn,literal:()=>ti,makeIssue:()=>x,map:()=>te,nan:()=>ej,nativeEnum:()=>ts,never:()=>e0,null:()=>eq,nullable:()=>tc,number:()=>eW,object:()=>e3,objectUtil:()=>l,oboolean:()=>t_,onumber:()=>tp,optional:()=>tu,ostring:()=>tf,pipeline:()=>th,preprocess:()=>td,promise:()=>to,quotelessJson:()=>_,record:()=>e9,set:()=>tt,setErrorMap:()=>v,strictObject:()=>e4,string:()=>e$,symbol:()=>eX,transformer:()=>tl,tuple:()=>e7,undefined:()=>eZ,union:()=>e5,unknown:()=>eJ,util:()=>o,void:()=>e1}),(i=o||(o={})).assertEqual=e=>{},i.assertIs=function(e){},i.assertNever=function(e){throw Error()},i.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},i.getValidEnumValues=e=>{let t=i.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let n of t)r[n]=e[n];return i.objectValues(r)},i.objectValues=e=>i.objectKeys(e).map(function(t){return e[t]}),i.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},i.find=(e,t)=>{for(let r of e)if(t(r))return r},i.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,i.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},i.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(l||(l={})).mergeShapes=(e,t)=>({...e,...t});let h=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),f=e=>{switch(typeof e){case"undefined":return h.undefined;case"string":return h.string;case"number":return Number.isNaN(e)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":if(Array.isArray(e))return h.array;if(null===e)return h.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return h.promise;if("undefined"!=typeof Map&&e instanceof Map)return h.map;if("undefined"!=typeof Set&&e instanceof Set)return h.set;if("undefined"!=typeof Date&&e instanceof Date)return h.date;return h.object;default:return h.unknown}},p=o.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),_=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class m extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(n);else if("invalid_return_type"===i.code)n(i.returnTypeError);else if("invalid_arguments"===i.code)n(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof m))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,o.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}m.create=e=>new m(e);let g=(e,t)=>{let r;switch(e.code){case p.invalid_type:r=e.received===h.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case p.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,o.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:r=`Unrecognized key(s) in object: ${o.joinValues(e.keys,", ")}`;break;case p.invalid_union:r="Invalid input";break;case p.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${o.joinValues(e.options)}`;break;case p.invalid_enum_value:r=`Invalid enum value. Expected ${o.joinValues(e.options)}, received '${e.received}'`;break;case p.invalid_arguments:r="Invalid function arguments";break;case p.invalid_return_type:r="Invalid function return type";break;case p.invalid_date:r="Invalid date";break;case p.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:o.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case p.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case p.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case p.custom:r="Invalid input";break;case p.invalid_intersection_types:r="Intersection results could not be merged";break;case p.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case p.not_finite:r="Number must be finite";break;default:r=t.defaultError,o.assertNever(e)}return{message:r}},y=g;function v(e){y=e}function b(){return y}let x=e=>{let{data:t,path:r,errorMaps:n,issueData:i}=e,a=[...r,...i.path||[]],s={...i,path:a};if(void 0!==i.message)return{...i,path:a,message:i.message};let o="";for(let e of n.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...i,path:a,message:o}},T=[];function E(e,t){let r=y,n=x({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===g?void 0:g].filter(e=>!!e)});e.common.issues.push(n)}class A{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let n of t){if("aborted"===n.status)return S;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return A.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let n of t){let{key:t,value:i}=n;if("aborted"===t.status||"aborted"===i.status)return S;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||n.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let S=Object.freeze({status:"aborted"}),I=e=>({status:"dirty",value:e}),C=e=>({status:"valid",value:e}),P=e=>"aborted"===e.status,R=e=>"dirty"===e.status,w=e=>"valid"===e.status,M=e=>"undefined"!=typeof Promise&&e instanceof Promise;(a=u||(u={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},a.toString=e=>"string"==typeof e?e:e?.message;class O{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let L=(e,t)=>{if(w(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new m(e.common.issues);return this._error=t,this._error}}};function N(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:a}=e;return"invalid_enum_value"===t.code?{message:a??i.defaultError}:void 0===i.data?{message:a??n??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:a??r??i.defaultError}},description:i}}class F{get description(){return this._def.description}_getType(e){return f(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:f(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new A,ctx:{common:e.parent.common,data:e.data,parsedType:f(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(M(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:f(e)},n=this._parseSync({data:e,path:r.path,parent:r});return L(r,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:f(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return w(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>w(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:f(e)},n=this._parse({data:e,path:r.path,parent:r});return L(r,await (M(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let i=e(t),a=()=>n.addIssue({code:p.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(a(),!1)):!!i||(a(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new eR({schema:this,typeName:c.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ew.create(this,this._def)}nullable(){return eM.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eh.create(this)}promise(){return eP.create(this,this._def)}or(e){return ep.create([this,e],this._def)}and(e){return eg.create(this,e,this._def)}transform(e){return new eR({...N(this._def),schema:this,typeName:c.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eO({...N(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:c.ZodDefault})}brand(){return new eD({typeName:c.ZodBranded,type:this,...N(this._def)})}catch(e){return new eL({...N(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:c.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eB.create(this,e)}readonly(){return ek.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let D=/^c[^\s-]{8,}$/i,B=/^[0-9a-z]+$/,k=/^[0-9A-HJKMNP-TV-Z]{26}$/i,G=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,U=/^[a-z0-9_-]{21}$/i,V=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,H=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,$=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,W=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,j=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,z=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Y=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,K=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,X=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Z="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",q=RegExp(`^${Z}$`);function Q(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function J(e){let t=`${Z}T${Q(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class ee extends F{_parse(e){var t,r,i,a;let s;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.string,received:t.parsedType}),S}let l=new A;for(let u of this._def.checks)if("min"===u.kind)e.data.length<u.value&&(E(s=this._getOrReturnCtx(e,s),{code:p.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),l.dirty());else if("max"===u.kind)e.data.length>u.value&&(E(s=this._getOrReturnCtx(e,s),{code:p.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),l.dirty());else if("length"===u.kind){let t=e.data.length>u.value,r=e.data.length<u.value;(t||r)&&(s=this._getOrReturnCtx(e,s),t?E(s,{code:p.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):r&&E(s,{code:p.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),l.dirty())}else if("email"===u.kind)$.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"email",code:p.invalid_string,message:u.message}),l.dirty());else if("emoji"===u.kind)n||(n=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"emoji",code:p.invalid_string,message:u.message}),l.dirty());else if("uuid"===u.kind)G.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"uuid",code:p.invalid_string,message:u.message}),l.dirty());else if("nanoid"===u.kind)U.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"nanoid",code:p.invalid_string,message:u.message}),l.dirty());else if("cuid"===u.kind)D.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"cuid",code:p.invalid_string,message:u.message}),l.dirty());else if("cuid2"===u.kind)B.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"cuid2",code:p.invalid_string,message:u.message}),l.dirty());else if("ulid"===u.kind)k.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"ulid",code:p.invalid_string,message:u.message}),l.dirty());else if("url"===u.kind)try{new URL(e.data)}catch{E(s=this._getOrReturnCtx(e,s),{validation:"url",code:p.invalid_string,message:u.message}),l.dirty()}else"regex"===u.kind?(u.regex.lastIndex=0,u.regex.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"regex",code:p.invalid_string,message:u.message}),l.dirty())):"trim"===u.kind?e.data=e.data.trim():"includes"===u.kind?e.data.includes(u.value,u.position)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),l.dirty()):"toLowerCase"===u.kind?e.data=e.data.toLowerCase():"toUpperCase"===u.kind?e.data=e.data.toUpperCase():"startsWith"===u.kind?e.data.startsWith(u.value)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:{startsWith:u.value},message:u.message}),l.dirty()):"endsWith"===u.kind?e.data.endsWith(u.value)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:{endsWith:u.value},message:u.message}),l.dirty()):"datetime"===u.kind?J(u).test(e.data)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:"datetime",message:u.message}),l.dirty()):"date"===u.kind?q.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:"date",message:u.message}),l.dirty()):"time"===u.kind?RegExp(`^${Q(u)}$`).test(e.data)||(E(s=this._getOrReturnCtx(e,s),{code:p.invalid_string,validation:"time",message:u.message}),l.dirty()):"duration"===u.kind?H.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"duration",code:p.invalid_string,message:u.message}),l.dirty()):"ip"===u.kind?(t=e.data,!(("v4"===(r=u.version)||!r)&&W.test(t)||("v6"===r||!r)&&z.test(t))&&1&&(E(s=this._getOrReturnCtx(e,s),{validation:"ip",code:p.invalid_string,message:u.message}),l.dirty())):"jwt"===u.kind?!function(e,t){if(!V.test(e))return!1;try{let[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));if("object"!=typeof i||null===i||"typ"in i&&i?.typ!=="JWT"||!i.alg||t&&i.alg!==t)return!1;return!0}catch{return!1}}(e.data,u.alg)&&(E(s=this._getOrReturnCtx(e,s),{validation:"jwt",code:p.invalid_string,message:u.message}),l.dirty()):"cidr"===u.kind?(i=e.data,!(("v4"===(a=u.version)||!a)&&j.test(i)||("v6"===a||!a)&&Y.test(i))&&1&&(E(s=this._getOrReturnCtx(e,s),{validation:"cidr",code:p.invalid_string,message:u.message}),l.dirty())):"base64"===u.kind?K.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"base64",code:p.invalid_string,message:u.message}),l.dirty()):"base64url"===u.kind?X.test(e.data)||(E(s=this._getOrReturnCtx(e,s),{validation:"base64url",code:p.invalid_string,message:u.message}),l.dirty()):o.assertNever(u);return{status:l.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:p.invalid_string,...u.errToObj(r)})}_addCheck(e){return new ee({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...u.errToObj(e)})}url(e){return this._addCheck({kind:"url",...u.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...u.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...u.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...u.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...u.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...u.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...u.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...u.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...u.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...u.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...u.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...u.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...u.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...u.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...u.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...u.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...u.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...u.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...u.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...u.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...u.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...u.errToObj(t)})}nonempty(e){return this.min(1,u.errToObj(e))}trim(){return new ee({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ee({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ee({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ee.create=e=>new ee({checks:[],typeName:c.ZodString,coerce:e?.coerce??!1,...N(e)});class et extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.number,received:t.parsedType}),S}let r=new A;for(let n of this._def.checks)"int"===n.kind?o.isInteger(e.data)||(E(t=this._getOrReturnCtx(e,t),{code:p.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}(e.data,n.value)&&(E(t=this._getOrReturnCtx(e,t),{code:p.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(E(t=this._getOrReturnCtx(e,t),{code:p.not_finite,message:n.message}),r.dirty()):o.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,u.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.toString(t))}setLimit(e,t,r,n){return new et({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.toString(n)}]})}_addCheck(e){return new et({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:u.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:u.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:u.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:u.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:u.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:u.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:u.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:u.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&o.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}et.create=e=>new et({checks:[],typeName:c.ZodNumber,coerce:e?.coerce||!1,...N(e)});class er extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==h.bigint)return this._getInvalidInput(e);let r=new A;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(E(t=this._getOrReturnCtx(e,t),{code:p.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):o.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.bigint,received:t.parsedType}),S}gte(e,t){return this.setLimit("min",e,!0,u.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.toString(t))}setLimit(e,t,r,n){return new er({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.toString(n)}]})}_addCheck(e){return new er({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:u.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:u.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:u.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:u.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}er.create=e=>new er({checks:[],typeName:c.ZodBigInt,coerce:e?.coerce??!1,...N(e)});class en extends F{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==h.boolean){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.boolean,received:t.parsedType}),S}return C(e.data)}}en.create=e=>new en({typeName:c.ZodBoolean,coerce:e?.coerce||!1,...N(e)});class ei extends F{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.date,received:t.parsedType}),S}if(Number.isNaN(e.data.getTime()))return E(this._getOrReturnCtx(e),{code:p.invalid_date}),S;let r=new A;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(E(t=this._getOrReturnCtx(e,t),{code:p.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):o.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ei({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:u.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:u.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ei.create=e=>new ei({checks:[],coerce:e?.coerce||!1,typeName:c.ZodDate,...N(e)});class ea extends F{_parse(e){if(this._getType(e)!==h.symbol){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.symbol,received:t.parsedType}),S}return C(e.data)}}ea.create=e=>new ea({typeName:c.ZodSymbol,...N(e)});class es extends F{_parse(e){if(this._getType(e)!==h.undefined){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.undefined,received:t.parsedType}),S}return C(e.data)}}es.create=e=>new es({typeName:c.ZodUndefined,...N(e)});class eo extends F{_parse(e){if(this._getType(e)!==h.null){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.null,received:t.parsedType}),S}return C(e.data)}}eo.create=e=>new eo({typeName:c.ZodNull,...N(e)});class el extends F{constructor(){super(...arguments),this._any=!0}_parse(e){return C(e.data)}}el.create=e=>new el({typeName:c.ZodAny,...N(e)});class eu extends F{constructor(){super(...arguments),this._unknown=!0}_parse(e){return C(e.data)}}eu.create=e=>new eu({typeName:c.ZodUnknown,...N(e)});class ec extends F{_parse(e){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.never,received:t.parsedType}),S}}ec.create=e=>new ec({typeName:c.ZodNever,...N(e)});class ed extends F{_parse(e){if(this._getType(e)!==h.undefined){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.void,received:t.parsedType}),S}return C(e.data)}}ed.create=e=>new ed({typeName:c.ZodVoid,...N(e)});class eh extends F{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==h.array)return E(t,{code:p.invalid_type,expected:h.array,received:t.parsedType}),S;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,i=t.data.length<n.exactLength.value;(e||i)&&(E(t,{code:e?p.too_big:p.too_small,minimum:i?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(E(t,{code:p.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(E(t,{code:p.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new O(t,e,t.path,r)))).then(e=>A.mergeArray(r,e));let i=[...t.data].map((e,r)=>n.type._parseSync(new O(t,e,t.path,r)));return A.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new eh({...this._def,minLength:{value:e,message:u.toString(t)}})}max(e,t){return new eh({...this._def,maxLength:{value:e,message:u.toString(t)}})}length(e,t){return new eh({...this._def,exactLength:{value:e,message:u.toString(t)}})}nonempty(e){return this.min(1,e)}}eh.create=(e,t)=>new eh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:c.ZodArray,...N(t)});class ef extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=o.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==h.object){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.object,received:t.parsedType}),S}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof ec&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||a.push(e);let s=[];for(let e of i){let t=n[e],i=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new O(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ec){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&(E(r,{code:p.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let n=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new O(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>A.mergeObjectSync(t,e)):A.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return u.errToObj,new ef({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let n=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:u.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new ef({...this._def,unknownKeys:"strip"})}passthrough(){return new ef({...this._def,unknownKeys:"passthrough"})}extend(e){return new ef({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ef({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:c.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ef({...this._def,catchall:e})}pick(e){let t={};for(let r of o.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new ef({...this._def,shape:()=>t})}omit(e){let t={};for(let r of o.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new ef({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ef){let r={};for(let n in t.shape){let i=t.shape[n];r[n]=ew.create(e(i))}return new ef({...t._def,shape:()=>r})}if(t instanceof eh)return new eh({...t._def,type:e(t.element)});if(t instanceof ew)return ew.create(e(t.unwrap()));if(t instanceof eM)return eM.create(e(t.unwrap()));if(t instanceof ey)return ey.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of o.objectKeys(this.shape)){let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}return new ef({...this._def,shape:()=>t})}required(e){let t={};for(let r of o.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ew;)e=e._def.innerType;t[r]=e}return new ef({...this._def,shape:()=>t})}keyof(){return eS(o.objectKeys(this.shape))}}ef.create=(e,t)=>new ef({shape:()=>e,unknownKeys:"strip",catchall:ec.create(),typeName:c.ZodObject,...N(t)}),ef.strictCreate=(e,t)=>new ef({shape:()=>e,unknownKeys:"strict",catchall:ec.create(),typeName:c.ZodObject,...N(t)}),ef.lazycreate=(e,t)=>new ef({shape:e,unknownKeys:"strip",catchall:ec.create(),typeName:c.ZodObject,...N(t)});class ep extends F{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new m(e.ctx.common.issues));return E(t,{code:p.invalid_union,unionErrors:r}),S});{let e,n=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},a=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=n.map(e=>new m(e));return E(t,{code:p.invalid_union,unionErrors:i}),S}}get options(){return this._def.options}}ep.create=(e,t)=>new ep({options:e,typeName:c.ZodUnion,...N(t)});let e_=e=>{if(e instanceof eE)return e_(e.schema);if(e instanceof eR)return e_(e.innerType());if(e instanceof eA)return[e.value];if(e instanceof eI)return e.options;if(e instanceof eC)return o.objectValues(e.enum);else if(e instanceof eO)return e_(e._def.innerType);else if(e instanceof es)return[void 0];else if(e instanceof eo)return[null];else if(e instanceof ew)return[void 0,...e_(e.unwrap())];else if(e instanceof eM)return[null,...e_(e.unwrap())];else if(e instanceof eD)return e_(e.unwrap());else if(e instanceof ek)return e_(e.unwrap());else if(e instanceof eL)return e_(e._def.innerType);else return[]};class em extends F{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return E(t,{code:p.invalid_type,expected:h.object,received:t.parsedType}),S;let r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),S)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let n=new Map;for(let r of t){let t=e_(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(n.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);n.set(i,r)}}return new em({typeName:c.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...N(r)})}}class eg extends F{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(P(e)||P(n))return S;let i=function e(t,r){let n=f(t),i=f(r);if(t===r)return{valid:!0,data:t};if(n===h.object&&i===h.object){let n=o.objectKeys(r),i=o.objectKeys(t).filter(e=>-1!==n.indexOf(e)),a={...t,...r};for(let n of i){let i=e(t[n],r[n]);if(!i.valid)return{valid:!1};a[n]=i.data}return{valid:!0,data:a}}if(n===h.array&&i===h.array){if(t.length!==r.length)return{valid:!1};let n=[];for(let i=0;i<t.length;i++){let a=e(t[i],r[i]);if(!a.valid)return{valid:!1};n.push(a.data)}return{valid:!0,data:n}}if(n===h.date&&i===h.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,n.value);return i.valid?((R(e)||R(n))&&t.dirty(),{status:t.value,value:i.data}):(E(r,{code:p.invalid_intersection_types}),S)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}eg.create=(e,t,r)=>new eg({left:e,right:t,typeName:c.ZodIntersection,...N(r)});class ey extends F{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.array)return E(r,{code:p.invalid_type,expected:h.array,received:r.parsedType}),S;if(r.data.length<this._def.items.length)return E(r,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),S;!this._def.rest&&r.data.length>this._def.items.length&&(E(r,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new O(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>A.mergeArray(t,e)):A.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new ey({...this._def,rest:e})}}ey.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ey({items:e,typeName:c.ZodTuple,rest:null,...N(t)})};class ev extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.object)return E(r,{code:p.invalid_type,expected:h.object,received:r.parsedType}),S;let n=[],i=this._def.keyType,a=this._def.valueType;for(let e in r.data)n.push({key:i._parse(new O(r,e,r.path,e)),value:a._parse(new O(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?A.mergeObjectAsync(t,n):A.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new ev(t instanceof F?{keyType:e,valueType:t,typeName:c.ZodRecord,...N(r)}:{keyType:ee.create(),valueType:e,typeName:c.ZodRecord,...N(t)})}}class eb extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.map)return E(r,{code:p.invalid_type,expected:h.map,received:r.parsedType}),S;let n=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([e,t],a)=>({key:n._parse(new O(r,e,r.path,[a,"key"])),value:i._parse(new O(r,t,r.path,[a,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of a){let n=await r.key,i=await r.value;if("aborted"===n.status||"aborted"===i.status)return S;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of a){let n=r.key,i=r.value;if("aborted"===n.status||"aborted"===i.status)return S;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}}}eb.create=(e,t,r)=>new eb({valueType:t,keyType:e,typeName:c.ZodMap,...N(r)});class ex extends F{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.set)return E(r,{code:p.invalid_type,expected:h.set,received:r.parsedType}),S;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(E(r,{code:p.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(E(r,{code:p.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function a(e){let r=new Set;for(let n of e){if("aborted"===n.status)return S;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>i._parse(new O(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>a(e)):a(s)}min(e,t){return new ex({...this._def,minSize:{value:e,message:u.toString(t)}})}max(e,t){return new ex({...this._def,maxSize:{value:e,message:u.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ex.create=(e,t)=>new ex({valueType:e,minSize:null,maxSize:null,typeName:c.ZodSet,...N(t)});class eT extends F{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.function)return E(t,{code:p.invalid_type,expected:h.function,received:t.parsedType}),S;function r(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,y,g].filter(e=>!!e),issueData:{code:p.invalid_arguments,argumentsError:r}})}function n(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,y,g].filter(e=>!!e),issueData:{code:p.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof eP){let e=this;return C(async function(...t){let s=new m([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw s.addIssue(r(t,e)),s}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw s.addIssue(n(l,e)),s})})}{let e=this;return C(function(...t){let s=e._def.args.safeParse(t,i);if(!s.success)throw new m([r(t,s.error)]);let o=Reflect.apply(a,this,s.data),l=e._def.returns.safeParse(o,i);if(!l.success)throw new m([n(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eT({...this._def,args:ey.create(e).rest(eu.create())})}returns(e){return new eT({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eT({args:e||ey.create([]).rest(eu.create()),returns:t||eu.create(),typeName:c.ZodFunction,...N(r)})}}class eE extends F{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}eE.create=(e,t)=>new eE({getter:e,typeName:c.ZodLazy,...N(t)});class eA extends F{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),S}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eS(e,t){return new eI({values:e,typeName:c.ZodEnum,...N(t)})}eA.create=(e,t)=>new eA({value:e,typeName:c.ZodLiteral,...N(t)});class eI extends F{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{expected:o.joinValues(r),received:t.parsedType,code:p.invalid_type}),S}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{received:t.data,code:p.invalid_enum_value,options:r}),S}return C(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eI.create(e,{...this._def,...t})}exclude(e,t=this._def){return eI.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}eI.create=eS;class eC extends F{_parse(e){let t=o.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==h.string&&r.parsedType!==h.number){let e=o.objectValues(t);return E(r,{expected:o.joinValues(e),received:r.parsedType,code:p.invalid_type}),S}if(this._cache||(this._cache=new Set(o.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=o.objectValues(t);return E(r,{received:r.data,code:p.invalid_enum_value,options:e}),S}return C(e.data)}get enum(){return this._def.values}}eC.create=(e,t)=>new eC({values:e,typeName:c.ZodNativeEnum,...N(t)});class eP extends F{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==h.promise&&!1===t.common.async?(E(t,{code:p.invalid_type,expected:h.promise,received:t.parsedType}),S):C((t.parsedType===h.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eP.create=(e,t)=>new eP({type:e,typeName:c.ZodPromise,...N(t)});class eR extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===c.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{E(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){let e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return S;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?S:"dirty"===n.status||"dirty"===t.value?I(n.value):n});{if("aborted"===t.value)return S;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?S:"dirty"===n.status||"dirty"===t.value?I(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?S:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?S:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>w(e)?Promise.resolve(n.transform(e.value,i)).then(e=>({status:t.value,value:e})):S);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!w(e))return S;let a=n.transform(e.value,i);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}o.assertNever(n)}}eR.create=(e,t,r)=>new eR({schema:e,typeName:c.ZodEffects,effect:t,...N(r)}),eR.createWithPreprocess=(e,t,r)=>new eR({schema:t,effect:{type:"preprocess",transform:e},typeName:c.ZodEffects,...N(r)});class ew extends F{_parse(e){return this._getType(e)===h.undefined?C(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ew.create=(e,t)=>new ew({innerType:e,typeName:c.ZodOptional,...N(t)});class eM extends F{_parse(e){return this._getType(e)===h.null?C(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eM.create=(e,t)=>new eM({innerType:e,typeName:c.ZodNullable,...N(t)});class eO extends F{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===h.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eO.create=(e,t)=>new eO({innerType:e,typeName:c.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...N(t)});class eL extends F{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return M(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new m(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new m(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eL.create=(e,t)=>new eL({innerType:e,typeName:c.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...N(t)});class eN extends F{_parse(e){if(this._getType(e)!==h.nan){let t=this._getOrReturnCtx(e);return E(t,{code:p.invalid_type,expected:h.nan,received:t.parsedType}),S}return{status:"valid",value:e.data}}}eN.create=e=>new eN({typeName:c.ZodNaN,...N(e)});let eF=Symbol("zod_brand");class eD extends F{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class eB extends F{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?S:"dirty"===e.status?(t.dirty(),I(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?S:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new eB({in:e,out:t,typeName:c.ZodPipeline})}}class ek extends F{_parse(e){let t=this._def.innerType._parse(e),r=e=>(w(e)&&(e.value=Object.freeze(e.value)),e);return M(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eG(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eU(e,t={},r){return e?el.create().superRefine((n,i)=>{let a=e(n);if(a instanceof Promise)return a.then(e=>{if(!e){let e=eG(t,n),a=e.fatal??r??!0;i.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=eG(t,n),a=e.fatal??r??!0;i.addIssue({code:"custom",...e,fatal:a})}}):el.create()}ek.create=(e,t)=>new ek({innerType:e,typeName:c.ZodReadonly,...N(t)});let eV={object:ef.lazycreate};(s=c||(c={})).ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly";let eH=(e,t={message:`Input not instance of ${e.name}`})=>eU(t=>t instanceof e,t),e$=ee.create,eW=et.create,ej=eN.create,ez=er.create,eY=en.create,eK=ei.create,eX=ea.create,eZ=es.create,eq=eo.create,eQ=el.create,eJ=eu.create,e0=ec.create,e1=ed.create,e2=eh.create,e3=ef.create,e4=ef.strictCreate,e5=ep.create,e6=em.create,e8=eg.create,e7=ey.create,e9=ev.create,te=eb.create,tt=ex.create,tr=eT.create,tn=eE.create,ti=eA.create,ta=eI.create,ts=eC.create,to=eP.create,tl=eR.create,tu=ew.create,tc=eM.create,td=eR.createWithPreprocess,th=eB.create,tf=()=>e$().optional(),tp=()=>eW().optional(),t_=()=>eY().optional(),tm={string:e=>ee.create({...e,coerce:!0}),number:e=>et.create({...e,coerce:!0}),boolean:e=>en.create({...e,coerce:!0}),bigint:e=>er.create({...e,coerce:!0}),date:e=>ei.create({...e,coerce:!0})},tg=S},27060:function(e,t,r){r.r(t),r.d(t,{gaussianSplattingPixelShaderWGSL:()=>l});var n=r(66755);r(87889),r(33083),r(22526),r(23203),r(41001);let i="gaussianSplattingFragmentDeclaration",a=`fn gaussianColor(inColor: vec4f,inPosition: vec2f)->vec4f
{var A : f32=-dot(inPosition,inPosition);if (A>-4.0)
{var B: f32=exp(A)*inColor.a;
#include<logDepthFragment>
var color: vec3f=inColor.rgb;
#ifdef FOG
#include<fogFragment>
#endif
return vec4f(color,B);} else {return vec4f(0.0);}}
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a),r(39220);let s="gaussianSplattingPixelShader",o=`#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
varying vColor: vec4f;varying vPosition: vec2f;
#include<gaussianSplattingFragmentDeclaration>
@fragment
fn main(input: FragmentInputs)->FragmentOutputs {
#include<clipPlaneFragment>
fragmentOutputs.color=gaussianColor(input.vColor,input.vPosition);}
`;n.v.ShadersStoreWGSL[s]||(n.v.ShadersStoreWGSL[s]=o);let l={name:s,shader:o}},27222:function(e,t,r){var n=r(66755);let i="sceneUboDeclaration",a=`struct Scene {viewProjection : mat4x4<f32>,
#ifdef MULTIVIEW
viewProjectionR : mat4x4<f32>,
#endif 
view : mat4x4<f32>,
projection : mat4x4<f32>,
vEyePosition : vec4<f32>,};
#define SCENE_UBO
var<uniform> scene : Scene;
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},27736:function(e,t,r){r.d(t,{k:()=>n});function n(e,t){if("vertex"===e){let e={CUSTOM_VERTEX_DEFINITIONS:`
                attribute float grl_widths;
                attribute vec3 grl_offsets;
                attribute float grl_colorPointers;
                varying float grlCounters;
                varying float grlColorPointer;

                #ifdef GREASED_LINE_CAMERA_FACING
                    attribute vec4 grl_previousAndSide;
                    attribute vec4 grl_nextAndCounters;

                    vec2 grlFix( vec4 i, float aspect ) {
                        vec2 res = i.xy / i.w;
                        res.x *= aspect;
                        return res;
                    }
                #else
                    attribute vec3 grl_slopes;
                    attribute float grl_counters;
                #endif
                `,CUSTOM_VERTEX_UPDATE_POSITION:`
                #ifdef GREASED_LINE_CAMERA_FACING
                    vec3 grlPositionOffset = grl_offsets;
                    positionUpdated += grlPositionOffset;
                #else
                    positionUpdated = (positionUpdated + grl_offsets) + (grl_slopes * grl_widths);
                #endif
                `,CUSTOM_VERTEX_MAIN_END:`
                grlColorPointer = grl_colorPointers;

                #ifdef GREASED_LINE_CAMERA_FACING

                    float grlAspect = grl_aspect_resolution_lineWidth.x;
                    float grlBaseWidth = grl_aspect_resolution_lineWidth.w;

                    vec3 grlPrevious = grl_previousAndSide.xyz;
                    float grlSide = grl_previousAndSide.w;

                    vec3 grlNext = grl_nextAndCounters.xyz;
                    grlCounters = grl_nextAndCounters.w;
                    float grlWidth = grlBaseWidth * grl_widths;
                    
                    vec3 worldDir = normalize(grlNext - grlPrevious);
                    vec3 nearPosition = positionUpdated + (worldDir * 0.001);
                    mat4 grlMatrix = viewProjection * finalWorld;
                    vec4 grlFinalPosition = grlMatrix * vec4(positionUpdated , 1.0);
                    vec4 screenNearPos = grlMatrix * vec4(nearPosition, 1.0);
                    vec2 grlLinePosition = grlFix(grlFinalPosition, grlAspect);
                    vec2 grlLineNearPosition = grlFix(screenNearPos, grlAspect);
                    vec2 grlDir = normalize(grlLineNearPosition - grlLinePosition);

                    vec4 grlNormal = vec4(-grlDir.y, grlDir.x, 0., 1.);

                    #ifdef GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM
                        grlNormal.xy *= -.5 * grlWidth;
                    #else
                        grlNormal.xy *= .5 * grlWidth;
                    #endif

                    grlNormal *= grl_projection;

                    #ifdef GREASED_LINE_SIZE_ATTENUATION
                        grlNormal.xy *= grlFinalPosition.w;
                        grlNormal.xy /= (vec4(grl_aspect_resolution_lineWidth.yz, 0., 1.) * grl_projection).xy;
                    #endif

                    grlFinalPosition.xy += grlNormal.xy * grlSide;
                    gl_Position = grlFinalPosition;

                    vPositionW = vec3(grlFinalPosition);
                #else
                    grlCounters = grl_counters;
                #endif
                `};return t&&(e["!gl_Position\\=viewProjection\\*worldPos;"]="//"),e}return"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:`
                    #ifdef PBR
                         #define grlFinalColor finalColor
                    #else
                         #define grlFinalColor color
                    #endif

                    varying float grlCounters;
                    varying float grlColorPointer;
                    uniform sampler2D grl_colors;
                `,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:`
                    float grlColorMode = grl_colorMode_visibility_colorsWidth_useColors.x;
                    float grlVisibility = grl_colorMode_visibility_colorsWidth_useColors.y;
                    float grlColorsWidth = grl_colorMode_visibility_colorsWidth_useColors.z;
                    float grlUseColors = grl_colorMode_visibility_colorsWidth_useColors.w;

                    float grlUseDash = grl_dashOptions.x;
                    float grlDashArray = grl_dashOptions.y;
                    float grlDashOffset = grl_dashOptions.z;
                    float grlDashRatio = grl_dashOptions.w;

                    grlFinalColor.a *= step(grlCounters, grlVisibility);
                    if(grlFinalColor.a == 0.) discard;

                    if(grlUseDash == 1.){
                        grlFinalColor.a *= ceil(mod(grlCounters + grlDashOffset, grlDashArray) - (grlDashArray * grlDashRatio));
                        if (grlFinalColor.a == 0.) discard;
                    }

                    #ifdef GREASED_LINE_HAS_COLOR
                        if (grlColorMode == 0.) {
                            grlFinalColor.rgb = grl_singleColor;
                        } else if (grlColorMode == 1.) {
                            grlFinalColor.rgb += grl_singleColor;
                        } else if (grlColorMode == 2.) {
                            grlFinalColor.rgb *= grl_singleColor;
                        }
                    #else
                        if (grlUseColors == 1.) {
                            #ifdef GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE
                                vec4 grlColor = texture2D(grl_colors, vec2(grlCounters, 0.), 0.);
                            #else
                                vec2 lookup = vec2(fract(grlColorPointer / grl_textureSize.x), 1.0 - floor(grlColorPointer / grl_textureSize.x) / max(grl_textureSize.y - 1.0, 1.0));
                                vec4 grlColor = texture2D(grl_colors, lookup, 0.0);
                            #endif
                            if (grlColorMode == 0.) {
                                grlFinalColor = grlColor;
                            } else if (grlColorMode == 1.) {
                                grlFinalColor += grlColor;
                            } else if (grlColorMode == 2.) {
                                grlFinalColor *= grlColor;
                            }
                        }
                    #endif
                `}:null}},28465:function(e,t,r){r.d(t,{k:()=>n});function n(e,t){if("vertex"===e){let e={CUSTOM_VERTEX_DEFINITIONS:`
                attribute grl_widths: f32;
                attribute grl_colorPointers: f32;
                varying grlCounters: f32;
                varying grlColorPointer: f32;

                #ifdef GREASED_LINE_USE_OFFSETS
                    attribute grl_offsets: vec3f;   
                #endif

                #ifdef GREASED_LINE_CAMERA_FACING
                    attribute grl_previousAndSide : vec4f;
                    attribute grl_nextAndCounters : vec4f;

                    fn grlFix(i: vec4f, aspect: f32) -> vec2f {
                        var res = i.xy / i.w;
                        res.x *= aspect;
                        return res;
                    }
                #else
                    attribute grl_slopes: f32;
                    attribute grl_counters: f32;
                #endif


                `,CUSTOM_VERTEX_UPDATE_POSITION:`
                #ifdef GREASED_LINE_USE_OFFSETS
                    var grlPositionOffset: vec3f = input.grl_offsets;
                #else
                    var grlPositionOffset = vec3f(0.);
                #endif

                #ifdef GREASED_LINE_CAMERA_FACING
                    positionUpdated += grlPositionOffset;
                #else
                    positionUpdated = (positionUpdated + grlPositionOffset) + (input.grl_slopes * input.grl_widths);
                #endif
                `,CUSTOM_VERTEX_MAIN_END:`
                vertexOutputs.grlColorPointer = input.grl_colorPointers;

                #ifdef GREASED_LINE_CAMERA_FACING

                    let grlAspect: f32 = uniforms.grl_aspect_resolution_lineWidth.x;
                    let grlBaseWidth: f32 = uniforms.grl_aspect_resolution_lineWidth.w;

                    let grlPrevious: vec3f = input.grl_previousAndSide.xyz;
                    let grlSide: f32 = input.grl_previousAndSide.w;

                    let grlNext: vec3f = input.grl_nextAndCounters.xyz;
                    vertexOutputs.grlCounters = input.grl_nextAndCounters.w;

                    let grlWidth: f32 = grlBaseWidth * input.grl_widths;

                    let worldDir: vec3f = normalize(grlNext - grlPrevious);
                    let nearPosition: vec3f = positionUpdated + (worldDir * 0.001);
                    let grlMatrix: mat4x4f = uniforms.viewProjection * finalWorld;
                    let grlFinalPosition: vec4f = grlMatrix * vec4f(positionUpdated, 1.0); 
                    let screenNearPos: vec4f = grlMatrix * vec4(nearPosition, 1.0);
                    let grlLinePosition: vec2f = grlFix(grlFinalPosition, grlAspect);
                    let grlLineNearPosition: vec2f = grlFix(screenNearPos, grlAspect);
                    let grlDir: vec2f = normalize(grlLineNearPosition - grlLinePosition);

                    var grlNormal: vec4f = vec4f(-grlDir.y, grlDir.x, 0.0, 1.0);

                    let grlHalfWidth: f32 = 0.5 * grlWidth;
                    #if defined(GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM)
                        grlNormal.x *= -grlHalfWidth;
                        grlNormal.y *= -grlHalfWidth;
                    #else
                        grlNormal.x *= grlHalfWidth;
                        grlNormal.y *= grlHalfWidth;
                    #endif

                    grlNormal *= uniforms.grl_projection;

                    #if defined(GREASED_LINE_SIZE_ATTENUATION)
                        grlNormal.x *= grlFinalPosition.w;
                        grlNormal.y *= grlFinalPosition.w;

                        let pr = vec4f(uniforms.grl_aspect_resolution_lineWidth.yz, 0.0, 1.0) * uniforms.grl_projection;
                        grlNormal.x /= pr.x;
                        grlNormal.y /= pr.y;
                    #endif

                    vertexOutputs.position = vec4f(grlFinalPosition.xy + grlNormal.xy * grlSide, grlFinalPosition.z, grlFinalPosition.w);
                    vertexOutputs.vPositionW = vertexOutputs.position.xyz;
                
                #else
                    vertexOutputs.grlCounters = input.grl_counters;
                #endif
                `};return t&&(e["!vertexOutputs\\.position\\s=\\sscene\\.viewProjection\\s\\*\\sworldPos;"]="//"),e}return"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:`
                    #ifdef PBR
                         #define grlFinalColor finalColor
                    #else
                         #define grlFinalColor color
                    #endif

                    varying grlCounters: f32;
                    varying grlColorPointer: 32;

                    var grl_colors: texture_2d<f32>;
                    var grl_colorsSampler: sampler;
                `,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:`
                    let grlColorMode: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.x;
                    let grlVisibility: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.y;
                    let grlColorsWidth: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.z;
                    let grlUseColors: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.w;

                    let grlUseDash: f32 = uniforms.grl_dashOptions.x;
                    let grlDashArray: f32 = uniforms.grl_dashOptions.y;
                    let grlDashOffset: f32 = uniforms.grl_dashOptions.z;
                    let grlDashRatio: f32 = uniforms.grl_dashOptions.w;

                    grlFinalColor.a *= step(fragmentInputs.grlCounters, grlVisibility);
                    if (grlFinalColor.a == 0.0) {
                        discard;
                    }

                    if (grlUseDash == 1.0) {
                        let dashPosition = (fragmentInputs.grlCounters + grlDashOffset) % grlDashArray;
                        grlFinalColor.a *= ceil(dashPosition - (grlDashArray * grlDashRatio));

                        if (grlFinalColor.a == 0.0) {
                            discard;
                        }
                    }

                    #ifdef GREASED_LINE_HAS_COLOR
                        if (grlColorMode == 0.) {
                            grlFinalColor = vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        } else if (grlColorMode == 1.) {
                            grlFinalColor += vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        } else if (grlColorMode == 2.) {
                            grlFinalColor *= vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        }
                    #else
                        if (grlUseColors == 1.) {
                            #ifdef GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE
                                let grlColor: vec4f = textureSample(grl_colors, grl_colorsSampler, vec2f(fragmentInputs.grlCounters, 0.));
                            #else
                                let lookup: vec2f = vec2(fract(fragmentInputs.grlColorPointer / uniforms.grl_textureSize.x), 1.0 - floor(fragmentInputs.grlColorPointer / uniforms.grl_textureSize.x) / max(uniforms.grl_textureSize.y - 1.0, 1.0));
                                let grlColor: vec4f = textureSample(grl_colors, grl_colorsSampler, lookup);
                            #endif
                            if (grlColorMode == 0.) {
                                grlFinalColor = grlColor;
                            } else if (grlColorMode == 1.) {
                                grlFinalColor += grlColor;
                            } else if (grlColorMode == 2.) {
                                grlFinalColor *= grlColor;
                            }
                        }
                    #endif


                `}:null}},28564:function(e,t,r){var n=r(66755);let i="sceneUboDeclaration",a=`layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif 
mat4 view;mat4 projection;vec4 vEyePosition;};
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},30060:function(e,t,r){var n=r(82961),i=r(20534),a=r(72384),s=r(90481),o=r(61834),l=r(32556),u=r(17133),c=r(87286);function d(e,t){let r=new l.M(e,void 0,!0,t);return r.addUniform("viewProjection",16),r.addUniform("viewProjectionR",16),r.addUniform("view",16),r.addUniform("projection",16),r.addUniform("vEyePosition",4),r}i.D.prototype.createMultiviewRenderTargetTexture=function(e,t,r,n){let i=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";let a=this._createHardwareRenderTargetWrapper(!1,!1,{width:e,height:t});a._framebuffer=i.createFramebuffer();let o=new s.l(this,0,!0);return o.width=e,o.height=t,o.isMultiview=!0,r||(r=i.createTexture(),i.bindTexture(i.TEXTURE_2D_ARRAY,r),i.texStorage3D(i.TEXTURE_2D_ARRAY,1,i.RGBA8,e,t,2)),a._colorTextureArray=r,n||(n=i.createTexture(),i.bindTexture(i.TEXTURE_2D_ARRAY,n),i.texStorage3D(i.TEXTURE_2D_ARRAY,1,i.DEPTH24_STENCIL8,e,t,2)),a._depthStencilTextureArray=n,o.isReady=!0,a.setTextures(o),a._depthStencilTexture=o,a},i.D.prototype.bindMultiviewFramebuffer=function(e){let t=this._gl,r=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),e._colorTextureArray&&e._depthStencilTextureArray)this.getCaps().oculusMultiview?(r.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,e.samples,0,2),r.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,e.samples,0,2)):(r.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),r.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2));else throw"Invalid multiview frame buffer"},i.D.prototype.bindSpaceWarpFramebuffer=function(e){let t=this._gl,r=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),e._colorTextureArray&&e._depthStencilTextureArray)r.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),r.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_ATTACHMENT,e._depthStencilTextureArray,0,0,2);else throw Error("Invalid Space Warp framebuffer")},n.V.prototype._useMultiviewToSingleView=!1,n.V.prototype._multiviewTexture=null,n.V.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?(this._multiviewTexture.getRenderWidth()!=e||this._multiviewTexture.getRenderHeight()!=t)&&(this._multiviewTexture.dispose(),this._multiviewTexture=new u.x(this.getScene(),{width:e,height:t})):this._multiviewTexture=new u.x(this.getScene(),{width:e,height:t})};let h=a.x.prototype.createSceneUniformBuffer;a.x.prototype._transformMatrixR=o.y3.Zero(),a.x.prototype._multiviewSceneUbo=null,a.x.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=d(this.getEngine(),"scene_multiview")},a.x.prototype.createSceneUniformBuffer=function(e){return this._multiviewSceneUbo?d(this.getEngine(),e):h.bind(this)(e)},a.x.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,o.jp.Matrix["0"]),c.i.GetRightPlaneToRef(o.jp.Matrix["0"],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.updateMatrix("projection",this._projectionMatrix))},a.x.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(let t=0;t<e._rigCameras.length;t++){let r=this.getEngine();this._activeCamera=e._rigCameras[t],r.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}}},30554:function(e,t,r){r.d(t,{Z:()=>a});var n=r(16891),i=r(56865);class a{get underlyingResource(){return this._webgpuTexture}getMSAATexture(e){return this._webgpuMSAATexture?.[e]??null}setMSAATexture(e,t){this._webgpuMSAATexture||(this._webgpuMSAATexture=[]),this._webgpuMSAATexture[t]=e}releaseMSAATexture(e){if(this._webgpuMSAATexture)if(void 0!==e)this._engine._textureHelper.releaseTexture(this._webgpuMSAATexture[e]),delete this._webgpuMSAATexture[e];else{for(let e of this._webgpuMSAATexture)this._engine._textureHelper.releaseTexture(e);this._webgpuMSAATexture=null}}constructor(e,t=null){this._engine=e,this._originalFormatIsRGB=!1,this.format="rgba8unorm",this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=t,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null}set(e){this._webgpuTexture=e}setUsage(e,t,r,a,s,o,l,u){let c="2d",d=1;a?(c=r?"cube-array":"cube",d=6*(u||1)):s?(c="3d",d=1):r&&(c="2d-array",d=u);let h=i.D.GetDepthFormatOnly(this.format),f=i.D.HasDepthAndStencilAspects(this.format)?"depth-only":"all";this.createView({label:`TextureView${s?"3D":a?"Cube":"2D"}${r?"_Array"+d:""}_${o}x${l}_${t?"wmips":"womips"}_${this.format}_${c}`,format:h,dimension:c,mipLevelCount:t?(0,n.ILog2)(Math.max(o,l))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:d,aspect:f})}createView(e,t=!1){if(this.view=this._webgpuTexture.createView(e),t&&e){let t=e.mipLevelCount;e.mipLevelCount=1,this.viewForWriting=this._webgpuTexture.createView(e),e.mipLevelCount=t}}reset(){this._webgpuTexture=null,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null}release(){this._webgpuTexture?.destroy(),this.releaseMSAATexture(),this._copyInvertYTempTexture?.destroy(),this.reset()}}},31440:function(e,t,r){r.r(t),r.d(t,{clipPlaneVertexWGSL:()=>s});var n=r(66755);let i="clipPlaneVertex",a=`#ifdef CLIPPLANE
vertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);
#endif
#ifdef CLIPPLANE2
vertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);
#endif
#ifdef CLIPPLANE3
vertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);
#endif
#ifdef CLIPPLANE4
vertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);
#endif
#ifdef CLIPPLANE5
vertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);
#endif
#ifdef CLIPPLANE6
vertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},3155:function(e,t,r){r.d(t,{i:()=>a});var n=r(74549),i=r(74913);class a{constructor(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=n.x.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=n.x.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,this.forceRenderingWhenOccluded=!1}}i.a.prototype.createQuery=function(){return null},i.a.prototype.deleteQuery=function(e){return this},i.a.prototype.isQueryResultAvailable=function(e){return!1},i.a.prototype.getQueryResult=function(e){return 0},i.a.prototype.beginOcclusionQuery=function(e,t){return!1},i.a.prototype.endOcclusionQuery=function(e){return this},Object.defineProperty(n.x.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(e){this._occlusionDataStorage.isOcclusionQueryInProgress=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.x.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new a),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(n.x.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.x.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.x.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.x.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.x.prototype,"forceRenderingWhenOccluded",{get:function(){return this._occlusionDataStorage.forceRenderingWhenOccluded},set:function(e){this._occlusionDataStorage.forceRenderingWhenOccluded=e},enumerable:!0,configurable:!0}),n.x.prototype._checkOcclusionQuery=function(){let e=this._occlusionDataStorage;if(e.occlusionType===n.x.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;let t=this.getEngine();if(!t.getCaps().supportOcclusionQuery||!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&null!==this._occlusionQuery&&void 0!==this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){let r=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=!(r>0)}else{if(e.occlusionInternalRetryCounter++,-1===e.occlusionRetryCount||!(e.occlusionInternalRetryCounter>e.occlusionRetryCount))return e.occlusionType!==n.x.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==n.x.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}let r=this.getScene();if(r.getBoundingBoxRenderer){let n=r.getBoundingBoxRenderer();null===this._occlusionQuery&&(this._occlusionQuery=t.createQuery()),this._occlusionQuery&&t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery)&&(n.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0)}return e.isOccluded}},31678:function(e,t,r){r.d(t,{Z:()=>i});var n=r(22540);class i extends n.Z{constructor(e,t){super(e),this.pressPoint=.5,t>=0&&(this.pressPoint=t)}evaluate(){var e;return+(((null==(e=this.action.activeControl)?void 0:e.magnitude())||0)>=this.pressPoint)}}},31974:function(e,t,r){var n=r(66755);let i="pointCloudVertex",a=`#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},32155:function(e,t,r){r.d(t,{T:()=>o});var n=r(31913),i=r(6648),a=r(88280),s=r(55687);class o{get fogEnabled(){return this._fogEnabled}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this._createEffects())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){let t=!!this._scene?.getEngine().getCaps().fragmentDepthSupported;e&&!t&&a.Y.Warn("Logarithmic depth has been requested for a sprite renderer on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._createEffects()}get capacity(){return this._capacity}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(e){this._pixelPerfect!==e&&(this._pixelPerfect=e,this._createEffects())}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,r=.01,i=null,a){let s;this.blendMode=2,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this._fogEnabled=!0,this._pixelPerfect=!1,this._shaderLanguage=0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._isDisposed=!1,this._shadersLoaded=!1,this._pixelPerfect=a?.pixelPerfect??!1,this._capacity=t,this._epsilon=r,this._engine=e,this._useInstancing=e.getCaps().instancedArrays&&e._features.supportSpriteInstancing,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects,this._scene=i,this._useInstancing||this._buildIndexBuffer(),this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(t*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new n.l(e,this._vertexData,!0,this._vertexBufferSize);let o=this._buffer.createVertexBuffer(n.o.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),l=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing),u=6;if(this._useInstancing){let t=new Float32Array([this._epsilon,this._epsilon,1-this._epsilon,this._epsilon,this._epsilon,1-this._epsilon,1-this._epsilon,1-this._epsilon]);this._spriteBuffer=new n.l(e,t,!1,2),s=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else s=this._buffer.createVertexBuffer("offsets",u,2,this._vertexBufferSize,this._useInstancing),u+=2;let c=this._buffer.createVertexBuffer("inverts",u,2,this._vertexBufferSize,this._useInstancing),d=this._buffer.createVertexBuffer("cellInfo",u+2,4,this._vertexBufferSize,this._useInstancing),h=this._buffer.createVertexBuffer(n.o.ColorKind,u+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.o.PositionKind]=o,this._vertexBuffers.options=l,this._vertexBuffers.offsets=s,this._vertexBuffers.inverts=c,this._vertexBuffers.cellInfo=d,this._vertexBuffers[n.o.ColorKind]=h,this._initShaderSourceAsync()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!o.ForceGLSL?(this._shaderLanguage=1,await Promise.all([r.e("7809").then(r.bind(r,43164)),r.e("5630").then(r.bind(r,40393))])):await Promise.all([r.e("2070").then(r.bind(r,11305)),r.e("833").then(r.bind(r,52026))]),this._shadersLoaded=!0,this._createEffects()}_createEffects(){if(this._isDisposed||!this._shadersLoaded)return;this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._drawWrapperBase=new i.q(this._engine),this._drawWrapperDepth=new i.q(this._engine,!1),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=this._useInstancing),this._drawWrapperDepth.drawContext&&(this._drawWrapperDepth.drawContext.useInstancing=this._useInstancing);let e="";this._pixelPerfect&&(e+="#define PIXEL_PERFECT\n"),this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode&&this._fogEnabled&&(e+="#define FOG\n"),this._useLogarithmicDepth&&(e+="#define LOGARITHMICDEPTH\n"),this._drawWrapperBase.effect=this._engine.createEffect("sprites",[n.o.PositionKind,"options","offsets","inverts","cellInfo",n.o.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor","logarithmicDepthConstant"],["diffuseSampler"],e,void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperDepth.effect=this._drawWrapperBase.effect,this._drawWrapperBase.effect._refCount++,this._drawWrapperDepth.materialContext=this._drawWrapperBase.materialContext}render(e,t,r,n,i=null){if(!this._shadersLoaded||!this.texture||!this.texture.isReady()||!e.length)return;let a=this._drawWrapperBase,o=this._drawWrapperDepth,l=this.fogEnabled&&this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode,u=a.effect;if(!u.isReady())return;let c=this._engine,d=!!(this._scene&&this._scene.useRightHandedSystem),h=Math.min(this._capacity,e.length),f=0,p=!0;for(let r=0;r<h;r++){let n=e[r];if(!n||!n.isVisible)continue;p=!1,n._animate(t);let a=this.texture.getBaseSize();this._appendSpriteVertex(f++,n,0,0,a,d,i),this._useInstancing||(this._appendSpriteVertex(f++,n,1,0,a,d,i),this._appendSpriteVertex(f++,n,1,1,a,d,i),this._appendSpriteVertex(f++,n,0,1,a,d,i))}if(p)return;this._buffer.update(this._vertexData);let _=!!c.depthCullingState.cull,m=c.depthCullingState.zOffset,g=c.depthCullingState.zOffsetUnits;if(c.setState(_,m,!1,!1,void 0,void 0,g),c.enableEffect(a),u.setTexture("diffuseSampler",this.texture),u.setMatrix("view",r),u.setMatrix("projection",n),l){let e=this._scene;u.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),u.setColor3("vFogColor",e.fogColor)}this.useLogarithmicDepth&&this._scene&&(0,s.gz)(a.defines,u,this._scene),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=c.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,u)),c.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):c.bindBuffers(this._vertexBuffers,this._indexBuffer,u),c.depthCullingState.depthFunc=c.useReverseDepthBuffer?518:515,this.disableDepthWrite||(u.setBool("alphaTest",!0),c.setColorWrite(!1),c.enableEffect(o),this._useInstancing?c.drawArraysType(7,0,4,f):c.drawElementsType(0,0,f/4*6),c.enableEffect(a),c.setColorWrite(!0),u.setBool("alphaTest",!1)),c.setAlphaMode(this.blendMode),this._useInstancing?c.drawArraysType(7,0,4,f):c.drawElementsType(0,0,f/4*6),this.autoResetAlpha&&c.setAlphaMode(0),d&&this._scene.getEngine().setState(_,m,!1,!0,void 0,void 0,g),c.unbindInstanceAttributes()}_appendSpriteVertex(e,t,r,n,i,a,s){let o=e*this._vertexBufferSize;if(0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),s)s(t,i);else{t.cellIndex||(t.cellIndex=0);let e=i.width/this.cellWidth,r=t.cellIndex/e|0;t._xOffset=(t.cellIndex-r*e)*this.cellWidth/i.width,t._yOffset=r*this.cellHeight/i.height,t._xSize=this.cellWidth,t._ySize=this.cellHeight}this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._useInstancing?o-=2:(this._vertexData[o+6]=r,this._vertexData[o+7]=n),a?this._vertexData[o+8]=+!t.invertU:this._vertexData[o+8]=+!!t.invertU,this._vertexData[o+9]=+!!t.invertV,this._vertexData[o+10]=t._xOffset,this._vertexData[o+11]=t._yOffset,this._vertexData[o+12]=t._xSize/i.width,this._vertexData[o+13]=t._ySize/i.height,this._vertexData[o+14]=t.color.r,this._vertexData[o+15]=t.color.g,this._vertexData[o+16]=t.color.b,this._vertexData[o+17]=t.color.a}_buildIndexBuffer(){let e=[],t=0;for(let r=0;r<this._capacity;r++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}rebuild(){for(let e in this._indexBuffer&&this._buildIndexBuffer(),this._useVAO&&(this._vertexArrayObject=void 0),this._buffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild();this._spriteBuffer?._rebuild()}dispose(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null),this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._isDisposed=!0}}o.ForceGLSL=!1},32785:function(e,t,r){r.r(t),r.d(t,{colorVertexShader:()=>s});var n=r(66755);r(33414),r(76438),r(16397),r(94838),r(99046),r(20536),r(5929),r(4194),r(20995),r(5242),r(86019);let i="colorVertexShader",a=`attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#ifdef FOG
uniform mat4 view;
#endif
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<vertexColorMixing>
#define CUSTOM_VERTEX_MAIN_END
}`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a);let s={name:i,shader:a}},33083:function(e,t,r){var n=r(66755);let i="logDepthDeclaration",a=`#ifdef LOGARITHMICDEPTH
uniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},33414:function(e,t,r){r.r(t),r.d(t,{bonesDeclaration:()=>s});var n=r(66755);let i="bonesDeclaration",a=`#if NUM_BONE_INFLUENCERS>0
attribute vec4 matricesIndices;attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
uniform highp sampler2D boneSampler;uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}
#endif
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},33716:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise3D=void 0;var r=1/6,n=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,-1],[0,1,-1],[0,-1,-1]];t.makeNoise3D=function(e){void 0===e&&(e=Math.random);for(var t,i,a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;for(var s=255;s>0;s--)t=Math.floor((s+1)*e()),i=a[s],a[s]=a[t],a[t]=i;for(var o=new Uint8Array(512),l=new Uint8Array(512),s=0;s<512;s++)o[s]=a[255&s],l[s]=o[s]%12;return function(e,t,i){var a,s,u,c,d,h,f=(e+t+i)/3,p=Math.floor(e+f),_=Math.floor(t+f),m=Math.floor(i+f),g=(p+_+m)*r,y=e-(p-g),v=t-(_-g),b=i-(m-g);y>=v?v>=b?(a=c=d=1,s=u=h=0):y>=b?(a=c=h=1,s=u=d=0):(u=c=h=1,a=s=d=0):v<b?(u=d=h=1,a=s=c=0):y<b?(s=d=h=1,a=u=c=0):(s=c=d=1,a=u=h=0);var x=y-a+r,T=v-s+r,E=b-u+r,A=y-c+2*r,S=v-d+2*r,I=b-h+2*r,C=y-1+3*r,P=v-1+3*r,R=b-1+3*r,w=255&p,M=255&_,O=255&m,L=n[l[w+o[M+o[O]]]],N=n[l[w+a+o[M+s+o[O+u]]]],F=n[l[w+c+o[M+d+o[O+h]]]],D=n[l[w+1+o[M+1+o[O+1]]]],B=.5-y*y-v*v-b*b,k=B<0?0:Math.pow(B,4)*(L[0]*y+L[1]*v+L[2]*b),G=.5-x*x-T*T-E*E,U=G<0?0:Math.pow(G,4)*(N[0]*x+N[1]*T+N[2]*E),V=.5-A*A-S*S-I*I,H=V<0?0:Math.pow(V,4)*(F[0]*A+F[1]*S+F[2]*I),$=.5-C*C-P*P-R*R;return 94.68493150681972*(k+U+H+($<0?0:Math.pow($,4)*(D[0]*C+D[1]*P+D[2]*R)))}}},34410:function(e,t,r){var n=r(66755);let i="bakedVertexAnimationDeclaration",a=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;
#ifdef INSTANCES
attribute bakedVertexAnimationSettingsInstanced : vec4<f32>;
#endif
fn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>
{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},34416:function(e,t,r){r.d(t,{S1:()=>Q,ZP:()=>q,t:()=>J});let n=e=>"string"==typeof e,i=()=>{let e,t,r=new Promise((r,n)=>{e=r,t=n});return r.resolve=e,r.reject=t,r},a=e=>null==e?"":""+e,s=(e,t,r)=>{e.forEach(e=>{t[e]&&(r[e]=t[e])})},o=/###/g,l=e=>e&&e.indexOf("###")>-1?e.replace(o,"."):e,u=e=>!e||n(e),c=(e,t,r)=>{let i=n(t)?t.split("."):t,a=0;for(;a<i.length-1;){if(u(e))return{};let t=l(i[a]);!e[t]&&r&&(e[t]=new r),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++a}return u(e)?{}:{obj:e,k:l(i[a])}},d=(e,t,r)=>{let{obj:n,k:i}=c(e,t,Object);if(void 0!==n||1===t.length){n[i]=r;return}let a=t[t.length-1],s=t.slice(0,t.length-1),o=c(e,s,Object);for(;void 0===o.obj&&s.length;)a=`${s[s.length-1]}.${a}`,o=c(e,s=s.slice(0,s.length-1),Object),o?.obj&&void 0!==o.obj[`${o.k}.${a}`]&&(o.obj=void 0);o.obj[`${o.k}.${a}`]=r},h=(e,t,r,n)=>{let{obj:i,k:a}=c(e,t,Object);i[a]=i[a]||[],i[a].push(r)},f=(e,t)=>{let{obj:r,k:n}=c(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},p=(e,t,r)=>{let n=f(e,r);return void 0!==n?n:f(t,r)},_=(e,t,r)=>{for(let i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?n(e[i])||e[i]instanceof String||n(t[i])||t[i]instanceof String?r&&(e[i]=t[i]):_(e[i],t[i],r):e[i]=t[i]);return e},m=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};let y=e=>n(e)?e.replace(/[&<>"'\/]/g,e=>g[e]):e,v=[" ",",","?","!",";"],b=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){let t=this.regExpMap.get(e);if(void 0!==t)return t;let r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}(20),x=(e,t,r)=>{t=t||"",r=r||"";let n=v.filter(e=>0>t.indexOf(e)&&0>r.indexOf(e));if(0===n.length)return!0;let i=b.getRegExp(`(${n.map(e=>"?"===e?"\\?":e).join("|")})`),a=!i.test(e);if(!a){let t=e.indexOf(r);t>0&&!i.test(e.substring(0,t))&&(a=!0)}return a},T=(e,t,r=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}let n=t.split(r),i=e;for(let e=0;e<n.length;){let t;if(!i||"object"!=typeof i)return;let a="";for(let s=e;s<n.length;++s)if(s!==e&&(a+=r),a+=n[s],void 0!==(t=i[a])){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<n.length-1)continue;e+=s-e+1;break}i=t}return i},E=e=>e?.replace("_","-"),A={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class S{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||A,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,i){return i&&!this.debug?null:(n(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new S(this.logger,{...{prefix:`${this.prefix}:${e}:`},...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new S(this.logger,e)}}var I=new S;class C{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);let r=this.observers[e].get(t)||0;this.observers[e].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([e,r])=>{for(let n=0;n<r;n++)e(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([r,n])=>{for(let i=0;i<n;i++)r.apply(r,[e,...t])})}}class P extends C{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}removeNamespaces(e){let t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r,i={}){let a,s=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,o=void 0!==i.ignoreJSONStructure?i.ignoreJSONStructure:this.options.ignoreJSONStructure;e.indexOf(".")>-1?a=e.split("."):(a=[e,t],r&&(Array.isArray(r)?a.push(...r):n(r)&&s?a.push(...r.split(s)):a.push(r)));let l=f(this.data,a);return(!l&&!t&&!r&&e.indexOf(".")>-1&&(e=a[0],t=a[1],r=a.slice(2).join(".")),!l&&o&&n(r))?T(this.data?.[e]?.[t],r,s):l}addResource(e,t,r,n,i={silent:!1}){let a=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,s=[e,t];r&&(s=s.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(s=e.split("."),n=t,t=s[1]),this.addNamespaces(t),d(this.data,s,n),i.silent||this.emit("added",e,t,r,n)}addResources(e,t,r,i={silent:!1}){for(let i in r)(n(r[i])||Array.isArray(r[i]))&&this.addResource(e,t,i,r[i],{silent:!0});i.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,n,i,a={silent:!1,skipCopy:!1}){let s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),n=r,r=t,t=s[1]),this.addNamespaces(t);let o=f(this.data,s)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),n?_(o,r,i):o={...o,...r},d(this.data,s,o),a.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){let t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var R={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,i){return e.forEach(e=>{t=this.processors[e]?.process(t,r,n,i)??t}),t}};let w={},M=e=>!n(e)&&"boolean"!=typeof e&&"number"!=typeof e;class O extends C{constructor(e,t={}){super(),s(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=I.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){let r={...t};if(null==e)return!1;let n=this.resolve(e,r);return n?.res!==void 0}extractFromKey(e,t){let r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");let i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,a=t.ns||this.options.defaultNS||[],s=r&&e.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!x(e,r,i);if(s&&!o){let t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:n(a)?[a]:a};let s=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(s[0])>-1)&&(a=s.shift()),e=s.join(i)}return{key:e,namespaces:n(a)?[a]:a}}translate(e,t,r){let i="object"==typeof t?{...t}:t;if("object"!=typeof i&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(i={...i}),i||(i={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);let a=void 0!==i.returnDetails?i.returnDetails:this.options.returnDetails,s=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(e[e.length-1],i),u=l[l.length-1],c=void 0!==i.nsSeparator?i.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");let d=i.lng||this.language,h=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d?.toLowerCase()==="cimode")return h?a?{res:`${u}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:`${u}${c}${o}`:a?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:o;let f=this.resolve(e,i),p=f?.res,_=f?.usedKey||o,m=f?.exactUsedKey||o,g=void 0!==i.joinArrays?i.joinArrays:this.options.joinArrays,y=!this.i18nFormat||this.i18nFormat.handleAsObject,v=void 0!==i.count&&!n(i.count),b=O.hasDefaultValue(i),x=v?this.pluralResolver.getSuffix(d,i.count,i):"",T=i.ordinal&&v?this.pluralResolver.getSuffix(d,i.count,{ordinal:!1}):"",E=v&&!i.ordinal&&0===i.count,A=E&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${x}`]||i[`defaultValue${T}`]||i.defaultValue,S=p;y&&!p&&b&&(S=A);let I=M(S),C=Object.prototype.toString.apply(S);if(y&&S&&I&&0>["[object Number]","[object Function]","[object RegExp]"].indexOf(C)&&!(n(g)&&Array.isArray(S))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");let e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(_,S,{...i,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return a?(f.res=e,f.usedParams=this.getUsedParamsDetails(i),f):e}if(s){let e=Array.isArray(S),t=e?[]:{},r=e?m:_;for(let e in S)if(Object.prototype.hasOwnProperty.call(S,e)){let n=`${r}${s}${e}`;b&&!p?t[e]=this.translate(n,{...i,defaultValue:M(A)?A[e]:void 0,...{joinArrays:!1,ns:l}}):t[e]=this.translate(n,{...i,joinArrays:!1,ns:l}),t[e]===n&&(t[e]=S[e])}p=t}}else if(y&&n(g)&&Array.isArray(p))(p=p.join(g))&&(p=this.extendTranslation(p,e,i,r));else{let t=!1,n=!1;!this.isValidLookup(p)&&b&&(t=!0,p=A),this.isValidLookup(p)||(n=!0,p=o);let a=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&n?void 0:p,l=b&&A!==p&&this.options.updateMissing;if(n||t||l){if(this.logger.log(l?"updateKey":"missingKey",d,u,o,l?A:p),s){let e=this.resolve(o,{...i,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[],t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let r=0;r<t.length;r++)e.push(t[r]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(i.lng||this.language):e.push(i.lng||this.language);let r=(e,t,r)=>{let n=b&&r!==p?r:a;this.options.missingKeyHandler?this.options.missingKeyHandler(e,u,t,n,l,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,u,t,n,l,i),this.emit("missingKey",e,u,t,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?e.forEach(e=>{let t=this.pluralResolver.getSuffixes(e,i);E&&i[`defaultValue${this.options.pluralSeparator}zero`]&&0>t.indexOf(`${this.options.pluralSeparator}zero`)&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{r([e],o+t,i[`defaultValue${t}`]||A)})}):r(e,o,A))}p=this.extendTranslation(p,e,i,f,r),n&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${u}${c}${o}`),(n||t)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${c}${o}`:o,t?p:void 0,i))}return a?(f.res=p,f.usedParams=this.getUsedParamsDetails(i),f):p}extendTranslation(e,t,r,i,a){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){let s;r.interpolation&&this.interpolator.init({...r,...{interpolation:{...this.options.interpolation,...r.interpolation}}});let o=n(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){let t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let l=r.replace&&!n(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,r.lng||this.language||i.usedLng,r),o){let t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),!1!==r.nest&&(e=this.interpolator.nest(e,(...e)=>a?.[0]!==e[0]||r.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),r)),r.interpolation&&this.interpolator.reset()}let s=r.postProcess||this.options.postProcess,o=n(s)?[s]:s;return null!=e&&o?.length&&!1!==r.applyPostProcessor&&(e=R.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,t={}){let r,i,a,s,o;return n(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(r))return;let l=this.extractFromKey(e,t),u=l.key;i=u;let c=l.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));let d=void 0!==t.count&&!n(t.count),h=d&&!t.ordinal&&0===t.count,f=void 0!==t.context&&(n(t.context)||"number"==typeof t.context)&&""!==t.context,p=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(e=>{this.isValidLookup(r)||(o=e,!w[`${p[0]}-${e}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(w[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${i}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(n=>{let i;if(this.isValidLookup(r))return;s=n;let o=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(o,u,n,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(n,t.count,t));let r=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(o.push(u+e),t.ordinal&&0===e.indexOf(i)&&o.push(u+e.replace(i,this.options.pluralSeparator)),h&&o.push(u+r)),f){let n=`${u}${this.options.contextSeparator}${t.context}`;o.push(n),d&&(o.push(n+e),t.ordinal&&0===e.indexOf(i)&&o.push(n+e.replace(i,this.options.pluralSeparator)),h&&o.push(n+r))}}for(;i=o.pop();)this.isValidLookup(r)||(a=i,r=this.getResource(n,e,i,t))}))})}),{res:r,usedKey:i,exactUsedKey:a,usedLng:s,usedNS:o}}isValidLookup(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}getResource(e,t,r,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,r,n):this.resourceStore.getResource(e,t,r,n)}getUsedParamsDetails(e={}){let t=e.replace&&!n(e.replace),r=t?e.replace:e;if(t&&void 0!==e.count&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!t)for(let e of(r={...r},["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]))delete r[e];return r}static hasDefaultValue(e){let t="defaultValue";for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&void 0!==e[r])return!0;return!1}}class L{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=I.create("languageUtils")}getScriptPartFromCode(e){if(!(e=E(e))||0>e.indexOf("-"))return null;let t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=E(e))||0>e.indexOf("-"))return e;let t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(n(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return(t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t)?t:this.options.lowerCaseLng?e.toLowerCase():e}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){let t;return e?(e.forEach(e=>{if(t)return;let r=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;let r=this.getScriptPartFromCode(e);if(this.isSupportedCode(r))return t=r;let n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>{if(e===n||!(0>e.indexOf("-")&&0>n.indexOf("-"))&&(e.indexOf("-")>0&&0>n.indexOf("-")&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1))return e})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),n(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){let r=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),i=[],a=e=>{e&&(this.isSupportedCode(e)?i.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return n(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&a(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&a(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&a(this.getLanguagePartFromCode(e))):n(e)&&a(this.formatLanguageCode(e)),r.forEach(e=>{0>i.indexOf(e)&&a(this.formatLanguageCode(e))}),i}}let N={zero:0,one:1,two:2,few:3,many:4,other:5},F={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class D{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=I.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){let r,n=E("dev"===e?"en":e),i=t.ordinal?"ordinal":"cardinal",a=JSON.stringify({cleanedCode:n,type:i});if(a in this.pluralRulesCache)return this.pluralRulesCache[a];try{r=new Intl.PluralRules(n,{type:i})}catch(i){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),F;if(!e.match(/-|_/))return F;let n=this.languageUtils.getLanguagePartFromCode(e);r=this.getRule(n,t)}return this.pluralRulesCache[a]=r,r}needsPlural(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,r={}){return this.getSuffixes(e,r).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let r=this.getRule(e,t);return(r||(r=this.getRule("dev",t)),r)?r.resolvedOptions().pluralCategories.sort((e,t)=>N[e]-N[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,r={}){let n=this.getRule(e,r);return n?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}let B=(e,t,r,i=".",a=!0)=>{let s=p(e,t,r);return!s&&a&&n(r)&&void 0===(s=T(e,r,i))&&(s=T(t,r,i)),s},k=e=>e.replace(/\$/g,"$$$$");class G{constructor(e={}){this.logger=I.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});let{escape:t,escapeValue:r,useRawValueToEscape:n,prefix:i,prefixEscaped:a,suffix:s,suffixEscaped:o,formatSeparator:l,unescapeSuffix:u,unescapePrefix:c,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:f,nestingSuffixEscaped:p,nestingOptionsSeparator:_,maxReplaces:g,alwaysFormat:v}=e.interpolation;this.escape=void 0!==t?t:y,this.escapeValue=void 0===r||r,this.useRawValueToEscape=void 0!==n&&n,this.prefix=i?m(i):a||"{{",this.suffix=s?m(s):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=d?m(d):h||m("$t("),this.nestingSuffix=f?m(f):p||m(")"),this.nestingOptionsSeparator=_||",",this.maxReplaces=g||1e3,this.alwaysFormat=void 0!==v&&v,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){let e=(e,t)=>e?.source===t?(e.lastIndex=0,e):RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,i){let s,o,l,u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(0>e.indexOf(this.formatSeparator)){let n=B(t,u,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(n,void 0,r,{...i,...t,interpolationkey:e}):n}let n=e.split(this.formatSeparator),a=n.shift().trim(),s=n.join(this.formatSeparator).trim();return this.format(B(t,u,a,this.options.keySeparator,this.options.ignoreJSONStructure),s,r,{...i,...t,interpolationkey:a})};this.resetRegExp();let d=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>k(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?k(this.escape(e)):k(e)}].forEach(t=>{for(l=0;s=t.regex.exec(e);){let r=s[1].trim();if(void 0===(o=c(r)))if("function"==typeof d){let t=d(e,s,i);o=n(t)?t:""}else if(i&&Object.prototype.hasOwnProperty.call(i,r))o="";else if(h){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${r} for interpolating ${e}`),o="";else n(o)||this.useRawValueToEscape||(o=a(o));let u=t.safeValue(o);if(e=e.replace(s[0],u),h?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=s[0].length):t.regex.lastIndex=0,++l>=this.maxReplaces)break}}),e}nest(e,t,r={}){let i,s,o,l=(e,t)=>{let r=this.nestingOptionsSeparator;if(0>e.indexOf(r))return e;let n=e.split(RegExp(`${r}[ ]*{`)),i=`{${n[1]}`;e=n[0];let a=(i=this.interpolate(i,o)).match(/'/g),s=i.match(/"/g);((a?.length??0)%2!=0||s)&&s.length%2==0||(i=i.replace(/'/g,'"'));try{o=JSON.parse(i),t&&(o={...t,...o})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${r}${i}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,e};for(;i=this.nestingRegexp.exec(e);){let u=[];(o=(o={...r}).replace&&!n(o.replace)?o.replace:o).applyPostProcessor=!1,delete o.defaultValue;let c=!1;if(-1!==i[0].indexOf(this.formatSeparator)&&!/{.*}/.test(i[1])){let e=i[1].split(this.formatSeparator).map(e=>e.trim());i[1]=e.shift(),u=e,c=!0}if((s=t(l.call(this,i[1].trim(),o),o))&&i[0]===e&&!n(s))return s;n(s)||(s=a(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),c&&(s=u.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}let U=e=>{let t=e.toLowerCase().trim(),r={};if(e.indexOf("(")>-1){let n=e.split("(");t=n[0].toLowerCase().trim();let i=n[1].substring(0,n[1].length-1);"currency"===t&&0>i.indexOf(":")?r.currency||(r.currency=i.trim()):"relativetime"===t&&0>i.indexOf(":")?r.range||(r.range=i.trim()):i.split(";").forEach(e=>{if(e){let[t,...n]=e.split(":"),i=n.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();r[a]||(r[a]=i),"false"===i&&(r[a]=!1),"true"===i&&(r[a]=!0),isNaN(i)||(r[a]=parseInt(i,10))}})}return{formatName:t,formatOptions:r}},V=e=>{let t={};return(r,n,i)=>{let a=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(a={...a,[i.interpolationkey]:void 0});let s=n+JSON.stringify(a),o=t[s];return o||(o=e(E(n),i),t[s]=o),o(r)}},H=e=>(t,r,n)=>e(E(r),n)(t);class ${constructor(e={}){this.logger=I.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";let r=t.cacheInBuiltFormats?V:H;this.formats={number:r((e,t)=>{let r=new Intl.NumberFormat(e,{...t});return e=>r.format(e)}),currency:r((e,t)=>{let r=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>r.format(e)}),datetime:r((e,t)=>{let r=new Intl.DateTimeFormat(e,{...t});return e=>r.format(e)}),relativetime:r((e,t)=>{let r=new Intl.RelativeTimeFormat(e,{...t});return e=>r.format(e,t.range||"day")}),list:r((e,t)=>{let r=new Intl.ListFormat(e,{...t});return e=>r.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=V(t)}format(e,t,r,n={}){let i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&0>i[0].indexOf(")")&&i.find(e=>e.indexOf(")")>-1)){let e=i.findIndex(e=>e.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,e)].join(this.formatSeparator)}return i.reduce((e,t)=>{let{formatName:i,formatOptions:a}=U(t);if(this.formats[i]){let t=e;try{let s=n?.formatParams?.[n.interpolationkey]||{},o=s.locale||s.lng||n.locale||n.lng||r;t=this.formats[i](e,o,{...a,...n,...s})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${i}`),e},e)}}let W=(e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)};class j extends C{constructor(e,t,r,n={}){super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=n,this.logger=I.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,n.backend,n)}queueLoad(e,t,r,n){let i={},a={},s={},o={};return e.forEach(e=>{let n=!0;t.forEach(t=>{let s=`${e}|${t}`;!r.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===a[s]&&(a[s]=!0):(this.state[s]=1,n=!1,void 0===a[s]&&(a[s]=!0),void 0===i[s]&&(i[s]=!0),void 0===o[t]&&(o[t]=!0)))}),n||(s[e]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(o)}}loaded(e,t,r){let n=e.split("|"),i=n[0],a=n[1];t&&this.emit("failedLoading",i,a,t),!t&&r&&this.store.addResourceBundle(i,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);let s={};this.queue.forEach(r=>{h(r.loaded,[i],a),W(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach(e=>{s[e]||(s[e]={});let t=r.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,r,n=0,i=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:n,wait:i,callback:a});this.readingCalls++;let s=(s,o)=>{if(this.readingCalls--,this.waitingReads.length>0){let e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}if(s&&o&&n<this.maxRetries)return void setTimeout(()=>{this.read.call(this,e,t,r,n+1,2*i,a)},i);a(s,o)},o=this.backend[r].bind(this.backend);if(2===o.length){try{let r=o(e,t);r&&"function"==typeof r.then?r.then(e=>s(null,e)).catch(s):s(null,r)}catch(e){s(e)}return}return o(e,t,s)}prepareLoading(e,t,r={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();n(e)&&(e=this.languageUtils.toResolveHierarchy(e)),n(t)&&(t=[t]);let a=this.queueLoad(e,t,r,i);if(!a.toLoad.length)return a.pending.length||i(),null;a.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e,t=""){let r=e.split("|"),n=r[0],i=r[1];this.read(n,i,"read",void 0,void 0,(r,a)=>{r&&this.logger.warn(`${t}loading namespace ${i} for language ${n} failed`,r),!r&&a&&this.logger.log(`${t}loaded namespace ${i} for language ${n}`,a),this.loaded(e,r,a)})}saveMissing(e,t,r,n,i,a={},s=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t))return void this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");if(null!=r&&""!==r){if(this.backend?.create){let o={...a,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let i;(i=5===l.length?l(e,t,r,n,o):l(e,t,r,n))&&"function"==typeof i.then?i.then(e=>s(null,e)).catch(s):s(null,i)}catch(e){s(e)}else l(e,t,r,n,s,o)}e&&e[0]&&this.store.addResource(e[0],t,r,n)}}}let z=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),n(e[1])&&(t.defaultValue=e[1]),n(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){let r=e[3]||e[2];Object.keys(r).forEach(e=>{t[e]=r[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Y=e=>(n(e.ns)&&(e.ns=[e.ns]),n(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),n(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),K=()=>{},X=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))})};class Z extends C{constructor(e={},t){if(super(),this.options=Y(e),this.services={},this.logger=I,this.modules={external:[]},X(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(n(e.ns)?e.defaultNS=e.ns:0>e.ns.indexOf("translation")&&(e.defaultNS=e.ns[0]));let r=z();this.options={...r,...this.options,...Y(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);let a=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?I.init(a(this.modules.logger),this.options):I.init(null,this.options),e=this.modules.formatter?this.modules.formatter:$;let t=new L(this.options);this.store=new P(this.options.resources,this.options);let n=this.services;n.logger=I,n.resourceStore=this.store,n.languageUtils=t,n.pluralResolver=new D(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),e&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(n.formatter=a(e),n.formatter.init(n,this.options),this.options.interpolation.format=n.formatter.format.bind(n.formatter)),n.interpolator=new G(this.options),n.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},n.backendConnector=new j(a(this.modules.backend),n.resourceStore,n,this.options),n.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(n.languageDetector=a(this.modules.languageDetector),n.languageDetector.init&&n.languageDetector.init(n,this.options.detection,this.options)),this.modules.i18nFormat&&(n.i18nFormat=a(this.modules.i18nFormat),n.i18nFormat.init&&n.i18nFormat.init(this)),this.translator=new O(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=K),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){let e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});let s=i(),o=()=>{let e=(e,r)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),s.resolve(r),t(e,r)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),s}loadResources(e,t=K){let r=t,i=n(e)?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||0===this.options.preload.length))return r();let e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&0>e.indexOf(t)&&e.push(t)})};i?t(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),r(e)})}else r(null)}reloadResources(e,t,r){let n=i();return"function"==typeof e&&(r=e,e=void 0),"function"==typeof t&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=K),this.services.backendConnector.reload(e,t,e=>{n.resolve(),r(e)}),n}use(e){if(!e)throw Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&R.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){let t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&0>this.languages.indexOf(e)&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;let r=i();this.emit("languageChanging",e);let a=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},s=(n,i)=>{i?this.isLanguageChangingTo===e&&(a(i),this.translator.changeLanguage(i),this.isLanguageChangingTo=void 0,this.emit("languageChanged",i),this.logger.log("languageChanged",i)):this.isLanguageChangingTo=void 0,r.resolve((...e)=>this.t(...e)),t&&t(n,(...e)=>this.t(...e))},o=t=>{e||t||!this.services.languageDetector||(t=[]);let r=n(t)?t:t&&t[0],i=this.store.hasLanguageSomeTranslations(r)?r:this.services.languageUtils.getBestMatchFromCodes(n(t)?[t]:t);i&&(this.language||a(i),this.translator.language||this.translator.changeLanguage(i),this.services.languageDetector?.cacheUserLanguage?.(i)),this.loadResources(i,e=>{s(e,i)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),r}getFixedT(e,t,r){let i=(e,t,...n)=>{let a,s;(a="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(n)):{...t}).lng=a.lng||i.lng,a.lngs=a.lngs||i.lngs,a.ns=a.ns||i.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||r||i.keyPrefix);let o=this.options.keySeparator||".";return s=a.keyPrefix&&Array.isArray(e)?e.map(e=>`${a.keyPrefix}${o}${e}`):a.keyPrefix?`${a.keyPrefix}${o}${e}`:e,this.t(s,a)};return n(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=r,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;let r=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;let a=(e,t)=>{let r=this.services.backendConnector.state[`${e}|${t}`];return -1===r||0===r||2===r};if(t.precheck){let e=t.precheck(this,a);if(void 0!==e)return e}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,e)&&(!n||a(i,e)))}loadNamespaces(e,t){let r=i();return this.options.ns?(n(e)&&(e=[e]),e.forEach(e=>{0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){let r=i();n(e)&&(e=[e]);let a=this.options.preload||[],s=e.filter(e=>0>a.indexOf(e)&&this.services.languageUtils.isSupportedCode(e));return s.length?(this.options.preload=a.concat(s),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}dir(e){return(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),e)?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf((this.services?.languageUtils||new L(z())).getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr":"rtl"}static createInstance(e={},t){return new Z(e,t)}cloneInstance(e={},t=K){let r=e.forkResourceStore;r&&delete e.forkResourceStore;let n={...this.options,...e,isClone:!0},i=new Z(n);return(void 0!==e.debug||void 0!==e.prefix)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(e=>{i[e]=this[e]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},r&&(i.store=new P(Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((r,n)=>(r[n]={...e[t][n]},r),e[t]),e),{}),n),i.services.resourceStore=i.store),i.translator=new O(i.services,n),i.translator.on("*",(e,...t)=>{i.emit(e,...t)}),i.init(n,t),i.translator.options=n,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}let q=Z.createInstance();q.createInstance=Z.createInstance,q.createInstance,q.dir;let Q=q.init;q.loadResources,q.reloadResources,q.use,q.changeLanguage,q.getFixedT;let J=q.t;q.exists,q.setDefaultNamespace,q.hasLoadedNamespace,q.loadNamespaces,q.loadLanguages},34504:function(e,t,r){r.d(t,{q:()=>o});var n=r(74913),i=r(88280),a=r(56865),s=r(78685);class o extends n.a{constructor(){super(...arguments),this.dbgShowShaderCode=!1,this.dbgSanityChecks=!0,this.dbgVerboseLogsNumFrames=10,this.dbgLogIfNotDrawWrapper=!0,this.dbgShowEmptyEnableEffectCalls=!0,this.dbgVerboseLogsForFirstFrames=!1,this._currentRenderPass=null,this._snapshotRenderingMode=0,this._timestampIndex=0,this._debugStackRenderPass=[]}get enableGPUTimingMeasurements(){return this._timestampQuery.enable}set enableGPUTimingMeasurements(e){this._timestampQuery.enable!==e&&(this.gpuTimeInFrameForMainPass=e?new s.Q:void 0,this._timestampQuery.enable=e)}_currentPassIsMainPass(){return null===this._currentRenderTarget}_endCurrentRenderPass(){if(!this._currentRenderPass)return 0;if(0!==this._debugStackRenderPass.length)for(let e=0;e<this._debugStackRenderPass.length;++e)this._currentRenderPass.popDebugGroup();let e=this._currentPassIsMainPass()?2:1;return this._snapshotRendering.endRenderPass(this._currentRenderPass)||this.compatibilityMode||(this._bundleList.run(this._currentRenderPass),this._bundleList.reset()),this._currentRenderPass.end(),this._timestampQuery.endPass(this._timestampIndex,this._currentRenderTarget&&this._currentRenderTarget.gpuTimeInFrame?this._currentRenderTarget.gpuTimeInFrame:this.gpuTimeInFrameForMainPass),this._timestampIndex+=2,this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&i.Y.Log("frame #"+this._count+" - "+(2===e?"main":"render target")+" end pass"+(1===e?" - internalTexture.uniqueId="+this._currentRenderTarget?.texture?.uniqueId:""))),this._debugPopGroup?.(0),this._currentRenderPass=null,e}_generateMipmaps(e,t){t=t??this._renderEncoder;let r=e._hardwareTexture;if(!r)return;t===this._renderEncoder&&this._endCurrentRenderPass();let n=e._hardwareTexture.format,s=a.D.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&i.Y.Log("frame #"+this._count+" - generate mipmaps - width="+e.width+", height="+e.height+", isCube="+e.isCube+", command encoder="+(t===this._renderEncoder?"render":"copy"))),e.isCube?this._textureHelper.generateCubeMipmaps(r,n,s,t):this._textureHelper.generateMipmaps(r,n,s,0,e.is3D,t)}}},3510:function(e,t,r){r.d(t,{o:()=>u});var n=r(76600),i=r(88280),a=r(52746),s=r(98607);r(34410),r(51940),r(56168),r(10884),r(85116),r(9630),r(35140),r(27222),r(58311);let o="fragmentOutputs.fragDepth",l={texture_1d:"1d",texture_2d:"2d",texture_2d_array:"2d-array",texture_3d:"3d",texture_cube:"cube",texture_cube_array:"cube-array",texture_multisampled_2d:"2d",texture_depth_2d:"2d",texture_depth_2d_array:"2d-array",texture_depth_cube:"cube",texture_depth_cube_array:"cube-array",texture_depth_multisampled_2d:"2d",texture_storage_1d:"1d",texture_storage_2d:"2d",texture_storage_2d_array:"2d-array",texture_storage_3d:"3d",texture_external:null};class u extends a.e{constructor(){super(...arguments),this.shaderLanguage=1,this.uniformRegexp=/uniform\s+(\w+)\s*:\s*(.+)\s*;/,this.textureRegexp=/var\s+(\w+)\s*:\s*((array<\s*)?(texture_\w+)\s*(<\s*(.+)\s*>)?\s*(,\s*\w+\s*>\s*)?);/,this.noPrecision=!0,this.pureMode=!1}_getArraySize(e,t,r){let n=0,i=t.lastIndexOf(">");if(t.indexOf("array")>=0&&i>0){let e=i;for(;e>0&&" "!==t.charAt(e)&&","!==t.charAt(e);)e--;let a=t.substring(e+1,i);for(isNaN(n=+a)&&(n=+r[a.trim()]);e>0&&(" "===t.charAt(e)||","===t.charAt(e));)e--;t=t.substring(t.indexOf("<")+1,e+1)}return[e,t,n]}initializeShaders(e){this._webgpuProcessingContext=e,this._attributesInputWGSL=[],this._attributesWGSL=[],this._attributesConversionCodeWGSL=[],this._hasNonFloatAttribute=!1,this._varyingsWGSL=[],this._varyingNamesWGSL=[],this._stridedUniformArrays=[]}preProcessShaderCode(e){let t=this.pureMode?"":`struct ${a.e.InternalsUBOName} {
  yFactor_: f32,
  textureOutputHeight_: f32,
};
var<uniform> internals : ${a.e.InternalsUBOName};
`;return -1!==e.indexOf(t)?e:t+(0,s.Kt)(e)}varyingCheck(e){return/(flat|linear|perspective)?\s*(center|centroid|sample)?\s*\bvarying\b/.test(e)}varyingProcessor(e,t,r){let n=/\s*(flat|linear|perspective)?\s*(center|centroid|sample)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==n){let a,s=n[1]??"perspective",o=n[2]??"center",l=n[4],u=n[3],c="flat"===s?`@interpolate(${s})`:`@interpolate(${s}, ${o})`;t?void 0===(a=this._webgpuProcessingContext.availableVaryings[u])&&i.Y.Warn(`Invalid fragment shader: The varying named "${u}" is not declared in the vertex shader! This declaration will be ignored.`):(a=this._webgpuProcessingContext.getVaryingNextLocation(l,this._getArraySize(u,l,r)[2]),this._webgpuProcessingContext.availableVaryings[u]=a,this._varyingsWGSL.push(`  @location(${a}) ${c} ${u} : ${l},`),this._varyingNamesWGSL.push(u)),e=""}return e}attributeProcessor(e,t){let r=/\s*attribute\s+(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==r){let n=r[2],i=r[1],a=this._webgpuProcessingContext.getAttributeNextLocation(n,this._getArraySize(i,n,t)[2]);this._webgpuProcessingContext.availableAttributes[i]=a,this._webgpuProcessingContext.orderedAttributes[a]=i;let s=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[i];if(void 0!==s){let e=`_int_${i}_`;this._attributesInputWGSL.push(`@location(${a}) ${e} : ${s<0?-1===s?"i32":"vec"+-s+"<i32>":1===s?"u32":"vec"+s+"<u32>"},`),this._attributesWGSL.push(`${i} : ${n},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${i} = ${n}(vertexInputs_.${e});`),this._hasNonFloatAttribute=!0}else this._attributesInputWGSL.push(`@location(${a}) ${i} : ${n},`),this._attributesWGSL.push(`${i} : ${n},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${i} = vertexInputs_.${i};`);e=""}return e}uniformProcessor(e,t,r){let n=this.uniformRegexp.exec(e);if(null!==n){let t=n[2],i=n[1];this._addUniformToLeftOverUBO(i,t,r),e=""}return e}textureProcessor(e,t,r){let n=this.textureRegexp.exec(e);if(null!==n){let i=n[1],a=n[2],s=!!n[3],o=n[4],u=o.indexOf("storage")>0,c=n[6],d=u?c.substring(0,c.indexOf(",")).trim():null,h=s?this._getArraySize(i,a,r)[2]:0,f=this._webgpuProcessingContext.availableTextures[i];if(f)h=f.textures.length;else{f={isTextureArray:h>0,isStorageTexture:u,textures:[],sampleType:"float"},h=h||1;for(let e=0;e<h;++e)f.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}this._webgpuProcessingContext.availableTextures[i]=f;let p=o.indexOf("depth")>0,_=l[o],m=p?"depth":"u32"===c?"uint":"i32"===c?"sint":"float";if(f.sampleType=m,void 0===_)throw`Can't get the texture dimension corresponding to the texture function "${o}"!`;for(let r=0;r<h;++r){let{groupIndex:n,bindingIndex:a}=f.textures[r];0===r&&(e=`@group(${n}) @binding(${a}) ${e}`),this._addTextureBindingDescription(i,f,r,_,d,!t)}}return e}_convertDefinesToConst(e){let t="";for(let r in e){let n=e[r];!r.startsWith("__")&&(isNaN(parseInt(n))&&isNaN(parseFloat(n))?r&&""===n&&(t+=`const ${r} = true;
`):t+=`const ${r} = ${n};
`)}return t}postProcessor(e,t,r,n,i,a,s){let o=[];for(let e in s)"true"!==s[e]&&o.push(e);for(let t of(o.sort((e,t)=>e.length-t.length>0?-1:+(e.length!==t.length)),o)){let r=e.indexOf("#define "+t),n=e.indexOf("\n",r);-1===n&&(n=e.length);let i=e.substring(r+8+t.length+1,n);e=e.replace(RegExp(t,"g"),i)}return e=this._convertDefinesToConst(a)+e}finalizeShaders(e,t){let r=t.indexOf("fragmentInputs.position")>=0&&!this.pureMode?`
            if (internals.yFactor_ == 1.) {
                fragmentInputs.position.y = internals.textureOutputHeight_ - fragmentInputs.position.y;
            }
        `:"";e=this._processSamplers(e,!0),t=this._processSamplers(t,!1),e=this._processCustomBuffers(e,!0),t=this._processCustomBuffers(t,!1);let n=this._buildLeftOverUBO();e=n+e,t=n+t,e=e.replace(/#define /g,"//#define "),e=this._processStridedUniformArrays(e);let i="struct VertexInputs {\n  @builtin(vertex_index) vertexIndex : u32,\n  @builtin(instance_index) instanceIndex : u32,\n";this._attributesInputWGSL.length>0&&(i+=this._attributesInputWGSL.join("\n")),i+="\n};\nvar<private> vertexInputs"+(this._hasNonFloatAttribute?"_":"")+" : VertexInputs;\n",this._hasNonFloatAttribute&&(i+="struct VertexInputs_ {\n  vertexIndex : u32, instanceIndex : u32,\n",i+=this._attributesWGSL.join("\n"),i+="\n};\nvar<private> vertexInputs : VertexInputs_;\n");let a="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n";this._varyingsWGSL.length>0&&(a+=this._varyingsWGSL.join("\n")),a+="\n};\nvar<private> vertexOutputs : FragmentInputs;\n",e=i+a+e;let l=`
  vertexInputs${this._hasNonFloatAttribute?"_":""} = input;
`;this._hasNonFloatAttribute&&(l+="vertexInputs.vertexIndex = vertexInputs_.vertexIndex;\nvertexInputs.instanceIndex = vertexInputs_.instanceIndex;\n",l+=this._attributesConversionCodeWGSL.join("\n"),l+="\n");let u=this.pureMode?"  return vertexOutputs;":`  vertexOutputs.position.y = vertexOutputs.position.y * internals.yFactor_;
  return vertexOutputs;`,c=-1!==e.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS");e=(c?"diagnostic(off, derivative_uniformity);\n":"")+"diagnostic(off, chromium.unreachable_code);\n"+(0,s.e0)(e,"fn main",l,u),t=t.replace(/#define /g,"//#define "),t=this._processStridedUniformArrays(t),this.pureMode||(t=t.replace(/dpdy/g,"(-internals.yFactor_)*dpdy"));let d="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n  @builtin(front_facing) frontFacing : bool,\n";this._varyingsWGSL.length>0&&(d+=this._varyingsWGSL.join("\n")),d+="\n};\nvar<private> fragmentInputs : FragmentInputs;\n";let h="struct FragmentOutputs {\n",f="fragmentOutputs\\.fragData",p=t.match(RegExp(f+"0","g")),_=0;if(p){h+=` @location(${_}) fragData0 : vec4<f32>,
`,_++;for(let e=1;e<8;e++)(p=t.match(RegExp(f+e,"g")))&&(h+=` @location(${_}) fragData${_} : vec4<f32>,
`,_++);-1!==t.indexOf("MRT_AND_COLOR")&&(h+=`  @location(${_}) color : vec4<f32>,
`,_++)}(p=t.match(/oitDepthSampler/))&&(h+=` @location(${_++}) depth : vec2<f32>,
 @location(${_++}) frontColor : vec4<f32>,
 @location(${_++}) backColor : vec4<f32>,
`),0===_&&(h+="  @location(0) color : vec4<f32>,\n",_++);let m=!1,g=0;for(;!m&&!((g=t.indexOf(o,g))<0);){let e=g;for(m=!0;g>1&&"\n"!==t.charAt(g);){if("/"===t.charAt(g)&&"/"===t.charAt(g-1)){m=!1;break}g--}g=e+o.length}return m&&(h+="  @builtin(frag_depth) fragDepth: f32,\n"),h+="};\nvar<private> fragmentOutputs : FragmentOutputs;\n",t=((c=-1!==(t=d+h+t).indexOf("#define DISABLE_UNIFORMITY_ANALYSIS"))?"diagnostic(off, derivative_uniformity);\n":"")+"diagnostic(off, chromium.unreachable_code);\n"+(0,s.e0)(t,"fn main","  fragmentInputs = input;\n  "+r,"  return fragmentOutputs;"),this._collectBindingNames(),this._preCreateBindGroupEntries(),this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}_generateLeftOverUBOCode(e,t){let r="",n=`struct ${e} {
`;for(let t of this._webgpuProcessingContext.leftOverUniforms){let i=t.type.replace(/^(.*?)(<.*>)?$/,"$1"),s=a.e.UniformSizes[i];if(t.length>0)if(s<=2){let a=`${e}_${this._stridedUniformArrays.length}_strided_arr`;r+=`struct ${a} {
                        @size(16)
                        el: ${i},
                    }`,this._stridedUniformArrays.push(t.name),n+=` @align(16) ${t.name} : array<${a}, ${t.length}>,
`}else n+=` ${t.name} : array<${t.type}, ${t.length}>,
`;else n+=`  ${t.name} : ${t.type},
`}return n+="};\n",n=`${r}
${n}@group(${t.binding.groupIndex}) @binding(${t.binding.bindingIndex}) var<uniform> uniforms : ${e};
`}_processSamplers(e,t){let r=/var\s+(\w+Sampler)\s*:\s*(sampler|sampler_comparison)\s*;/gm;for(;;){let n=r.exec(e);if(null===n)break;let i=n[1],a=n[2],s=i.length-7,o=i.lastIndexOf("Sampler")===s?i.substring(0,s):null,l="sampler_comparison"===a?"comparison":"filtering";if(o){let e=this._webgpuProcessingContext.availableTextures[o];e&&(e.autoBindSampler=!0)}let u=this._webgpuProcessingContext.availableSamplers[i];u||(u={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:l},this._webgpuProcessingContext.availableSamplers[i]=u),this._addSamplerBindingDescription(i,u,t);let c=e.substring(0,n.index),d=`@group(${u.binding.groupIndex}) @binding(${u.binding.bindingIndex}) `;e=c+d+e.substring(n.index),r.lastIndex+=d.length}return e}_processCustomBuffers(e,t){let r=/var<\s*(uniform|storage)\s*(,\s*(read|read_write)\s*)?>\s+(\S+)\s*:\s*(\S+)\s*;/gm;for(;;){let i=r.exec(e);if(null===i)break;let a=i[1],s=i[3],o=i[4],l=i[5],u=this._webgpuProcessingContext.availableBuffers[o];if(!u){let e,t="uniform"===a?n.d.KnownUBOs[l]:null;t?(o=l,-1===(e=t.binding).groupIndex&&((e=this._webgpuProcessingContext.availableBuffers[o]?.binding)||(e=this._webgpuProcessingContext.getNextFreeUBOBinding()))):e=this._webgpuProcessingContext.getNextFreeUBOBinding(),u={binding:e},this._webgpuProcessingContext.availableBuffers[o]=u}this._addBufferBindingDescription(o,this._webgpuProcessingContext.availableBuffers[o],"read_write"===s?"storage":"storage"===a?"read-only-storage":"uniform",t);let c=u.binding.groupIndex,d=u.binding.bindingIndex,h=e.substring(0,i.index),f=`@group(${c}) @binding(${d}) `;e=h+f+e.substring(i.index),r.lastIndex+=f.length}return e}_processStridedUniformArrays(e){for(let t of this._stridedUniformArrays)e=e.replace(RegExp(`${t}\\s*\\[(.*?)\\]`,"g"),`${t}[$1].el`);return e}}},35140:function(e,t,r){var n=r(66755);let i="meshUboDeclaration",a=`struct Mesh {world : mat4x4<f32>,
visibility : f32,};var<uniform> mesh : Mesh;
#define WORLD_UBO
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},36180:function(e,t,r){var n=r(66755);let i="meshUboDeclaration",a=`#ifdef WEBGL2
uniform mat4 world;uniform float visibility;
#else
layout(std140,column_major) uniform;uniform Mesh
{mat4 world;float visibility;};
#endif
#define WORLD_UBO
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},36986:function(e,t,r){r.r(t),r.d(t,{clipPlaneFragment:()=>s});var n=r(66755);let i="clipPlaneFragment",a=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fClipDistance6>0.0)
{discard;}
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},37161:function(e,t,r){var n=r(66755);let i="logDepthVertex",a=`#ifdef LOGARITHMICDEPTH
vertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},37393:function(e,t,r){r.d(t,{S:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("value",i.E.AutoDetect),this.registerInput("edge0",i.E.Float),this.registerInput("edge1",i.E.Float),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SmoothStepBlock"}get value(){return this._inputs[0]}get edge0(){return this._inputs[1]}get edge1(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0],r=e._getShaderType(this.value.type);return e.compilationString+=e._declareOutput(t)+` = smoothstep(${r}(${this.edge0.associatedVariableName}), ${r}(${this.edge1.associatedVariableName}), ${this.value.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.SmoothStepBlock",o)},38741:function(e,t,r){r.d(t,{S:()=>s});var n=r(69254),i=r(90131),a=r(88609);class s{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){i.p.Clone(()=>e,this)}serialize(){return i.p.Serialize(this)}parse(e,t,r){i.p.Parse(()=>this,e,t,r)}}(0,n.gn)([(0,a.qC)()],s.prototype,"func",null),(0,n.gn)([(0,a.qC)()],s.prototype,"funcRef",null),(0,n.gn)([(0,a.qC)()],s.prototype,"funcMask",null),(0,n.gn)([(0,a.qC)()],s.prototype,"opStencilFail",null),(0,n.gn)([(0,a.qC)()],s.prototype,"opDepthFail",null),(0,n.gn)([(0,a.qC)()],s.prototype,"opStencilDepthPass",null),(0,n.gn)([(0,a.qC)()],s.prototype,"mask",null),(0,n.gn)([(0,a.qC)()],s.prototype,"enabled",null)},39220:function(e,t,r){r.r(t),r.d(t,{clipPlaneFragmentWGSL:()=>s});var n=r(66755);let i="clipPlaneFragment",a=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fragmentInputs.fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fragmentInputs.fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fragmentInputs.fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fragmentInputs.fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fragmentInputs.fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fragmentInputs.fClipDistance6>0.0)
{discard;}
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},39953:function(e,t,r){var n=r(34504),i=r(90481);n.q.prototype.createRenderTargetCubeTexture=function(e,t){let r=this._createHardwareRenderTargetWrapper(!1,!0,e),n={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,samples:1,...t};n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,r.label=n.label??"RenderTargetWrapper",r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=n.generateStencilBuffer;let a=new i.l(this,5);return a.width=e,a.height=e,a.depth=0,a.isReady=!0,a.isCube=!0,a.samples=n.samples,a.generateMipMaps=n.generateMipMaps,a.samplingMode=n.samplingMode,a.type=n.type,a.format=n.format,this._internalTexturesCache.push(a),r.setTextures(a),(r._generateDepthBuffer||r._generateStencilBuffer)&&r.createDepthStencilTexture(0,void 0===n.samplingMode||2===n.samplingMode||2===n.samplingMode||3===n.samplingMode||3===n.samplingMode||5===n.samplingMode||6===n.samplingMode||7===n.samplingMode||11===n.samplingMode,r._generateStencilBuffer,r.samples),t&&t.createMipMaps&&!n.generateMipMaps&&(a.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(a),t&&t.createMipMaps&&!n.generateMipMaps&&(a.generateMipMaps=!1),r}},40583:function(e,t,r){r.r(t),r.d(t,{gaussianSplattingPixelShader:()=>l});var n=r(66755);r(63647),r(56283),r(72297),r(86459),r(1241);let i="gaussianSplattingFragmentDeclaration",a=`vec4 gaussianColor(vec4 inColor)
{float A=-dot(vPosition,vPosition);if (A<-4.0) discard;float B=exp(A)*inColor.a;
#include<logDepthFragment>
vec3 color=inColor.rgb;
#ifdef FOG
#include<fogFragment>
#endif
return vec4(color,B);}
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a),r(36986);let s="gaussianSplattingPixelShader",o=`#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
varying vec4 vColor;varying vec2 vPosition;
#include<gaussianSplattingFragmentDeclaration>
void main () { 
#include<clipPlaneFragment>
gl_FragColor=gaussianColor(vColor);}
`;n.v.ShadersStore[s]||(n.v.ShadersStore[s]=o);let l={name:s,shader:o}},40789:function(e,t,r){r.d(t,{S:()=>s});var n=r(72384),i=r(67148),a=r(80405);n.x.prototype.enableDepthRenderer=function(e,t=!1,r=!1,n=3,a=!1){if(!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){let s=!!this.getEngine().getCaps().textureFloatRender,o=0;o=!this.getEngine().getCaps().textureHalfFloatRender||r&&s?+!!s:2,this._depthRenderer[e.id]=new i.g(this,o,e,t,n,a)}return this._depthRenderer[e.id]},n.x.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&this._depthRenderer[e.id].dispose()};class s{constructor(e){this.name=a.l.NAME_DEPTHRENDERER,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(a.l.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(a.l.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)}rebuild(){}dispose(){for(let e in this.scene._depthRenderer)this.scene._depthRenderer[e].dispose()}_gatherRenderTargets(e){if(this.scene._depthRenderer)for(let t in this.scene._depthRenderer){let r=this.scene._depthRenderer[t];r.enabled&&!r.useOnlyInActiveCamera&&e.push(r.getDepthMap())}}_gatherActiveCameraRenderTargets(e){if(this.scene._depthRenderer)for(let t in this.scene._depthRenderer){let r=this.scene._depthRenderer[t];r.enabled&&r.useOnlyInActiveCamera&&this.scene.activeCamera.id===t&&e.push(r.getDepthMap())}}}i.g._SceneComponentInitialization=e=>{let t=e._getComponent(a.l.NAME_DEPTHRENDERER);t||(t=new s(e),e._addComponent(t))}},41001:function(e,t,r){var n=r(66755);let i="fogFragment",a=`#ifdef FOG
var fog: f32=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},41316:function(e,t,r){var n=r(90481),i=r(88280),a=r(21381),s=r(53986),o=r(74913),l=r(14366),u=r(36020);o.a.prototype._partialLoadFile=function(e,t,r,n,i=null){this._loadFile(e,e=>{r[t]=e,r._internalCount++,6===r._internalCount&&n(r)},void 0,void 0,!0,(e,t)=>{i&&e&&i(e.status+" "+e.statusText,t)})},o.a.prototype._cascadeLoadFiles=function(e,t,r,n=null){let i=[];i._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(r[e],e,i,t,n)},o.a.prototype._cascadeLoadImgs=function(e,t,r,n,i=null,a){let s=[];s._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(n[o],o,s,e,t,r,i,a)},o.a.prototype._partialLoadImg=function(e,t,r,n,i,o,l=null,u){let c=(0,s.f)();(0,a.r6)(e,e=>{r[t]=e,r._internalCount++,n&&n.removePendingData(c),6===r._internalCount&&o&&o(i,r)},(e,t)=>{n&&n.removePendingData(c),l&&l(e,t)},n?n.offlineProvider:null,u),n&&n.addPendingData(c)},o.a.prototype.createCubeTextureBase=function(e,t,r,a,s=null,o=null,c,d=null,h=!1,f=0,p=0,_=null,m=null,g=null,y=!1,v=null){let b=_||new n.l(this,7);b.isCube=!0,b.url=e,b.generateMipMaps=!a,b._lodGenerationScale=f,b._lodGenerationOffset=p,b._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!a),b!==_&&(b.label=e.substring(0,60)),this._doNotHandleContextLost||(b._extension=d,b._files=r,b._buffer=v);let x=e;this._transformTextureUrl&&!_&&(e=this._transformTextureUrl(e));let T=d??(0,u.t)(e),E=(0,l.qr)(T),A=(e,t)=>{b.dispose(),o?o(e,t):e&&i.Y.Warn(e)},S=(n,o)=>{e===x?n&&A(n.status+" "+n.statusText,o):(i.Y.Warn(`Failed to load ${e}, falling back to the ${x}`),this.createCubeTextureBase(x,t,r,!!a,s,A,c,d,h,f,p,b,m,g,y,v))};if(E)E.then(n=>{let i=e=>{m&&m(b,e),n.loadCubeData(e,b,h,s,(e,t)=>{A(e,t)})};v?i(v):r&&6===r.length?n.supportCascades?this._cascadeLoadFiles(t,e=>i(e.map(e=>new Uint8Array(e))),r,A):A("Textures type does not support cascades."):this._loadFile(e,e=>i(new Uint8Array(e)),void 0,void 0,!0,S)});else{if(!r||0===r.length)throw Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,b,(e,t)=>{g&&g(e,t)},r,A)}return this._internalTexturesCache.push(b),b}},4194:function(e,t,r){var n=r(66755);let i="bakedVertexAnimation",a=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
#define BVASNAME bakedVertexAnimationSettingsInstanced
#else
#define BVASNAME bakedVertexAnimationSettings
#endif
float VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},42826:function(e,t,r){r.d(t,{Z:()=>i});let n=(e,t)=>t(e);function i(e,t){return e.reduce(n,t)}},43622:function(e,t,r){r.r(t),r.d(t,{packingFunctions:()=>s});var n=r(66755);let i="packingFunctions",a=`vec4 pack(float depth)
{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},43927:function(e,t,r){r.d(t,{o:()=>n});class n{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,r,n,i){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[r.uniqueId]||(this.previousWorldMatrices[r.uniqueId]=n.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());let i=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=i.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==i.frameId&&(this._lastUpdateFrameId=i.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[r.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[r.uniqueId]=n.clone()}}}},43999:function(e,t,r){r.d(t,{Z:()=>o});var n=r(42826),i=r(10645),a=r(22837);let s="undefined"==typeof performance?()=>performance.now():()=>Date.now();class o extends a.Z{constructor(e={}){let t;super(),Array.isArray(e)&&(e={bindings:e}),this.name=e.name||"";let r=[],a=[],o=!1,l=!0,u=null,c=0;this.bindings=r,this.processors=a,this.bind=(e,n)=>{if(n||e instanceof i.Z||(n=e),n&&n.control&&(e=n.control),!(e instanceof i.Z))throw Error("Binding requires an InputControl");let a={control:e,processors:n&&n.processors};return r.push(a),void 0===t&&(t=Object.getPrototypeOf(e).constructor.defaultValue),(null==n?void 0:n.autoUpdate)!==!1&&e.on("change",this.update),r.length-1},this.unbind=e=>{if(e<r.length&&e>=0){let t=r[e];r.splice(e,1),t.control.off("change",this.update)}},this.update=()=>{if(!l)return;let e=t;u=null;let i=-1/0;for(let e=0;e<r.length;e++){let a=r[e],{control:o}=a;if(o.enabled){let e=a.processors?(0,n.Z)(a.processors,o.read()):o.read(),r=o.magnitude(e);r>i&&(t=e,i=r,r>0&&(u=a,c||(c=s())))}}u||(c=0),void 0!==t&&(t=(0,n.Z)(a,t)),this.emit("update"),t!==e&&this.emit("change")};let d=this.destroy;this.destroy=()=>{o=!0,l=!1,d()},Object.defineProperties(this,{enabled:{set(e){(e=!!e)===l||o||((l=e)?this.emit("enable"):this.emit("disable"))},get:()=>l},activeControl:{get:()=>u?u.control:null},value:{get:()=>t}}),e.bindings&&e.bindings.forEach(e=>{this.bind(e)}),e.processors&&a.push(...e.processors),!1===e.enabled&&(this.enabled=!1)}}},44578:function(e,t,r){r.d(t,{A:()=>u,u:()=>c});var n=r(54603),i=r(59942),a=r(66755),s=r(79710),o=r(94294),l=r(48545);let u="USE_SFE_FRAMEWORK";class c{constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._terminalBlocks=new Set,this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}get fSuffix(){return 1===this.shaderLanguage?"f":""}get isSFEMode(){return this.sharedData.nodeMaterial.mode===s.a.SFE}getProcessedShaderAsync(){if(!this._builtCompilationString)throw Error("Shader not built yet.");let e=this.sharedData.nodeMaterial.getScene().getEngine(),t={defines:[],indexParameters:void 0,isFragment:this.target===i.u.Fragment,shouldUseHighPrecisionShader:e._shouldUseHighPrecisionShader,processor:e._getShaderProcessor(this.shaderLanguage),supportsUniformBuffers:e.supportsUniformBuffers,shadersRepository:a.v.GetShadersRepository(this.shaderLanguage),includesShadersStore:a.v.GetIncludesShadersStore(this.shaderLanguage),version:(100*e.version).toString(),platformName:e.shaderPlatformName,processingContext:null,isNDCHalfZRange:e.isNDCHalfZRange,useReverseDepthBuffer:e.useReverseDepthBuffer};return!e.isWebGPU&&e.version>1&&(t.processor=new l.f),this.isSFEMode&&t.defines.push(u),new Promise(r=>{(0,o.An)(this._builtCompilationString,t,(e,t)=>{r(e)},e)})}finalize(e){let t=e.sharedData.emitComments,r=this.target===i.u.Fragment,n=`
${t?"//Entry point\n":""}`;1===this.shaderLanguage?n=r?`@fragment
fn main(input: FragmentInputs) -> FragmentOutputs {
${this.sharedData.varyingInitializationsFragment}`:`@vertex
fn main(input: VertexInputs) -> FragmentInputs{
`:this.isSFEMode?n+=`#ifdef ${u}
vec4 nmeMain(vec2 vUV) { // main
#else
void main(void) {
#endif
`:n=`void main(void) {
`,this.compilationString=n+this.compilationString,this._constantDeclaration&&(this.compilationString=`
${t?"//Constants\n":""}${this._constantDeclaration}
${this.compilationString}`);let a="";for(let e in this.functions)a+=this.functions[e]+`
`;if(this.compilationString=`
${a}
${this.compilationString}`,!r&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}
${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}
${this._injectAtEnd}`),this.compilationString=`${this.compilationString}
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`
${t?"//Varyings\n":""}${r?this.sharedData.varyingDeclarationFragment:this.sharedData.varyingDeclaration}
${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`
${t?"//Samplers\n":""}${this._samplerDeclaration}
${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`
${t?"//Uniforms\n":""}${this._uniformDeclaration}
${this.compilationString}`),this._attributeDeclaration&&!r&&(this.compilationString=`
${t?"//Attributes\n":""}${this._attributeDeclaration}
${this.compilationString}`),1!==this.shaderLanguage)for(let e in this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,r&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString),this.extensions){let t=this.extensions[e];this.compilationString=`
${t}
${this.compilationString}`}this.isSFEMode&&(this.compilationString=`
// { "smartFilterBlockType": "${this.sharedData.nodeMaterial.name}", "namespace": "Babylon.NME.Test" }
${this.compilationString}`),this._builtCompilationString=this.compilationString}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_getFreeVariableName(e){return(e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e])?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e)?e+this.sharedData.variableNames[e]:e:(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_emit2DSampler(e,t="",r=!1,n,i,a){(0>this.samplers.indexOf(e)||r)&&(t&&(this._samplerDeclaration+=`#if ${t}
`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;
`,this._samplerDeclaration+=`var ${e}: texture_2d<${i?"u":"f"}32>;
`):this._samplerDeclaration+=`uniform ${a??""} ${i?"u":""}sampler2D ${e}; ${n||""}
`,t&&(this._samplerDeclaration+=`#endif
`),r||this.samplers.push(e))}_emitCubeSampler(e,t="",r=!1){(0>this.samplers.indexOf(e)||r)&&(t&&(this._samplerDeclaration+=`#if ${t}
`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;
`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;
`):this._samplerDeclaration+=`uniform samplerCube ${e};
`,t&&(this._samplerDeclaration+=`#endif
`),r||this.samplers.push(e))}_emit2DArraySampler(e){0>this.samplers.indexOf(e)&&(this._samplerDeclaration+=`uniform sampler2DArray ${e};
`,this.samplers.push(e))}_getGLType(e){switch(e){case n.E.Float:return"float";case n.E.Int:return"int";case n.E.Vector2:return"vec2";case n.E.Color3:case n.E.Vector3:return"vec3";case n.E.Color4:case n.E.Vector4:return"vec4";case n.E.Matrix:return"mat4"}return""}_getShaderType(e){let t=1===this.shaderLanguage;switch(e){case n.E.Float:return t?"f32":"float";case n.E.Int:return t?"i32":"int";case n.E.Vector2:return t?"vec2f":"vec2";case n.E.Color3:case n.E.Vector3:return t?"vec3f":"vec3";case n.E.Color4:case n.E.Vector4:return t?"vec4f":"vec4";case n.E.Matrix:return t?"mat4x4f":"mat4"}return""}_emitExtension(e,t,r=""){this.extensions[e]||(r&&(t=`#if ${r}
${t}
#endif`),this.extensions[e]=t)}_emitFunction(e,t,r){this.functions[e]||(this.sharedData.emitComments&&(t=r+`
`+t),this.functions[e]=t)}_emitCodeFromInclude(e,t,r){let n=a.v.GetIncludesShadersStore(this.shaderLanguage);if(r&&r.repeatKey)return`#include<${e}>${r.substitutionVars?"("+r.substitutionVars+")":""}[0..${r.repeatKey}]
`;let i=n[e]+"\n";if(this.sharedData.emitComments&&(i=t+`
`+i),!r)return i;if(r.replaceStrings)for(let e=0;e<r.replaceStrings.length;e++){let t=r.replaceStrings[e];i=i.replace(t.search,t.replace)}return i}_emitFunctionFromInclude(e,t,r,n=""){let i=e+n;if(this.functions[i])return;let s=a.v.GetIncludesShadersStore(this.shaderLanguage);if(!r||!r.removeAttributes&&!r.removeUniforms&&!r.removeVaryings&&!r.removeIfDef&&!r.replaceStrings){r&&r.repeatKey?this.functions[i]=`#include<${e}>${r.substitutionVars?"("+r.substitutionVars+")":""}[0..${r.repeatKey}]
`:this.functions[i]=`#include<${e}>${r?.substitutionVars?"("+r?.substitutionVars+")":""}
`,this.sharedData.emitComments&&(this.functions[i]=t+`
`+this.functions[i]);return}if(this.functions[i]=s[e],this.sharedData.emitComments&&(this.functions[i]=t+`
`+this.functions[i]),r.removeIfDef&&(this.functions[i]=this.functions[i].replace(/^\s*?#ifdef.+$/gm,""),this.functions[i]=this.functions[i].replace(/^\s*?#endif.*$/gm,""),this.functions[i]=this.functions[i].replace(/^\s*?#else.*$/gm,""),this.functions[i]=this.functions[i].replace(/^\s*?#elif.*$/gm,"")),r.removeAttributes&&(this.functions[i]=this.functions[i].replace(/\s*?attribute .+?;/g,"\n")),r.removeUniforms&&(this.functions[i]=this.functions[i].replace(/\s*?uniform .*?;/g,"\n")),r.removeVaryings&&(this.functions[i]=this.functions[i].replace(/\s*?(varying|in) .+?;/g,"\n")),r.replaceStrings)for(let e=0;e<r.replaceStrings.length;e++){let t=r.replaceStrings[e];this.functions[i]=this.functions[i].replace(t.search,t.replace)}}_registerTempVariable(e){return -1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitVaryingFromString(e,t,r="",n=!1){if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e);let i=this._getShaderType(t),a=(t=!1)=>{let a="";return r&&(r.startsWith("defined(")?a+=`#if ${r}
`:a+=`${n?"#ifndef":"#ifdef"} ${r}
`),1===this.shaderLanguage?"mat4x4f"===i?(a+=`varying ${e}_r0: vec4f;
varying ${e}_r1: vec4f;
varying ${e}_r2: vec4f;
varying ${e}_r3: vec4f;
`,t&&(a+=`var<private> ${e}: mat4x4f;
`,this.sharedData.varyingInitializationsFragment+=`${e} = mat4x4f(fragmentInputs.${e}_r0, fragmentInputs.${e}_r1, fragmentInputs.${e}_r2, fragmentInputs.${e}_r3);
`)):a+=`varying ${e}: ${i};
`:a+=`varying ${i} ${e};
`,r&&(a+=`#endif
`),a};if(1===this.shaderLanguage)this.sharedData.varyingDeclaration+=a(!1),this.sharedData.varyingDeclarationFragment+=a(!0);else{let e=a();this.sharedData.varyingDeclaration+=e,this.sharedData.varyingDeclarationFragment+=e}return!0}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==i.u.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_emitUniformFromString(e,t,r="",n=!1,i){if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),r&&(r.startsWith("defined(")?this._uniformDeclaration+=`#if ${r}
`:this._uniformDeclaration+=`${n?"#ifndef":"#ifdef"} ${r}
`),i&&(this._uniformDeclaration+=`${i}
`);let a=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${a};
`:this._uniformDeclaration+=`uniform ${a} ${e};
`,r&&(this._uniformDeclaration+=`#endif
`)}_generateTernary(e,t,r){return 1===this.shaderLanguage?`select(${t}, ${e}, ${r})`:`(${r}) ? ${e} : ${t}`}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_declareLocalVar(e,t,r){return 1===this.shaderLanguage?`${r?"const":"var"} ${e}: ${this._getShaderType(t)}`:`${r?"const ":""}${this._getShaderType(t)} ${e}`}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_toLinearSpace(e){return 1===this.shaderLanguage&&(e.type===n.E.Color3||e.type===n.E.Vector3)?`toLinearSpaceVec3(${e.associatedVariableName})`:`toLinearSpace(${e.associatedVariableName})`}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}_generateTextureSampleLOD(e,t,r){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${r})`:`${this._samplerLODFunc()}(${t}, ${e}, ${r})`}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}_generateTextureSampleCubeLOD(e,t,r){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${r})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${r})`}_convertVariableDeclarationToWGSL(e,t,r){return r.replace(RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}_convertVariableConstructorsToWGSL(e,t,r){return r.replace(RegExp(`(${e})\\(`,"g"),` ${t}(`)}_convertOutParametersToWGSL(e){return e.replace(RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_convertTernaryOperandsToWGSL(e){return e.replace(RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),(e,t,r,n)=>`select(${n}, ${r}, ${t})`)}_convertModOperatorsToWGSL(e){return e.replace(RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),(e,t,r)=>`((${t})%(${r}))`)}_convertConstToWGSL(e){return e.replace(RegExp("const var","g"),"const")}_convertInnerFunctionsToWGSL(e){return e.replace(/inversesqrt/g,"inverseSqrt")}_convertFunctionsToWGSL(e){let t,r=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;for(;null!==(t=r.exec(e));){let r=t[1],n=t[2],i=t[3].replace(/var\s/g,"");e=e.replace(t[0],`fn ${r}(${i}) -> ${n}`)}return e}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),e=(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}_convertTernaryOperandsToGLSL(e){return e.replace(RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),(e,t,r,n)=>`${t} ? ${r} : ${n}`)}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),e=this._convertTernaryOperandsToGLSL(e)}}},44745:function(e,t,r){r.d(t,{n:()=>i});var n=r(81951);class i extends n.x{constructor(e){super(e)}}},4489:function(e,t,r){r.d(t,{J:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("left",i.E.AutoDetect),this.registerInput("right",i.E.AutoDetect),this.registerInput("gradient",i.E.AutoDetect),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._linkConnectionTypes(1,2,!0),this._inputs[2].acceptedConnectionPointTypes.push(i.E.Float)}getClassName(){return"LerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = mix(${this.left.associatedVariableName} , ${this.right.associatedVariableName}, ${this.gradient.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.LerpBlock",o)},44976:function(e,t,r){r.d(t,{Z:()=>i});var n=r(10645);class i extends n.Z{constructor(e,t){e&&"function"!=typeof e&&!t&&(t=e,e=null),super(e,t),this.axis=this.read}}},45133:function(e,t,r){var n=r(66755);let i="logDepthVertex",a=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},45263:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexGlobalDeclarationWGSL:()=>s});var n=r(66755);let i="morphTargetsVertexGlobalDeclaration",a=`#ifdef MORPHTARGETS
uniform morphTargetInfluences : array<f32,NUM_MORPH_INFLUENCERS>;
#ifdef MORPHTARGETS_TEXTURE 
uniform morphTargetTextureIndices : array<f32,NUM_MORPH_INFLUENCERS>;uniform morphTargetTextureInfo : vec3<f32>;var morphTargets : texture_2d_array<f32>;var morphTargetsSampler : sampler;fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec3<f32>
{ 
let y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0).xyz;}
fn readVector4FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec4<f32>
{ 
let y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0);}
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},45743:function(e,t,r){Object.defineProperty(r(74549).x.prototype,"decalMap",{get:function(){return this._decalMap},set:function(e){this._decalMap=e},enumerable:!0,configurable:!0})},46005:function(e,t,r){r.d(t,{t:()=>i});var n=r(69724);class i{get querySet(){return this._querySet}constructor(e,t,r,i,a,s=!0,o){this._dstBuffers=[],this._engine=e,this._device=i,this._bufferManager=a,this._count=t,this._canUseMultipleBuffers=s,this._querySet=i.createQuerySet({label:o??"QuerySet",type:r,count:t}),this._queryBuffer=a.createRawBuffer(8*t,n.FB.QueryResolve|n.FB.CopySrc,void 0,"QueryBuffer"),s||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,n.FB.MapRead|n.FB.CopyDst,void 0,"QueryBufferNoMultipleBuffers"))}_getBuffer(e,t){let r;if(!this._canUseMultipleBuffers&&0===this._dstBuffers.length)return null;let i=this._device.createCommandEncoder();return 0===this._dstBuffers.length?r=this._bufferManager.createRawBuffer(8*this._count,n.FB.MapRead|n.FB.CopyDst,void 0,"QueryBufferAdditionalBuffer"):(r=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),i.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),i.copyBufferToBuffer(this._queryBuffer,0,r,0,8*t),this._device.queue.submit([i.finish()]),r}async readValues(e=0,t=1){let r=this._getBuffer(e,t);if(null===r)return null;let n=this._engine.uniqueId;try{await r.mapAsync(1);let e=new BigUint64Array(r.getMappedRange()).slice();return r.unmap(),this._dstBuffers[this._dstBuffers.length]=r,e}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==n)return null;throw e}}async readValue(e=0){let t=this._getBuffer(e,1);if(null===t)return null;let r=this._engine.uniqueId;try{await t.mapAsync(1);let e=new BigUint64Array(t.getMappedRange()),r=Number(e[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,r}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==r)return 0;throw e}}async readTwoValuesAndSubtract(e=0){let t=this._getBuffer(e,2);if(null===t)return null;let r=this._engine.uniqueId;try{await t.mapAsync(1);let e=new BigUint64Array(t.getMappedRange()),r=Number(e[1]-e[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,r}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==r)return 0;throw e}}dispose(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(let e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])}}},46658:function(e,t,r){r.d(t,{K:()=>S,R:()=>A});var n=r(69254),i=r(88609),a=r(32960),s=r(72384),o=r(57423),l=r(31913),u=r(43927),c=r(67983),d=r(69631),h=r(35038),f=r(53916),p=r(32160),_=r(46363),m=r(34642),g=r(6885),y=r(5741),v=r(66668),b=r(55687),x=r(90131),T=r(54622);let E={effect:null,subMesh:null};class A extends h.H{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){for(let t of["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"])this[t]=t===e}}class S extends f.a{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e?this._imageProcessingConfiguration=e:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t,r=!1){super(e,t,void 0,r||S.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new o.Wo(0,0,0),this.diffuseColor=new o.Wo(1,1,1),this.specularColor=new o.Wo(1,1,1),this.emissiveColor=new o.Wo(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new a.t(16),this._globalAmbientColor=new o.Wo(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new y.p(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new u.o,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),S.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),S.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!S.ReflectionTextureEnabled&&!!this._reflectionTexture&&!!this._reflectionTexture.isRenderTarget||!!S.RefractionTextureEnabled&&!!this._refractionTexture&&!!this._refractionTexture.isRenderTarget||this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===d.F.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==d.F.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,n=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();let i=t._drawWrapper;if(i.effect&&this.isFrozen&&i._wasPreviouslyReady&&i._wasPreviouslyUsingInstances===n)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new A(this._eventInfo.defineNames));let a=this.getScene(),s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;let o=a.getEngine();s._needNormals=(0,b.UX)(a,e,s,!0,this._maxSimultaneousLights,this._disableLighting),(0,b.Z7)(a,s);let d=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if((0,b.Kg)(a,s,this.canRenderToMRT&&!d),(0,b.t6)(a,s,d),T.l.PrepareDefines(o.currentRenderPassId,e,s),s._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,s._needUVs=!1;for(let e=1;e<=6;++e)s["MAINUV"+e]=!1;if(a.texturesEnabled){if(s.DIFFUSEDIRECTUV=0,s.BUMPDIRECTUV=0,s.AMBIENTDIRECTUV=0,s.OPACITYDIRECTUV=0,s.EMISSIVEDIRECTUV=0,s.SPECULARDIRECTUV=0,s.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&S.DiffuseTextureEnabled)if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._diffuseTexture,s,"DIFFUSE");else s.DIFFUSE=!1;if(this._ambientTexture&&S.AmbientTextureEnabled)if(!this._ambientTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._ambientTexture,s,"AMBIENT");else s.AMBIENT=!1;if(this._opacityTexture&&S.OpacityTextureEnabled)if(!this._opacityTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._opacityTexture,s,"OPACITY"),s.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else s.OPACITY=!1;if(this._reflectionTexture&&S.ReflectionTextureEnabled)if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;else{switch(s._needNormals=!0,s.REFLECTION=!0,s.ROUGHNESS=this._roughness>0,s.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,s.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.x.INVCUBIC_MODE,s.REFLECTIONMAP_3D=this._reflectionTexture.isCube,s.REFLECTIONMAP_OPPOSITEZ=s.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,s.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case p.x.EXPLICIT_MODE:s.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.x.PLANAR_MODE:s.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.x.PROJECTION_MODE:s.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.x.SKYBOX_MODE:s.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case p.x.SPHERICAL_MODE:s.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.x.EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.x.FIXED_EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.x.CUBIC_MODE:case p.x.INVCUBIC_MODE:default:s.setReflectionMode("REFLECTIONMAP_CUBIC")}s.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else s.REFLECTION=!1,s.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&S.EmissiveTextureEnabled)if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._emissiveTexture,s,"EMISSIVE");else s.EMISSIVE=!1;if(this._lightmapTexture&&S.LightmapTextureEnabled)if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._lightmapTexture,s,"LIGHTMAP"),s.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,s.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else s.LIGHTMAP=!1;if(this._specularTexture&&S.SpecularTextureEnabled)if(!this._specularTexture.isReadyOrNotBlocking())return!1;else(0,b.lw)(this._specularTexture,s,"SPECULAR"),s.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else s.SPECULAR=!1;if(a.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&S.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,b.lw)(this._bumpTexture,s,"BUMP"),s.PARALLAX=this._useParallax,s.PARALLAX_RHS=a.useRightHandedSystem,s.PARALLAXOCCLUSION=this._useParallaxOcclusion,s.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else s.BUMP=!1,s.PARALLAX=!1,s.PARALLAX_RHS=!1,s.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&S.RefractionTextureEnabled)if(!this._refractionTexture.isReadyOrNotBlocking())return!1;else s._needUVs=!0,s.REFRACTION=!0,s.REFRACTIONMAP_3D=this._refractionTexture.isCube,s.RGBDREFRACTION=this._refractionTexture.isRGBD,s.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize;else s.REFRACTION=!1;s.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else s.DIFFUSE=!1,s.AMBIENT=!1,s.OPACITY=!1,s.REFLECTION=!1,s.EMISSIVE=!1,s.LIGHTMAP=!1,s.BUMP=!1,s.REFRACTION=!1;s.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),s.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,s.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,s.SPECULAROVERALPHA=this._useSpecularOverAlpha,s.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,s.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,s.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(s._areFresnelDirty&&(S.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(s.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,s.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,s.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,s.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,s.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,s.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,s._needNormals=!0,s.FRESNEL=!0):s.FRESNEL=!1),s.AREALIGHTUSED){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}(0,b.BV)(e,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),s,this._applyDecalMapAfterDetailMap),(0,b.vG)(a,o,this,s,n,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=s,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,b.wJ)(e,s,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let h=!1;if(s.isDirty){let n=s._areLightsDisposed;s.markAsProcessed();let i=new g.L;s.REFLECTION&&i.addFallback(0,"REFLECTION"),s.SPECULAR&&i.addFallback(0,"SPECULAR"),s.BUMP&&i.addFallback(0,"BUMP"),s.PARALLAX&&i.addFallback(1,"PARALLAX"),s.PARALLAX_RHS&&i.addFallback(1,"PARALLAX_RHS"),s.PARALLAXOCCLUSION&&i.addFallback(0,"PARALLAXOCCLUSION"),s.SPECULAROVERALPHA&&i.addFallback(0,"SPECULAROVERALPHA"),s.FOG&&i.addFallback(1,"FOG"),s.POINTSIZE&&i.addFallback(0,"POINTSIZE"),s.LOGARITHMICDEPTH&&i.addFallback(0,"LOGARITHMICDEPTH"),(0,b.Lh)(s,i,this._maxSimultaneousLights),s.SPECULARTERM&&i.addFallback(0,"SPECULARTERM"),s.DIFFUSEFRESNEL&&i.addFallback(1,"DIFFUSEFRESNEL"),s.OPACITYFRESNEL&&i.addFallback(2,"OPACITYFRESNEL"),s.REFLECTIONFRESNEL&&i.addFallback(3,"REFLECTIONFRESNEL"),s.EMISSIVEFRESNEL&&i.addFallback(4,"EMISSIVEFRESNEL"),s.FRESNEL&&i.addFallback(4,"FRESNEL"),s.MULTIVIEW&&i.addFallback(0,"MULTIVIEW");let d=[l.o.PositionKind];s.NORMAL&&d.push(l.o.NormalKind),s.TANGENT&&d.push(l.o.TangentKind);for(let e=1;e<=6;++e)s["UV"+e]&&d.push(`uv${1===e?"":e}`);s.VERTEXCOLOR&&d.push(l.o.ColorKind),(0,b.TD)(d,e,s,i),(0,b.od)(d,s),(0,b.n5)(d,e,s),(0,b.pd)(d,e,s);let f="default",p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],_=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],m=["Material","Scene","Mesh"],y={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=i,this._eventInfo.fallbackRank=0,this._eventInfo.defines=s,this._eventInfo.uniforms=p,this._eventInfo.attributes=d,this._eventInfo.samplers=_,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=y,this._callbackPluginEventGeneric(128,this._eventInfo),T.l.AddUniformsAndSamplers(p,_),u.o.AddUniforms(p),u.o.AddSamplers(_),c.$&&(c.$.PrepareUniforms(p,s),c.$.PrepareSamplers(_,s)),(0,b.DI)({uniformsNames:p,uniformBuffersNames:m,samplers:_,defines:s,maxSimultaneousLights:this._maxSimultaneousLights}),(0,v.eb)(p);let x={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,p,m,_,s,d,x));let A=s.toString(),S=t.effect,I=a.getEngine().createEffect(f,{attributes:d,uniformsNames:p,uniformBuffersNames:m,samplers:_,defines:A,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:y,processFinalCode:x.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:s.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([r.e("2814").then(r.bind(r,40270)),Promise.all([r.e("1633"),r.e("3826"),r.e("2886")]).then(r.bind(r,29896))]):await Promise.all([r.e("5381").then(r.bind(r,55641)),Promise.all([r.e("52"),r.e("7650"),r.e("1730")]).then(r.bind(r,43521))]),this._shadersLoaded=!0}},o);if(this._eventInfo.customCode=void 0,I)if(this._onEffectCreatedObservable&&(E.effect=I,E.subMesh=t,this._onEffectCreatedObservable.notifyObservers(E)),this.allowShaderHotSwapping&&S&&!I.isReady()){if(I=S,s.markAsUnprocessed(),h=this.isFrozen,n)return s._areLightsDisposed=!0,!1}else a.resetCachedMaterial(),t.setEffect(I,s,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(s._renderId=a.getRenderId(),i._wasPreviouslyReady=!h,i._wasPreviouslyUsingInstances=n,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){let e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,r){let n=this.getScene(),i=r.materialDefines;if(!i)return;let a=r.effect;if(!a)return;this._activeEffect=a,t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(a,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,n,t,e,this.isFrozen),T.l.Bind(n.getEngine().currentRenderPassId,this._activeEffect,t,e,this),this._eventInfo.subMesh=r,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),i.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));let l=this._mustRebind(n,a,r,t.visibility);(0,b.qx)(t,a);let u=this._uniformBuffer;if(l){if(this.bindViewProjection(a),!u.useUbo||!this.isFrozen||!u.isSync||r._drawWrapper._forceRebindOnNextCall){if(S.FresnelEnabled&&i.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(u.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),u.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&u.updateColor4("opacityParts",new o.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(u.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),u.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(u.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),u.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(u.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),u.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),n.texturesEnabled){if(this._diffuseTexture&&S.DiffuseTextureEnabled&&(u.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,b.NL)(this._diffuseTexture,u,"diffuse")),this._ambientTexture&&S.AmbientTextureEnabled&&(u.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,b.NL)(this._ambientTexture,u,"ambient")),this._opacityTexture&&S.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,b.NL)(this._opacityTexture,u,"opacity")),this._hasAlphaChannel()&&u.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&S.ReflectionTextureEnabled){if(u.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),u.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){let e=this._reflectionTexture;u.updateVector3("vReflectionPosition",e.boundingBoxPosition),u.updateVector3("vReflectionSize",e.boundingBoxSize)}}else u.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&S.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,b.NL)(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&S.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,b.NL)(this._lightmapTexture,u,"lightmap")),this._specularTexture&&S.SpecularTextureEnabled&&(u.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,b.NL)(this._specularTexture,u,"specular")),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,b.NL)(this._bumpTexture,u,"bump"),n._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&S.RefractionTextureEnabled){let e=1;if(!this._refractionTexture.isCube&&(u.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),u.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){let e=this._refractionTexture;u.updateVector3("vRefractionPosition",e.boundingBoxPosition),u.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),u.updateColor4("vSpecularColor",this.specularColor,this.specularPower),u.updateColor3("vEmissiveColor",S.EmissiveTextureEnabled?this.emissiveColor:o.Wo.BlackReadOnly),u.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),n.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),u.updateColor3("vAmbientColor",this._globalAmbientColor)}n.texturesEnabled&&(this._diffuseTexture&&S.DiffuseTextureEnabled&&a.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&S.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&S.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&S.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?a.setTexture("reflectionCubeSampler",this._reflectionTexture):a.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&S.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&S.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&S.SpecularTextureEnabled&&a.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&a.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&S.RefractionTextureEnabled&&(this._refractionTexture.isCube?a.setTexture("refractionCubeSampler",this._refractionTexture):a.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(a),this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,v.Ji)(a,this,n),this.bindEyePosition(a)}else n.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(l||!this.isFrozen)&&(n.lightsEnabled&&!this._disableLighting&&(0,b.VX)(n,t,a,i,this._maxSimultaneousLights),(n.fogEnabled&&t.applyFog&&n.fogMode!==s.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||i.PREPASS)&&this.bindView(a),(0,b.D1)(n,t,a),i.NUM_MORPH_INFLUENCERS&&(0,b.KG)(t,a),i.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(a,i.INSTANCES),this.useLogarithmicDepth&&(0,b.gz)(i,a,n),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,r),u.update()}getAnimatables(){let e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e||!1}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,r=""){let n=x.p.Clone(()=>new S(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return n.name=e,n.id=e,this.stencil.copyTo(n.stencil),this._clonePlugins(n,r),n}static Parse(e,t,r){let n=x.p.Parse(()=>new S(e.name,t),e,t,r);return e.stencil&&n.stencil.parse(e.stencil,t,r),d.F._ParsePlugins(e,n,t,r),n}static get DiffuseTextureEnabled(){return m.k.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){m.k.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return m.k.DetailTextureEnabled}static set DetailTextureEnabled(e){m.k.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return m.k.AmbientTextureEnabled}static set AmbientTextureEnabled(e){m.k.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return m.k.OpacityTextureEnabled}static set OpacityTextureEnabled(e){m.k.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return m.k.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){m.k.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return m.k.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){m.k.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return m.k.SpecularTextureEnabled}static set SpecularTextureEnabled(e){m.k.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return m.k.BumpTextureEnabled}static set BumpTextureEnabled(e){m.k.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return m.k.LightmapTextureEnabled}static set LightmapTextureEnabled(e){m.k.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return m.k.RefractionTextureEnabled}static set RefractionTextureEnabled(e){m.k.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return m.k.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){m.k.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return m.k.FresnelEnabled}static set FresnelEnabled(e){m.k.FresnelEnabled=e}}S.ForceGLSL=!1,(0,n.gn)([(0,i.oU)("diffuseTexture")],S.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,i.oU)("ambientTexture")],S.prototype,"_ambientTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,n.gn)([(0,i.oU)("opacityTexture")],S.prototype,"_opacityTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,n.gn)([(0,i.oU)("reflectionTexture")],S.prototype,"_reflectionTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,n.gn)([(0,i.oU)("emissiveTexture")],S.prototype,"_emissiveTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,n.gn)([(0,i.oU)("specularTexture")],S.prototype,"_specularTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularTexture",void 0),(0,n.gn)([(0,i.oU)("bumpTexture")],S.prototype,"_bumpTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,n.gn)([(0,i.oU)("lightmapTexture")],S.prototype,"_lightmapTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"lightmapTexture",void 0),(0,n.gn)([(0,i.oU)("refractionTexture")],S.prototype,"_refractionTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"refractionTexture",void 0),(0,n.gn)([(0,i.n9)("ambient")],S.prototype,"ambientColor",void 0),(0,n.gn)([(0,i.n9)("diffuse")],S.prototype,"diffuseColor",void 0),(0,n.gn)([(0,i.n9)("specular")],S.prototype,"specularColor",void 0),(0,n.gn)([(0,i.n9)("emissive")],S.prototype,"emissiveColor",void 0),(0,n.gn)([(0,i.qC)()],S.prototype,"specularPower",void 0),(0,n.gn)([(0,i.qC)("useAlphaFromDiffuseTexture")],S.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromDiffuseTexture",void 0),(0,n.gn)([(0,i.qC)("useEmissiveAsIllumination")],S.prototype,"_useEmissiveAsIllumination",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useEmissiveAsIllumination",void 0),(0,n.gn)([(0,i.qC)("linkEmissiveWithDiffuse")],S.prototype,"_linkEmissiveWithDiffuse",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"linkEmissiveWithDiffuse",void 0),(0,n.gn)([(0,i.qC)("useSpecularOverAlpha")],S.prototype,"_useSpecularOverAlpha",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,n.gn)([(0,i.qC)("useReflectionOverAlpha")],S.prototype,"_useReflectionOverAlpha",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useReflectionOverAlpha",void 0),(0,n.gn)([(0,i.qC)("disableLighting")],S.prototype,"_disableLighting",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,n.gn)([(0,i.qC)("useObjectSpaceNormalMap")],S.prototype,"_useObjectSpaceNormalMap",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,n.gn)([(0,i.qC)("useParallax")],S.prototype,"_useParallax",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,n.gn)([(0,i.qC)("useParallaxOcclusion")],S.prototype,"_useParallaxOcclusion",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,n.gn)([(0,i.qC)()],S.prototype,"parallaxScaleBias",void 0),(0,n.gn)([(0,i.qC)("roughness")],S.prototype,"_roughness",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,n.gn)([(0,i.qC)()],S.prototype,"indexOfRefraction",void 0),(0,n.gn)([(0,i.qC)()],S.prototype,"invertRefractionY",void 0),(0,n.gn)([(0,i.qC)()],S.prototype,"alphaCutOff",void 0),(0,n.gn)([(0,i.qC)("useLightmapAsShadowmap")],S.prototype,"_useLightmapAsShadowmap",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,n.gn)([(0,i.qQ)("diffuseFresnelParameters")],S.prototype,"_diffuseFresnelParameters",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"diffuseFresnelParameters",void 0),(0,n.gn)([(0,i.qQ)("opacityFresnelParameters")],S.prototype,"_opacityFresnelParameters",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],S.prototype,"opacityFresnelParameters",void 0),(0,n.gn)([(0,i.qQ)("reflectionFresnelParameters")],S.prototype,"_reflectionFresnelParameters",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"reflectionFresnelParameters",void 0),(0,n.gn)([(0,i.qQ)("refractionFresnelParameters")],S.prototype,"_refractionFresnelParameters",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"refractionFresnelParameters",void 0),(0,n.gn)([(0,i.qQ)("emissiveFresnelParameters")],S.prototype,"_emissiveFresnelParameters",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"emissiveFresnelParameters",void 0),(0,n.gn)([(0,i.qC)("useReflectionFresnelFromSpecular")],S.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"useReflectionFresnelFromSpecular",void 0),(0,n.gn)([(0,i.qC)("useGlossinessFromSpecularMapAlpha")],S.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,n.gn)([(0,i.qC)("maxSimultaneousLights")],S.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,n.gn)([(0,i.qC)("invertNormalMapX")],S.prototype,"_invertNormalMapX",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,n.gn)([(0,i.qC)("invertNormalMapY")],S.prototype,"_invertNormalMapY",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,n.gn)([(0,i.qC)("twoSidedLighting")],S.prototype,"_twoSidedLighting",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,n.gn)([(0,i.qC)("applyDecalMapAfterDetailMap")],S.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,n.gn)([(0,i.wz)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,_.H7)("BABYLON.StandardMaterial",S),s.x.DefaultMaterialFactory=e=>new S("default material",e)},49228:function(e,t,r){var n=r(66588),i=r(74549),a=r(81299);r(61535),r(3155),n.ThinEngine.prototype.createQuery=function(){let e=this._gl.createQuery();if(!e)throw Error("Unable to create Occlusion Query");return e},n.ThinEngine.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},n.ThinEngine.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},n.ThinEngine.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},n.ThinEngine.prototype.beginOcclusionQuery=function(e,t){let r=this._getGlAlgorithmType(e);return this._gl.beginQuery(r,t),!0},n.ThinEngine.prototype.endOcclusionQuery=function(e){let t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},n.ThinEngine.prototype._createTimeQuery=function(){let e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},n.ThinEngine.prototype._deleteTimeQuery=function(e){let t=this.getCaps().timerQuery;if(t.deleteQueryEXT)return void t.deleteQueryEXT(e);this.deleteQuery(e)},n.ThinEngine.prototype._getTimeQueryResult=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},n.ThinEngine.prototype._getTimeQueryAvailability=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},n.ThinEngine.prototype.startTimeQuery=function(){let e=this.getCaps(),t=e.timerQuery;if(!t)return null;let r=new a.W;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)r._startTimeQuery=this._createTimeQuery(),r._startTimeQuery&&t.queryCounterEXT(r._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;r._timeElapsedQuery=this._createTimeQuery(),r._timeElapsedQuery&&(t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,r._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,r._timeElapsedQuery)),this._currentNonTimestampToken=r}return r},n.ThinEngine.prototype.endTimeQuery=function(e){let t=this.getCaps(),r=t.timerQuery;if(!r||!e)return -1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return -1;!e._endTimeQuery&&(e._endTimeQuery=this._createTimeQuery(),e._endTimeQuery&&r.queryCounterEXT(e._endTimeQuery,r.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return -1;r.endQueryEXT?r.endQueryEXT(r.TIME_ELAPSED_EXT):(this._gl.endQuery(r.TIME_ELAPSED_EXT),this._currentNonTimestampToken=null),e._timeElapsedQueryEnded=!0}let n=this._gl.getParameter(r.GPU_DISJOINT_EXT),i=!1;if(e._endTimeQuery?i=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(i=this._getTimeQueryAvailability(e._timeElapsedQuery)),i&&!n){let r=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return -1;let t=this._getTimeQueryResult(e._startTimeQuery);r=this._getTimeQueryResult(e._endTimeQuery)-t,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return -1;r=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1}return r}return -1},n.ThinEngine.prototype.captureGPUFrameTime=function(e){if(e!==this._captureGPUFrameTime)if(this._captureGPUFrameTime=e,e){let e=this.getGPUFrameTimeCounter();this._onBeginFrameObserver=this.onBeginFrameObservable.add(()=>{this._gpuFrameTimeToken||(this._gpuFrameTimeToken=this.startTimeQuery())}),this._onEndFrameObserver=this.onEndFrameObservable.add(()=>{if(!this._gpuFrameTimeToken)return;let t=this.endTimeQuery(this._gpuFrameTimeToken);t>-1&&(this._gpuFrameTimeToken=null,e.fetchNewFrame(),e.addCount(t,!0))})}else this.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null},n.ThinEngine.prototype._getGlAlgorithmType=function(e){return e===i.x.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED}},50195:function(e,t,r){r.d(t,{Z:()=>o});var n=r(9787),i=r(96368),a=r(93014),s=r(62083);class o extends s.AS{constructor(e){super();let t=!1,r=!1,s=(null==e?void 0:e.keyCode)!==!1,o=new Set,l=e=>{let t=s?e.code:e.key;o.add(t),o.add(t.toLowerCase()),this.emit("change")},u=e=>{let t=s?e.code:e.key;o.delete(t),o.delete(t.toLowerCase()),this.emit("change")};function c(){return o.size>0}function d(e){return o.has(e.toLowerCase())}let h=(e=!1)=>{!r&&(r=!0,window.addEventListener("keydown",l),window.addEventListener("keyup",u),e&&this.emit("enable"))},f=(e=!1)=>{r&&(r=!1,o.clear(),window.removeEventListener("keydown",l),window.removeEventListener("keyup",u),e&&this.emit("disable"))};this.getControl=(e,t={})=>{let{filter:r=e}=t,s=(0,n._T)(t,["filter"]),l=c;return r&&("string"==typeof r?l=()=>d(r):"function"==typeof r?l=()=>c()&&r(new Set(o)):Array.isArray(r)&&(l=()=>r.some(d))),new i.Z((0,a.Z)(l),Object.assign({name:t.filter?String(e||r):"string"==typeof r&&r?`key:${r}`:String(e||r||"any key")},s,{device:this,children:null}))};let p=this.destroy;this.destroy=()=>{t=!0,p(),f()},Object.defineProperties(this,{connected:{enumerable:!1,configurable:!1,writable:!1,value:!0},enabled:{get:()=>r,set(e){e&&!t?h(!0):f(!0)}}}),(null==e?void 0:e.enabled)!==!1&&h()}}},50571:function(e,t,r){r.d(t,{j:()=>c});var n=r(72384),i=r(80405),a=r(47811),s=r(29531),o=r(58486),l=r(4300),u=r(17722);Object.defineProperty(n.x.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new a.v(this);let e=this._getComponent(i.l.NAME_GAMEPAD);e||(e=new c(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),s.a.prototype.addGamepad=function(){return this.add(new o.c),this},l.$.prototype.addGamepad=function(){return this.add(new u.R),this};class c{constructor(e){this.name=i.l.NAME_GAMEPAD,this.scene=e}register(){}rebuild(){}dispose(){let e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)}}},51940:function(e,t,r){var n=r(66755);let i="bakedVertexAnimation",a=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
let VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;
#else
let VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;
#endif
let totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},52137:function(e,t,r){r.d(t,{x:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("x",i.E.Float),this.registerInput("y",i.E.Float),this.registerOutput("output",i.E.Float)}getClassName(){return"ArcTan2Block"}get x(){return this._inputs[0]}get y(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0],r=1===e.shaderLanguage?"atan2":"atan";return e.compilationString+=e._declareOutput(t)+` = ${r}(${this.x.associatedVariableName}, ${this.y.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.ArcTan2Block",o)},5242:function(e,t,r){var n=r(66755);let i="fogVertex",a=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},52842:function(e,t,r){r.r(t),r.d(t,{AnimationPropertyInfo:()=>u,TransformNodeAnimationPropertyInfo:()=>c,WeightAnimationPropertyInfo:()=>d,getQuaternion:()=>o,getVector3:()=>s,getWeights:()=>l});var n=r(68763),i=r(61834),a=r(81453);function s(e,t,r,n){return i.P.FromArray(t,r).scaleInPlace(n)}function o(e,t,r,n){return i._f.FromArray(t,r).scaleInPlace(n)}function l(e,t,r,n){let i=Array(e._numMorphTargets);for(let e=0;e<i.length;e++)i[e]=t[r++]*n;return i}class u{constructor(e,t,r,n){this.type=e,this.name=t,this.getValue=r,this.getStride=n}_buildAnimation(e,t,r){let i=new n.fw(e,this.name,t,this.type);return i.setKeys(r),i}}class c extends u{buildAnimations(e,t,r,n){let i=[];return i.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(t,r,n)}),i}}class d extends u{buildAnimations(e,t,r,i){let a=[];if(e._numMorphTargets)for(let s=0;s<e._numMorphTargets;s++){let o=new n.fw(`${t}_${s}`,this.name,r,this.type);if(o.setKeys(i.map(e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[s]:void 0,value:e.value[s],outTangent:e.outTangent?e.outTangent[s]:void 0,interpolation:e.interpolation}))),e._primitiveBabylonMeshes){for(let t of e._primitiveBabylonMeshes)if(t.morphTargetManager){let e=t.morphTargetManager.getTarget(s),r=o.clone();e.animations.push(r),a.push({babylonAnimatable:e,babylonAnimation:r})}}}return a}}(0,a.eF)("/nodes/{}/translation",[new c(n.fw.ANIMATIONTYPE_VECTOR3,"position",s,()=>3)]),(0,a.eF)("/nodes/{}/rotation",[new c(n.fw.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",o,()=>4)]),(0,a.eF)("/nodes/{}/scale",[new c(n.fw.ANIMATIONTYPE_VECTOR3,"scaling",s,()=>3)]),(0,a.eF)("/nodes/{}/weights",[new d(n.fw.ANIMATIONTYPE_FLOAT,"influence",l,e=>e._numMorphTargets)])},5330:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexDeclarationWGSL:()=>s});var n=r(66755);let i="morphTargetsVertexDeclaration",a=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
#ifdef MORPHTARGETS_POSITION
attribute position{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_NORMAL
attribute normal{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_TANGENT
attribute tangent{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_UV
attribute uv_{X} : vec2<f32>;
#endif
#ifdef MORPHTARGETS_UV2
attribute uv2_{X} : vec2<f32>;
#endif
#elif {X}==0
uniform morphTargetCount: i32;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},53567:function(e,t,r){var n=r(66755);let i="vrMultiviewToSingleviewPixelShader",a=`precision mediump sampler2DArray;varying vec2 vUV;uniform sampler2DArray multiviewSampler;uniform int imageIndex;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{gl_FragColor=texture2D(multiviewSampler,vec3(vUV,imageIndex));}`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a)},53648:function(e,t,r){r.r(t),r.d(t,{depthVertexShader:()=>l});var n=r(66755);r(33414),r(76438),r(74959),r(75522),r(16397),r(99046);let i="pointCloudVertexDeclaration",a=`#ifdef POINTSIZE
uniform float pointSize;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a),r(1629),r(9858),r(20536),r(5929),r(4194),r(20995),r(31974);let s="depthVertexShader",o=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<clipPlaneVertexDeclaration>
#include<instancesDeclaration>
uniform mat4 viewProjection;uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#ifdef STORE_CAMERASPACE_Z
uniform mat4 view;varying vec4 vViewPos;
#endif
#include<pointCloudVertexDeclaration>
varying float vDepthMetric;
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef UV2
vec2 uv2Updated=uv2;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#include<clipPlaneVertex>
gl_Position=viewProjection*worldPos;
#ifdef STORE_CAMERASPACE_Z
vViewPos=view*worldPos;
#else
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));
#else
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#endif
#endif
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2Updated,1.0,0.0));
#endif
#endif
#include<pointCloudVertex>
}
`;n.v.ShadersStore[s]||(n.v.ShadersStore[s]=o);let l={name:s,shader:o}},53815:function(){},54795:function(e,t,r){r.d(t,{D:()=>i});var n=r(46005);class i{get querySet(){return this._querySet.querySet}get hasQueries(){return this._currentTotalIndices!==this._availableIndices.length}canBeginQuery(e){if(this._frameQuerySetIsDirty===this._engine.frameId||this._queryFrameId[e]===this._engine.frameId)return!1;let t=void 0!==this._engine._getCurrentRenderPassWrapper().renderPassDescriptor.occlusionQuerySet;return t&&(this._queryFrameId[e]=this._engine.frameId),t}constructor(e,t,r,n=50,i=100){this._availableIndices=[],this._frameQuerySetIsDirty=-1,this._queryFrameId=[],this._engine=e,this._device=t,this._bufferManager=r,this._frameLastBuffer=-1,this._currentTotalIndices=0,this._countIncrement=i,this._allocateNewIndices(n)}createQuery(){0===this._availableIndices.length&&this._allocateNewIndices();let e=this._availableIndices[this._availableIndices.length-1];return this._availableIndices.length--,e}deleteQuery(e){this._availableIndices[this._availableIndices.length]=e}isQueryResultAvailable(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length}getQueryResult(e){return Number(this._lastBuffer?.[e]??-1)}_retrieveQueryBuffer(){this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices).then(e=>{this._lastBuffer=e}))}_allocateNewIndices(e){e=e??this._countIncrement,this._delayQuerySetDispose();for(let t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);this._currentTotalIndices+=e,this._querySet=new n.t(this._engine,this._currentTotalIndices,"occlusion",this._device,this._bufferManager,!1,"QuerySet_OcclusionQuery_count_"+this._currentTotalIndices),this._frameQuerySetIsDirty=this._engine.frameId}_delayQuerySetDispose(){let e=this._querySet;e&&setTimeout(()=>e.dispose,1e3)}dispose(){this._querySet?.dispose(),this._availableIndices.length=0}}},54812:function(e,t){t.seededSquirrelNoise=void 0,t.seededSquirrelNoise=function(e){return function(t){var r,n,i;return r=e,i=0x68e31da4*(n=t)+r,i^=i>>8,i+=0xb5297a4d,i^=i<<8,i*=0x1b56c4e9,(i^=i>>8)/0x7fffffff}}},56093:function(e,t,r){r.d(t,{n:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("value",i.E.Float),this.registerInput("edge",i.E.Float),this.registerOutput("output",i.E.Float)}getClassName(){return"StepBlock"}get value(){return this._inputs[0]}get edge(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = step(${this.edge.associatedVariableName}, ${this.value.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.StepBlock",o)},56168:function(e,t,r){var n=r(66755);let i="instancesDeclaration",a=`#ifdef INSTANCES
attribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;
#ifdef INSTANCESCOLOR
attribute instanceColor : vec4<f32>;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;
#ifdef THIN_INSTANCES
uniform previousWorld : mat4x4<f32>;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform previousWorld : mat4x4<f32>;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},56283:function(e,t,r){var n=r(66755);let i="logDepthDeclaration",a=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;varying float vFragmentDepth;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},56865:function(e,t,r){r.d(t,{D:()=>i});var n=r(16891);class i{static ComputeNumMipmapLevels(e,t){return(0,n.ILog2)(Math.max(e,t))+1}static GetTextureTypeFromFormat(e){switch(e){case"r8unorm":case"r8uint":case"rg8unorm":case"rg8uint":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8uint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb10a2uint":case"rgb10a2unorm":case"rgb9e5ufloat":case"rg11b10ufloat":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc5-rg-unorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc4-r-unorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-rg11unorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":case"stencil8":break;case"r8snorm":case"r8sint":case"rg8snorm":case"rg8sint":case"rgba8snorm":case"rgba8sint":case"bc6h-rgb-float":case"bc5-rg-snorm":case"bc4-r-snorm":case"eac-r11snorm":case"eac-rg11snorm":return 3;case"r16uint":case"r16unorm":case"rg16unorm":case"rgba16unorm":case"rg16uint":case"rgba16uint":case"depth16unorm":return 5;case"r16sint":case"r16snorm":case"rg16snorm":case"rgba16snorm":case"rg16sint":case"rgba16sint":return 4;case"r16float":case"rg16float":case"rgba16float":return 2;case"r32uint":case"rg32uint":case"rgba32uint":case"r32sint":case"rg32sint":case"rgba32sint":return 7;case"r32float":case"rg32float":case"rgba32float":case"depth32float":case"depth32float-stencil8":case"depth24plus":case"depth24plus-stencil8":return 1}return 0}static GetBlockInformationFromFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16unorm":case"rg16unorm":case"rgba16unorm":case"r16snorm":case"rg16snorm":case"rgba16snorm":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2uint":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":break;case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw"No fixed size for Stencil8 format!";case"depth24plus":throw"No fixed size for Depth24Plus format!";case"depth24plus-stencil8":throw"No fixed size for Depth24PlusStencil8 format!";case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc5-rg-unorm":case"bc5-rg-snorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-rg11unorm":case"eac-rg11snorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":return{width:4,height:4,length:8};case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":return{width:5,height:4,length:16};case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":return{width:5,height:5,length:16};case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":return{width:6,height:5,length:16};case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":return{width:6,height:6,length:16};case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":return{width:8,height:5,length:16};case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":return{width:8,height:6,length:16};case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":return{width:8,height:8,length:16};case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":return{width:10,height:5,length:16};case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":return{width:10,height:6,length:16};case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":return{width:10,height:8,length:16};case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":return{width:10,height:10,length:16};case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":return{width:12,height:10,length:16};case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return{width:12,height:12,length:16}}return{width:1,height:1,length:4}}static IsHardwareTexture(e){return!!e.release}static IsInternalTexture(e){return!!e.dispose}static IsImageBitmap(e){return void 0!==e.close}static IsImageBitmapArray(e){return Array.isArray(e)&&void 0!==e[0].close}static IsCompressedFormat(e){switch(e){case"bc7-rgba-unorm-srgb":case"bc7-rgba-unorm":case"bc6h-rgb-float":case"bc6h-rgb-ufloat":case"bc5-rg-snorm":case"bc5-rg-unorm":case"bc4-r-snorm":case"bc4-r-unorm":case"bc3-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc1-rgba-unorm-srgb":case"bc1-rgba-unorm":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":case"eac-rg11unorm":case"eac-rg11snorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return!0}return!1}static GetWebGPUTextureFormat(e,t,r=!1){switch(t){case 15:return"depth16unorm";case 16:return"depth24plus";case 13:return"depth24plus-stencil8";case 14:return"depth32float";case 18:return"depth32float-stencil8";case 19:return"stencil8";case 36492:return r?"bc7-rgba-unorm-srgb":"bc7-rgba-unorm";case 36495:return"bc6h-rgb-ufloat";case 36494:return"bc6h-rgb-float";case 33779:return r?"bc3-rgba-unorm-srgb":"bc3-rgba-unorm";case 33778:return r?"bc2-rgba-unorm-srgb":"bc2-rgba-unorm";case 33777:case 33776:return r?"bc1-rgba-unorm-srgb":"bc1-rgba-unorm";case 37808:return r?"astc-4x4-unorm-srgb":"astc-4x4-unorm";case 36196:case 37492:return r?"etc2-rgb8unorm-srgb":"etc2-rgb8unorm";case 37496:return r?"etc2-rgba8unorm-srgb":"etc2-rgba8unorm"}switch(e){case 3:switch(t){case 6:return"r8snorm";case 7:return"rg8snorm";case 4:throw"RGB format not supported in WebGPU";case 8:return"r8sint";case 9:return"rg8sint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8sint";default:return"rgba8snorm"}case 0:switch(t){case 6:return"r8unorm";case 7:return"rg8unorm";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return r?"rgba8unorm-srgb":"rgba8unorm";case 12:return r?"bgra8unorm-srgb":"bgra8unorm";case 8:return"r8uint";case 9:return"rg8uint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8uint";case 0:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case 1:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case 2:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return"rgba8unorm"}case 4:switch(t){case 8:return"r16sint";case 9:return"rg16sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba16sint"}case 5:switch(t){case 8:return"r16uint";case 9:return"rg16uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba16uint"}case 6:switch(t){case 8:return"r32sint";case 9:return"rg32sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba32sint"}case 7:switch(t){case 8:return"r32uint";case 9:return"rg32uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba32uint"}case 1:switch(t){case 6:return"r32float";case 7:return"rg32float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return"rgba32float"}case 2:switch(t){case 6:return"r16float";case 7:return"rg16float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return"rgba16float"}case 10:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case 13:switch(t){case 5:default:return"rg11b10ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV"}case 14:switch(t){case 5:default:return"rgb9e5ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV"}case 8:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case 9:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case 11:switch(t){case 5:default:return"rgb10a2unorm";case 11:return"rgb10a2uint"}}return r?"rgba8unorm-srgb":"rgba8unorm"}static GetNumChannelsFromWebGPUTextureFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":case"bc4-r-unorm":case"bc4-r-snorm":case"r16uint":case"r16sint":case"depth16unorm":case"r16float":case"r16unorm":case"r16snorm":case"r32uint":case"r32sint":case"r32float":case"depth32float":case"stencil8":case"depth24plus":case"eac-r11unorm":case"eac-r11snorm":return 1;case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth32float-stencil8":case"bc5-rg-unorm":case"bc5-rg-snorm":case"rg16uint":case"rg16sint":case"rg16float":case"rg16unorm":case"rg16snorm":case"rg32uint":case"rg32sint":case"rg32float":case"depth24plus-stencil8":case"eac-rg11unorm":case"eac-rg11snorm":return 2;case"rgb9e5ufloat":case"rg11b10ufloat":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":return 3;case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgba16unorm":case"rgba16snorm":case"rgb10a2uint":case"rgb10a2unorm":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"rgba16uint":case"rgba16sint":case"rgba16float":case"rgba32uint":case"rgba32sint":case"rgba32float":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return 4}throw`Unknown format ${e}!`}static HasStencilAspect(e){switch(e){case"stencil8":case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static HasDepthAndStencilAspects(e){switch(e){case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static GetDepthFormatOnly(e){switch(e){case"depth16unorm":return"depth16unorm";case"depth24plus":case"depth24plus-stencil8":return"depth24plus";case"depth32float":case"depth32float-stencil8":return"depth32float"}return e}static GetSample(e){return e>1?4:1}}},57955:function(e,t,r){r.r(t),r.d(t,{clipPlaneVertexDeclarationWGSL:()=>s});var n=r(66755);let i="clipPlaneVertexDeclaration",a=`#ifdef CLIPPLANE
uniform vClipPlane: vec4<f32>;varying fClipDistance: f32;
#endif
#ifdef CLIPPLANE2
uniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;
#endif
#ifdef CLIPPLANE3
uniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;
#endif
#ifdef CLIPPLANE4
uniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;
#endif
#ifdef CLIPPLANE5
uniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;
#endif
#ifdef CLIPPLANE6
uniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},58237:function(e,t,r){r.d(t,{Z:()=>a});var n=r(9787),i=r(81997);class a extends i.Z{constructor(e){var{left:t,right:r,up:i,down:a}=e;super(()=>[this.children.get("right").read()-this.children.get("left").read(),this.children.get("up").read()-this.children.get("down").read()],(0,n._T)(e,["left","right","up","down"])),this.children.set("left",t),this.children.set("right",r),this.children.set("up",i),this.children.set("down",a);let s=()=>this.emit("change");this.children.forEach(e=>{e.on("change",s)})}}},58311:function(e,t,r){var n=r(66755);let i="decalFragment",a=`#ifdef DECAL
var decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;
#ifdef GAMMADECAL
decalTempColor=toLinearSpaceVec3(decalColor.rgb);
#endif
#ifdef DECAL_SMOOTHALPHA
decalTempAlpha=decalColor.a*decalColor.a;
#endif
surfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},58560:function(e,t,r){r.d(t,{c:()=>o});var n=r(69254),i=r(58526),a=r(71231),s=r(16415);class o extends i.s{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("instance",a.g.Geometry,!0),this.registerInput("count",a.g.Int,!0,1),this.registerOutput("output",a.g.Geometry)}getInstanceIndex(){return this._currentIndex}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"InstantiateBaseBlock"}get instance(){return this._inputs[0]}get count(){return this._inputs[1]}get output(){return this._outputs[0]}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){let e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),void 0!==e.evaluateContext&&(this.evaluateContext=e.evaluateContext)}}(0,n.gn)([(0,s.p)("Evaluate context",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],o.prototype,"evaluateContext",void 0)},5929:function(e,t,r){r.r(t),r.d(t,{bonesVertex:()=>s});var n=r(66755);let i="bonesVertex",a=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},60413:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise4D=void 0;var r=(5-Math.sqrt(5))/20,n=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]];t.makeNoise4D=function(e){void 0===e&&(e=Math.random);for(var t,i,a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;for(var s=255;s>0;s--)t=Math.floor((s+1)*e()),i=a[s],a[s]=a[t],a[t]=i;for(var o=new Uint8Array(512),l=new Uint8Array(512),s=0;s<512;s++)o[s]=a[255&s],l[s]=o[s]%12;return function(e,t,i,a){var s=(e+t+i+a)*(Math.sqrt(5)-1)/4,l=Math.floor(e+s),u=Math.floor(t+s),c=Math.floor(i+s),d=Math.floor(a+s),h=(l+u+c+d)*r,f=e-(l-h),p=t-(u-h),_=i-(c-h),m=a-(d-h),g=0,y=0,v=0,b=0;f>p?g++:y++,f>_?g++:v++,f>m?g++:b++,p>_?y++:v++,p>m?y++:b++,_>m?v++:b++;var x=+(g>=3),T=+(y>=3),E=+(v>=3),A=+(b>=3),S=+(g>=2),I=+(y>=2),C=+(v>=2),P=+(b>=2),R=+(g>=1),w=+(y>=1),M=+(v>=1),O=+(b>=1),L=f-x+r,N=p-T+r,F=_-E+r,D=m-A+r,B=f-S+2*r,k=p-I+2*r,G=_-C+2*r,U=m-P+2*r,V=f-R+3*r,H=p-w+3*r,$=_-M+3*r,W=m-O+3*r,j=f-1+4*r,z=p-1+4*r,Y=_-1+4*r,K=m-1+4*r,X=255&l,Z=255&u,q=255&c,Q=255&d,J=n[o[X+o[Z+o[q+o[Q]]]]%32],ee=n[o[X+x+o[Z+T+o[q+E+o[Q+A]]]]%32],et=n[o[X+S+o[Z+I+o[q+C+o[Q+P]]]]%32],er=n[o[X+R+o[Z+w+o[q+M+o[Q+O]]]]%32],en=n[o[X+1+o[Z+1+o[q+1+o[Q+1]]]]%32],ei=.5-f*f-p*p-_*_-m*m,ea=ei<0?0:Math.pow(ei,4)*(J[0]*f+J[1]*p+J[2]*_+J[3]*m),es=.5-L*L-N*N-F*F-D*D,eo=es<0?0:Math.pow(es,4)*(ee[0]*L+ee[1]*N+ee[2]*F+ee[3]*D),el=.5-B*B-k*k-G*G-U*U,eu=el<0?0:Math.pow(el,4)*(et[0]*B+et[1]*k+et[2]*G+et[3]*U),ec=.5-V*V-H*H-$*$-W*W,ed=ec<0?0:Math.pow(ec,4)*(er[0]*V+er[1]*H+er[2]*$+er[3]*W),eh=.5-j*j-z*z-Y*Y-K*K;return 72.37855765153665*(ea+eo+eu+ed+(eh<0?0:Math.pow(eh,4)*(en[0]*j+en[1]*z+en[2]*Y+en[3]*K)))}}},61062:function(e,t,r){r.d(t,{o:()=>l});var n=r(71777),i=r(16891),a=r(11740),s=r(19956),o=r(64261);class l{constructor(e,t={}){this.quality=4096,this.hdrScale=1,this.useCdf=!1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality,this.useCdf=t.useCdf||this.useCdf}_createRenderTarget(e){let t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);let r=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!1,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:2,label:"HDR_Irradiance_Filtering_Target"});return this._engine.updateTextureWrappingMode(r.texture,0,0,0),r}_prefilterInternal(e){let t=e.getSize().width,r=(0,i.ILog2)(t),s=this._effectWrapper.effect,o=Math.max(32,1<<(0,i.ILog2)(t>>3)),l=this._createRenderTarget(o);this._effectRenderer.saveStates(),this._effectRenderer.setViewport(),this._effectRenderer.applyEffectWrapper(this._effectWrapper);let u=[[new n.P(0,0,-1),new n.P(0,-1,0),new n.P(1,0,0)],[new n.P(0,0,1),new n.P(0,-1,0),new n.P(-1,0,0)],[new n.P(1,0,0),new n.P(0,0,1),new n.P(0,1,0)],[new n.P(1,0,0),new n.P(0,0,-1),new n.P(0,-1,0)],[new n.P(1,0,0),new n.P(0,-1,0),new n.P(0,0,1)],[new n.P(-1,0,0),new n.P(0,-1,0),new n.P(0,0,-1)]];s.setFloat("hdrScale",this.hdrScale),s.setFloat2("vFilteringInfo",e.getSize().width,r),s.setTexture("inputTexture",e),this._cdfGenerator&&s.setTexture("icdfTexture",this._cdfGenerator.getIcdfTexture());for(let e=0;e<6;e++)s.setVector3("up",u[e][0]),s.setVector3("right",u[e][1]),s.setVector3("front",u[e][2]),this._engine.bindFramebuffer(l,e,void 0,void 0,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper),this._effectRenderer.draw();this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),s.setTexture("inputTexture",null),s.setTexture("icdfTexture",null);let c=new a.V(e.getScene(),l.texture);return c.name=e.name+"_irradiance",c.displayName=e.name+"_irradiance",c.gammaSpace=!1,c}_createEffect(e,t){let n=[];e.gammaSpace&&n.push("#define GAMMA_INPUT"),n.push("#define NUM_SAMPLES "+this.quality+"u");let i=this._engine.isWebGPU,a=["inputTexture"];return this._cdfGenerator&&(a.push("icdfTexture"),n.push("#define IBL_CDF_FILTERING")),new s.H({engine:this._engine,name:"HDRIrradianceFiltering",vertexShader:"hdrIrradianceFiltering",fragmentShader:"hdrIrradianceFiltering",samplerNames:a,uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale"],useShaderStore:!0,defines:n,onCompiled:t,shaderLanguage:+!!i,extraInitializationsAsync:async()=>{i?await Promise.all([r.e("67").then(r.bind(r,72085)),r.e("8097").then(r.bind(r,66145))]):await Promise.all([r.e("4164").then(r.bind(r,2907)),r.e("4129").then(r.bind(r,90620))])}})}isReady(e){return e.isReady()&&this._effectWrapper.effect.isReady()}async prefilter(e){if(!this._engine._features.allowTexturePrefiltering)throw Error("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.");this.useCdf&&(this._cdfGenerator=new o.M(this._engine),this._cdfGenerator.iblSource=e,await this._cdfGenerator.renderWhenReady()),this._effectRenderer=new s.I(this._engine),this._effectWrapper=this._createEffect(e),await this._effectWrapper.effect.whenCompiledAsync();let t=this._prefilterInternal(e);return this.useCdf&&await this._cdfGenerator.findDominantDirection().then(e=>{t._dominantDirection=e}),this._effectRenderer.dispose(),this._effectWrapper.dispose(),this._cdfGenerator?.dispose(),t}}},61535:function(e,t,r){var n=r(74913),i=r(60963);n.a.prototype.getGPUFrameTimeCounter=function(){return this._gpuFrameTime||(this._gpuFrameTime=new i.z),this._gpuFrameTime},n.a.prototype.captureGPUFrameTime=function(e){}},61883:function(e,t,r){r.d(t,{V:()=>o});var n=r(3588),i=r(60746),a=r(56877),s=r(69724);class o{static _IsGPUBuffer(e){return void 0===e.underlyingResource}static _FlagsToString(e,t=""){let r=t;for(let t=0;t<=9;++t)e&1<<t&&(r&&(r+="_"),r+=s.FB[1<<t]);return r}constructor(e,t){this._deferredReleaseBuffers=[],this._engine=e,this._device=t}createRawBuffer(e,t,r=!1,n){let i=void 0!==e.byteLength?e.byteLength+3&-4:e+3&-4,a={label:"BabylonWebGPUDevice"+this._engine.uniqueId+"_"+o._FlagsToString(t,n??"Buffer")+"_size"+i,mappedAtCreation:r,size:i,usage:t};return this._device.createBuffer(a)}createBuffer(e,t,r){let i=void 0!==e.byteLength,a=new n.C,s="DataBufferUniqueId="+a.uniqueId;return a.buffer=this.createRawBuffer(e,t,void 0,r?s+"-"+r:s),a.references=1,a.capacity=i?e.byteLength:e,a.engineId=this._engine.uniqueId,i&&this.setSubData(a,0,e),a}setRawData(e,t,r,n,i){n+=r.byteOffset,this._device.queue.writeBuffer(e,t,r.buffer,n,i)}setSubData(e,t,r,n=0,i=0){let a=e.underlyingResource;i=i||r.byteLength-n;let s=3&t;n-=s,t-=s;let o=i;if(i=i+s+3&-4,r.buffer.byteLength-r.byteOffset<i){let e=new Uint8Array(i);e.set(new Uint8Array(r.buffer,r.byteOffset+n,o)),r=e,n=0}this.setRawData(a,t,r,n,i)}_getHalfFloatAsFloatRGBAArrayBuffer(e,t,r){r?e=Math.min(e,r.length):r=new Float32Array(e);let n=new Uint16Array(t);for(;e--;)r[e]=(0,i.qZ)(n[e]);return r}readDataFromBuffer(e,t,r,n,i,s,o=0,l=0,u=null,c=!0,d=!1){let h=1===o?2:+(2===o),f=this._engine.uniqueId;return new Promise((r,p)=>{e.mapAsync(1,l,t).then(()=>{let f=e.getMappedRange(l,t),p=u;if(d)p=null===p?(0,a.A8)(o,t,!0,f):(0,a.A8)(o,p.buffer,void 0,f);else if(null===p)switch(h){case 0:(p=new Uint8Array(t)).set(new Uint8Array(f));break;case 1:p=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,f);break;case 2:(p=new Float32Array(t/4)).set(new Float32Array(f))}else switch(h){case 0:(p=new Uint8Array(p.buffer)).set(new Uint8Array(f,0,Math.min(p.byteLength,t)));break;case 1:p=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,f,u);break;case 2:(p=new Float32Array(p.buffer)).set(new Float32Array(f,0,p.byteLength/4))}if(i!==s){1!==h||d||(i*=2,s*=2);let e=new Uint8Array(p.buffer),t=i,r=0;for(let a=1;a<n;++a){r=a*s;for(let n=0;n<i;++n)e[t++]=e[r++]}p=0===h||d?new Uint8Array(e.buffer,0,t):new Float32Array(e.buffer,0,t/4)}e.unmap(),c&&this.releaseBuffer(e),r(p)},e=>{this._engine.isDisposed||this._engine.uniqueId!==f?r(new Uint8Array):p(e)})})}releaseBuffer(e){return o._IsGPUBuffer(e)?(this._deferredReleaseBuffers.push(e),!0):(e.references--,0===e.references&&(this._deferredReleaseBuffers.push(e.underlyingResource),!0))}destroyDeferredBuffers(){for(let e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0}}},62083:function(e,t,r){r.d(t,{AS:()=>i,Fh:()=>s,S1:()=>a});var n=r(22837);class i extends n.Z{}class a extends i{}class s extends a{}},6331:function(e,t,r){r.d(t,{Z:()=>a});var n=r(9787),i=r(44976);class a extends i.Z{constructor(e){let{negative:t,positive:r}=e;super(()=>{let e=this.children.get("negative").read();return this.children.get("positive").read()-e},(0,n._T)(e,["negative","positive"])),this.children.set("negative",t),this.children.set("positive",r);let i=()=>this.emit("change");this.children.forEach(e=>{e.on("change",i)})}}},6359:function(e,t,r){r.d(t,{N:()=>a});var n=r(74913),i=r(65098);class a{constructor(e,t="",r="black"){this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=r,this._loadingDivToRenderingCanvasMap=new Map,this._resizeLoadingUI=()=>{this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach(([e,t],r)=>{let n=e.getBoundingClientRect();if(this._isCanvasLayoutChanged(t,n)){let t=window.getComputedStyle(e).position;r.style.position="fixed"===t?"fixed":"absolute",r.style.left=n.left+window.scrollX+"px",r.style.top=n.top+window.scrollY+"px",r.style.width=n.width+"px",r.style.height=n.height+"px",this._loadingDivToRenderingCanvasMap.set(r,[e,n])}})}}displayLoadingUI(){if(this._isLoading)return;this._isLoading=!0,this._engine=i.l.Instances.find(e=>e.getRenderingCanvas()===this._renderingCanvas);let e=document.createElement("div");e.id="babylonjsLoadingDiv",e.style.opacity="0",e.style.transition="opacity 1.5s ease",e.style.pointerEvents="none",e.style.display="grid",e.style.gridTemplateRows="100%",e.style.gridTemplateColumns="100%",e.style.justifyItems="center",e.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",e.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,this._style=document.createElement("style");let t=`@-webkit-keyframes spin1 {\
                            0% { -webkit-transform: rotate(0deg);}
                            100% { -webkit-transform: rotate(360deg);}
                        }\
                        @keyframes spin1 {\
                            0% { transform: rotate(0deg);}
                            100% { transform: rotate(360deg);}
                        }`;this._style.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(this._style);let r=!!window.SVGSVGElement,n=new Image;a.DefaultLogoUrl?n.src=a.DefaultLogoUrl:n.src=r?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",n.style.width="150px",n.style.gridColumn="1",n.style.gridRow="1",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.position="absolute";let s=document.createElement("div");s.style.width="300px",s.style.gridColumn="1",s.style.gridRow="1",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.position="absolute";let o=new Image;if(a.DefaultSpinnerUrl?o.src=a.DefaultSpinnerUrl:o.src=r?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",o.style.animation="spin1 0.75s infinite linear",o.style.transformOrigin="50% 50%",!r){let e={w:16,h:18.5},t={w:30,h:30};n.style.width=`${e.w}vh`,n.style.height=`${e.h}vh`,n.style.left=`calc(50% - ${e.w/2}vh)`,n.style.top=`calc(50% - ${e.h/2}vh)`,o.style.width=`${t.w}vh`,o.style.height=`${t.h}vh`,o.style.left=`calc(50% - ${t.w/2}vh)`,o.style.top=`calc(50% - ${t.h/2}vh)`}s.appendChild(o),e.appendChild(n),e.appendChild(s),e.style.backgroundColor=this._loadingDivBackgroundColor,e.style.opacity="1";let l=[],u=this._engine.views;if(u?.length)for(let e of u)e.enabled&&l.push(e.target);else l.push(this._renderingCanvas);for(let t=0;t<l.length;t++){let r=l[t],n=e.cloneNode(!0);n.id+=`-${t}`,this._loadingDivToRenderingCanvasMap.set(n,[r,null])}this._resizeLoadingUI(),this._resizeObserver=this._engine.onResizeObservable.add(()=>{this._resizeLoadingUI()}),this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{document.body.appendChild(t)})}hideLoadingUI(){if(!this._isLoading)return;let e=0,t=r=>{let n=r.target;this._loadingDivToRenderingCanvasMap.has(n)&&(e++,n.remove(),e===this._loadingDivToRenderingCanvasMap.size&&(this._loadingTextDiv&&(this._loadingTextDiv.remove(),this._loadingTextDiv=null),this._style&&(this._style.remove(),this._style=null),window.removeEventListener("transitionend",t),this._engine.onResizeObservable.remove(this._resizeObserver),this._loadingDivToRenderingCanvasMap.clear(),this._engine=null,this._isLoading=!1))};this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.style.opacity="0"}),window.addEventListener("transitionend",t)}set loadingUIText(e){this._loadingText=e,this._loadingTextDiv&&this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.children[0].innerHTML=this._loadingText})}get loadingUIText(){return this._loadingText}get loadingUIBackgroundColor(){return this._loadingDivBackgroundColor}set loadingUIBackgroundColor(e){this._loadingDivBackgroundColor=e,this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.style.backgroundColor=this._loadingDivBackgroundColor})}_isCanvasLayoutChanged(e,t){return!e||e.left!==t.left||e.top!==t.top||e.right!==t.right||e.bottom!==t.bottom||e.width!==t.width||e.height!==t.height||e.x!==t.x||e.y!==t.y}}a.DefaultLogoUrl="",a.DefaultSpinnerUrl="",n.a.DefaultLoadingScreenFactory=e=>new a(e)},63647:function(e,t,r){r.r(t),r.d(t,{clipPlaneFragmentDeclaration:()=>s});var n=r(66755);let i="clipPlaneFragmentDeclaration",a=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},65002:function(e,t,r){r(43999),r(10645),r(6331),r(44976),r(96368),r(58237),r(2043),r(81997)},65195:function(e,t,r){var n=r(74549),i=r(75815);Object.defineProperty(n.x.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsImpostor&&(this.physicsImpostor.dispose(),this.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),n.x.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},n.x.prototype.applyImpulse=function(e,t){return this.physicsImpostor&&this.physicsImpostor.applyImpulse(e,t),this},n.x.prototype.setPhysicsLinkWith=function(e,t,r,n){return this.physicsImpostor&&e.physicsImpostor&&this.physicsImpostor.createJoint(e.physicsImpostor,i.q7.HingeJoint,{mainPivot:t,connectedPivot:r,nativeParams:n}),this}},6562:function(e,t,r){r.d(t,{BH:()=>c,Gz:()=>f,RN:()=>p,eW:()=>u,nL:()=>h,xW:()=>d});var n=r(61834),i=r(51577),a=r(91149),s=r(44114),o=r(31913),l=r(88280);function u(e){let t=[],r=[],n=e.lines,i=e.colors,s=[],o=0;for(let e=0;e<n.length;e++){let a=n[e];for(let n=0;n<a.length;n++){let{x:l,y:u,z:c}=a[n];if(r.push(l,u,c),i){let{r:t,g:r,b:a,a:o}=i[e][n];s.push(t,r,a,o)}n>0&&(t.push(o-1),t.push(o)),o++}}let l=new a.x;return l.indices=t,l.positions=r,i&&(l.colors=s),l}function c(e){let t=e.dashSize||3,r=e.gapSize||1,i=e.dashNb||200,s=e.points,o=[],l=[],u=n.P.Zero(),c=0,d=0,h=0,f=0,p=0,_=0,m=0;for(m=0;m<s.length-1;m++)s[m+1].subtractToRef(s[m],u),c+=u.length();for(m=0,f=t*(h=c/i)/(t+r);m<s.length-1;m++){s[m+1].subtractToRef(s[m],u),d=Math.floor(u.length()/h),u.normalize();for(let e=0;e<d;e++)p=h*e,o.push(s[m].x+p*u.x,s[m].y+p*u.y,s[m].z+p*u.z),o.push(s[m].x+(p+f)*u.x,s[m].y+(p+f)*u.y,s[m].z+(p+f)*u.z),l.push(_,_+1),_+=2}let g=new a.x;return g.positions=o,g.indices=l,g}function d(e,t,r=null){let n=t.instance,i=t.lines,a=t.colors;if(n){let e,t,r=n.getVerticesData(o.o.PositionKind);a&&(e=n.getVerticesData(o.o.ColorKind));let s=0,l=0;for(let n=0;n<i.length;n++){let o=i[n];for(let i=0;i<o.length;i++)r[s]=o[i].x,r[s+1]=o[i].y,r[s+2]=o[i].z,a&&e&&(t=a[n],e[l]=t[i].r,e[l+1]=t[i].g,e[l+2]=t[i].b,e[l+3]=t[i].a,l+=4),s+=3}return n.updateVerticesData(o.o.PositionKind,r,!1,!1),a&&e&&n.updateVerticesData(o.o.ColorKind,e,!1,!1),n.refreshBoundingInfo(),n}let l=!!a,c=new s._(e,r,null,void 0,void 0,l,t.useVertexAlpha,t.material);return u(t).applyToMesh(c,t.updatable),c}function h(e,t,r=null){let n=t.colors?[t.colors]:null;return d(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:n,useVertexAlpha:t.useVertexAlpha,material:t.material},r)}function f(e,t,r=null){let a=t.points,o=t.instance,u=t.gapSize||1,d=t.dashSize||3;if(o)return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&l.Y.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(e=>{let t=n.P.Zero(),r=e.length/6,i=0,s=0,l=0,u=0,c=0,d=0,h=0,f=0;for(h=0;h<a.length-1;h++)a[h+1].subtractToRef(a[h],t),i+=t.length();l=i/r;let p=o._creationDataStorage.dashSize;for(h=0,u=p*l/(p+o._creationDataStorage.gapSize);h<a.length-1;h++)for(a[h+1].subtractToRef(a[h],t),s=Math.floor(t.length()/l),t.normalize(),f=0;f<s&&d<e.length;)c=l*f,e[d]=a[h].x+c*t.x,e[d+1]=a[h].y+c*t.y,e[d+2]=a[h].z+c*t.z,e[d+3]=a[h].x+(c+u)*t.x,e[d+4]=a[h].y+(c+u)*t.y,e[d+5]=a[h].z+(c+u)*t.z,d+=6,f++;for(;d<e.length;)e[d]=a[h].x,e[d+1]=a[h].y,e[d+2]=a[h].z,d+=3},!1),o;let h=new s._(e,r,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return c(t).applyToMesh(h,t.updatable),h._creationDataStorage=new i.gW,h._creationDataStorage.dashSize=d,h._creationDataStorage.gapSize=u,h}let p={CreateDashedLines:f,CreateLineSystem:d,CreateLines:h};a.x.CreateLineSystem=u,a.x.CreateDashedLines=c,i.Kj.CreateLines=(e,t,r=null,n=!1,i=null)=>h(e,{points:t,updatable:n,instance:i},r),i.Kj.CreateDashedLines=(e,t,r,n,i,a=null,s,o)=>f(e,{points:t,dashSize:r,gapSize:n,dashNb:i,updatable:s,instance:o},a)},65794:function(e,t,r){r.d(t,{K:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("left",i.E.AutoDetect),this.registerInput("right",i.E.AutoDetect),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"MaxBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = max(${this.left.associatedVariableName}, ${this.right.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.MaxBlock",o)},67934:function(e,t,r){r.d(t,{f:()=>a});var n=r(21255);let i={[n.o.PositionKind]:!0,[n.o.NormalKind]:!0,[n.o.TangentKind]:!0,[n.o.UVKind]:!0,[n.o.UV2Kind]:!0,[n.o.UV3Kind]:!0,[n.o.UV4Kind]:!0,[n.o.UV5Kind]:!0,[n.o.UV6Kind]:!0,[n.o.ColorKind]:!0,[n.o.ColorInstanceKind]:!0,[n.o.MatricesIndicesKind]:!0,[n.o.MatricesWeightsKind]:!0,[n.o.MatricesIndicesExtraKind]:!0,[n.o.MatricesWeightsExtraKind]:!0};function a(e,t){let r=t.getEngine(),a=t._pipelineContext;if(!a?.vertexBufferKindToType)return;let s=null;for(let o in e){let l=e[o];if(!l||!i[o])continue;let u=l.normalized?n.o.FLOAT:l.type,c=a.vertexBufferKindToType[o];(u!==n.o.FLOAT&&void 0===c||void 0!==c&&c!==u)&&(s||(s=r._getShaderProcessingContext(t.shaderLanguage,!1)),a.vertexBufferKindToType[o]=u,u!==n.o.FLOAT&&(s.vertexBufferKindToNumberOfComponents[o]=n.o.DeduceStride(o),function(e){switch(e){case n.o.BYTE:case n.o.SHORT:case n.o.INT:case n.o.FLOAT:return!0;case n.o.UNSIGNED_BYTE:case n.o.UNSIGNED_SHORT:case n.o.UNSIGNED_INT:return!1;default:throw Error(`Invalid type '${e}'`)}}(u)&&(s.vertexBufferKindToNumberOfComponents[o]*=-1)))}if(s){let e=r._caps.parallelShaderCompile;r._caps.parallelShaderCompile=void 0,t._processShaderCodeAsync(null,r._features._checkNonFloatVertexBuffersDontRecreatePipelineContext,s),r._caps.parallelShaderCompile=e}}},68088:function(e,t,r){r.d(t,{b:()=>s});var n=r(60963),i=r(46005),a=r(88280);class s{get gpuFrameTimeCounter(){return this._gpuFrameTimeCounter}constructor(e,t,r){this._enabled=!1,this._gpuFrameTimeCounter=new n.z,this._measureDurationState=0,this._engine=e,this._device=t,this._bufferManager=r}get enable(){return this._enabled}set enable(e){if(this._enabled!==e)if(this._enabled=e,this._measureDurationState=0,e)try{this._measureDuration=new o(this._engine,this._device,this._bufferManager,2e3,"QuerySet_TimestampQuery")}catch(e){this._enabled=!1,a.Y.Error("Could not create a WebGPUDurationMeasure!\nError: "+e.message+"\nMake sure timestamp query is supported and enabled in your browser.");return}else this._measureDuration.dispose()}startFrame(e){this._enabled&&0===this._measureDurationState&&(this._measureDuration.start(e),this._measureDurationState=1)}endFrame(e){1===this._measureDurationState&&(this._measureDurationState=2,this._measureDuration.stop(e).then(e=>{null!==e&&e>=0&&(this._gpuFrameTimeCounter.fetchNewFrame(),this._gpuFrameTimeCounter.addCount(e,!0)),this._measureDurationState=0}))}startPass(e,t){this._enabled?this._measureDuration.startPass(e,t):e.timestampWrites=void 0}endPass(e,t){if(!this._enabled||!t)return;let r=this._engine.frameId;this._measureDuration.stopPass(e).then(e=>{t._addDuration(r,null!==e&&e>0?e:0)})}dispose(){this._measureDuration?.dispose()}}class o{constructor(e,t,r,n=2,a){this._count=n,this._querySet=new i.t(e,n,"timestamp",t,r,!0,a)}start(e){e.writeTimestamp?.(this._querySet.querySet,0)}async stop(e){return e.writeTimestamp?.(this._querySet.querySet,1),e.writeTimestamp?await this._querySet.readTwoValuesAndSubtract(0):0}startPass(e,t){if(t+3>this._count)throw Error("WebGPUDurationMeasure: index out of range ("+t+")");e.timestampWrites={querySet:this._querySet.querySet,beginningOfPassWriteIndex:t+2,endOfPassWriteIndex:t+3}}async stopPass(e){return await this._querySet.readTwoValuesAndSubtract(e+2)}dispose(){this._querySet.dispose()}}},6849:function(e,t,r){r.d(t,{G:()=>E,U:()=>T});var n,i,a,s,o=r(69724),l=r(30554),u=r(56865),c=r(94294);let d=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    varying vTex: vec2f;

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.vTex = tex[input.vertexIndex];
        vertexOutputs.position = vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,h=`
    var imgSampler: sampler;
    var img: texture_2d<f32>;

    varying vTex: vec2f;

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = textureSample(img, imgSampler, input.vTex);
    }
    `,f=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        #ifdef INVERTY
            vertexOutputs.vTextureSize = vec2f(textureDimensions(img, 0));
        #endif
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,p=`
    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(input.vTextureSize.y - input.position.y)), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,_=`
    var img: texture_2d<f32>;
    uniform ofstX: f32;
    uniform ofstY: f32;
    uniform width: f32;
    uniform height: f32;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        if (input.position.x < uniforms.ofstX || input.position.x >= uniforms.ofstX + uniforms.width) {
            discard;
        }
        if (input.position.y < uniforms.ofstY || input.position.y >= uniforms.ofstY + uniforms.height) {
            discard;
        }
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(uniforms.ofstY + uniforms.height - (input.position.y - uniforms.ofstY))), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,m=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,g=`
    uniform color: vec4f;


    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = uniforms.color;
    }
    `,y=`
    struct VertexOutput {
        @builtin(position) Position : vec4<f32>,
        @location(0) fragUV : vec2<f32>
    }

    @vertex
    fn main(
        @builtin(vertex_index) VertexIndex : u32
    ) -> VertexOutput {
        var pos = array<vec2<f32>, 4>(
            vec2(-1.0,  1.0),
            vec2( 1.0,  1.0),
            vec2(-1.0, -1.0),
            vec2( 1.0, -1.0)
        );
        var tex = array<vec2<f32>, 4>(
            vec2(0.0, 0.0),
            vec2(1.0, 0.0),
            vec2(0.0, 1.0),
            vec2(1.0, 1.0)
        );

        var output: VertexOutput;

        output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
        output.fragUV = tex[VertexIndex];

        return output;
    }
    `,v=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, fragUV);
    }
    `,b=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, vec2<f32>(fragUV.x, 1.0 - fragUV.y));
    }
    `;(n=a||(a={}))[n.MipMap=0]="MipMap",n[n.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",n[n.Clear=2]="Clear",n[n.InvertYPremultiplyAlphaWithOfst=3]="InvertYPremultiplyAlphaWithOfst",(i=s||(s={}))[i.DontInvertY=0]="DontInvertY",i[i.InvertY=1]="InvertY";let x=[{vertex:d,fragment:h},{vertex:f,fragment:p},{vertex:m,fragment:g},{vertex:f,fragment:_}],T={"":0,r8unorm:1,r8uint:2,r8sint:3,r16uint:4,r16sint:5,r16float:6,rg8unorm:7,rg8uint:8,rg8sint:9,r32uint:10,r32sint:11,r32float:12,rg16uint:13,rg16sint:14,rg16float:15,rgba8unorm:16,"rgba8unorm-srgb":17,rgba8uint:18,rgba8sint:19,bgra8unorm:20,"bgra8unorm-srgb":21,rgb10a2uint:22,rgb10a2unorm:23,rg32uint:24,rg32sint:25,rg32float:26,rgba16uint:27,rgba16sint:28,rgba16float:29,rgba32uint:30,rgba32sint:31,rgba32float:32,stencil8:33,depth16unorm:34,depth24plus:35,"depth24plus-stencil8":36,depth32float:37,"depth32float-stencil8":38,r16unorm:39,rg16unorm:40,rgba16unorm:41,r16snorm:42,rg16snorm:43,rgba16snorm:44};class E{constructor(e,t,r,n){if(this._pipelines={},this._compiledShaders=[],this._videoPipelines={},this._videoCompiledShaders=[],this._deferredReleaseTextures=[],this._engine=e,this._device=t,this._bufferManager=r,-1!==n.indexOf("rg11b10ufloat-renderable")){let e=Object.keys(T);T.rg11b10ufloat=T[e[e.length-1]]+1}this._mipmapSampler=t.createSampler({minFilter:"linear"}),this._videoSampler=t.createSampler({minFilter:"linear"}),this._ubCopyWithOfst=this._bufferManager.createBuffer(16,o.FB.Uniform|o.FB.CopyDst,"UBCopyWithOffset").underlyingResource,this._getPipeline("rgba8unorm"),this._getVideoPipeline("rgba8unorm")}_getPipeline(e,t=a.MipMap,r){let n=t===a.MipMap?1:t===a.InvertYPremultiplyAlpha?(!!r.invertY<<1)+(!!r.premultiplyAlpha<<2):t===a.Clear?8:t===a.InvertYPremultiplyAlphaWithOfst?(!!r.invertY<<4)+(!!r.premultiplyAlpha<<5):0;this._pipelines[e]||(this._pipelines[e]=[]);let i=this._pipelines[e][n];if(!i){let s="";(t===a.InvertYPremultiplyAlpha||t===a.InvertYPremultiplyAlphaWithOfst)&&(r.invertY&&(s+="#define INVERTY\n"),r.premultiplyAlpha&&(s+="#define PREMULTIPLYALPHA\n"));let o=this._compiledShaders[n];if(!o){let e=x[t].vertex,r=x[t].fragment,i={defines:s.split("\n"),indexParameters:null,isFragment:!1,shouldUseHighPrecisionShader:!0,processor:this._engine._getShaderProcessor(1),supportsUniformBuffers:!0,shadersRepository:"",includesShadersStore:{},version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._engine._getShaderProcessingContext(1,!0),isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};(0,c.wz)(i),i.processor.pureMode=!0,(0,c.An)(e,i,t=>{e=t},this._engine),i.isFragment=!0,(0,c.An)(r,i,e=>{r=e},this._engine);let a=(0,c.Ku)(e,r,i);i.processor.pureMode=!1;let l=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVertexShader_${n}`,code:a.vertexCode}),u=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalFragmentShader_${n}`,code:a.fragmentCode});o=this._compiledShaders[n]=[l,u]}let l=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalPipeline_${e}_${n}`,layout:"auto",vertex:{module:o[0],entryPoint:"main"},fragment:{module:o[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});i=this._pipelines[e][n]=[l,l.getBindGroupLayout(0)]}return i}_getVideoPipeline(e,t=s.DontInvertY){let r=+(t===s.InvertY);this._videoPipelines[e]||(this._videoPipelines[e]=[]);let n=this._videoPipelines[e][r];if(!n){let t=this._videoCompiledShaders[r];if(!t){let e=this._device.createShaderModule({code:y,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_VertexShader`}),n=this._device.createShaderModule({code:0===r?v:b,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_FragmentShader_${0===r?"DontInvertY":"InvertY"}`});t=this._videoCompiledShaders[r]=[e,n]}let i=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVideoPipeline_${e}_${0===r?"DontInvertY":"InvertY"}`,layout:"auto",vertex:{module:t[0],entryPoint:"main"},fragment:{module:t[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});n=this._videoPipelines[e][r]=[i,i.getBindGroupLayout(0)]}return n}setCommandEncoder(e){this._commandEncoderForCreation=e}copyVideoToTexture(e,t,r,n=!1,i){let a=void 0===i,[o,l]=this._getVideoPipeline(r,n?s.InvertY:s.DontInvertY);a&&(i=this._device.createCommandEncoder({})),i.pushDebugGroup?.(`copy video to texture - invertY=${n}`);let u=t._hardwareTexture,c={label:`BabylonWebGPUDevice${this._engine.uniqueId}_copyVideoToTexture_${r}_${n?"InvertY":"DontInvertY"}${t.label?"_"+t.label:""}`,colorAttachments:[{view:u.underlyingResource.createView({format:r,dimension:"2d",mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:1,aspect:"all"}),loadOp:"load",storeOp:"store"}]},d=i.beginRenderPass(c),h={layout:l,entries:[{binding:0,resource:this._videoSampler},{binding:1,resource:this._device.importExternalTexture({source:e.underlyingResource})}]},f=this._device.createBindGroup(h);d.setPipeline(o),d.setBindGroup(0,f),d.draw(4,1,0,0),d.end(),i.popDebugGroup?.(),a&&(this._device.queue.submit([i.finish()]),i=null)}invertYPreMultiplyAlpha(e,t,r,n,i=!1,s=!1,o=0,l=0,c=1,d=0,h=0,f=0,p=0,_,m){let g,y=0!==f,v=void 0===_,[b,x]=this._getPipeline(n,y?a.InvertYPremultiplyAlphaWithOfst:a.InvertYPremultiplyAlpha,{invertY:i,premultiplyAlpha:s});if(o=Math.max(o,0),v&&(_=this._device.createCommandEncoder({})),_.pushDebugGroup?.(`internal process texture - invertY=${i} premultiplyAlpha=${s}`),u.D.IsHardwareTexture(e)?(g=e.underlyingResource,i&&!s&&1===c&&0===o||(e=void 0)):(g=e,e=void 0),!g)return;y&&this._bufferManager.setRawData(this._ubCopyWithOfst,0,new Float32Array([d,h,f,p]),0,16);let T=e,E=T?._copyInvertYTempTexture??this.createTexture({width:t,height:r,layers:1},!1,!1,!1,!1,!1,n,1,_,21,void 0,"TempTextureForCopyWithInvertY"),A=T?._copyInvertYRenderPassDescr??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_invertYPreMultiplyAlpha_${n}_${i?"InvertY":"DontInvertY"}_${s?"PremultiplyAlpha":"DontPremultiplyAlpha"}`,colorAttachments:[{view:E.createView({format:n,dimension:"2d",baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadOp:"load",storeOp:"store"}]},S=_.beginRenderPass(A),I=y?T?._copyInvertYBindGroupWithOfst:T?._copyInvertYBindGroup;if(!I){let e={layout:x,entries:[{binding:0,resource:g.createView({format:n,dimension:"2d",baseMipLevel:l,mipLevelCount:1,arrayLayerCount:c,baseArrayLayer:o})}]};y&&e.entries.push({binding:1,resource:{buffer:this._ubCopyWithOfst}}),I=this._device.createBindGroup(e)}S.setPipeline(b),S.setBindGroup(0,I),S.draw(4,1,0,0),S.end(),_.copyTextureToTexture({texture:E},{texture:g,mipLevel:l,origin:{x:0,y:0,z:o}},{width:f||t,height:p||r,depthOrArrayLayers:1}),T?(T._copyInvertYTempTexture=E,T._copyInvertYRenderPassDescr=A,y?T._copyInvertYBindGroupWithOfst=I:T._copyInvertYBindGroup=I):this._deferredReleaseTextures.push([E,null]),_.popDebugGroup?.(),v&&(this._device.queue.submit([_.finish()]),_=null)}createTexture(e,t=!1,r=!1,n=!1,i=!1,a=!1,s="rgba8unorm",o=1,l,c=-1,d=0,h){o=u.D.GetSample(o);let f=e.layers||1,p={width:e.width,height:e.height,depthOrArrayLayers:f},_=16*!!T[s],m=u.D.IsCompressedFormat(s),g=t?u.D.ComputeNumMipmapLevels(e.width,e.height):1;d|=t&&!m?1|_:0,m||a||(d|=2|_);let y=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_Texture${a?"3D":"2D"}_${h?h+"_":""}${p.width}x${p.height}x${p.depthOrArrayLayers}_${t?"wmips":"womips"}_${s}_samples${o}`,size:p,dimension:a?"3d":"2d",format:s,usage:(c>=0?c:7)|d,sampleCount:o,mipLevelCount:g});return u.D.IsImageBitmap(e)&&(this.updateTexture(e,y,e.width,e.height,f,s,0,0,n,i,0,0),t&&r&&this.generateMipmaps(y,s,g,0,a,l)),y}createCubeTexture(e,t=!1,r=!1,n=!1,i=!1,a="rgba8unorm",s=1,o,l=-1,c=0,d){s=u.D.GetSample(s);let h=u.D.IsImageBitmapArray(e)?e[0].width:e.width,f=u.D.IsImageBitmapArray(e)?e[0].height:e.height,p=16*!!T[a],_=u.D.IsCompressedFormat(a),m=t?u.D.ComputeNumMipmapLevels(h,f):1;c|=t&&!_?1|p:0,_||(c|=2|p);let g=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureCube_${d?d+"_":""}${h}x${f}x6_${t?"wmips":"womips"}_${a}_samples${s}`,size:{width:h,height:f,depthOrArrayLayers:6},dimension:"2d",format:a,usage:(l>=0?l:7)|c,sampleCount:s,mipLevelCount:m});return u.D.IsImageBitmapArray(e)&&(this.updateCubeTextures(e,g,h,f,a,n,i,0,0),t&&r&&this.generateCubeMipmaps(g,a,m,o)),g}generateCubeMipmaps(e,t,r,n){let i=void 0===n;i&&(n=this._device.createCommandEncoder({})),n.pushDebugGroup?.(`create cube mipmaps - ${r} levels`);for(let i=0;i<6;++i)this.generateMipmaps(e,t,r,i,!1,n);n.popDebugGroup?.(),i&&(this._device.queue.submit([n.finish()]),n=null)}generateMipmaps(e,t,r,n=0,i=!1,a){let s,o=void 0===a,[l,c]=this._getPipeline(t);if(n=Math.max(n,0),o&&(a=this._device.createCommandEncoder({})),a.pushDebugGroup?.(`create mipmaps for face #${n} - ${r} levels`),u.D.IsHardwareTexture(e)?(s=e.underlyingResource,e._mipmapGenRenderPassDescr=e._mipmapGenRenderPassDescr||[],e._mipmapGenBindGroup=e._mipmapGenBindGroup||[]):(s=e,e=void 0),!s)return;let d=e;for(let e=1;e<r;++e){let r=d?._mipmapGenRenderPassDescr[n]?.[e-1]??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_generateMipmaps_${t}_faceIndex${n}_level${e}`,colorAttachments:[{view:s.createView({format:t,dimension:i?"3d":"2d",baseMipLevel:e,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:n}),loadOp:"load",storeOp:"store"}]};d&&(d._mipmapGenRenderPassDescr[n]=d._mipmapGenRenderPassDescr[n]||[],d._mipmapGenRenderPassDescr[n][e-1]=r);let o=a.beginRenderPass(r),u=d?._mipmapGenBindGroup[n]?.[e-1]??this._device.createBindGroup({layout:c,entries:[{binding:0,resource:s.createView({format:t,dimension:i?"3d":"2d",baseMipLevel:e-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:n})},{binding:1,resource:this._mipmapSampler}]});d&&(d._mipmapGenBindGroup[n]=d._mipmapGenBindGroup[n]||[],d._mipmapGenBindGroup[n][e-1]=u),o.setPipeline(l),o.setBindGroup(0,u),o.draw(4,1,0,0),o.end()}a.popDebugGroup?.(),o&&(this._device.queue.submit([a.finish()]),a=null)}createGPUTextureForInternalTexture(e,t,r,n,i,a){let s;e._hardwareTexture||(e._hardwareTexture=new l.Z(this._engine)),void 0===t&&(t=e.width),void 0===r&&(r=e.height),void 0===n&&(n=e.depth);let o=e._hardwareTexture,c=((i??0)&1)!=0;o.format=u.D.GetWebGPUTextureFormat(e.type,e.format,e._useSRGBBuffer),o.textureUsages=5===e._source||6===e.source?21:12===e._source?20:-1,o.textureAdditionalUsages=8*!!c;let d=e.generateMipMaps,h=n||1;if(s=null!==e._maxLodLevel?e._maxLodLevel:d?u.D.ComputeNumMipmapLevels(t,r):1,e.isCube){let n=this.createCubeTexture({width:t,height:r},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages,e.label);o.set(n);let i=e.is3D?1:h,a=u.D.GetDepthFormatOnly(o.format),l=u.D.HasDepthAndStencilAspects(o.format)?"depth-only":"all",f=e.is2DArray?"cube-array":"cube";o.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureViewCube${e.is2DArray?"_Array"+i:""}_${t}x${r}_${d?"wmips":"womips"}_${a}_${f}_${l}_${e.label??"noname"}`,format:a,dimension:f,mipLevelCount:s,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6,aspect:l},c)}else{let n=this.createTexture({width:t,height:r,layers:h},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,e.is3D,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages,e.label);o.set(n);let i=e.is3D?1:h,a=u.D.GetDepthFormatOnly(o.format),l=u.D.HasDepthAndStencilAspects(o.format)?"depth-only":"all",f=e.is2DArray?"2d-array":e.is3D?"3d":"2d";o.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureView${e.is3D?"3D":"2D"}${e.is2DArray?"_Array"+i:""}_${t}x${r}${e.is3D?"x"+h:""}_${d?"wmips":"womips"}_${a}_${f}_${l}_${e.label??"noname"}`,format:a,dimension:f,mipLevelCount:s,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:i,aspect:l},c)}return e.width=e.baseWidth=t,e.height=e.baseHeight=r,e.depth=e.baseDepth=n,a||this.createMSAATexture(e,e.samples),o}createMSAATexture(e,t,r=!0,n=0){let i=e._hardwareTexture;if(r&&i?.releaseMSAATexture(),!i||(t??1)<=1)return;let a=e.width,s=e.height,o=this.createTexture({width:a,height:s,layers:1},!1,!1,!1,!1,!1,i.format,t,this._commandEncoderForCreation,16,0,e.label?"MSAA_"+e.label:"MSAA");i.setMSAATexture(o,n)}updateCubeTextures(e,t,r,n,i,a=!1,s=!1,o=0,l=0){let u=[0,3,1,4,2,5];for(let c=0;c<u.length;++c){let d=e[u[c]];this.updateTexture(d,t,r,n,1,i,c,0,a,s,o,l)}}updateTexture(e,t,r,n,i,a,s=0,l=0,c=!1,d=!1,h=0,f=0,p){let _=u.D.IsInternalTexture(t)?t._hardwareTexture.underlyingResource:t,m=u.D.GetBlockInformationFromFormat(a),g=u.D.IsInternalTexture(t)?t._hardwareTexture:t,y={texture:_,origin:{x:h,y:f,z:Math.max(s,0)},mipLevel:l,premultipliedAlpha:d},v={width:Math.ceil(r/m.width)*m.width,height:Math.ceil(n/m.height)*m.height,depthOrArrayLayers:i||1};if(void 0!==e.byteLength){let b=Math.ceil(r/m.width)*m.length;if(256*Math.ceil(b/256)===b){let t=this._device.createCommandEncoder({}),r=this._bufferManager.createRawBuffer(e.byteLength,o.FB.MapWrite|o.FB.CopySrc,!0,"TempBufferForUpdateTexture"+(_?"_"+_.label:""));new Uint8Array(r.getMappedRange()).set(e),r.unmap(),t.copyBufferToTexture({buffer:r,offset:0,bytesPerRow:b,rowsPerImage:n},y,v),this._device.queue.submit([t.finish()]),this._bufferManager.releaseBuffer(r)}else this._device.queue.writeTexture(y,e,{offset:0,bytesPerRow:b,rowsPerImage:n},v);if(c||d)if(u.D.IsInternalTexture(t)){let e=0===h&&0===f&&r===t.width&&n===t.height;this.invertYPreMultiplyAlpha(g,t.width,t.height,a,c,d,s,l,i||1,h,f,e?0:r,e?0:n,void 0,p)}else throw"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!"}else this._device.queue.copyExternalImageToTexture({source:e,flipY:c},y,v)}readPixels(e,t,r,n,i,a,s=0,l=0,c=null,d=!1){let h=u.D.GetBlockInformationFromFormat(a),f=Math.ceil(n/h.width)*h.length,p=256*Math.ceil(f/256),_=p*i,m=this._bufferManager.createRawBuffer(_,o.FB.MapRead|o.FB.CopyDst,void 0,"TempBufferForReadPixels"+(e.label?"_"+e.label:"")),g=this._device.createCommandEncoder({});return g.copyTextureToBuffer({texture:e,mipLevel:l,origin:{x:t,y:r,z:Math.max(s,0)}},{buffer:m,offset:0,bytesPerRow:p},{width:n,height:i,depthOrArrayLayers:1}),this._device.queue.submit([g.finish()]),this._bufferManager.readDataFromBuffer(m,_,n,i,f,p,u.D.GetTextureTypeFromFormat(a),0,c,!0,d)}releaseTexture(e){if(u.D.IsInternalTexture(e)){let t=e._hardwareTexture,r=e._irradianceTexture;this._deferredReleaseTextures.push([t,r])}else this._deferredReleaseTextures.push([e,null])}destroyDeferredTextures(){for(let e=0;e<this._deferredReleaseTextures.length;++e){let[t,r]=this._deferredReleaseTextures[e];t&&(u.D.IsHardwareTexture(t)?t.release():t.destroy()),r?.dispose()}this._deferredReleaseTextures.length=0}}},70402:function(e,t,r){r.d(t,{s:()=>n});class n{get isFixedFoveationSupported(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation}get fixedFoveation(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null}set fixedFoveation(e){if(this.isFixedFoveationSupported){let t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}}createRenderTargetTextureProvider(e){return this._rttWrapper=this._createRenderTargetTextureProvider(e),this._rttWrapper}dispose(){this._rttWrapper&&(this._rttWrapper.dispose(),this._rttWrapper=null)}constructor(e,t,r,n,i){this.getWidth=e,this.getHeight=t,this.layer=r,this.layerType=n,this._createRenderTargetTextureProvider=i,this._rttWrapper=null}}},70719:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexWGSL:()=>s});var n=r(66755);let i="morphTargetsVertex",a=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (i>=uniforms.morphTargetCount) {break;}
vertexID=f32(vertexInputs.vertexIndex)*uniforms.morphTargetTextureInfo.x;
#ifdef MORPHTARGETS_POSITION
positionUpdated=positionUpdated+(readVector3FromRawSampler(i,vertexID)-vertexInputs.position)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASPOSITIONS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated=normalUpdated+(readVector3FromRawSampler(i,vertexID) -vertexInputs.normal)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASNORMALS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated=uvUpdated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUVS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated=vec4f(tangentUpdated.xyz+(readVector3FromRawSampler(i,vertexID) -vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[i],tangentUpdated.a);
#endif
#ifdef MORPHTARGETTEXTURE_HASTANGENTS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated=uv2Updated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv2)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated=colorUpdated+(readVector4FromRawSampler(i,vertexID)-vertexInputs.color)*uniforms.morphTargetInfluences[i];
#endif
}
#endif
#else
#ifdef MORPHTARGETS_POSITION
positionUpdated=positionUpdated+(vertexInputs.position{X}-vertexInputs.position)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated=normalUpdated+(vertexInputs.normal{X}-vertexInputs.normal)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated=vec4f(tangentUpdated.xyz+(vertexInputs.tangent{X}-vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[{X}],tangentUpdated.a);
#endif
#ifdef MORPHTARGETS_UV
uvUpdated=uvUpdated+(vertexInputs.uv_{X}-vertexInputs.uv)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated=uv2Updated+(vertexInputs.uv2_{X}-vertexInputs.uv2)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated=colorUpdated+(vertexInputs.color{X}-vertexInputs.color)*uniforms.morphTargetInfluences[{X}];
#endif
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},7111:function(e,t,r){r.d(t,{u:()=>o});var n=r(72384),i=r(61834),a=r(15490),s=r(74913);class o{constructor(){this._scaledPosition=i.P.Zero(),this._scaledVelocity=i.P.Zero(),this._finalPosition=i.P.Zero()}getNewPosition(e,t,r,n,i,a,s,o=!0){e.divideToRef(r._radius,this._scaledPosition),t.divideToRef(r._radius,this._scaledVelocity),r.collidedMesh=null,r._retry=0,r._initialVelocity=this._scaledVelocity,r._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,r,n,this._finalPosition,o,i),this._finalPosition.multiplyInPlace(r._radius),a(s,this._finalPosition,r.collidedMesh)}createCollider(){return new a.Y}init(e){this._scene=e}_collideWithWorld(e,t,r,n,i,a,o=null){let l=10*s.a.CollisionsEpsilon;if(r._retry>=n)return void i.copyFrom(e);let u=o?o.collisionMask:r.collisionMask;r._initialize(e,t,l);let c=o&&o.surroundingMeshes||this._scene.meshes;for(let e=0;e<c.length;e++){let t=c[e];t.isEnabled()&&t.checkCollisions&&t.subMeshes&&t!==o&&(u&t.collisionGroup)!=0&&t._checkCollision(r)}return r.collisionFound?((0!==t.x||0!==t.y||0!==t.z)&&(r._getResponse(e,t,a),a||t.setAll(0)),t.length()<=l)?void i.copyFrom(e):void(r._retry++,this._collideWithWorld(e,t,r,n,i,a,o)):void e.addToRef(t,i)}}n.x.CollisionCoordinatorFactory=()=>new o},71193:function(e,t,r){r.d(t,{S:()=>d,p:()=>i});var n,i,a=r(69254),s=r(58417),o=r(54603),l=r(59942),u=r(46363),c=r(16415);(n=i||(i={}))[n.Cos=0]="Cos",n[n.Sin=1]="Sin",n[n.Abs=2]="Abs",n[n.Exp=3]="Exp",n[n.Exp2=4]="Exp2",n[n.Round=5]="Round",n[n.Floor=6]="Floor",n[n.Ceiling=7]="Ceiling",n[n.Sqrt=8]="Sqrt",n[n.Log=9]="Log",n[n.Tan=10]="Tan",n[n.ArcTan=11]="ArcTan",n[n.ArcCos=12]="ArcCos",n[n.ArcSin=13]="ArcSin",n[n.Fract=14]="Fract",n[n.Sign=15]="Sign",n[n.Radians=16]="Radians",n[n.Degrees=17]="Degrees",n[n.Set=18]="Set";class d extends s.k{constructor(e){super(e,l.u.Neutral),this.operation=i.Cos,this.registerInput("input",o.E.AutoDetect),this.registerOutput("output",o.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"TrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0],r="";switch(this.operation){case i.Cos:r="cos";break;case i.Sin:r="sin";break;case i.Abs:r="abs";break;case i.Exp:r="exp";break;case i.Exp2:r="exp2";break;case i.Round:r="round";break;case i.Floor:r="floor";break;case i.Ceiling:r="ceil";break;case i.Sqrt:r="sqrt";break;case i.Log:r="log";break;case i.Tan:r="tan";break;case i.ArcTan:r="atan";break;case i.ArcCos:r="acos";break;case i.ArcSin:r="asin";break;case i.Fract:r="fract";break;case i.Sign:r="sign";break;case i.Radians:r="radians";break;case i.Degrees:r="degrees";break;case i.Set:r=""}return e.compilationString+=e._declareOutput(t)+` = ${r}(${this.input.associatedVariableName});
`,this}serialize(){let e=super.serialize();return e.operation=this.operation,e}_deserialize(e,t,r){super._deserialize(e,t,r),this.operation=e.operation}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.TrigonometryBlockOperations.${i[this.operation]};
`}}(0,a.gn)([(0,c.p)("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Cos",value:i.Cos},{label:"Sin",value:i.Sin},{label:"Abs",value:i.Abs},{label:"Exp",value:i.Exp},{label:"Exp2",value:i.Exp2},{label:"Round",value:i.Round},{label:"Floor",value:i.Floor},{label:"Ceiling",value:i.Ceiling},{label:"Sqrt",value:i.Sqrt},{label:"Log",value:i.Log},{label:"Tan",value:i.Tan},{label:"ArcTan",value:i.ArcTan},{label:"ArcCos",value:i.ArcCos},{label:"ArcSin",value:i.ArcSin},{label:"Fract",value:i.Fract},{label:"Sign",value:i.Sign},{label:"Radians",value:i.Radians},{label:"Degrees",value:i.Degrees},{label:"Set",value:i.Set}]})],d.prototype,"operation",void 0),(0,u.H7)("BABYLON.TrigonometryBlock",d)},71460:function(e,t,r){var n=r(90481),i=r(45748),a=r(5451);r(48932);var s=r(34504);s.q.prototype._createHardwareRenderTargetWrapper=function(e,t,r){let n=new i.$(e,t,r,this);return this._renderTargetWrapperCache.push(n),n},s.q.prototype.createRenderTargetTexture=function(e,t){let r=this._createHardwareRenderTargetWrapper(!1,!1,e),n={};void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode,n.creationFlags=t.creationFlags??0,n.noColorAttachment=!!t.noColorAttachment,n.colorAttachment=t.colorAttachment,n.samples=t.samples,n.label=t.label,n.format=t.format,n.type=t.type):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.samplingMode=3,n.creationFlags=0,n.noColorAttachment=!1);let i=n.colorAttachment||(n.noColorAttachment?null:this._createInternalTexture(e,n,!0,5));return r.label=n.label??"RenderTargetWrapper",r._samples=n.colorAttachment?.samples??n.samples??1,r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=!!n.generateStencilBuffer,r.setTextures(i),(r._generateDepthBuffer||r._generateStencilBuffer)&&r.createDepthStencilTexture(0,!1,r._generateStencilBuffer,r.samples,n.generateStencilBuffer?13:14,n.label?n.label+"-DepthStencil":void 0),i&&!n.colorAttachment&&(void 0!==t&&"object"==typeof t&&t.createMipMaps&&!n.generateMipMaps&&(i.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(i,void 0,void 0,void 0,n.creationFlags),void 0!==t&&"object"==typeof t&&t.createMipMaps&&!n.generateMipMaps&&(i.generateMipMaps=!1)),r},s.q.prototype._createDepthStencilTexture=function(e,t,r){let i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1,depthTextureFormat:t.generateStencil?13:14,...t},s=(0,a.QF)(i.depthTextureFormat);r._depthStencilTextureWithStencil=s;let o=new n.l(this,s?12:14);return o.label=t.label,o.format=i.depthTextureFormat,o.type=(0,a.Co)(o.format),this._setupDepthStencilTexture(o,e,i.bilinearFiltering,i.comparisonFunction,i.samples),this._textureHelper.createGPUTextureForInternalTexture(o),this._internalTexturesCache.push(o),o},s.q.prototype._setupDepthStencilTexture=function(e,t,r,n,i=1){let a=t.width??t,s=t.height??t,o=t.layers||0,l=t.depth||0;e.baseWidth=a,e.baseHeight=s,e.width=a,e.height=s,e.is2DArray=o>0,e.is3D=l>0,e.depth=o||l,e.isReady=!0,e.samples=i,e.generateMipMaps=!1,e.samplingMode=r?2:1,e.type=1,e._comparisonFunction=n,e._cachedWrapU=0,e._cachedWrapV=0},s.q.prototype.updateRenderTargetTextureSampleCount=function(e,t){return e&&e.texture&&e.samples!==t&&(t=Math.min(t,this.getCaps().maxMSAASamples),this._textureHelper.createMSAATexture(e.texture,t),e._depthStencilTexture&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),e._samples=t,e.texture.samples=t),t}},72227:function(e,t,r){r.d(t,{i:()=>s});var n=r(66755);let i="gaussianSplattingVertexDeclaration",a="attribute vec2 position;uniform mat4 view;uniform mat4 projection;uniform mat4 world;uniform vec4 vEyePosition;";n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},72297:function(e,t,r){r.r(t),r.d(t,{fogFragmentDeclaration:()=>s});var n=r(66755);let i="fogFragmentDeclaration",a=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()
{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},72392:function(e,t,r){var n;r.d(t,{Z:()=>i});let i=(n="file:///home/runner/work/CosmosJourneyer/CosmosJourneyer/node_modules/.pnpm/@babylonjs+havok@1.3.10/node_modules/@babylonjs/havok/lib/esm/HavokPhysics_es.js",function(e){var t,i,a,s,o,l,u,c,d,h,f,p,_,m,g,y,v,b,x,T,E,A=void 0!==(e=e||{})?e:{};A.ready=new Promise(function(e,t){i=e,a=t});var S=Object.assign({},A),I=[],C=(e,t)=>{throw t},P="";"undefined"!=typeof document&&document.currentScript&&(P=document.currentScript.src),n&&(P=n),P=0!==P.indexOf("blob:")?P.substr(0,P.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var R=A.print||console.log.bind(console),w=A.printErr||console.warn.bind(console);Object.assign(A,S),S=null,A.arguments&&(I=A.arguments),A.thisProgram&&A.thisProgram,A.quit&&(C=A.quit),A.wasmBinary&&(o=A.wasmBinary);var M=A.noExitRuntime||!0;"object"!=typeof WebAssembly&&$("no native wasm support detected");var O=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function N(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.buffer&&L)return L.decode(e.subarray(t,i));for(var a="";t<i;){var s=e[t++];if(!(128&s)){a+=String.fromCharCode(s);continue}var o=63&e[t++];if((224&s)==192){a+=String.fromCharCode((31&s)<<6|o);continue}var l=63&e[t++];if((s=(240&s)==224?(15&s)<<12|o<<6|l:(7&s)<<18|o<<12|l<<6|63&e[t++])<65536)a+=String.fromCharCode(s);else{var u=s-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}return a}function F(e){c=e,A.HEAP8=d=new Int8Array(e),A.HEAP16=f=new Int16Array(e),A.HEAP32=_=new Int32Array(e),A.HEAPU8=h=new Uint8Array(e),A.HEAPU16=p=new Uint16Array(e),A.HEAPU32=m=new Uint32Array(e),A.HEAPF32=g=new Float32Array(e),A.HEAPF64=b=new Float64Array(e),A.HEAP64=y=new BigInt64Array(e),A.HEAPU64=v=new BigUint64Array(e)}A.INITIAL_MEMORY;var D=[],B=[],k=[],G=[],U=0,V=null,H=null;function $(e){A.onAbort&&A.onAbort(e),w(e="Aborted("+e+")"),O=!0,u=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw a(t),t}function W(e){return e.startsWith("data:application/octet-stream;base64,")}function j(e){try{if(e==T&&o)return new Uint8Array(o);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){$(e)}}function z(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Y(e){for(;e.length>0;)e.shift()(A)}A.locateFile?W(T="HavokPhysics.wasm")||(t=T,T=A.locateFile?A.locateFile(t,P):P+t):T=new URL(r(87462),r.b).toString();var K={};function X(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function Z(e){return this.fromWireType(_[e>>2])}var q={},Q={},J={};function ee(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function et(e,t){return Function("body","return function "+(e=ee(e))+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function er(e,t){var r=et(t,function(e){this.name=t,this.message=e;var r=Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var en=void 0;function ei(e){throw new en(e)}function ea(e,t,r){function n(t){var n=r(t);n.length!==e.length&&ei("Mismatched type converter count");for(var i=0;i<e.length;++i)ed(e[i],n[i])}e.forEach(function(e){J[e]=t});var i=Array(t.length),a=[],s=0;t.forEach((e,t)=>{Q.hasOwnProperty(e)?i[t]=Q[e]:(a.push(e),q.hasOwnProperty(e)||(q[e]=[]),q[e].push(()=>{i[t]=Q[e],++s===a.length&&n(i)}))}),0===a.length&&n(i)}function es(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}var eo=void 0;function el(e){for(var t="",r=e;h[r];)t+=eo[h[r++]];return t}var eu=void 0;function ec(e){throw new eu(e)}function ed(e,t,r={}){if(!("argPackAdvance"in t))throw TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||ec('type "'+n+'" must have a positive integer typeid pointer'),Q.hasOwnProperty(e))if(r.ignoreDuplicateRegistrations)return;else ec("Cannot register type '"+n+"' twice");if(Q[e]=t,delete J[e],q.hasOwnProperty(e)){var i=q[e];delete q[e],i.forEach(e=>e())}}function eh(e,t,r){switch(t){case 0:return r?function(e){return d[e]}:function(e){return h[e]};case 1:return r?function(e){return f[e>>1]}:function(e){return p[e>>1]};case 2:return r?function(e){return _[e>>2]}:function(e){return m[e>>2]};case 3:return r?function(e){return y[e>>3]}:function(e){return v[e>>3]};default:throw TypeError("Unknown integer type: "+e)}}function ef(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw TypeError("Unknown type size: "+e)}}var ep=[],e_=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function em(e){e>4&&0==--e_[e].refcount&&(e_[e]=void 0,ep.push(e))}var eg=e=>(e||ec("Cannot use deleted val. handle = "+e),e_[e].value),ey=e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=ep.length?ep.pop():e_.length;return e_[t]={refcount:1,value:e},t}};function ev(e,t,r){if(A.hasOwnProperty(e)){(void 0===r||void 0!==A[e].overloadTable&&void 0!==A[e].overloadTable[r])&&ec("Cannot register public name '"+e+"' twice");if(void 0===A[e].overloadTable){var n=A[e];A[e]=function(){return A[e].overloadTable.hasOwnProperty(arguments.length)||ec("Function '"+e+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+A[e].overloadTable+")!"),A[e].overloadTable[arguments.length].apply(this,arguments)},A[e].overloadTable=[],A[e].overloadTable[n.argCount]=n}A.hasOwnProperty(r)&&ec("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),A[e].overloadTable[r]=t}else A[e]=t,void 0!==r&&(A[e].numArguments=r)}function eb(e){var t=e$(e),r=el(t);return eH(t),r}function ex(e,t){var r=Q[e];return void 0===r&&ec(t+" has unknown type "+eb(e)),r}function eT(e,t){if(!(e instanceof Function))throw TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=et(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,i=e.apply(n,t);return i instanceof Object?i:n}var eE=[];function eA(e,t){e=el(e);var r,n=((r=eE[t])||(t>=eE.length&&(eE.length=t+1),eE[t]=r=x.get(t)),r);return"function"!=typeof n&&ec("unknown function pointer with signature "+e+": "+t),n}var eS=void 0,eI="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function eC(e,t){for(var r=e,n=r>>1,i=n+t/2;!(n>=i)&&p[n];)++n;if((r=n<<1)-e>32&&eI)return eI.decode(h.subarray(e,r));for(var a="",s=0;!(s>=t/2);++s){var o=f[e+2*s>>1];if(0==o)break;a+=String.fromCharCode(o)}return a}function eP(e,t,r){if(void 0===r&&(r=0x7fffffff),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,a=0;a<i;++a){var s=e.charCodeAt(a);f[t>>1]=s,t+=2}return f[t>>1]=0,t-n}function eR(e){return 2*e.length}function ew(e,t){for(var r=0,n="";!(r>=t/4);){var i=_[e+4*r>>2];if(0==i)break;if(++r,i>=65536){var a=i-65536;n+=String.fromCharCode(55296|a>>10,56320|1023&a)}else n+=String.fromCharCode(i)}return n}function eM(e,t,r){if(void 0===r&&(r=0x7fffffff),r<4)return 0;for(var n=t,i=n+r-4,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),_[t>>2]=s,(t+=4)+4>i)break}return _[t>>2]=0,t-n}function eO(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}var eL={},eN=[],eF=[];function eD(){return 0x80000000}var eB=[null,[],[]];en=A.InternalError=er(Error,"InternalError");for(var ek=Array(256),eG=0;eG<256;++eG)ek[eG]=String.fromCharCode(eG);eo=ek,eu=A.BindingError=er(Error,"BindingError"),A.count_emval_handles=function(){for(var e=0,t=5;t<e_.length;++t)void 0!==e_[t]&&++e;return e},A.get_first_emval=function(){for(var e=5;e<e_.length;++e)if(void 0!==e_[e])return e_[e];return null},eS=A.UnboundTypeError=er(Error,"UnboundTypeError");var eU={_embind_finalize_value_array:function(e){var t=K[e];delete K[e];var r=t.elements,n=r.length,i=r.map(function(e){return e.getterReturnType}).concat(r.map(function(e){return e.setterArgumentType})),a=t.rawConstructor,s=t.rawDestructor;ea([e],i,function(e){return r.forEach((t,r)=>{var i=e[r],a=t.getter,s=t.getterContext,o=e[r+n],l=t.setter,u=t.setterContext;t.read=e=>i.fromWireType(a(s,e)),t.write=(e,t)=>{var r=[];l(u,e,o.toWireType(r,t)),X(r)}}),[{name:t.name,fromWireType:function(e){for(var t=Array(n),i=0;i<n;++i)t[i]=r[i].read(e);return s(e),t},toWireType:function(e,i){if(n!==i.length)throw TypeError("Incorrect number of tuple elements for "+t.name+": expected="+n+", actual="+i.length);for(var o=a(),l=0;l<n;++l)r[l].write(o,i[l]);return null!==e&&e.push(s,o),o},argPackAdvance:8,readValueFromPointer:Z,destructorFunction:s}]})},_embind_register_bigint:function(e,t,r,n,i){t=el(t);var a=ef(r),s=-1!=t.indexOf("u");s&&(i=(1n<<64n)-1n),ed(e,{name:t,fromWireType:function(e){return e},toWireType:function(e,r){if("bigint"!=typeof r&&"number"!=typeof r)throw TypeError('Cannot convert "'+es(r)+'" to '+this.name);if(r<n||r>i)throw TypeError('Passing a number "'+es(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+i+"]!");return r},argPackAdvance:8,readValueFromPointer:eh(t,a,!s),destructorFunction:null})},_embind_register_bool:function(e,t,r,n,i){var a=ef(r);ed(e,{name:t=el(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=d;else if(2===r)n=f;else if(4===r)n=_;else throw TypeError("Unknown boolean type size: "+t);return this.fromWireType(n[e>>a])},destructorFunction:null})},_embind_register_emval:function(e,t){ed(e,{name:t=el(t),fromWireType:function(e){var t=eg(e);return em(e),t},toWireType:function(e,t){return ey(t)},argPackAdvance:8,readValueFromPointer:Z,destructorFunction:null})},_embind_register_enum:function(e,t,r,n){var i=ef(r);function a(){}t=el(t),a.values={},ed(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:function(e,t,r){switch(t){case 0:return function(e){var t=r?d:h;return this.fromWireType(t[e])};case 1:return function(e){var t=r?f:p;return this.fromWireType(t[e>>1])};case 2:return function(e){var t=r?_:m;return this.fromWireType(t[e>>2])};default:throw TypeError("Unknown integer type: "+e)}}(t,i,n),destructorFunction:null}),ev(t,a)},_embind_register_enum_value:function(e,t,r){var n=ex(e,"enum");t=el(t);var i=n.constructor,a=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:et(n.name+"_"+t,function(){})}});i.values[r]=a,i[t]=a},_embind_register_float:function(e,t,r){var n=ef(r);ed(e,{name:t=el(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:function(e,t){switch(t){case 2:return function(e){return this.fromWireType(g[e>>2])};case 3:return function(e){return this.fromWireType(b[e>>3])};default:throw TypeError("Unknown float type: "+e)}}(t,n),destructorFunction:null})},_embind_register_function:function(e,t,r,n,i,a){var s=function(e,t){for(var r=[],n=0;n<e;n++)r.push(m[t+4*n>>2]);return r}(t,r);e=el(e),i=eA(n,i),ev(e,function(){var t="Cannot call "+e+" due to unbound types",r=[],n={};throw s.forEach(function e(t){if(!n[t]&&!Q[t]){if(J[t])return void J[t].forEach(e);r.push(t),n[t]=!0}}),new eS(t+": "+r.map(eb).join([", "]))},t-1),ea([],s,function(r){var n,s,o,l=[r[0],null].concat(r.slice(1));return n=e,s=function(e,t,r,n,i){var a=t.length;a<2&&ec("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var s=null!==t[1]&&!1,o=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){o=!0;break}for(var u="void"!==t[0].name,c="",d="",l=0;l<a-2;++l)c+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var h="return function "+ee(e)+"("+c+") {\nif (arguments.length !== "+(a-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(a-2)+" args!');\n}\n";o&&(h+="var destructors = [];\n");var f=o?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],_=[ec,n,i,X,t[0],t[1]];s&&(h+="var thisWired = classParam.toWireType("+f+", this);\n");for(var l=0;l<a-2;++l)h+="var arg"+l+"Wired = argType"+l+".toWireType("+f+", arg"+l+"); // "+t[l+2].name+"\n",p.push("argType"+l),_.push(t[l+2]);if(s&&(d="thisWired"+(d.length>0?", ":"")+d),h+=(u?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",o)h+="runDestructors(destructors);\n";else for(var l=s?1:2;l<t.length;++l){var m=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(h+=m+"_dtor("+m+"); // "+t[l].name+"\n",p.push(m+"_dtor"),_.push(t[l].destructorFunction))}return u&&(h+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),h+="}\n",p.push(h),eT(Function,p).apply(null,_)}(e,l,0,i,a),o=t-1,A.hasOwnProperty(n)||ei("Replacing nonexistant public symbol"),void 0!==A[n].overloadTable&&void 0!==o?A[n].overloadTable[o]=s:(A[n]=s,A[n].argCount=o),[]})},_embind_register_integer:function(e,t,r,n,i){t=el(t),-1===i&&(i=0xffffffff);var a,s=ef(r),o=e=>e;if(0===n){var l=32-8*r;o=e=>e<<l>>>l}var u=t.includes("unsigned"),c=(e,t)=>{};ed(e,{name:t,fromWireType:o,toWireType:u?function(e,t){return c(t,this.name),t>>>0}:function(e,t){return c(t,this.name),t},argPackAdvance:8,readValueFromPointer:eh(t,s,0!==n),destructorFunction:null})},_embind_register_memory_view:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];function i(e){e>>=2;var t=m,r=t[e],i=t[e+1];return new n(c,i,r)}ed(e,{name:r=el(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},_embind_register_std_string:function(e,t){var r="std::string"===(t=el(t));ed(e,{name:t,fromWireType:function(e){var t,n=m[e>>2],i=e+4;if(r)for(var a=i,s=0;s<=n;++s){var o=i+s;if(s==n||0==h[o]){var l,u=o-a,c=(l=a)?N(h,l,u):"";void 0===t?t=c:(t+="\0",t+=c),a=o+1}}else{for(var d=Array(n),s=0;s<n;++s)d[s]=String.fromCharCode(h[i+s]);t=d.join("")}return eH(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n,i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ec("Cannot pass non-string to std::string"),n=r&&i?function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t}(t):t.length;var a=eV(4+n+1),s=a+4;if(m[a>>2]=n,r&&i)!function(e,t,r){var n=h,i=t;if(r>0){for(var a=i+r-1,s=0;s<e.length;++s){var o=e.charCodeAt(s);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),o<=127){if(i>=a)break;n[i++]=o}else if(o<=2047){if(i+1>=a)break;n[i++]=192|o>>6,n[i++]=128|63&o}else if(o<=65535){if(i+2>=a)break;n[i++]=224|o>>12,n[i++]=128|o>>6&63,n[i++]=128|63&o}else{if(i+3>=a)break;n[i++]=240|o>>18,n[i++]=128|o>>12&63,n[i++]=128|o>>6&63,n[i++]=128|63&o}}n[i]=0}}(t,s,n+1);else if(i)for(var o=0;o<n;++o){var l=t.charCodeAt(o);l>255&&(eH(s),ec("String has UTF-16 code units that do not fit in 8 bits")),h[s+o]=l}else for(var o=0;o<n;++o)h[s+o]=t[o];return null!==e&&e.push(eH,a),a},argPackAdvance:8,readValueFromPointer:Z,destructorFunction:function(e){eH(e)}})},_embind_register_std_wstring:function(e,t,r){var n,i,a,s,o;r=el(r),2===t?(n=eC,i=eP,s=eR,a=()=>p,o=1):4===t&&(n=ew,i=eM,s=eO,a=()=>m,o=2),ed(e,{name:r,fromWireType:function(e){for(var r,i=m[e>>2],s=a(),l=e+4,u=0;u<=i;++u){var c=e+4+u*t;if(u==i||0==s[c>>o]){var d=c-l,h=n(l,d);void 0===r?r=h:(r+="\0",r+=h),l=c+t}}return eH(e),r},toWireType:function(e,n){"string"!=typeof n&&ec("Cannot pass non-string to C++ string type "+r);var a=s(n),l=eV(4+a+t);return m[l>>2]=a>>o,i(n,l+4,a+t),null!==e&&e.push(eH,l),l},argPackAdvance:8,readValueFromPointer:Z,destructorFunction:function(e){eH(e)}})},_embind_register_value_array:function(e,t,r,n,i,a){K[e]={name:el(t),rawConstructor:eA(r,n),rawDestructor:eA(i,a),elements:[]}},_embind_register_value_array_element:function(e,t,r,n,i,a,s,o,l){K[e].elements.push({getterReturnType:t,getter:eA(r,n),getterContext:i,setterArgumentType:a,setter:eA(s,o),setterContext:l})},_embind_register_void:function(e,t){ed(e,{isVoid:!0,name:t=el(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},_emscripten_get_now_is_monotonic:function(){return!0},_emval_call_void_method:function(e,t,r,n){var i,a;e=eN[e],e(t=eg(t),r=void 0===(a=eL[i=r])?el(i):a,null,n)},_emval_decref:em,_emval_get_method_caller:function(e,t){var r,n,i=function(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=ex(m[t+4*n>>2],"parameter "+n);return r}(e,t),a=i[0],s=a.name+"_$"+i.slice(1).map(function(e){return e.name}).join("_")+"$",o=eF[s];if(void 0!==o)return o;for(var l=["retType"],u=[a],c="",d=0;d<e-1;++d)c+=(0!==d?", ":"")+"arg"+d,l.push("argType"+d),u.push(i[1+d]);for(var h="return function "+ee("methodCaller_"+s)+"(handle, name, destructors, args) {\n",f=0,d=0;d<e-1;++d)h+="    var arg"+d+" = argType"+d+".readValueFromPointer(args"+(f?"+"+f:"")+");\n",f+=i[d+1].argPackAdvance;h+="    var rv = handle[name]("+c+");\n";for(var d=0;d<e-1;++d)i[d+1].deleteObject&&(h+="    argType"+d+".deleteObject(arg"+d+");\n");return a.isVoid||(h+="    return retType.toWireType(destructors, rv);\n"),h+="};\n",l.push(h),r=eT(Function,l).apply(null,u),n=eN.length,eN.push(r),o=n,eF[s]=o,o},abort:function(){$("")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return eD()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:function(e,t,r){h.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t=h.length;e>>>=0;var r=eD();if(e>r)return!1;let n=(e,t)=>e+(t-e%t)%t;for(var i=1;i<=4;i*=2){var a=t*(1+.2/i);if(a=Math.min(a,e+0x6000000),function(e){try{return l.grow(e-c.byteLength+65535>>>16),F(l.buffer),1}catch(e){}}(Math.min(r,n(Math.max(e,a),65536))))return!0}return!1},fd_write:function(e,t,r,n){for(var i=0,a=0;a<r;a++){var s=m[t>>2],o=m[t+4>>2];t+=8;for(var l=0;l<o;l++)!function(e,t){var r=eB[e];0===t||10===t?((1===e?R:w)(N(r,0)),r.length=0):r.push(t)}(e,h[s+l]);i+=o}return m[n>>2]=i,0}};!function(){var e={env:eU,wasi_snapshot_preview1:eU};function t(e,t){var r;if(A.asm=e.exports,F((l=A.asm.memory).buffer),x=A.asm.__indirect_function_table,r=A.asm.__wasm_call_ctors,B.unshift(r),U--,A.monitorRunDependencies&&A.monitorRunDependencies(U),0==U&&(null!==V&&(clearInterval(V),V=null),H)){var n=H;H=null,n()}}function r(e){t(e.instance)}function n(t){return(!o&&"function"==typeof fetch?fetch(T,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+T+"'";return e.arrayBuffer()}).catch(function(){return j(T)}):Promise.resolve().then(function(){return j(T)})).then(function(t){return WebAssembly.instantiate(t,e)}).then(function(e){return e}).then(t,function(e){w("failed to asynchronously prepare wasm: "+e),$(e)})}if(U++,A.monitorRunDependencies&&A.monitorRunDependencies(U),A.instantiateWasm)try{return A.instantiateWasm(e,t)}catch(e){w("Module.instantiateWasm callback failed with error: "+e),a(e)}(!o&&"function"==typeof WebAssembly.instantiateStreaming&&!W(T)&&"function"==typeof fetch?fetch(T,{credentials:"same-origin"}).then(function(t){return WebAssembly.instantiateStreaming(t,e).then(r,function(e){return w("wasm streaming compile failed: "+e),w("falling back to ArrayBuffer instantiation"),n(r)})}):n(r)).catch(a)}(),A.___wasm_call_ctors=function(){return(A.___wasm_call_ctors=A.asm.__wasm_call_ctors).apply(null,arguments)},A._HP_GetStatistics=function(){return(A._HP_GetStatistics=A.asm.HP_GetStatistics).apply(null,arguments)},A._HP_Shape_CreateSphere=function(){return(A._HP_Shape_CreateSphere=A.asm.HP_Shape_CreateSphere).apply(null,arguments)},A._HP_Shape_CreateCapsule=function(){return(A._HP_Shape_CreateCapsule=A.asm.HP_Shape_CreateCapsule).apply(null,arguments)},A._HP_Shape_CreateCylinder=function(){return(A._HP_Shape_CreateCylinder=A.asm.HP_Shape_CreateCylinder).apply(null,arguments)},A._HP_Shape_CreateBox=function(){return(A._HP_Shape_CreateBox=A.asm.HP_Shape_CreateBox).apply(null,arguments)},A._HP_Shape_CreateConvexHull=function(){return(A._HP_Shape_CreateConvexHull=A.asm.HP_Shape_CreateConvexHull).apply(null,arguments)},A._HP_Shape_CreateMesh=function(){return(A._HP_Shape_CreateMesh=A.asm.HP_Shape_CreateMesh).apply(null,arguments)},A._HP_Shape_CreateHeightField=function(){return(A._HP_Shape_CreateHeightField=A.asm.HP_Shape_CreateHeightField).apply(null,arguments)},A._HP_Shape_CreateContainer=function(){return(A._HP_Shape_CreateContainer=A.asm.HP_Shape_CreateContainer).apply(null,arguments)},A._HP_Shape_Release=function(){return(A._HP_Shape_Release=A.asm.HP_Shape_Release).apply(null,arguments)},A._HP_Shape_GetType=function(){return(A._HP_Shape_GetType=A.asm.HP_Shape_GetType).apply(null,arguments)},A._HP_Shape_AddChild=function(){return(A._HP_Shape_AddChild=A.asm.HP_Shape_AddChild).apply(null,arguments)},A._HP_Shape_RemoveChild=function(){return(A._HP_Shape_RemoveChild=A.asm.HP_Shape_RemoveChild).apply(null,arguments)},A._HP_Shape_GetNumChildren=function(){return(A._HP_Shape_GetNumChildren=A.asm.HP_Shape_GetNumChildren).apply(null,arguments)},A._HP_Shape_GetChildShape=function(){return(A._HP_Shape_GetChildShape=A.asm.HP_Shape_GetChildShape).apply(null,arguments)},A._HP_Shape_SetChildQSTransform=function(){return(A._HP_Shape_SetChildQSTransform=A.asm.HP_Shape_SetChildQSTransform).apply(null,arguments)},A._HP_Shape_GetChildQSTransform=function(){return(A._HP_Shape_GetChildQSTransform=A.asm.HP_Shape_GetChildQSTransform).apply(null,arguments)},A._HP_Shape_SetFilterInfo=function(){return(A._HP_Shape_SetFilterInfo=A.asm.HP_Shape_SetFilterInfo).apply(null,arguments)},A._HP_Shape_GetFilterInfo=function(){return(A._HP_Shape_GetFilterInfo=A.asm.HP_Shape_GetFilterInfo).apply(null,arguments)},A._HP_Shape_SetMaterial=function(){return(A._HP_Shape_SetMaterial=A.asm.HP_Shape_SetMaterial).apply(null,arguments)},A._HP_Shape_GetMaterial=function(){return(A._HP_Shape_GetMaterial=A.asm.HP_Shape_GetMaterial).apply(null,arguments)},A._HP_Shape_SetDensity=function(){return(A._HP_Shape_SetDensity=A.asm.HP_Shape_SetDensity).apply(null,arguments)},A._HP_Shape_GetDensity=function(){return(A._HP_Shape_GetDensity=A.asm.HP_Shape_GetDensity).apply(null,arguments)},A._HP_Shape_GetBoundingBox=function(){return(A._HP_Shape_GetBoundingBox=A.asm.HP_Shape_GetBoundingBox).apply(null,arguments)},A._HP_Shape_CastRay=function(){return(A._HP_Shape_CastRay=A.asm.HP_Shape_CastRay).apply(null,arguments)},A._HP_Shape_BuildMassProperties=function(){return(A._HP_Shape_BuildMassProperties=A.asm.HP_Shape_BuildMassProperties).apply(null,arguments)},A._HP_ShapePathIterator_GetNext=function(){return(A._HP_ShapePathIterator_GetNext=A.asm.HP_ShapePathIterator_GetNext).apply(null,arguments)},A._HP_Shape_SetTrigger=function(){return(A._HP_Shape_SetTrigger=A.asm.HP_Shape_SetTrigger).apply(null,arguments)},A._HP_Shape_CreateDebugDisplayGeometry=function(){return(A._HP_Shape_CreateDebugDisplayGeometry=A.asm.HP_Shape_CreateDebugDisplayGeometry).apply(null,arguments)},A._HP_DebugGeometry_GetInfo=function(){return(A._HP_DebugGeometry_GetInfo=A.asm.HP_DebugGeometry_GetInfo).apply(null,arguments)},A._HP_DebugGeometry_Release=function(){return(A._HP_DebugGeometry_Release=A.asm.HP_DebugGeometry_Release).apply(null,arguments)},A._HP_Body_Create=function(){return(A._HP_Body_Create=A.asm.HP_Body_Create).apply(null,arguments)},A._HP_Body_Release=function(){return(A._HP_Body_Release=A.asm.HP_Body_Release).apply(null,arguments)},A._HP_Body_SetShape=function(){return(A._HP_Body_SetShape=A.asm.HP_Body_SetShape).apply(null,arguments)},A._HP_Body_GetShape=function(){return(A._HP_Body_GetShape=A.asm.HP_Body_GetShape).apply(null,arguments)},A._HP_Body_SetMotionType=function(){return(A._HP_Body_SetMotionType=A.asm.HP_Body_SetMotionType).apply(null,arguments)},A._HP_Body_GetMotionType=function(){return(A._HP_Body_GetMotionType=A.asm.HP_Body_GetMotionType).apply(null,arguments)},A._HP_Body_SetEventMask=function(){return(A._HP_Body_SetEventMask=A.asm.HP_Body_SetEventMask).apply(null,arguments)},A._HP_Body_GetEventMask=function(){return(A._HP_Body_GetEventMask=A.asm.HP_Body_GetEventMask).apply(null,arguments)},A._HP_Body_SetMassProperties=function(){return(A._HP_Body_SetMassProperties=A.asm.HP_Body_SetMassProperties).apply(null,arguments)},A._HP_Body_GetMassProperties=function(){return(A._HP_Body_GetMassProperties=A.asm.HP_Body_GetMassProperties).apply(null,arguments)},A._HP_Body_SetLinearDamping=function(){return(A._HP_Body_SetLinearDamping=A.asm.HP_Body_SetLinearDamping).apply(null,arguments)},A._HP_Body_GetLinearDamping=function(){return(A._HP_Body_GetLinearDamping=A.asm.HP_Body_GetLinearDamping).apply(null,arguments)},A._HP_Body_SetAngularDamping=function(){return(A._HP_Body_SetAngularDamping=A.asm.HP_Body_SetAngularDamping).apply(null,arguments)},A._HP_Body_GetAngularDamping=function(){return(A._HP_Body_GetAngularDamping=A.asm.HP_Body_GetAngularDamping).apply(null,arguments)},A._HP_Body_SetGravityFactor=function(){return(A._HP_Body_SetGravityFactor=A.asm.HP_Body_SetGravityFactor).apply(null,arguments)},A._HP_Body_GetGravityFactor=function(){return(A._HP_Body_GetGravityFactor=A.asm.HP_Body_GetGravityFactor).apply(null,arguments)},A._HP_Body_GetWorld=function(){return(A._HP_Body_GetWorld=A.asm.HP_Body_GetWorld).apply(null,arguments)},A._HP_Body_SetPosition=function(){return(A._HP_Body_SetPosition=A.asm.HP_Body_SetPosition).apply(null,arguments)},A._HP_Body_GetPosition=function(){return(A._HP_Body_GetPosition=A.asm.HP_Body_GetPosition).apply(null,arguments)},A._HP_Body_SetOrientation=function(){return(A._HP_Body_SetOrientation=A.asm.HP_Body_SetOrientation).apply(null,arguments)},A._HP_Body_GetOrientation=function(){return(A._HP_Body_GetOrientation=A.asm.HP_Body_GetOrientation).apply(null,arguments)},A._HP_Body_SetQTransform=function(){return(A._HP_Body_SetQTransform=A.asm.HP_Body_SetQTransform).apply(null,arguments)},A._HP_Body_GetWorldTransformOffset=function(){return(A._HP_Body_GetWorldTransformOffset=A.asm.HP_Body_GetWorldTransformOffset).apply(null,arguments)},A._HP_Body_GetQTransform=function(){return(A._HP_Body_GetQTransform=A.asm.HP_Body_GetQTransform).apply(null,arguments)},A._HP_Body_SetLinearVelocity=function(){return(A._HP_Body_SetLinearVelocity=A.asm.HP_Body_SetLinearVelocity).apply(null,arguments)},A._HP_Body_GetLinearVelocity=function(){return(A._HP_Body_GetLinearVelocity=A.asm.HP_Body_GetLinearVelocity).apply(null,arguments)},A._HP_Body_SetAngularVelocity=function(){return(A._HP_Body_SetAngularVelocity=A.asm.HP_Body_SetAngularVelocity).apply(null,arguments)},A._HP_Body_GetAngularVelocity=function(){return(A._HP_Body_GetAngularVelocity=A.asm.HP_Body_GetAngularVelocity).apply(null,arguments)},A._HP_Body_ApplyImpulse=function(){return(A._HP_Body_ApplyImpulse=A.asm.HP_Body_ApplyImpulse).apply(null,arguments)},A._HP_Body_ApplyAngularImpulse=function(){return(A._HP_Body_ApplyAngularImpulse=A.asm.HP_Body_ApplyAngularImpulse).apply(null,arguments)},A._HP_Body_SetTargetQTransform=function(){return(A._HP_Body_SetTargetQTransform=A.asm.HP_Body_SetTargetQTransform).apply(null,arguments)},A._HP_Body_SetActivationState=function(){return(A._HP_Body_SetActivationState=A.asm.HP_Body_SetActivationState).apply(null,arguments)},A._HP_Body_GetActivationState=function(){return(A._HP_Body_GetActivationState=A.asm.HP_Body_GetActivationState).apply(null,arguments)},A._HP_Body_SetActivationControl=function(){return(A._HP_Body_SetActivationControl=A.asm.HP_Body_SetActivationControl).apply(null,arguments)},A._HP_Body_SetActivationPriority=function(){return(A._HP_Body_SetActivationPriority=A.asm.HP_Body_SetActivationPriority).apply(null,arguments)},A._HP_Constraint_Create=function(){return(A._HP_Constraint_Create=A.asm.HP_Constraint_Create).apply(null,arguments)},A._HP_Constraint_Release=function(){return(A._HP_Constraint_Release=A.asm.HP_Constraint_Release).apply(null,arguments)},A._HP_Constraint_SetParentBody=function(){return(A._HP_Constraint_SetParentBody=A.asm.HP_Constraint_SetParentBody).apply(null,arguments)},A._HP_Constraint_GetParentBody=function(){return(A._HP_Constraint_GetParentBody=A.asm.HP_Constraint_GetParentBody).apply(null,arguments)},A._HP_Constraint_SetChildBody=function(){return(A._HP_Constraint_SetChildBody=A.asm.HP_Constraint_SetChildBody).apply(null,arguments)},A._HP_Constraint_GetChildBody=function(){return(A._HP_Constraint_GetChildBody=A.asm.HP_Constraint_GetChildBody).apply(null,arguments)},A._HP_Constraint_SetAnchorInParent=function(){return(A._HP_Constraint_SetAnchorInParent=A.asm.HP_Constraint_SetAnchorInParent).apply(null,arguments)},A._HP_Constraint_SetAnchorInChild=function(){return(A._HP_Constraint_SetAnchorInChild=A.asm.HP_Constraint_SetAnchorInChild).apply(null,arguments)},A._HP_Constraint_SetCollisionsEnabled=function(){return(A._HP_Constraint_SetCollisionsEnabled=A.asm.HP_Constraint_SetCollisionsEnabled).apply(null,arguments)},A._HP_Constraint_GetCollisionsEnabled=function(){return(A._HP_Constraint_GetCollisionsEnabled=A.asm.HP_Constraint_GetCollisionsEnabled).apply(null,arguments)},A._HP_Constraint_SetEnabled=function(){return(A._HP_Constraint_SetEnabled=A.asm.HP_Constraint_SetEnabled).apply(null,arguments)},A._HP_Constraint_GetEnabled=function(){return(A._HP_Constraint_GetEnabled=A.asm.HP_Constraint_GetEnabled).apply(null,arguments)},A._HP_Constraint_SetAxisMinLimit=function(){return(A._HP_Constraint_SetAxisMinLimit=A.asm.HP_Constraint_SetAxisMinLimit).apply(null,arguments)},A._HP_Constraint_GetAxisMinLimit=function(){return(A._HP_Constraint_GetAxisMinLimit=A.asm.HP_Constraint_GetAxisMinLimit).apply(null,arguments)},A._HP_Constraint_SetAxisMaxLimit=function(){return(A._HP_Constraint_SetAxisMaxLimit=A.asm.HP_Constraint_SetAxisMaxLimit).apply(null,arguments)},A._HP_Constraint_GetAxisMaxLimit=function(){return(A._HP_Constraint_GetAxisMaxLimit=A.asm.HP_Constraint_GetAxisMaxLimit).apply(null,arguments)},A._HP_Constraint_GetAxisMode=function(){return(A._HP_Constraint_GetAxisMode=A.asm.HP_Constraint_GetAxisMode).apply(null,arguments)},A._HP_Constraint_SetAxisMode=function(){return(A._HP_Constraint_SetAxisMode=A.asm.HP_Constraint_SetAxisMode).apply(null,arguments)},A._HP_Constraint_SetAxisFriction=function(){return(A._HP_Constraint_SetAxisFriction=A.asm.HP_Constraint_SetAxisFriction).apply(null,arguments)},A._HP_Constraint_GetAxisFriction=function(){return(A._HP_Constraint_GetAxisFriction=A.asm.HP_Constraint_GetAxisFriction).apply(null,arguments)},A._HP_Constraint_SetAxisMotorType=function(){return(A._HP_Constraint_SetAxisMotorType=A.asm.HP_Constraint_SetAxisMotorType).apply(null,arguments)},A._HP_Constraint_GetAxisMotorType=function(){return(A._HP_Constraint_GetAxisMotorType=A.asm.HP_Constraint_GetAxisMotorType).apply(null,arguments)},A._HP_Constraint_SetAxisMotorPositionTarget=function(){return(A._HP_Constraint_SetAxisMotorPositionTarget=A.asm.HP_Constraint_SetAxisMotorPositionTarget).apply(null,arguments)},A._HP_Constraint_GetAxisMotorPositionTarget=function(){return(A._HP_Constraint_GetAxisMotorPositionTarget=A.asm.HP_Constraint_GetAxisMotorPositionTarget).apply(null,arguments)},A._HP_Constraint_SetAxisMotorVelocityTarget=function(){return(A._HP_Constraint_SetAxisMotorVelocityTarget=A.asm.HP_Constraint_SetAxisMotorVelocityTarget).apply(null,arguments)},A._HP_Constraint_GetAxisMotorVelocityTarget=function(){return(A._HP_Constraint_GetAxisMotorVelocityTarget=A.asm.HP_Constraint_GetAxisMotorVelocityTarget).apply(null,arguments)},A._HP_Constraint_SetAxisMotorMaxForce=function(){return(A._HP_Constraint_SetAxisMotorMaxForce=A.asm.HP_Constraint_SetAxisMotorMaxForce).apply(null,arguments)},A._HP_Constraint_GetAxisMotorMaxForce=function(){return(A._HP_Constraint_GetAxisMotorMaxForce=A.asm.HP_Constraint_GetAxisMotorMaxForce).apply(null,arguments)},A._HP_Constraint_SetAxisMotorStiffness=function(){return(A._HP_Constraint_SetAxisMotorStiffness=A.asm.HP_Constraint_SetAxisMotorStiffness).apply(null,arguments)},A._HP_Constraint_GetAxisMotorStiffness=function(){return(A._HP_Constraint_GetAxisMotorStiffness=A.asm.HP_Constraint_GetAxisMotorStiffness).apply(null,arguments)},A._HP_Constraint_SetAxisMotorDamping=function(){return(A._HP_Constraint_SetAxisMotorDamping=A.asm.HP_Constraint_SetAxisMotorDamping).apply(null,arguments)},A._HP_Constraint_GetAxisMotorDamping=function(){return(A._HP_Constraint_GetAxisMotorDamping=A.asm.HP_Constraint_GetAxisMotorDamping).apply(null,arguments)},A._HP_Constraint_SetAxisStiffness=function(){return(A._HP_Constraint_SetAxisStiffness=A.asm.HP_Constraint_SetAxisStiffness).apply(null,arguments)},A._HP_Constraint_SetAxisDamping=function(){return(A._HP_Constraint_SetAxisDamping=A.asm.HP_Constraint_SetAxisDamping).apply(null,arguments)},A._HP_Constraint_SetAxisMotorTarget=function(){return(A._HP_Constraint_SetAxisMotorTarget=A.asm.HP_Constraint_SetAxisMotorTarget).apply(null,arguments)},A._HP_Constraint_GetAxisMotorTarget=function(){return(A._HP_Constraint_GetAxisMotorTarget=A.asm.HP_Constraint_GetAxisMotorTarget).apply(null,arguments)},A._HP_World_Create=function(){return(A._HP_World_Create=A.asm.HP_World_Create).apply(null,arguments)},A._HP_World_Release=function(){return(A._HP_World_Release=A.asm.HP_World_Release).apply(null,arguments)},A._HP_World_GetBodyBuffer=function(){return(A._HP_World_GetBodyBuffer=A.asm.HP_World_GetBodyBuffer).apply(null,arguments)},A._HP_World_SetGravity=function(){return(A._HP_World_SetGravity=A.asm.HP_World_SetGravity).apply(null,arguments)},A._HP_World_GetGravity=function(){return(A._HP_World_GetGravity=A.asm.HP_World_GetGravity).apply(null,arguments)},A._HP_World_AddBody=function(){return(A._HP_World_AddBody=A.asm.HP_World_AddBody).apply(null,arguments)},A._HP_World_RemoveBody=function(){return(A._HP_World_RemoveBody=A.asm.HP_World_RemoveBody).apply(null,arguments)},A._HP_World_GetNumBodies=function(){return(A._HP_World_GetNumBodies=A.asm.HP_World_GetNumBodies).apply(null,arguments)},A._HP_World_CastRayWithCollector=function(){return(A._HP_World_CastRayWithCollector=A.asm.HP_World_CastRayWithCollector).apply(null,arguments)},A._HP_World_PointProximityWithCollector=function(){return(A._HP_World_PointProximityWithCollector=A.asm.HP_World_PointProximityWithCollector).apply(null,arguments)},A._HP_World_ShapeProximityWithCollector=function(){return(A._HP_World_ShapeProximityWithCollector=A.asm.HP_World_ShapeProximityWithCollector).apply(null,arguments)},A._HP_World_ShapeCastWithCollector=function(){return(A._HP_World_ShapeCastWithCollector=A.asm.HP_World_ShapeCastWithCollector).apply(null,arguments)},A._HP_World_Step=function(){return(A._HP_World_Step=A.asm.HP_World_Step).apply(null,arguments)},A._HP_World_SetIdealStepTime=function(){return(A._HP_World_SetIdealStepTime=A.asm.HP_World_SetIdealStepTime).apply(null,arguments)},A._HP_World_SetSpeedLimit=function(){return(A._HP_World_SetSpeedLimit=A.asm.HP_World_SetSpeedLimit).apply(null,arguments)},A._HP_World_GetSpeedLimit=function(){return(A._HP_World_GetSpeedLimit=A.asm.HP_World_GetSpeedLimit).apply(null,arguments)},A._HP_World_GetNextCollisionEvent=function(){return(A._HP_World_GetNextCollisionEvent=A.asm.HP_World_GetNextCollisionEvent).apply(null,arguments)},A._HP_World_GetNextTriggerEvent=function(){return(A._HP_World_GetNextTriggerEvent=A.asm.HP_World_GetNextTriggerEvent).apply(null,arguments)},A._HP_QueryCollector_Create=function(){return(A._HP_QueryCollector_Create=A.asm.HP_QueryCollector_Create).apply(null,arguments)},A._HP_QueryCollector_Release=function(){return(A._HP_QueryCollector_Release=A.asm.HP_QueryCollector_Release).apply(null,arguments)},A._HP_QueryCollector_GetNumHits=function(){return(A._HP_QueryCollector_GetNumHits=A.asm.HP_QueryCollector_GetNumHits).apply(null,arguments)},A._HP_QueryCollector_GetCastRayResult=function(){return(A._HP_QueryCollector_GetCastRayResult=A.asm.HP_QueryCollector_GetCastRayResult).apply(null,arguments)},A._HP_QueryCollector_GetPointProximityResult=function(){return(A._HP_QueryCollector_GetPointProximityResult=A.asm.HP_QueryCollector_GetPointProximityResult).apply(null,arguments)},A._HP_QueryCollector_GetShapeProximityResult=function(){return(A._HP_QueryCollector_GetShapeProximityResult=A.asm.HP_QueryCollector_GetShapeProximityResult).apply(null,arguments)},A._HP_QueryCollector_GetShapeCastResult=function(){return(A._HP_QueryCollector_GetShapeCastResult=A.asm.HP_QueryCollector_GetShapeCastResult).apply(null,arguments)},A._main=function(){return(A._main=A.asm.main).apply(null,arguments)};var eV=A._malloc=function(){return(eV=A._malloc=A.asm.malloc).apply(null,arguments)},eH=A._free=function(){return(eH=A._free=A.asm.free).apply(null,arguments)},e$=(A._HP_Debug_StartRecordingStats=function(){return(A._HP_Debug_StartRecordingStats=A.asm.HP_Debug_StartRecordingStats).apply(null,arguments)},A._HP_Debug_StopRecordingStats=function(){return(A._HP_Debug_StopRecordingStats=A.asm.HP_Debug_StopRecordingStats).apply(null,arguments)},A.___errno_location=function(){return(A.___errno_location=A.asm.__errno_location).apply(null,arguments)},A._htons=function(){return(A._htons=A.asm.htons).apply(null,arguments)},A._ntohs=function(){return(A._ntohs=A.asm.ntohs).apply(null,arguments)},A.___getTypeName=function(){return(e$=A.___getTypeName=A.asm.__getTypeName).apply(null,arguments)});function eW(e){if(e=e||I,!(U>0)){if(A.preRun)for("function"==typeof A.preRun&&(A.preRun=[A.preRun]);A.preRun.length;){var t;t=A.preRun.shift(),D.unshift(t)}Y(D),U>0||(A.setStatus?(A.setStatus("Running..."),setTimeout(function(){setTimeout(function(){A.setStatus("")},1),r()},1)):r())}function r(){if(!E&&(E=!0,A.calledRun=!0,!O)){if(Y(B),Y(k),i(A),A.onRuntimeInitialized&&A.onRuntimeInitialized(),ej&&function(e){var t=A._main;try{var r=t(0,0);u=r,u=r,M||(A.onExit&&A.onExit(r),O=!0),C(r,new z(r))}catch(e){if(e instanceof z||"unwind"==e)return u;C(1,e);return}}(0),A.postRun)for("function"==typeof A.postRun&&(A.postRun=[A.postRun]);A.postRun.length;){var e;e=A.postRun.shift(),G.unshift(e)}Y(G)}}}if(A.__embind_initialize_bindings=function(){return(A.__embind_initialize_bindings=A.asm._embind_initialize_bindings).apply(null,arguments)},A._htonl=function(){return(A._htonl=A.asm.htonl).apply(null,arguments)},A._setThrew=function(){return(A._setThrew=A.asm.setThrew).apply(null,arguments)},A._saveSetjmp=function(){return(A._saveSetjmp=A.asm.saveSetjmp).apply(null,arguments)},A.stackSave=function(){return(A.stackSave=A.asm.stackSave).apply(null,arguments)},A.stackRestore=function(){return(A.stackRestore=A.asm.stackRestore).apply(null,arguments)},A.stackAlloc=function(){return(A.stackAlloc=A.asm.stackAlloc).apply(null,arguments)},H=function e(){E||eW(),E||(H=e)},A.preInit)for("function"==typeof A.preInit&&(A.preInit=[A.preInit]);A.preInit.length>0;)A.preInit.pop()();var ej=!0;return A.noInitialRun&&(ej=!1),eW(),e.ready})},7283:function(e,t,r){r.d(t,{U:()=>i});var n=r(88280);class i{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.varyingDeclarationFragment="",this.varyingInitializationsFragment="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:[]},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}emitErrors(e=null){let t="";for(let e of(this.checks.emitVertex||this.allowEmptyVertexProgram||(t+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a position value.\n"),this.checks.emitFragment||(t+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a color value.\n"),this.checks.notConnectedNonOptionalInputs))t+=`input ${e.name} from block ${e.ownerBlock.name}[${e.ownerBlock.getClassName()}] is not connected and is not optional.
`;return!t||(e&&e.notifyObservers(t),n.Y.Error("Build of NodeMaterial failed:\n"+t),!1)}}},72930:function(e,t,r){r.d(t,{U:()=>M,v:()=>O});var n=r(88280),i=r(82961),a=r(61834),s=r(57423),o=r(51577),l=r(81466),u=r(27987),c=r(69631),d=r(40112),h=r(27396),f=r(74216),p=r(32517),_=r(40548),m=r(80405),g=r(3566),y=r(93919),v=r(83500),b=r(6027),x=r(58871),T=r(72855),E=r(38536),A=r(16783),S=r(41038),I=r(46363),C=r(70541),P=r(75590),R=r(137),w=r(29257),M=!0;class O{}O.LoaderInjectedPhysicsEngine=void 0;let L={},N={},F={},D=(e,t,r,n)=>{if(!t.materials)return null;for(let i=0,a=t.materials.length;i<a;i++){let a=t.materials[i];if(e(a))return{parsedMaterial:a,material:c.F.Parse(a,r,n)}}return null},B=(e,t,r)=>{for(let n in t)if(e.name===t[n])return r.push(e.id),!0;return void 0!==e.parentId&&-1!==r.indexOf(e.parentId)&&(r.push(e.id),!0)},k=(e,t)=>e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown"),G=(e,t)=>{if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){let r=t._waitingData.lods.ids,n=t.isEnabled(!1);if(t._waitingData.lods.distances){let i=t._waitingData.lods.distances;if(i.length>=r.length){let a=i.length>r.length?i[i.length-1]:0;t.setEnabled(!1);for(let n=0;n<r.length;n++){let a=r[n],s=e.getMeshById(a);null!=s&&t.addLODLevel(i[n],s)}a>0&&t.addLODLevel(a,null),!0===n&&t.setEnabled(!0)}else C.w1.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},U=(e,t,r)=>{if("number"!=typeof e){let n=r.getLastEntryById(e);return n&&null!=t?n.instances[parseInt(t)]:n}let n=L[e];return n&&null!=t?n.instances[parseInt(t)]:n},V=(e,t)=>"number"!=typeof e?t.getLastMaterialById(e,!0):N[e],H=(e,t,r,a,s=!1)=>{let m=new y.TJ(e),T="importScene has failed JSON parse";try{let n,a;var E=JSON.parse(t);T="";let s=g.n0.loggingLevel===g.n0.DETAILED_LOGGING;if(void 0!==E.environmentTexture&&null!==E.environmentTexture){let t=void 0===E.isPBR||E.isPBR;if(E.environmentTextureType&&"BABYLON.HDRCubeTexture"===E.environmentTextureType){let n=E.environmentTextureSize?E.environmentTextureSize:128,i=new f.e((E.environmentTexture.match(/https?:\/\//g)?"":r)+E.environmentTexture,e,n,!0,!t,void 0,E.environmentTexturePrefilterOnLoad);E.environmentTextureRotationY&&(i.rotationY=E.environmentTextureRotationY),e.environmentTexture=i}else if("object"==typeof E.environmentTexture){let t=h.B.Parse(E.environmentTexture,e,r);e.environmentTexture=t}else if(E.environmentTexture.endsWith(".env")){let t=new h.B((E.environmentTexture.match(/https?:\/\//g)?"":r)+E.environmentTexture,e,E.environmentTextureForcedExtension);E.environmentTextureRotationY&&(t.rotationY=E.environmentTextureRotationY),e.environmentTexture=t}else{let t=h.B.CreateFromPrefilteredData((E.environmentTexture.match(/https?:\/\//g)?"":r)+E.environmentTexture,e,E.environmentTextureForcedExtension);E.environmentTextureRotationY&&(t.rotationY=E.environmentTextureRotationY),e.environmentTexture=t}if(!0===E.createDefaultSkybox){let r=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,n=E.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,t,r,n)}m.environmentTexture=e.environmentTexture}if(void 0!==E.environmentIntensity&&null!==E.environmentIntensity&&(e.environmentIntensity=E.environmentIntensity),void 0!==E.iblIntensity&&null!==E.iblIntensity&&(e.iblIntensity=E.iblIntensity),void 0!==E.lights&&null!==E.lights)for(n=0,a=E.lights.length;n<a;n++){let t=E.lights[n],r=_._.Parse(t,e);r&&(L[t.uniqueId]=r,m.lights.push(r),r._parentContainer=m,T+=(0===n?"\n	Lights:":"")+"\n		"+r.toString(s))}if(void 0!==E.reflectionProbes&&null!==E.reflectionProbes)for(n=0,a=E.reflectionProbes.length;n<a;n++){let t=E.reflectionProbes[n],i=S.x.Parse(t,e,r);i&&(m.reflectionProbes.push(i),i._parentContainer=m,T+=(0===n?"\n	Reflection Probes:":"")+"\n		"+i.toString(s))}if(void 0!==E.animations&&null!==E.animations)for(n=0,a=E.animations.length;n<a;n++){let t=E.animations[n],r=(0,I.qw)("BABYLON.Animation");if(r){let i=r.Parse(t);e.animations.push(i),m.animations.push(i),T+=(0===n?"\n	Animations:":"")+"\n		"+i.toString(s)}}if(void 0!==E.materials&&null!==E.materials)for(n=0,a=E.materials.length;n<a;n++){let t=E.materials[n],i=c.F.Parse(t,e,r);if(i)for(let e of(N[t.uniqueId||t.id]=i,m.materials.push(i),i._parentContainer=m,T+=(0===n?"\n	Materials:":"")+"\n		"+i.toString(s),i.getActiveTextures()))-1==m.textures.indexOf(e)&&(m.textures.push(e),e._parentContainer=m)}if(void 0!==E.multiMaterials&&null!==E.multiMaterials)for(n=0,a=E.multiMaterials.length;n<a;n++){let t=E.multiMaterials[n],r=d.G.ParseMultiMaterial(t,e);for(let e of(N[t.uniqueId||t.id]=r,m.multiMaterials.push(r),r._parentContainer=m,T+=(0===n?"\n	MultiMaterials:":"")+"\n		"+r.toString(s),r.getActiveTextures()))-1==m.textures.indexOf(e)&&(m.textures.push(e),e._parentContainer=m)}if(void 0!==E.morphTargetManagers&&null!==E.morphTargetManagers)for(let t of E.morphTargetManagers){let r=x.O.Parse(t,e);F[t.id]=r,m.morphTargetManagers.push(r),r._parentContainer=m}if(void 0!==E.skeletons&&null!==E.skeletons)for(n=0,a=E.skeletons.length;n<a;n++){let t=E.skeletons[n],r=b.O.Parse(t,e);m.skeletons.push(r),r._parentContainer=m,T+=(0===n?"\n	Skeletons:":"")+"\n		"+r.toString(s)}let y=E.geometries;if(null!=y){let t=[],i=y.vertexData;if(null!=i)for(n=0,a=i.length;n<a;n++){let a=i[n];t.push(l.Z.Parse(a,e,r))}for(let e of t)e&&(m.geometries.push(e),e._parentContainer=m)}if(void 0!==E.transformNodes&&null!==E.transformNodes)for(n=0,a=E.transformNodes.length;n<a;n++){let t=E.transformNodes[n],i=u.Y.Parse(t,e,r);L[t.uniqueId]=i,m.transformNodes.push(i),i._parentContainer=m}if(void 0!==E.meshes&&null!==E.meshes)for(n=0,a=E.meshes.length;n<a;n++){let t=E.meshes[n],i=o.Kj.Parse(t,e,r);if(L[t.uniqueId]=i,m.meshes.push(i),i._parentContainer=m,i.hasInstances)for(let e of i.instances)m.meshes.push(e),e._parentContainer=m;T+=(0===n?"\n	Meshes:":"")+"\n		"+i.toString(s)}if(void 0!==E.cameras&&null!==E.cameras)for(n=0,a=E.cameras.length;n<a;n++){let t=E.cameras[n],r=i.V.Parse(t,e);L[t.uniqueId]=r,m.cameras.push(r),r._parentContainer=m,T+=(0===n?"\n	Cameras:":"")+"\n		"+r.toString(s)}if(void 0!==E.postProcesses&&null!==E.postProcesses)for(n=0,a=E.postProcesses.length;n<a;n++){let t=E.postProcesses[n],i=P.D.Parse(t,e,r);i&&(m.postProcesses.push(i),i._parentContainer=m,T+=(0===n?"\nPostprocesses:":"")+"\n		"+i.toString())}if(void 0!==E.animationGroups&&null!==E.animationGroups)for(n=0,a=E.animationGroups.length;n<a;n++){let t=E.animationGroups[n],r=p.AnimationGroup.Parse(t,e);m.animationGroups.push(r),r._parentContainer=m,T+=(0===n?"\n	AnimationGroups:":"")+"\n		"+r.toString(s)}if(E.spriteManagers)for(let t=0,n=E.spriteManagers.length;t<n;t++){let n=E.spriteManagers[t],i=R.Z.Parse(n,e,r);T+="\n		SpriteManager "+i.name}for(n=0,a=e.cameras.length;n<a;n++){let t=e.cameras[n];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(n=0,a=e.lights.length;n<a;n++){let t=e.lights[n];t&&null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(n=0,a=e.transformNodes.length;n<a;n++){let t=e.transformNodes[n];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(n=0,a=e.meshes.length;n<a;n++){let t=e.meshes[n];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null),t._waitingData.lods&&G(e,t)}for(let t of e.multiMaterials){for(let r of t._waitingSubMaterialsUniqueIds)t.subMaterials.push(V(r,e));t._waitingSubMaterialsUniqueIds=[]}for(let t of e.meshes)null!==t._waitingMaterialId&&(t.material=V(t._waitingMaterialId,e),t._waitingMaterialId=null);for(let t of e.meshes)null!==t._waitingMorphTargetManagerId&&(t.morphTargetManager=F[t._waitingMorphTargetManagerId],t._waitingMorphTargetManagerId=null);for(n=0,a=e.skeletons.length;n<a;n++){let t=e.skeletons[n];if(t._hasWaitingData){if(null!=t.bones){for(let r of t.bones)if(r._waitingTransformNodeId){let t=e.getLastEntryById(r._waitingTransformNodeId);t&&r.linkTransformNode(t),r._waitingTransformNodeId=null}}t._hasWaitingData=null}}for(n=0,a=e.meshes.length;n<a;n++){let t=e.meshes[n];t._waitingData.freezeWorldMatrix?(t.freezeWorldMatrix(),t._waitingData.freezeWorldMatrix=null):t.computeWorldMatrix(!0)}for(n=0,a=e.lights.length;n<a;n++){let t=e.lights[n];if(t._excludedMeshesIds.length>0){for(let r=0;r<t._excludedMeshesIds.length;r++){let n=e.getMeshById(t._excludedMeshesIds[r]);n&&t.excludedMeshes.push(n)}t._excludedMeshesIds=[]}if(t._includedOnlyMeshesIds.length>0){for(let r=0;r<t._includedOnlyMeshesIds.length;r++){let n=e.getMeshById(t._includedOnlyMeshesIds[r]);n&&t.includedOnlyMeshes.push(n)}t._includedOnlyMeshesIds=[]}}for(let t of e.geometries)t._loadedUniqueId="";for((0,w.Ze)(E,e,m,r),n=0,a=e.meshes.length;n<a;n++){let t=e.meshes[n];t._waitingData.actions&&(v.k.Parse(t._waitingData.actions,t,e),t._waitingData.actions=null)}void 0!==E.actions&&null!==E.actions&&v.k.Parse(E.actions,null,e)}catch(t){let e=k("loadAssets",E?E.producer:"Unknown")+T;if(a)a(e,t);else throw n.Y.Log(e),t}finally{L={},N={},F={},s||m.removeAllFromScene(),null!==T&&g.n0.loggingLevel!==g.n0.NO_LOGGING&&n.Y.Log(k("loadAssets",E?E.producer:"Unknown")+(g.n0.loggingLevel!==g.n0.MINIMAL_LOGGING?T:""))}return m};g.n0.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:e=>-1!==e.indexOf("babylon"),importMesh:(e,t,r,i,a,s,c,h)=>{let f="importMesh has failed JSON parse";try{var p=JSON.parse(r);f="";let h=g.n0.loggingLevel===g.n0.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;let _=[],y=new Map,v=[];if(void 0!==p.transformNodes&&null!==p.transformNodes)for(let e=0,r=p.transformNodes.length;e<r;e++){let r=p.transformNodes[e],n=u.Y.Parse(r,t,i);v.push(n),y.set(n._waitingParsedUniqueId,n),n._waitingParsedUniqueId=null}if(void 0!==p.meshes&&null!==p.meshes){let r,s=[],u=[],m=[],g=[];for(let r=0,v=p.meshes.length;r<v;r++){let v=p.meshes[r];if(null===e||B(v,e,_)){if(null!==e&&delete e[e.indexOf(v.name)],void 0!==v.geometryId&&null!==v.geometryId&&void 0!==p.geometries&&null!==p.geometries){let e=!1;for(let r of["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"])if(p.geometries[r]&&Array.isArray(p.geometries[r])){for(let n of p.geometries[r])if(n.id===v.geometryId){"vertexData"===r&&l.Z.Parse(n,t,i),e=!0;break}if(e)break}!1===e&&n.Y.Warn("Geometry not found for mesh "+v.id)}if(v.materialUniqueId||v.materialId){let e=v.materialUniqueId?m:u,r=-1!==e.indexOf(v.materialUniqueId||v.materialId);if(!1===r&&void 0!==p.multiMaterials&&null!==p.multiMaterials){let n=(r,n)=>{e.push(r);let a=D(n,p,t,i);a&&a.material&&(N[a.parsedMaterial.uniqueId||a.parsedMaterial.id]=a.material,f+="\n	Material "+a.material.toString(h))};for(let i=0,a=p.multiMaterials.length;i<a;i++){let a=p.multiMaterials[i];if(v.materialUniqueId&&a.uniqueId===v.materialUniqueId||a.id===v.materialId){if(a.materialsUniqueIds)for(let e of a.materialsUniqueIds)n(e,t=>t.uniqueId===e);else for(let e of a.materials)n(e,t=>t.id===e);e.push(a.uniqueId||a.id);let i=d.G.ParseMultiMaterial(a,t);N[a.uniqueId||a.id]=i,i&&(r=!0,f+="\n	Multi-Material "+i.toString(h));break}}}if(!1===r){e.push(v.materialUniqueId||v.materialId);let r=D(e=>v.materialUniqueId&&e.uniqueId===v.materialUniqueId||e.id===v.materialId,p,t,i);r&&r.material?(N[r.parsedMaterial.uniqueId||r.parsedMaterial.id]=r.material,f+="\n	Material "+r.material.toString(h)):n.Y.Warn("Material not found for mesh "+v.id)}}if(null!==v.skeletonId&&void 0!==v.skeletonId&&-1!==p.skeletonId&&void 0!==p.skeletons&&null!==p.skeletons&&!(s.indexOf(v.skeletonId)>-1))for(let e=0,r=p.skeletons.length;e<r;e++){let r=p.skeletons[e];if(r.id===v.skeletonId){let e=b.O.Parse(r,t);c.push(e),s.push(r.id),f+="\n	Skeleton "+e.toString(h)}}if(v.morphTargetManagerId>-1&&void 0!==p.morphTargetManagers&&null!==p.morphTargetManagers&&!(g.indexOf(v.morphTargetManagerId)>-1))for(let e=0;e<p.morphTargetManagers.length;e++){let r=p.morphTargetManagers[e];if(r.id===v.morphTargetManagerId){let e=x.O.Parse(r,t);F[r.id]=e,g.push(r.id),f+="\nMorph target manager"+e.toString()}}let r=o.Kj.Parse(v,t,i);a.push(r),y.set(r._waitingParsedUniqueId,r),r._waitingParsedUniqueId=null,f+="\n	Mesh "+r.toString(h)}}for(let e of t.multiMaterials){for(let r of e._waitingSubMaterialsUniqueIds)e.subMaterials.push(V(r,t));e._waitingSubMaterialsUniqueIds=[]}for(let e of t.meshes)null!==e._waitingMaterialId&&(e.material=V(e._waitingMaterialId,t),e._waitingMaterialId=null);for(let e of t.meshes)null!==e._waitingMorphTargetManagerId&&(e.morphTargetManager=F[e._waitingMorphTargetManagerId],e._waitingMorphTargetManagerId=null);for(let e=0,r=t.transformNodes.length;e<r;e++){let r=t.transformNodes[e];if(null!==r._waitingParentId){let e=y.get(parseInt(r._waitingParentId))||null;null===e&&(e=t.getLastEntryById(r._waitingParentId));let n=e;r._waitingParentInstanceIndex&&(n=e.instances[parseInt(r._waitingParentInstanceIndex)],r._waitingParentInstanceIndex=null),r.parent=n,r._waitingParentId=null}}for(let e=0,n=t.meshes.length;e<n;e++){if((r=t.meshes[e])._waitingParentId){let e=y.get(parseInt(r._waitingParentId))||null;null===e&&(e=t.getLastEntryById(r._waitingParentId));let n=e;r._waitingParentInstanceIndex&&(n=e.instances[parseInt(r._waitingParentInstanceIndex)],r._waitingParentInstanceIndex=null),r.parent=n,r._waitingParentId=null}r._waitingData.lods&&G(t,r)}for(let e of v)e.getChildMeshes(!1).length||e.dispose();for(let e=0,r=t.skeletons.length;e<r;e++){let r=t.skeletons[e];if(r._hasWaitingData){if(null!=r.bones){for(let e of r.bones)if(e._waitingTransformNodeId){let r=t.getLastEntryById(e._waitingTransformNodeId);r&&e.linkTransformNode(r),e._waitingTransformNodeId=null}}r._hasWaitingData=null}}for(let e=0,n=t.meshes.length;e<n;e++)(r=t.meshes[e])._waitingData.freezeWorldMatrix?(r.freezeWorldMatrix(),r._waitingData.freezeWorldMatrix=null):r.computeWorldMatrix(!0)}if(void 0!==p.particleSystems&&null!==p.particleSystems){let e=(0,w.t)(m.l.NAME_PARTICLESYSTEM);if(e)for(let r=0,n=p.particleSystems.length;r<n;r++){let n=p.particleSystems[r];-1!==_.indexOf(n.emitterId)&&s.push(e(n,t,i))}}for(let e of t.geometries)e._loadedUniqueId="";return!0}catch(t){let e=k("importMesh",p?p.producer:"Unknown")+f;if(h)h(e,t);else throw n.Y.Log(e),t}finally{null!==f&&g.n0.loggingLevel!==g.n0.NO_LOGGING&&n.Y.Log(k("importMesh",p?p.producer:"Unknown")+(g.n0.loggingLevel!==g.n0.MINIMAL_LOGGING?f:"")),N={},F={}}return!1},load:(e,t,r,i)=>{let o="importScene has failed JSON parse";try{var l=JSON.parse(t);switch(o="",void 0!==l.useDelayedTextureLoading&&null!==l.useDelayedTextureLoading&&(e.useDelayedTextureLoading=l.useDelayedTextureLoading&&!g.n0.ForceFullSceneLoadingForIncremental),void 0!==l.autoClear&&null!==l.autoClear&&(e.autoClear=l.autoClear),void 0!==l.clearColor&&null!==l.clearColor&&(e.clearColor=s.HE.FromArray(l.clearColor)),void 0!==l.ambientColor&&null!==l.ambientColor&&(e.ambientColor=s.Wo.FromArray(l.ambientColor)),void 0!==l.gravity&&null!==l.gravity&&(e.gravity=a.P.FromArray(l.gravity)),void 0!==l.useRightHandedSystem&&(e.useRightHandedSystem=!!l.useRightHandedSystem),void 0!==l.fogMode&&null!==l.fogMode&&(e.fogMode=l.fogMode),void 0!==l.fogColor&&null!==l.fogColor&&(e.fogColor=s.Wo.FromArray(l.fogColor)),void 0!==l.fogStart&&null!==l.fogStart&&(e.fogStart=l.fogStart),void 0!==l.fogEnd&&null!==l.fogEnd&&(e.fogEnd=l.fogEnd),void 0!==l.fogDensity&&null!==l.fogDensity&&(e.fogDensity=l.fogDensity),o+="	Fog mode for scene:  ",e.fogMode){case 0:o+="none\n";break;case 1:o+="exp\n";break;case 2:o+="exp2\n";break;case 3:o+="linear\n"}if(l.physicsEnabled){let t;"cannon"===l.physicsEngine||l.physicsEngine===T.s.name?t=new T.s(void 0,void 0,O.LoaderInjectedPhysicsEngine):"oimo"===l.physicsEngine||l.physicsEngine===E.A.name?t=new E.A(void 0,O.LoaderInjectedPhysicsEngine):("ammo"===l.physicsEngine||l.physicsEngine===A.b.name)&&(t=new A.b(void 0,O.LoaderInjectedPhysicsEngine,void 0)),o="	Physics engine "+(l.physicsEngine?l.physicsEngine:"oimo")+" enabled\n";let r=l.gravity?a.P.FromArray(l.gravity):l.physicsGravity?a.P.FromArray(l.physicsGravity):null;e.enablePhysics(r,t)}if(void 0!==l.metadata&&null!==l.metadata&&(e.metadata=l.metadata),void 0!==l.collisionsEnabled&&null!==l.collisionsEnabled&&(e.collisionsEnabled=l.collisionsEnabled),!H(e,t,r,i,!0))return!1;return l.autoAnimate&&e.beginAnimation(e,l.autoAnimateFrom,l.autoAnimateTo,l.autoAnimateLoop,l.autoAnimateSpeed||1),void 0!==l.activeCameraID&&null!==l.activeCameraID&&e.setActiveCameraById(l.activeCameraID),!0}catch(t){let e=k("importScene",l?l.producer:"Unknown")+o;if(i)i(e,t);else throw n.Y.Log(e),t}finally{null!==o&&g.n0.loggingLevel!==g.n0.NO_LOGGING&&n.Y.Log(k("importScene",l?l.producer:"Unknown")+(g.n0.loggingLevel!==g.n0.MINIMAL_LOGGING?o:""))}return!1},loadAssetContainer:(e,t,r,n)=>H(e,t,r,n)})},7299:function(e,t,r){var n=r(66755);r(33414),r(76438),r(74959),r(75522),r(99046),r(1629),r(9858),r(20536),r(5929),r(4194);let i="volumetricLightScatteringPassVertexShader",a=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
uniform mat4 viewProjection;uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV2)
vec2 uv2Updated=uv2;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2Updated,1.0,0.0));
#endif
#endif
}
`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a)},73207:function(e,t,r){r.r(t),r.d(t,{FlowGraphGLTFDataProvider:()=>a});var n=r(31700),i=r(82753);class a extends n.A{constructor(e){super();let t=e.glTF,r=t.animations?.map(e=>e._babylonAnimationGroup)||[];this.animationGroups=this.registerDataOutput("animationGroups",i.s8,r);let n=t.nodes?.map(e=>e._babylonTransformNode)||[];this.nodes=this.registerDataOutput("nodes",i.s8,n)}getClassName(){return"FlowGraphGLTFDataProvider"}}},73248:function(e,t,r){r.r(t),r.d(t,{gaussianSplattingVertexShader:()=>c});var n=r(66755);r(72227),r(28564),r(36180);let i="gaussianSplattingUboDeclaration",a=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
attribute vec2 position;`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a),r(16397),r(94838),r(56283),r(95277);let s="gaussianSplatting",o=`#if !defined(WEBGL2) && !defined(WEBGPU) && !defined(NATIVE)
mat3 transpose(mat3 matrix) {return mat3(matrix[0][0],matrix[1][0],matrix[2][0],
matrix[0][1],matrix[1][1],matrix[2][1],
matrix[0][2],matrix[1][2],matrix[2][2]);}
#endif
vec2 getDataUV(float index,vec2 textureSize) {float y=floor(index/textureSize.x);float x=index-y*textureSize.x;return vec2((x+0.5)/textureSize.x,(y+0.5)/textureSize.y);}
#if SH_DEGREE>0
ivec2 getDataUVint(float index,vec2 textureSize) {float y=floor(index/textureSize.x);float x=index-y*textureSize.x;return ivec2(uint(x+0.5),uint(y+0.5));}
#endif
struct Splat {vec4 center;vec4 color;vec4 covA;vec4 covB;
#if SH_DEGREE>0
uvec4 sh0; 
#endif
#if SH_DEGREE>1
uvec4 sh1;
#endif
#if SH_DEGREE>2
uvec4 sh2;
#endif
};Splat readSplat(float splatIndex)
{Splat splat;vec2 splatUV=getDataUV(splatIndex,dataTextureSize);splat.center=texture2D(centersTexture,splatUV);splat.color=texture2D(colorsTexture,splatUV);splat.covA=texture2D(covariancesATexture,splatUV)*splat.center.w;splat.covB=texture2D(covariancesBTexture,splatUV)*splat.center.w;
#if SH_DEGREE>0
ivec2 splatUVint=getDataUVint(splatIndex,dataTextureSize);splat.sh0=texelFetch(shTexture0,splatUVint,0);
#endif
#if SH_DEGREE>1
splat.sh1=texelFetch(shTexture1,splatUVint,0);
#endif
#if SH_DEGREE>2
splat.sh2=texelFetch(shTexture2,splatUVint,0);
#endif
return splat;}
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
vec3 computeColorFromSHDegree(vec3 dir,const vec3 sh[16])
{const float SH_C0=0.28209479;const float SH_C1=0.48860251;float SH_C2[5];SH_C2[0]=1.092548430;SH_C2[1]=-1.09254843;SH_C2[2]=0.315391565;SH_C2[3]=-1.09254843;SH_C2[4]=0.546274215;float SH_C3[7];SH_C3[0]=-0.59004358;SH_C3[1]=2.890611442;SH_C3[2]=-0.45704579;SH_C3[3]=0.373176332;SH_C3[4]=-0.45704579;SH_C3[5]=1.445305721;SH_C3[6]=-0.59004358;vec3 result=/*SH_C0**/sh[0];
#if SH_DEGREE>0
float x=dir.x;float y=dir.y;float z=dir.z;result+=- SH_C1*y*sh[1]+SH_C1*z*sh[2]-SH_C1*x*sh[3];
#if SH_DEGREE>1
float xx=x*x,yy=y*y,zz=z*z;float xy=x*y,yz=y*z,xz=x*z;result+=
SH_C2[0]*xy*sh[4] +
SH_C2[1]*yz*sh[5] +
SH_C2[2]*(2.0*zz-xx-yy)*sh[6] +
SH_C2[3]*xz*sh[7] +
SH_C2[4]*(xx-yy)*sh[8];
#if SH_DEGREE>2
result+=
SH_C3[0]*y*(3.0*xx-yy)*sh[9] +
SH_C3[1]*xy*z*sh[10] +
SH_C3[2]*y*(4.0*zz-xx-yy)*sh[11] +
SH_C3[3]*z*(2.0*zz-3.0*xx-3.0*yy)*sh[12] +
SH_C3[4]*x*(4.0*zz-xx-yy)*sh[13] +
SH_C3[5]*z*(xx-yy)*sh[14] +
SH_C3[6]*x*(xx-3.0*yy)*sh[15];
#endif
#endif
#endif
return result;}
vec4 decompose(uint value)
{vec4 components=vec4(
float((value ) & 255u),
float((value>>uint( 8)) & 255u),
float((value>>uint(16)) & 255u),
float((value>>uint(24)) & 255u));return components*vec4(2./255.)-vec4(1.);}
vec3 computeSH(Splat splat,vec3 dir)
{vec3 sh[16];sh[0]=vec3(0.,0.,0.);
#if SH_DEGREE>0
vec4 sh00=decompose(splat.sh0.x);vec4 sh01=decompose(splat.sh0.y);vec4 sh02=decompose(splat.sh0.z);sh[1]=vec3(sh00.x,sh00.y,sh00.z);sh[2]=vec3(sh00.w,sh01.x,sh01.y);sh[3]=vec3(sh01.z,sh01.w,sh02.x);
#endif
#if SH_DEGREE>1
vec4 sh03=decompose(splat.sh0.w);vec4 sh04=decompose(splat.sh1.x);vec4 sh05=decompose(splat.sh1.y);sh[4]=vec3(sh02.y,sh02.z,sh02.w);sh[5]=vec3(sh03.x,sh03.y,sh03.z);sh[6]=vec3(sh03.w,sh04.x,sh04.y);sh[7]=vec3(sh04.z,sh04.w,sh05.x);sh[8]=vec3(sh05.y,sh05.z,sh05.w);
#endif
#if SH_DEGREE>2
vec4 sh06=decompose(splat.sh1.z);vec4 sh07=decompose(splat.sh1.w);vec4 sh08=decompose(splat.sh2.x);vec4 sh09=decompose(splat.sh2.y);vec4 sh10=decompose(splat.sh2.z);vec4 sh11=decompose(splat.sh2.w);sh[9]=vec3(sh06.x,sh06.y,sh06.z);sh[10]=vec3(sh06.w,sh07.x,sh07.y);sh[11]=vec3(sh07.z,sh07.w,sh08.x);sh[12]=vec3(sh08.y,sh08.z,sh08.w);sh[13]=vec3(sh09.x,sh09.y,sh09.z);sh[14]=vec3(sh09.w,sh10.x,sh10.y);sh[15]=vec3(sh10.z,sh10.w,sh11.x); 
#endif
return computeColorFromSHDegree(dir,sh);}
#else
vec3 computeSH(Splat splat,vec3 dir)
{return vec3(0.,0.,0.);}
#endif
vec4 gaussianSplatting(vec2 meshPos,vec3 worldPos,vec2 scale,vec3 covA,vec3 covB,mat4 worldMatrix,mat4 viewMatrix,mat4 projectionMatrix)
{mat4 modelView=viewMatrix*worldMatrix;vec4 camspace=viewMatrix*vec4(worldPos,1.);vec4 pos2d=projectionMatrix*camspace;float bounds=1.2*pos2d.w;if (pos2d.z<-pos2d.w || pos2d.x<-bounds || pos2d.x>bounds
|| pos2d.y<-bounds || pos2d.y>bounds) {return vec4(0.0,0.0,2.0,1.0);}
mat3 Vrk=mat3(
covA.x,covA.y,covA.z,
covA.y,covB.x,covB.y,
covA.z,covB.y,covB.z
);mat3 J=mat3(
focal.x/camspace.z,0.,-(focal.x*camspace.x)/(camspace.z*camspace.z),
0.,focal.y/camspace.z,-(focal.y*camspace.y)/(camspace.z*camspace.z),
0.,0.,0.
);mat3 invy=mat3(1,0,0,0,-1,0,0,0,1);mat3 T=invy*transpose(mat3(modelView))*J;mat3 cov2d=transpose(T)*Vrk*T;
#if COMPENSATION
float c00=cov2d[0][0];float c11=cov2d[1][1];float c01=cov2d[0][1];float detOrig=c00*c11-c01*c01;
#endif
cov2d[0][0]+=kernelSize;cov2d[1][1]+=kernelSize;
#if COMPENSATION
vec3 c2d=vec3(cov2d[0][0],c01,cov2d[1][1]);float detBlur=c2d.x*c2d.z-c2d.y*c2d.y;float compensation=sqrt(max(0.,detOrig/detBlur));vColor.w*=compensation;
#endif
float mid=(cov2d[0][0]+cov2d[1][1])/2.0;float radius=length(vec2((cov2d[0][0]-cov2d[1][1])/2.0,cov2d[0][1]));float epsilon=0.0001;float lambda1=mid+radius+epsilon,lambda2=mid-radius+epsilon;if (lambda2<0.0)
{return vec4(0.0,0.0,2.0,1.0);}
vec2 diagonalVector=normalize(vec2(cov2d[0][1],lambda1-cov2d[0][0]));vec2 majorAxis=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;vec2 minorAxis=min(sqrt(2.0*lambda2),1024.0)*vec2(diagonalVector.y,-diagonalVector.x);vec2 vCenter=vec2(pos2d);return vec4(
vCenter 
+ ((meshPos.x*majorAxis
+ meshPos.y*minorAxis)*invViewport*pos2d.w)*scale,pos2d.zw);}`;n.v.IncludesShadersStore[s]||(n.v.IncludesShadersStore[s]=o),r(20995),r(5242),r(45133);let l="gaussianSplattingVertexShader",u=`#include<__decl__gaussianSplattingVertex>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
#include<helperFunctions>
attribute float splatIndex;uniform vec2 invViewport;uniform vec2 dataTextureSize;uniform vec2 focal;uniform float kernelSize;uniform vec3 eyePosition;uniform sampler2D covariancesATexture;uniform sampler2D covariancesBTexture;uniform sampler2D centersTexture;uniform sampler2D colorsTexture;
#if SH_DEGREE>0
uniform highp usampler2D shTexture0;
#endif
#if SH_DEGREE>1
uniform highp usampler2D shTexture1;
#endif
#if SH_DEGREE>2
uniform highp usampler2D shTexture2;
#endif
varying vec4 vColor;varying vec2 vPosition;
#include<gaussianSplatting>
void main () {Splat splat=readSplat(splatIndex);vec3 covA=splat.covA.xyz;vec3 covB=vec3(splat.covA.w,splat.covB.xy);vec4 worldPos=world*vec4(splat.center.xyz,1.0);vColor=splat.color;vPosition=position;
#if SH_DEGREE>0
mat3 worldRot=mat3(world);mat3 normWorldRot=inverseMat3(worldRot);vec3 dir=normalize(normWorldRot*(worldPos.xyz-eyePosition));dir*=vec3(1.,1.,-1.); 
vColor.xyz=splat.color.xyz+computeSH(splat,dir);
#endif
gl_Position=gaussianSplatting(position,worldPos.xyz,vec2(1.,1.),covA,covB,world,view,projection);
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
}
`;n.v.ShadersStore[l]||(n.v.ShadersStore[l]=u);let c={name:l,shader:u}},7473:function(e,t,r){r.r(t),r.d(t,{colorPixelShader:()=>s});var n=r(66755);r(63647),r(72297),r(36986),r(1241);let i="colorPixelShader",a=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
#define VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
#include<fogFragment>(color,gl_FragColor)
#define CUSTOM_FRAGMENT_MAIN_END
}`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a);let s={name:i,shader:a}},74828:function(e,t,r){var n=r(66755);let i="vertexColorMixing",a=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vertexOutputs.vColor=vec4f(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vertexOutputs.vColor*=vertexInputs.color;
#else
vertexOutputs.vColor=vec4f(vertexOutputs.vColor.rgb*vertexInputs.color.rgb,vertexOutputs.vColor.a);
#endif
#endif
#ifdef INSTANCESCOLOR
vertexOutputs.vColor*=vertexInputs.instanceColor;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},74959:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexGlobalDeclaration:()=>s});var n=r(66755);let i="morphTargetsVertexGlobalDeclaration",a=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#ifdef MORPHTARGETS_TEXTURE 
uniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}
vec4 readVector4FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV);}
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},75068:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexGlobalWGSL:()=>s});var n=r(66755);let i="morphTargetsVertexGlobal",a=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
var vertexID : f32;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},75208:function(e,t,r){let n={dpadUp:12,dpadDown:13,dpadLeft:14,dpadRight:15,L1:4,L2:6,L3:10,R1:5,R2:7,R3:11,A:0,B:1,X:2,Y:3,start:9,select:8,home:16},i=[];Object.keys(n).forEach(e=>{i[n[e]]=e});var a=r(96368),s=r(2043),o=r(44976),l=r(62083);let u=new Set(i);["leftStick","rightStick"].forEach(e=>u.add(e)),a.Z,s.Z,o.Z,l.Fh},75522:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertexDeclaration:()=>s});var n=r(66755);let i="morphTargetsVertexDeclaration",a=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
#ifdef MORPHTARGETS_POSITION
attribute vec3 position{X};
#endif
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#ifdef MORPHTARGETS_UV2
attribute vec2 uv2_{X};
#endif
#elif {X}==0
uniform int morphTargetCount;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},75552:function(e,t,r){r.d(t,{Ai:()=>A,Bg:()=>I,K7:()=>p,XI:()=>v,ZW:()=>S,a7:()=>c,dv:()=>T,kA:()=>_,mo:()=>x,oE:()=>h,pE:()=>E,yc:()=>f,z9:()=>b,zH:()=>d});var n=r(49087),i=r(61834),a=r(84865),s=r(67908),o=r(94826),l=r(65098),u=r(99372);let c={internalPickerForMesh:void 0};class d{constructor(e,t,r=Number.MAX_VALUE,i=n.kn){this.origin=e,this.direction=t,this.length=r,this.epsilon=i}clone(){return new d(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t,r=0){let n,i,a,s,o=d._TmpVector3[0].copyFromFloats(e.x-r,e.y-r,e.z-r),l=d._TmpVector3[1].copyFromFloats(t.x+r,t.y+r,t.z+r),u=0,c=Number.MAX_VALUE;if(1e-7>Math.abs(this.direction.x)){if(this.origin.x<o.x||this.origin.x>l.x)return!1}else if(n=1/this.direction.x,i=(o.x-this.origin.x)*n,(a=(l.x-this.origin.x)*n)==-1/0&&(a=1/0),i>a&&(s=i,i=a,a=s),(u=Math.max(i,u))>(c=Math.min(a,c)))return!1;if(1e-7>Math.abs(this.direction.y)){if(this.origin.y<o.y||this.origin.y>l.y)return!1}else if(n=1/this.direction.y,i=(o.y-this.origin.y)*n,(a=(l.y-this.origin.y)*n)==-1/0&&(a=1/0),i>a&&(s=i,i=a,a=s),(u=Math.max(i,u))>(c=Math.min(a,c)))return!1;if(1e-7>Math.abs(this.direction.z)){if(this.origin.z<o.z||this.origin.z>l.z)return!1}else if(n=1/this.direction.z,i=(o.z-this.origin.z)*n,(a=(l.z-this.origin.z)*n)==-1/0&&(a=1/0),i>a&&(s=i,i=a,a=s),(u=Math.max(i,u))>(c=Math.min(a,c)))return!1;return!0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e,t=0){let r=e.center.x-this.origin.x,n=e.center.y-this.origin.y,i=e.center.z-this.origin.z,a=r*r+n*n+i*i,s=e.radius+t,o=s*s;if(a<=o)return!0;let l=r*this.direction.x+n*this.direction.y+i*this.direction.z;return!(l<0)&&a-l*l<=o}intersectsTriangle(e,t,r){let n=d._TmpVector3[0],a=d._TmpVector3[1],o=d._TmpVector3[2],l=d._TmpVector3[3],u=d._TmpVector3[4];t.subtractToRef(e,n),r.subtractToRef(e,a),i.P.CrossToRef(this.direction,a,o);let c=i.P.Dot(n,o);if(0===c)return null;let h=1/c;this.origin.subtractToRef(e,l);let f=i.P.Dot(l,o)*h;if(f<-this.epsilon||f>1+this.epsilon)return null;i.P.CrossToRef(l,n,u);let p=i.P.Dot(this.direction,u)*h;if(p<-this.epsilon||f+p>1+this.epsilon)return null;let _=i.P.Dot(a,u)*h;return _>this.length?null:new s.c(1-f-p,f,_)}intersectsPlane(e){let t,r=i.P.Dot(e.normal,this.direction);if(999999997475243e-21>Math.abs(r))return null;{let n=i.P.Dot(e.normal,this.origin);if((t=(-e.d-n)/r)<0)if(t<-999999997475243e-21)return null;else return 0;return t}}intersectsAxis(e,t=0){switch(e){case"y":{let e=(this.origin.y-t)/this.direction.y;if(e>0)return null;return new i.P(this.origin.x+-(this.direction.x*e),t,this.origin.z+-(this.direction.z*e))}case"x":{let e=(this.origin.x-t)/this.direction.x;if(e>0)return null;return new i.P(t,this.origin.y+-(this.direction.y*e),this.origin.z+-(this.direction.z*e))}case"z":{let e=(this.origin.z-t)/this.direction.z;if(e>0)return null;return new i.P(this.origin.x+-(this.direction.x*e),this.origin.y+-(this.direction.y*e),t)}default:return null}}intersectsMesh(e,t,r,n=!1,a,s=!1){let o=i.jp.Matrix["0"];return e.getWorldMatrix().invertToRef(o),this._tmpRay?d.TransformToRef(this,o,this._tmpRay):this._tmpRay=d.Transform(this,o),e.intersects(this._tmpRay,t,r,n,a,s)}intersectsMeshes(e,t,r){r?r.length=0:r=[];for(let n=0;n<e.length;n++){let i=this.intersectsMesh(e[n],t);i.hit&&r.push(i)}return r.sort(this._comparePickingInfo),r}_comparePickingInfo(e,t){return e.distance<t.distance?-1:+(e.distance>t.distance)}intersectionSegment(e,t,r){let n=this.origin,a=i.jp.Vector3["0"],s=i.jp.Vector3["1"],o=i.jp.Vector3["2"],l=i.jp.Vector3["3"];t.subtractToRef(e,a),this.direction.scaleToRef(d._Rayl,o),n.addToRef(o,s),e.subtractToRef(n,l);let u=i.P.Dot(a,a),c=i.P.Dot(a,o),h=i.P.Dot(o,o),f=i.P.Dot(a,l),p=i.P.Dot(o,l),_=u*h-c*c,m,g=_,y,v=_;_<d._Smallnum?(m=0,g=1,y=p,v=h):(m=c*p-h*f,y=u*p-c*f,m<0?(m=0,y=p,v=h):m>g&&(m=g,y=p+c,v=h)),y<0?(y=0,0>-f?m=0:-f>u?m=g:(m=-f,g=u)):y>v&&(y=v,-f+c<0?m=0:-f+c>u?m=g:(m=-f+c,g=u));let b=Math.abs(m)<d._Smallnum?0:m/g,x=Math.abs(y)<d._Smallnum?0:y/v,T=i.jp.Vector3["4"];o.scaleToRef(x,T);let E=i.jp.Vector3["5"];a.scaleToRef(b,E),E.addInPlace(l);let A=i.jp.Vector3["6"];return(E.subtractToRef(T,A),x>0&&x<=this.length&&A.lengthSquared()<r*r)?E.length():-1}update(e,t,r,n,a,s,o,l=!1){if(l){d._RayDistant||(d._RayDistant=d.Zero()),d._RayDistant.unprojectRayToRef(e,t,r,n,i.y3.IdentityReadOnly,s,o);let l=i.jp.Matrix["0"];a.invertToRef(l),d.TransformToRef(d._RayDistant,l,this)}else this.unprojectRayToRef(e,t,r,n,a,s,o);return this}static Zero(){return new d(i.P.Zero(),i.P.Zero())}static CreateNew(e,t,r,n,i,a,s){return d.Zero().update(e,t,r,n,i,a,s)}static CreateNewFromTo(e,t,r=i.y3.IdentityReadOnly){let n=new d(new i.P(0,0,0),new i.P(0,0,0));return d.CreateFromToToRef(e,t,n,r)}static CreateFromToToRef(e,t,r,n=i.y3.IdentityReadOnly){r.origin.copyFrom(e);let a=t.subtractToRef(e,r.direction);return r.length=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),r.direction.normalize(),d.TransformToRef(r,n,r)}static Transform(e,t){let r=new d(new i.P(0,0,0),new i.P(0,0,0));return d.TransformToRef(e,t,r),r}static TransformToRef(e,t,r){i.P.TransformCoordinatesToRef(e.origin,t,r.origin),i.P.TransformNormalToRef(e.direction,t,r.direction),r.length=e.length,r.epsilon=e.epsilon;let n=r.direction,a=n.length();if(0!==a&&1!==a){let e=1/a;n.x*=e,n.y*=e,n.z*=e,r.length*=a}return r}unprojectRayToRef(e,t,r,n,a,s,o){let u=i.jp.Matrix["0"];a.multiplyToRef(s,u),u.multiplyToRef(o,u),u.invert();let c=l.l.LastCreatedEngine,d=i.jp.Vector3["0"];d.x=e/r*2-1,d.y=-(t/n*2-1),d.z=c?.useReverseDepthBuffer?1:c?.isNDCHalfZRange?0:-1;let h=i.jp.Vector3["1"].copyFromFloats(d.x,d.y,1-1e-8),f=i.jp.Vector3["2"],p=i.jp.Vector3["3"];i.P._UnprojectFromInvertedMatrixToRef(d,u,f),i.P._UnprojectFromInvertedMatrixToRef(h,u,p),this.origin.copyFrom(f),p.subtractToRef(f,this.direction),this.direction.normalize()}}function h(e,t,r,n,i,a=!1){let s=d.Zero();return f(e,t,r,n,s,i,a),s}function f(e,t,r,n,a,s,o=!1,l=!1){let u=e.getEngine();if(!s&&!(s=e.activeCamera))return e;let c=s.viewport,d=u.getRenderHeight(),{x:h,y:p,width:_,height:m}=c.toGlobal(u.getRenderWidth(),d),g=1/u.getHardwareScalingLevel();return t=t*g-h,r=r*g-(d-p-m),a.update(t,r,_,m,n||i.y3.IdentityReadOnly,o?i.y3.IdentityReadOnly:s.getViewMatrix(),s.getProjectionMatrix(),l),e}function p(e,t,r,n){let i=d.Zero();return _(e,t,r,i,n),i}function _(e,t,r,n,a){if(!o.p)return e;let s=e.getEngine();if(!a&&!(a=e.activeCamera))throw Error("Active camera not set");let l=a.viewport,u=s.getRenderHeight(),{x:c,y:d,width:h,height:f}=l.toGlobal(s.getRenderWidth(),u),p=i.y3.Identity(),_=1/s.getHardwareScalingLevel();return t=t*_-c,r=r*_-(u-d-f),n.update(t,r,h,f,p,p,a.getProjectionMatrix()),e}function m(e,t,r,n,i,a,s,o){let l=t(n,r.enableDistantPicking),u=r.intersects(l,i,s,a,n,o);return u&&u.hit&&(i||null==e||!(u.distance>=e.distance))?u:null}function g(e,t,r,n,a,s){let l=null,u=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),d=e.cameraToUseForPointers||e.activeCamera,h=c.internalPickerForMesh||m;for(let o=0;o<e.meshes.length;o++){let c=e.meshes[o];if(r){if(!r(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;let f=u&&c.isWorldMatrixCameraDependent(),p=c.computeWorldMatrix(f,d);if(c.hasThinInstances&&c.thinInstanceEnablePicking){let e=h(l,t,c,p,!0,!0,s);if(e){if(a)return e;let o=i.jp.Matrix["1"],u=c.thinInstanceGetWorldMatrices();for(let e=0;e<u.length;e++){if(r&&!r(c,e))continue;u[e].multiplyToRef(p,o);let i=h(l,t,c,o,n,a,s,!0);if(i&&((l=i).thinInstanceIndex=e,n))return l}}}else{let e=h(l,t,c,p,n,a,s);if(e&&(l=e,n))return l}}return l||new o.p}function y(e,t,r,n){if(!o.p)return null;let a=[],s=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),l=e.cameraToUseForPointers||e.activeCamera,u=c.internalPickerForMesh||m;for(let o=0;o<e.meshes.length;o++){let c=e.meshes[o];if(r){if(!r(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;let d=s&&c.isWorldMatrixCameraDependent(),h=c.computeWorldMatrix(d,l);if(c.hasThinInstances&&c.thinInstanceEnablePicking){if(u(null,t,c,h,!0,!0,n)){let e=i.jp.Matrix["1"],s=c.thinInstanceGetWorldMatrices();for(let i=0;i<s.length;i++){if(r&&!r(c,i))continue;s[i].multiplyToRef(h,e);let o=u(null,t,c,e,!1,!1,n,!0);o&&(o.thinInstanceIndex=i,a.push(o))}}}else{let e=u(null,t,c,h,!1,!1,n);e&&a.push(e)}}return a}function v(e,t,r,n,a,s){if(!o.p)return null;let l=g(e,n=>(e._tempPickingRay||(e._tempPickingRay=d.Zero()),f(e,t,r,n,e._tempPickingRay,s||null),e._tempPickingRay),n,a,!0);return l&&(l.ray=h(e,t,r,i.y3.Identity(),s||null)),l}function b(e,t,r,n,a,s,o,l=!1){let u=g(e,(n,i)=>(e._tempPickingRay||(e._tempPickingRay=d.Zero()),f(e,t,r,n,e._tempPickingRay,s||null,!1,i),e._tempPickingRay),n,a,!1,o);return u&&(u.ray=h(e,t,r,i.y3.Identity(),s||null)),u}function x(e,t,r,n,a){let s=g(e,r=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=i.y3.Identity()),r.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=d.Zero()),d.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform),r,n,!1,a);return s&&(s.ray=t),s}function T(e,t,r,n,i,a){return y(e,n=>h(e,t,r,n,i||null),n,a)}function E(e,t,r,n){return y(e,r=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=i.y3.Identity()),r.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=d.Zero()),d.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform),r,n)}function A(e,t=100,r,n){return S(e,new d(i.P.Zero(),i.P.Zero(),t),t,r,n)}function S(e,t,r=100,n,a){n||(n=e.getWorldMatrix()),t.length=r,a?t.origin.copyFrom(a):t.origin.copyFrom(e.position);let s=i.jp.Vector3["2"];s.set(0,0,e._scene.useRightHandedSystem?-1:1);let o=i.jp.Vector3["3"];return i.P.TransformNormalToRef(s,n,o),i.P.NormalizeToRef(o,t.direction),t}function I(e,t){t&&(t.prototype.getForwardRay=function(e=100,t,r){return S(this,new d(i.P.Zero(),i.P.Zero(),e),e,t,r)},t.prototype.getForwardRayToRef=function(e,t=100,r,n){return S(this,e,t,r,n)}),e&&(u.r._IsPickingAvailable=!0,e.prototype.createPickingRay=function(e,t,r,n,i=!1){return h(this,e,t,r,n,i)})}d._TmpVector3=(0,a.$G)(6,i.P.Zero),d._RayDistant=d.Zero(),d._Smallnum=1e-8,d._Rayl=1e9},76229:function(e,t,r){function n(){}function i(e){return null==e?n:function(){return this.querySelector(e)}}function a(){return[]}function s(e){return null==e?a:function(){return this.querySelectorAll(e)}}function o(e){return function(){return this.matches(e)}}function l(e){return function(t){return t.matches(e)}}r.d(t,{Nb1:()=>t7,Vaf:()=>tk,cJy:()=>function e(){var t,r,n=(r=(t=(function(){var e,t,r,n,i,a=0,s=1,o=tv,l=!1;function u(t){return null==t||isNaN(t*=1)?i:o(0===r?.5:(t=(n(t)-e)*r,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var r,n;return arguments.length?([r,n]=t,o=e(r,n),u):[o(0),o(1)]}}return u.domain=function(i){return arguments.length?([a,s]=i,e=n(a*=1),t=n(s*=1),r=e===t?0:1/(t-e),u):[a,s]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(o=e,u):o},u.range=c(function e(t,r){var n,i,a=typeof r;return null==r||"boolean"===a?te(r):("number"===a?eE:"string"===a?(i=eY(r))?(r=i,tr):ts:r instanceof eY?tr:r instanceof Date?function(e,t){var r=new Date;return e*=1,t*=1,function(n){return r.setTime(e*(1-n)+t*n),r}}:!ArrayBuffer.isView(n=r)||n instanceof DataView?Array.isArray(r)?function(t,r){var n,i=r?r.length:0,a=t?Math.min(i,t.length):0,s=Array(a),o=Array(i);for(n=0;n<a;++n)s[n]=e(t[n],r[n]);for(;n<i;++n)o[n]=r[n];return function(e){for(n=0;n<a;++n)o[n]=s[n](e);return o}}:"function"!=typeof r.valueOf&&"function"!=typeof r.toString||isNaN(r)?function(t,r){var n,i={},a={};for(n in(null===t||"object"!=typeof t)&&(t={}),(null===r||"object"!=typeof r)&&(r={}),r)n in t?i[n]=e(t[n],r[n]):a[n]=r[n];return function(e){for(n in i)a[n]=i[n](e);return a}}:eE:function(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}})(t,r)}),u.rangeRound=c(ty),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return n=i,e=i(a),t=i(s),r=e===t?0:1/(t-e),u}})()(tv)).domain,t.ticks=function(e){var t=r();return function(e,t,r){if(t*=1,e*=1,!((r*=1)>0))return[];if(e===t)return[e];let n=t<e,[i,a,s]=n?tA(t,e,r):tA(e,t,r);if(!(a>=i))return[];let o=a-i+1,l=Array(o);if(n)if(s<0)for(let e=0;e<o;++e)l[e]=-((a-e)/s);else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=-((i+e)/s);else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}(t[0],t[t.length-1],null==e?10:e)},t.tickFormat=function(e,t){var n=r();return function(e,t,r,n){var i,a,s,o=function(e,t,r){t*=1,e*=1,r*=1;let n=t<e,i=n?tS(t,e,r):tS(e,t,r);return(n?-1:1)*(i<0?-(1/i):i)}(e,t,r);switch((n=tC(null==n?",f":n)).type){case"s":var l=Math.max(Math.abs(e),Math.abs(t));return null!=n.precision||isNaN(s=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(tw(l)/3)))-tw(Math.abs(o))))||(n.precision=s),f(n,l);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(s=Math.max(0,tw(Math.abs(Math.max(Math.abs(e),Math.abs(t)))-(i=Math.abs(i=o)))-tw(i))+1)||(n.precision=s-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(s=Math.max(0,-tw(Math.abs(o))))||(n.precision=s-("%"===n.type)*2)}return h(n)}(n[0],n[n.length-1],null==e?10:e,t)},t.nice=function(e){null==e&&(e=10);var n,i,a=r(),s=0,o=a.length-1,l=a[s],u=a[o],c=10;for(u<l&&(i=l,l=u,u=i,i=s,s=o,o=i);c-- >0;){if((i=tS(l,u,e))===n)return a[s]=l,a[o]=u,r(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else if(i<0)l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i;else break;n=i}return t},t);return n.copy=function(){return e().domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())},tb.apply(n,arguments)},ve8:()=>rt});var u,c,d,h,f,p=Array.prototype.find;function _(){return this.firstElementChild}var m=Array.prototype.filter;function g(){return Array.from(this.children)}function y(e){return Array(e.length)}function v(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function b(e,t,r,n,i,a){for(var s,o=0,l=t.length,u=a.length;o<u;++o)(s=t[o])?(s.__data__=a[o],n[o]=s):r[o]=new v(e,a[o]);for(;o<l;++o)(s=t[o])&&(i[o]=s)}function x(e,t,r,n,i,a,s){var o,l,u,c=new Map,d=t.length,h=a.length,f=Array(d);for(o=0;o<d;++o)(l=t[o])&&(f[o]=u=s.call(l,l.__data__,o,t)+"",c.has(u)?i[o]=l:c.set(u,l));for(o=0;o<h;++o)u=s.call(e,a[o],o,a)+"",(l=c.get(u))?(n[o]=l,l.__data__=a[o],c.delete(u)):r[o]=new v(e,a[o]);for(o=0;o<d;++o)(l=t[o])&&c.get(f[o])===l&&(i[o]=l)}function T(e){return e.__data__}function E(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}v.prototype={constructor:v,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var A="http://www.w3.org/1999/xhtml";let S={svg:"http://www.w3.org/2000/svg",xhtml:A,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function I(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),S.hasOwnProperty(t)?{space:S[t],local:e}:e}function C(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function P(e,t){return e.style.getPropertyValue(t)||C(e).getComputedStyle(e,null).getPropertyValue(t)}function R(e){return e.trim().split(/^|\s+/)}function w(e){return e.classList||new M(e)}function M(e){this._node=e,this._names=R(e.getAttribute("class")||"")}function O(e,t){for(var r=w(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function L(e,t){for(var r=w(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function N(){this.textContent=""}function F(){this.innerHTML=""}function D(){this.nextSibling&&this.parentNode.appendChild(this)}function B(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function k(e){var t=I(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===A&&t.documentElement.namespaceURI===A?t.createElement(e):t.createElementNS(r,e)}})(t)}function G(){return null}function U(){var e=this.parentNode;e&&e.removeChild(this)}function V(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function H(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $(e){return function(){var t=this.__on;if(t){for(var r,n=0,i=-1,a=t.length;n<a;++n)(r=t[n],e.type&&r.type!==e.type||r.name!==e.name)?t[++i]=r:this.removeEventListener(r.type,r.listener,r.options);++i?t.length=i:delete this.__on}}}function W(e,t,r){return function(){var n,i=this.__on,a=function(e){t.call(this,e,this.__data__)};if(i){for(var s=0,o=i.length;s<o;++s)if((n=i[s]).type===e.type&&n.name===e.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=r),n.value=t;return}}this.addEventListener(e.type,a,r),n={type:e.type,name:e.name,value:t,listener:a,options:r},i?i.push(n):this.__on=[n]}}function j(e,t,r){var n=C(e),i=n.CustomEvent;"function"==typeof i?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}M.prototype={add:function(e){0>this._names.indexOf(e)&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var z=[null];function Y(e,t){this._groups=e,this._parents=t}function K(){return new Y([[document.documentElement]],z)}Y.prototype=K.prototype={constructor:Y,select:function(e){"function"!=typeof e&&(e=i(e));for(var t=this._groups,r=t.length,n=Array(r),a=0;a<r;++a)for(var s,o,l=t[a],u=l.length,c=n[a]=Array(u),d=0;d<u;++d)(s=l[d])&&(o=e.call(s,s.__data__,d,l))&&("__data__"in s&&(o.__data__=s.__data__),c[d]=o);return new Y(n,this._parents)},selectAll:function(e){if("function"==typeof e){var t;t=e,e=function(){var e;return e=t.apply(this,arguments),null==e?[]:Array.isArray(e)?e:Array.from(e)}}else e=s(e);for(var r=this._groups,n=r.length,i=[],a=[],o=0;o<n;++o)for(var l,u=r[o],c=u.length,d=0;d<c;++d)(l=u[d])&&(i.push(e.call(l,l.__data__,d,u)),a.push(l));return new Y(i,a)},selectChild:function(e){var t;return this.select(null==e?_:(t="function"==typeof e?e:l(e),function(){return p.call(this.children,t)}))},selectChildren:function(e){var t;return this.selectAll(null==e?g:(t="function"==typeof e?e:l(e),function(){return m.call(this.children,t)}))},filter:function(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,r=t.length,n=Array(r),i=0;i<r;++i)for(var a,s=t[i],l=s.length,u=n[i]=[],c=0;c<l;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&u.push(a);return new Y(n,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,T);var r=t?x:b,n=this._parents,i=this._groups;"function"!=typeof e&&(y=e,e=function(){return y});for(var a=i.length,s=Array(a),o=Array(a),l=Array(a),u=0;u<a;++u){var c=n[u],d=i[u],h=d.length,f="object"==typeof(g=e.call(c,c&&c.__data__,u,n))&&"length"in g?g:Array.from(g),p=f.length,_=o[u]=Array(p),m=s[u]=Array(p);r(c,d,_,m,l[u]=Array(h),f,t);for(var g,y,v,E,A=0,S=0;A<p;++A)if(v=_[A]){for(A>=S&&(S=A+1);!(E=m[S])&&++S<p;);v._next=E||null}}return(s=new Y(s,n))._enter=o,s._exit=l,s},enter:function(){return new Y(this._enter||this._groups.map(y),this._parents)},exit:function(){return new Y(this._exit||this._groups.map(y),this._parents)},join:function(e,t,r){var n=this.enter(),i=this,a=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==r?a.remove():r(a),n&&i?n.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,a=n.length,s=Math.min(i,a),o=Array(i),l=0;l<s;++l)for(var u,c=r[l],d=n[l],h=c.length,f=o[l]=Array(h),p=0;p<h;++p)(u=c[p]||d[p])&&(f[p]=u);for(;l<i;++l)o[l]=r[l];return new Y(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n,i=e[t],a=i.length-1,s=i[a];--a>=0;)(n=i[a])&&(s&&4^n.compareDocumentPosition(s)&&s.parentNode.insertBefore(n,s),s=n);return this},sort:function(e){function t(t,r){return t&&r?e(t.__data__,r.__data__):!t-!r}e||(e=E);for(var r=this._groups,n=r.length,i=Array(n),a=0;a<n;++a){for(var s,o=r[a],l=o.length,u=i[a]=Array(l),c=0;c<l;++c)(s=o[c])&&(u[c]=s);u.sort(t)}return new Y(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,a=n.length;i<a;++i){var s=n[i];if(s)return s}return null},size:function(){let e=0;for(let t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i,a=t[r],s=0,o=a.length;s<o;++s)(i=a[s])&&e.call(i,i.__data__,s,a);return this},attr:function(e,t){var r=I(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((null==t?r.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?r.local?function(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}:function(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttribute(e):this.setAttribute(e,r)}}:r.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(r,t))},style:function(e,t,r){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,r){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}:function(e,t,r){return function(){this.style.setProperty(e,t,r)}})(e,t,null==r?"":r)):P(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var r=t.apply(this,arguments);null==r?delete this[e]:this[e]=r}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var r=R(e+"");if(arguments.length<2){for(var n=w(this.node()),i=-1,a=r.length;++i<a;)if(!n.contains(r[i]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?O:L)(this,e)}}:t?function(e){return function(){O(this,e)}}:function(e){return function(){L(this,e)}})(r,t))},text:function(e){return arguments.length?this.each(null==e?N:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?F:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(D)},lower:function(){return this.each(B)},append:function(e){var t="function"==typeof e?e:k(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var r="function"==typeof e?e:k(e),n=null==t?G:"function"==typeof t?t:i(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(U)},clone:function(e){return this.select(e?H:V)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,r){var n,i,a=(e+"").trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}}),s=a.length;if(arguments.length<2){var o=this.node().__on;if(o){for(var l,u=0,c=o.length;u<c;++u)for(n=0,l=o[u];n<s;++n)if((i=a[n]).type===l.type&&i.name===l.name)return l.value}return}for(n=0,o=t?W:$;n<s;++n)this.each(o(a[n],t,r));return this},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return j(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return j(this,e,t)}})(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n,i=e[t],a=0,s=i.length;a<s;++a)(n=i[a])&&(yield n)}};var X={value:()=>{}};function Z(){for(var e,t=0,r=arguments.length,n={};t<r;++t){if(!(e=arguments[t]+"")||e in n||/[\s.]/.test(e))throw Error("illegal type: "+e);n[e]=[]}return new q(n)}function q(e){this._=e}function Q(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=X,e=e.slice(0,n).concat(e.slice(n+1));break}return null!=r&&e.push({name:t,value:r}),e}q.prototype=Z.prototype={constructor:q,on:function(e,t){var r,n=this._,i=(e+"").trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");if(r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),e&&!n.hasOwnProperty(e))throw Error("unknown type: "+e);return{type:e,name:t}}),a=-1,s=i.length;if(arguments.length<2){for(;++a<s;)if((r=(e=i[a]).type)&&(r=function(e,t){for(var r,n=0,i=e.length;n<i;++n)if((r=e[n]).name===t)return r.value}(n[r],e.name)))return r;return}if(null!=t&&"function"!=typeof t)throw Error("invalid callback: "+t);for(;++a<s;)if(r=(e=i[a]).type)n[r]=Q(n[r],e.name,t);else if(null==t)for(r in n)n[r]=Q(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new q(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,n,i=Array(r),a=0;a<r;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(n=this._[e],a=0,r=n.length;a<r;++a)n[a].value.apply(t,i)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(var n=this._[e],i=0,a=n.length;i<a;++i)n[i].value.apply(t,r)}};var J,ee,et=0,er=0,en=0,ei=0,ea=0,es=0,eo="object"==typeof performance&&performance.now?performance:Date,el="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eu(){return ea||(el(ec),ea=eo.now()+es)}function ec(){ea=0}function ed(){this._call=this._time=this._next=null}function eh(e,t,r){var n=new ed;return n.restart(e,t,r),n}function ef(){ea=(ei=eo.now())+es,et=er=0;try{eu(),++et;for(var e,t=J;t;)(e=ea-t._time)>=0&&t._call.call(void 0,e),t=t._next;--et}finally{et=0,function(){for(var e,t,r=J,n=1/0;r;)r._call?(n>r._time&&(n=r._time),e=r,r=r._next):(t=r._next,r._next=null,r=e?e._next=t:J=t);ee=e,e_(n)}(),ea=0}}function ep(){var e=eo.now(),t=e-ei;t>1e3&&(es-=t,ei=e)}function e_(e){!et&&(er&&(er=clearTimeout(er)),e-ea>24?(e<1/0&&(er=setTimeout(ef,e-eo.now()-es)),en&&(en=clearInterval(en))):(en||(ei=eo.now(),en=setInterval(ep,1e3)),et=1,el(ef)))}function em(e,t,r){var n=new ed;return t=null==t?0:+t,n.restart(r=>{n.stop(),e(r+t)},t,r),n}ed.prototype=eh.prototype={constructor:ed,restart:function(e,t,r){if("function"!=typeof e)throw TypeError("callback is not a function");r=(null==r?eu():+r)+(null==t?0:+t),this._next||ee===this||(ee?ee._next=this:J=this,ee=this),this._call=e,this._time=r,e_()},stop:function(){this._call&&(this._call=null,this._time=1/0,e_())}};var eg=Z("start","end","cancel","interrupt"),ey=[];function ev(e,t,r,n,i,a){var s=e.__transition;if(s){if(r in s)return}else e.__transition={};!function(e,t,r){var n,i=e.__transition;function a(l){var u,c,d,h;if(1!==r.state)return o();for(u in i)if((h=i[u]).name===r.name){if(3===h.state)return em(a);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[u]):+u<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[u])}if(em(function(){3===r.state&&(r.state=4,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=2,r.on.call("start",e,e.__data__,r.index,r.group),2===r.state){for(u=0,r.state=3,n=Array(d=r.tween.length),c=-1;u<d;++u)(h=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(n[++c]=h);n.length=c+1}}function s(t){for(var i=t<r.duration?r.ease.call(null,t/r.duration):(r.timer.restart(o),r.state=5,1),a=-1,s=n.length;++a<s;)n[a].call(e,i);5===r.state&&(r.on.call("end",e,e.__data__,r.index,r.group),o())}function o(){for(var n in r.state=6,r.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=r,r.timer=eh(function(e){r.state=1,r.timer.restart(a,r.delay,r.time),r.delay<=e&&a(e-r.delay)},0,r.time)}(e,r,{name:t,index:n,group:i,on:eg,tween:ey,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function eb(e,t){var r=eT(e,t);if(r.state>0)throw Error("too late; already scheduled");return r}function ex(e,t){var r=eT(e,t);if(r.state>3)throw Error("too late; already running");return r}function eT(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw Error("transition not found");return r}function eE(e,t){return e*=1,t*=1,function(r){return e*(1-r)+t*r}}var eA=180/Math.PI,eS={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eI(e,t,r,n,i,a){var s,o,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*r+t*n)&&(r-=e*l,n-=t*l),(o=Math.sqrt(r*r+n*n))&&(r/=o,n/=o,l/=o),e*n<t*r&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*eA,skewX:Math.atan(l)*eA,scaleX:s,scaleY:o}}function eC(e,t,r,n){function i(e){return e.length?e.pop()+" ":""}return function(a,s){var o,l,u,c,d=[],h=[];return a=e(a),s=e(s),!function(e,n,i,a,s,o){if(e!==i||n!==a){var l=s.push("translate(",null,t,null,r);o.push({i:l-4,x:eE(e,i)},{i:l-2,x:eE(n,a)})}else(i||a)&&s.push("translate("+i+t+a+r)}(a.translateX,a.translateY,s.translateX,s.translateY,d,h),o=a.rotate,l=s.rotate,o!==l?(o-l>180?l+=360:l-o>180&&(o+=360),h.push({i:d.push(i(d)+"rotate(",null,n)-2,x:eE(o,l)})):l&&d.push(i(d)+"rotate("+l+n),u=a.skewX,c=s.skewX,u!==c?h.push({i:d.push(i(d)+"skewX(",null,n)-2,x:eE(u,c)}):c&&d.push(i(d)+"skewX("+c+n),!function(e,t,r,n,a,s){if(e!==r||t!==n){var o=a.push(i(a)+"scale(",null,",",null,")");s.push({i:o-4,x:eE(e,r)},{i:o-2,x:eE(t,n)})}else(1!==r||1!==n)&&a.push(i(a)+"scale("+r+","+n+")")}(a.scaleX,a.scaleY,s.scaleX,s.scaleY,d,h),a=s=null,function(e){for(var t,r=-1,n=h.length;++r<n;)d[(t=h[r]).i]=t.x(e);return d.join("")}}}var eP=eC(function(e){let t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?eS:eI(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),eR=eC(function(e){return null==e?eS:(u||(u=document.createElementNS("http://www.w3.org/2000/svg","g")),u.setAttribute("transform",e),e=u.transform.baseVal.consolidate())?eI((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):eS},", ",")",")");function ew(e,t,r){var n=e._id;return e.each(function(){var e=ex(this,n);(e.value||(e.value={}))[t]=r.apply(this,arguments)}),function(e){return eT(e,n).value[t]}}function eM(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function eO(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function eL(){}var eN="\\s*([+-]?\\d+)\\s*",eF="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",eD="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eB=/^#([0-9a-f]{3,8})$/,ek=RegExp(`^rgb\\(${eN},${eN},${eN}\\)$`),eG=RegExp(`^rgb\\(${eD},${eD},${eD}\\)$`),eU=RegExp(`^rgba\\(${eN},${eN},${eN},${eF}\\)$`),eV=RegExp(`^rgba\\(${eD},${eD},${eD},${eF}\\)$`),eH=RegExp(`^hsl\\(${eF},${eD},${eD}\\)$`),e$=RegExp(`^hsla\\(${eF},${eD},${eD},${eF}\\)$`),eW={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function ej(){return this.rgb().formatHex()}function ez(){return this.rgb().formatRgb()}function eY(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=eB.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?eK(t):3===r?new eq(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?eX(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?eX(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ek.exec(e))?new eq(t[1],t[2],t[3],1):(t=eG.exec(e))?new eq(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=eU.exec(e))?eX(t[1],t[2],t[3],t[4]):(t=eV.exec(e))?eX(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=eH.exec(e))?e3(t[1],t[2]/100,t[3]/100,1):(t=e$.exec(e))?e3(t[1],t[2]/100,t[3]/100,t[4]):eW.hasOwnProperty(e)?eK(eW[e]):"transparent"===e?new eq(NaN,NaN,NaN,0):null}function eK(e){return new eq(e>>16&255,e>>8&255,255&e,1)}function eX(e,t,r,n){return n<=0&&(e=t=r=NaN),new eq(e,t,r,n)}function eZ(e,t,r,n){var i;return 1==arguments.length?((i=e)instanceof eL||(i=eY(i)),i)?new eq((i=i.rgb()).r,i.g,i.b,i.opacity):new eq:new eq(e,t,r,null==n?1:n)}function eq(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function eQ(){return`#${e2(this.r)}${e2(this.g)}${e2(this.b)}`}function eJ(){let e=e0(this.opacity);return`${1===e?"rgb(":"rgba("}${e1(this.r)}, ${e1(this.g)}, ${e1(this.b)}${1===e?")":`, ${e})`}`}function e0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function e1(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function e2(e){return((e=e1(e))<16?"0":"")+e.toString(16)}function e3(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new e5(e,t,r,n)}function e4(e){if(e instanceof e5)return new e5(e.h,e.s,e.l,e.opacity);if(e instanceof eL||(e=eY(e)),!e)return new e5;if(e instanceof e5)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(r-n)/o+(r<n)*6:r===a?(n-t)/o+2:(t-r)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new e5(s,o,l,e.opacity)}function e5(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function e6(e){return(e=(e||0)%360)<0?e+360:e}function e8(e){return Math.max(0,Math.min(1,e||0))}function e7(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function e9(e,t,r,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*r+(1+3*e+3*a-3*s)*n+s*i)/6}eM(eL,eY,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ej,formatHex:ej,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return e4(this).formatHsl()},formatRgb:ez,toString:ez}),eM(eq,eZ,eO(eL,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new eq(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new eq(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new eq(e1(this.r),e1(this.g),e1(this.b),e0(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eQ,formatHex:eQ,formatHex8:function(){return`#${e2(this.r)}${e2(this.g)}${e2(this.b)}${e2((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:eJ,toString:eJ})),eM(e5,function(e,t,r,n){return 1==arguments.length?e4(e):new e5(e,t,r,null==n?1:n)},eO(eL,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new e5(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new e5(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new eq(e7(e>=240?e-240:e+120,i,n),e7(e,i,n),e7(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new e5(e6(this.h),e8(this.s),e8(this.l),e0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=e0(this.opacity);return`${1===e?"hsl(":"hsla("}${e6(this.h)}, ${100*e8(this.s)}%, ${100*e8(this.l)}%${1===e?")":`, ${e})`}`}}));let te=e=>()=>e;function tt(e,t){var r=t-e;return r?function(t){return e+t*r}:te(isNaN(e)?t:e)}let tr=function e(t){var r,n=1==(r=+t)?tt:function(e,t){var n,i,a;return t-e?(n=e,i=t,n=Math.pow(n,a=r),i=Math.pow(i,a)-n,a=1/a,function(e){return Math.pow(n+e*i,a)}):te(isNaN(e)?t:e)};function i(e,t){var r=n((e=eZ(e)).r,(t=eZ(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),s=tt(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function tn(e){return function(t){var r,n,i=t.length,a=Array(i),s=Array(i),o=Array(i);for(r=0;r<i;++r)n=eZ(t[r]),a[r]=n.r||0,s[r]=n.g||0,o[r]=n.b||0;return a=e(a),s=e(s),o=e(o),n.opacity=1,function(e){return n.r=a(e),n.g=s(e),n.b=o(e),n+""}}}tn(function(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,o=n<t-1?e[n+2]:2*a-i;return e9((r-n/t)*t,s,i,a,o)}}),tn(function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],a=e[n%t],s=e[(n+1)%t],o=e[(n+2)%t];return e9((r-n/t)*t,i,a,s,o)}});var ti=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ta=RegExp(ti.source,"g");function ts(e,t){var r,n,i,a,s,o=ti.lastIndex=ta.lastIndex=0,l=-1,u=[],c=[];for(e+="",t+="";(i=ti.exec(e))&&(a=ta.exec(t));)(s=a.index)>o&&(s=t.slice(o,s),u[l]?u[l]+=s:u[++l]=s),(i=i[0])===(a=a[0])?u[l]?u[l]+=a:u[++l]=a:(u[++l]=null,c.push({i:l,x:eE(i,a)})),o=ta.lastIndex;return o<t.length&&(s=t.slice(o),u[l]?u[l]+=s:u[++l]=s),u.length<2?c[0]?(r=c[0].x,function(e){return r(e)+""}):(n=t,function(){return n}):(t=c.length,function(e){for(var r,n=0;n<t;++n)u[(r=c[n]).i]=r.x(e);return u.join("")})}function to(e,t){var r;return("number"==typeof t?eE:t instanceof eY?tr:(r=eY(t))?(t=r,tr):ts)(e,t)}var tl=K.prototype.constructor;function tu(e){return function(){this.style.removeProperty(e)}}var tc=0;function td(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}var th=K.prototype;td.prototype=(function(e){return K().transition(e)}).prototype={constructor:td,select:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=i(e));for(var n=this._groups,a=n.length,s=Array(a),o=0;o<a;++o)for(var l,u,c=n[o],d=c.length,h=s[o]=Array(d),f=0;f<d;++f)(l=c[f])&&(u=e.call(l,l.__data__,f,c))&&("__data__"in l&&(u.__data__=l.__data__),h[f]=u,ev(h[f],t,r,f,h,eT(l,r)));return new td(s,this._parents,t,r)},selectAll:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=s(e));for(var n=this._groups,i=n.length,a=[],o=[],l=0;l<i;++l)for(var u,c=n[l],d=c.length,h=0;h<d;++h)if(u=c[h]){for(var f,p=e.call(u,u.__data__,h,c),_=eT(u,r),m=0,g=p.length;m<g;++m)(f=p[m])&&ev(f,t,r,m,p,_);a.push(p),o.push(u)}return new td(a,o,t,r)},selectChild:th.selectChild,selectChildren:th.selectChildren,filter:function(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,r=t.length,n=Array(r),i=0;i<r;++i)for(var a,s=t[i],l=s.length,u=n[i]=[],c=0;c<l;++c)(a=s[c])&&e.call(a,a.__data__,c,s)&&u.push(a);return new td(n,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw Error();for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),s=Array(n),o=0;o<a;++o)for(var l,u=t[o],c=r[o],d=u.length,h=s[o]=Array(d),f=0;f<d;++f)(l=u[f]||c[f])&&(h[f]=l);for(;o<n;++o)s[o]=t[o];return new td(s,this._parents,this._name,this._id)},selection:function(){return new tl(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,r=++tc,n=this._groups,i=n.length,a=0;a<i;++a)for(var s,o=n[a],l=o.length,u=0;u<l;++u)if(s=o[u]){var c=eT(s,t);ev(s,e,r,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new td(n,this._parents,e,r)},call:th.call,nodes:th.nodes,node:th.node,size:th.size,empty:th.empty,each:th.each,on:function(e,t){var r,n,i,a,s,o,l=this._id;return arguments.length<2?eT(this.node(),l).on.on(e):this.each((r=l,n=e,i=t,o=(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})?eb:ex,function(){var e=o(this,r),t=e.on;t!==a&&(s=(a=t).copy()).on(n,i),e.on=s}))},attr:function(e,t){var r=I(e),n="transform"===r?eR:to;return this.attrTween(e,"function"==typeof t?(r.local?function(e,t,r){var n,i,a;return function(){var s,o,l=r(this);return null==l?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local))===(o=l+"")?null:s===n&&o===i?a:(i=o,a=t(n=s,l))}}:function(e,t,r){var n,i,a;return function(){var s,o,l=r(this);return null==l?void this.removeAttribute(e):(s=this.getAttribute(e))===(o=l+"")?null:s===n&&o===i?a:(i=o,a=t(n=s,l))}})(r,n,ew(this,"attr."+e,t)):null==t?(r.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(r):(r.local?function(e,t,r){var n,i,a=r+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===a?null:s===n?i:i=t(n=s,r)}}:function(e,t,r){var n,i,a=r+"";return function(){var s=this.getAttribute(e);return s===a?null:s===n?i:i=t(n=s,r)}})(r,n,t))},attrTween:function(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw Error();var n=I(e);return this.tween(r,(n.local?function(e,t){var r,n;function i(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function(t){this.setAttributeNS(e.space,e.local,i.call(this,t))}),r}return i._value=t,i}:function(e,t){var r,n;function i(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function(t){this.setAttribute(e,i.call(this,t))}),r}return i._value=t,i})(n,t))},style:function(e,t,r){var n,i,a,s,o,l,u,c,d,h,f,p,_,m,g,y,v,b,x,T,E,A="transform"==(e+="")?eP:to;return null==t?this.styleTween(e,(n=e,function(){var e=P(this,n),t=(this.style.removeProperty(n),P(this,n));return e===t?null:e===i&&t===a?s:s=A(i=e,a=t)})).on("end.style."+e,tu(e)):"function"==typeof t?this.styleTween(e,(o=e,l=ew(this,"style."+e,t),function(){var e=P(this,o),t=l(this),r=t+"";return null==t&&(this.style.removeProperty(o),r=t=P(this,o)),e===r?null:e===u&&r===c?d:(c=r,d=A(u=e,t))})).each((h=this._id,v="end."+(y="style."+(f=e)),function(){var e=ex(this,h),t=e.on,r=null==e.value[y]?g||(g=tu(f)):void 0;(t!==p||m!==r)&&(_=(p=t).copy()).on(v,m=r),e.on=_})):this.styleTween(e,(b=e,E=t+"",function(){var e=P(this,b);return e===E?null:e===x?T:T=A(x=e,t)}),r).on("end.style."+e,null)},styleTween:function(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw Error();return this.tween(n,function(e,t,r){var n,i;function a(){var a=t.apply(this,arguments);return a!==i&&(n=(i=a)&&function(t){this.style.setProperty(e,a.call(this,t),r)}),n}return a._value=t,a}(e,t,null==r?"":r))},text:function(e){var t,r;return this.tween("text","function"==typeof e?(t=ew(this,"text",e),function(){var e=t(this);this.textContent=null==e?"":e}):(r=null==e?"":e+"",function(){this.textContent=r}))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw Error();return this.tween(t,function(e){var t,r;function n(){var n=e.apply(this,arguments);return n!==r&&(t=(r=n)&&function(e){this.textContent=n.call(this,e)}),t}return n._value=e,n}(e))},remove:function(){var e;return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}))},tween:function(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n,i=eT(this.node(),r).tween,a=0,s=i.length;a<s;++a)if((n=i[a]).name===e)return n.value;return null}return this.each((null==t?function(e,t){var r,n;return function(){var i=ex(this,e),a=i.tween;if(a!==r){n=r=a;for(var s=0,o=n.length;s<o;++s)if(n[s].name===t){(n=n.slice()).splice(s,1);break}}i.tween=n}}:function(e,t,r){var n,i;if("function"!=typeof r)throw Error();return function(){var a=ex(this,e),s=a.tween;if(s!==n){i=(n=s).slice();for(var o={name:t,value:r},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=o;break}l===u&&i.push(o)}a.tween=i}})(r,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){eb(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){eb(this,e).delay=t}})(t,e)):eT(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){ex(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){ex(this,e).duration=t}})(t,e)):eT(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw Error();return function(){ex(this,e).ease=t}}(t,e)):eT(this.node(),t).ease},easeVarying:function(e){var t;if("function"!=typeof e)throw Error();return this.each((t=this._id,function(){var r=e.apply(this,arguments);if("function"!=typeof r)throw Error();ex(this,t).ease=r}))},end:function(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(a,s){var o={value:s},l={value:function(){0==--i&&a()}};r.each(function(){var r=ex(this,n),i=r.on;i!==e&&((t=(e=i).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),r.on=t}),0===i&&a()})},[Symbol.iterator]:th[Symbol.iterator]};var tf={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};K.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var r,n,i,a=e.__transition,s=!0;if(a){for(i in t=null==t?null:t+"",a){if((r=a[i]).name!==t){s=!1;continue}n=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(n?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete a[i]}s&&delete e.__transition}}(this,e)})},K.prototype.transition=function(e){var t,r;e instanceof td?(t=e._id,e=e._name):(t=++tc,(r=tf).time=eu(),e=null==e?null:e+"");for(var n=this._groups,i=n.length,a=0;a<i;++a)for(var s,o=n[a],l=o.length,u=0;u<l;++u)(s=o[u])&&ev(s,e,t,u,o,r||function(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return r}(s,t));return new td(n,this._parents,e,t)};let{abs:tp,max:t_,min:tm}=Math;function tg(e){return{type:e}}["w","e"].map(tg),["n","s"].map(tg),["n","w","e","s","nw","ne","sw","se"].map(tg);function ty(e,t){return e*=1,t*=1,function(r){return Math.round(e*(1-r)+t*r)}}function tv(e){return e}function tb(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}let tx=Math.sqrt(50),tT=Math.sqrt(10),tE=Math.sqrt(2);function tA(e,t,r){let n,i,a,s=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(s)),l=s/Math.pow(10,o),u=l>=tx?10:l>=tT?5:l>=tE?2:1;return(o<0?(n=Math.round(e*(a=Math.pow(10,-o)/u)),i=Math.round(t*a),n/a<e&&++n,i/a>t&&--i,a=-a):(n=Math.round(e/(a=Math.pow(10,o)*u)),i=Math.round(t/a),n*a<e&&++n,i*a>t&&--i),i<n&&.5<=r&&r<2)?tA(e,t,2*r):[n,i,a]}function tS(e,t,r){return tA(e*=1,t*=1,r*=1)[2]}var tI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tC(e){var t;if(!(t=tI.exec(e)))throw Error("invalid format: "+e);return new tP({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function tP(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function tR(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function tw(e){return(e=tR(Math.abs(e)))?e[1]:NaN}function tM(e,t){var r=tR(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+Array(i-n.length+2).join("0")}tC.prototype=tP.prototype,tP.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};let tO={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>tM(100*e,t),r:tM,s:function(e,t){var r=tR(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(c=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=n.length;return a===s?n:a>s?n+Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+Array(1-a).join("0")+tR(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function tL(e){return e}var tN=Array.prototype.map,tF=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function tD(e){for(var t=e.length/6|0,r=Array(t),n=0;n<t;)r[n]="#"+e.slice(6*n,6*++n);return r}function tB(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}h=(d=function(e){var t,r,n,i=void 0===e.grouping||void 0===e.thousands?tL:(t=tN.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>n&&(o=Math.max(1,n-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>n));)o=t[s=(s+1)%t.length];return a.reverse().join(r)}),a=void 0===e.currency?"":e.currency[0]+"",s=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?tL:(n=tN.call(e.numerals,String),function(e){return e.replace(/[0-9]/g,function(e){return n[+e]})}),u=void 0===e.percent?"%":e.percent+"",d=void 0===e.minus?"−":e.minus+"",h=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=tC(e)).fill,r=e.align,n=e.sign,f=e.symbol,p=e.zero,_=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):tO[v]||(void 0===g&&(g=12),y=!0,v="g"),(p||"0"===t&&"="===r)&&(p=!0,t="0",r="=");var b="$"===f?a:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===f?s:/[%p]/.test(v)?u:"",T=tO[v],E=/[defgprs%]/.test(v);function A(e){var a,s,u,f=b,A=x;if("c"===v)A=T(e)+A,e="";else{var S=(e*=1)<0||1/e<0;if(e=isNaN(e)?h:T(Math.abs(e),g),y&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==n&&(S=!1),f=(S?"("===n?n:d:"-"===n||"("===n?"":n)+f,A=("s"===v?tF[8+c/3]:"")+A+(S&&"("===n?")":""),E){for(a=-1,s=e.length;++a<s;)if(48>(u=e.charCodeAt(a))||u>57){A=(46===u?o+e.slice(a+1):e.slice(a))+A,e=e.slice(0,a);break}}}m&&!p&&(e=i(e,1/0));var I=f.length+e.length+A.length,C=I<_?Array(_-I+1).join(t):"";switch(m&&p&&(e=i(C+e,C.length?_-A.length:1/0),C=""),r){case"<":e=f+e+A+C;break;case"=":e=f+C+e+A;break;case"^":e=C.slice(0,I=C.length>>1)+f+e+A+C.slice(I);break;default:e=C+f+e+A}return l(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),A.toString=function(){return e+""},A}return{format:f,formatPrefix:function(e,t){var r=f(((e=tC(e)).type="f",e)),n=3*Math.max(-8,Math.min(8,Math.floor(tw(t)/3))),i=Math.pow(10,-n),a=tF[8+n/3];return function(e){return r(i*e)+a}}}}({thousands:",",grouping:[3],currency:["$",""]})).format,f=d.formatPrefix;let tk=tB(tD("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function tG(e){return function(){return e}}tB(tD("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),tB(tD("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),tB(tD("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));let tU=Math.abs,tV=Math.atan2,tH=Math.cos,t$=Math.max,tW=Math.min,tj=Math.sin,tz=Math.sqrt,tY=Math.PI,tK=tY/2,tX=2*tY;function tZ(e){return e>=1?tK:e<=-1?-tK:Math.asin(e)}let tq=Math.PI,tQ=2*tq,tJ=tQ-1e-6;function t0(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class t1{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?t0:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return t0;let r=10**t;return function(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,n){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+n}`}bezierCurveTo(e,t,r,n,i,a){this._append`C${+e},${+t},${+r},${+n},${this._x1=+i},${this._y1=+a}`}arcTo(e,t,r,n,i){if(e*=1,t*=1,r*=1,n*=1,(i*=1)<0)throw Error(`negative radius: ${i}`);let a=this._x1,s=this._y1,o=r-e,l=n-t,u=a-e,c=s-t,d=u*u+c*c;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(d>1e-6)if(Math.abs(c*o-l*u)>1e-6&&i){let h=r-a,f=n-s,p=o*o+l*l,_=Math.sqrt(p),m=Math.sqrt(d),g=i*Math.tan((tq-Math.acos((p+d-(h*h+f*f))/(2*_*m)))/2),y=g/m,v=g/_;Math.abs(y-1)>1e-6&&this._append`L${e+y*u},${t+y*c}`,this._append`A${i},${i},0,0,${+(c*h>u*f)},${this._x1=e+v*o},${this._y1=t+v*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,r,n,i,a){if(e*=1,t*=1,r*=1,a=!!a,r<0)throw Error(`negative radius: ${r}`);let s=r*Math.cos(n),o=r*Math.sin(n),l=e+s,u=t+o,c=1^a,d=a?n-i:i-n;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append`L${l},${u}`,r&&(d<0&&(d=d%tQ+tQ),d>tJ?this._append`A${r},${r},0,1,${c},${e-s},${t-o}A${r},${r},0,1,${c},${this._x1=l},${this._y1=u}`:d>1e-6&&this._append`A${r},${r},0,${+(d>=tq)},${c},${this._x1=e+r*Math.cos(i)},${this._y1=t+r*Math.sin(i)}`)}rect(e,t,r,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r*=1}v${+n}h${-r}Z`}toString(){return this._}}function t2(e){return e.innerRadius}function t3(e){return e.outerRadius}function t4(e){return e.startAngle}function t5(e){return e.endAngle}function t6(e){return e&&e.padAngle}function t8(e,t,r,n,i,a,s){var o=e-r,l=t-n,u=(s?a:-a)/tz(o*o+l*l),c=u*l,d=-u*o,h=e+c,f=t+d,p=r+c,_=n+d,m=(h+p)/2,g=(f+_)/2,y=p-h,v=_-f,b=y*y+v*v,x=i-a,T=h*_-p*f,E=(v<0?-1:1)*tz(t$(0,x*x*b-T*T)),A=(T*v-y*E)/b,S=(-T*y-v*E)/b,I=(T*v+y*E)/b,C=(-T*y+v*E)/b,P=A-m,R=S-g,w=I-m,M=C-g;return P*P+R*R>w*w+M*M&&(A=I,S=C),{cx:A,cy:S,x01:-c,y01:-d,x11:A*(i/x-1),y11:S*(i/x-1)}}function t7(){let e;var t=t2,r=t3,n=tG(0),i=null,a=t4,s=t5,o=t6,l=null,u=(e=3,c.digits=function(t){if(!arguments.length)return e;if(null==t)e=null;else{let r=Math.floor(t);if(!(r>=0))throw RangeError(`invalid digits: ${t}`);e=r}return c},()=>new t1(e));function c(){var e,c,d=+t.apply(this,arguments),h=+r.apply(this,arguments),f=a.apply(this,arguments)-tK,p=s.apply(this,arguments)-tK,_=tU(p-f),m=p>f;if(l||(l=e=u()),h<d&&(c=h,h=d,d=c),h>1e-12)if(_>tX-1e-12)l.moveTo(h*tH(f),h*tj(f)),l.arc(0,0,h,f,p,!m),d>1e-12&&(l.moveTo(d*tH(p),d*tj(p)),l.arc(0,0,d,p,f,m));else{var g,y,v=f,b=p,x=f,T=p,E=_,A=_,S=o.apply(this,arguments)/2,I=S>1e-12&&(i?+i.apply(this,arguments):tz(d*d+h*h)),C=tW(tU(h-d)/2,+n.apply(this,arguments)),P=C,R=C;if(I>1e-12){var w=tZ(I/d*tj(S)),M=tZ(I/h*tj(S));(E-=2*w)>1e-12?(w*=m?1:-1,x+=w,T-=w):(E=0,x=T=(f+p)/2),(A-=2*M)>1e-12?(M*=m?1:-1,v+=M,b-=M):(A=0,v=b=(f+p)/2)}var O=h*tH(v),L=h*tj(v),N=d*tH(T),F=d*tj(T);if(C>1e-12){var D,B=h*tH(b),k=h*tj(b),G=d*tH(x),U=d*tj(x);if(_<tY)if(D=function(e,t,r,n,i,a,s,o){var l=r-e,u=n-t,c=s-i,d=o-a,h=d*l-c*u;if(!(h*h<1e-12))return h=(c*(t-a)-d*(e-i))/h,[e+h*l,t+h*u]}(O,L,G,U,B,k,N,F)){var V,H=O-D[0],$=L-D[1],W=B-D[0],j=k-D[1],z=1/tj(((V=(H*W+$*j)/(tz(H*H+$*$)*tz(W*W+j*j)))>1?0:V<-1?tY:Math.acos(V))/2),Y=tz(D[0]*D[0]+D[1]*D[1]);P=tW(C,(d-Y)/(z-1)),R=tW(C,(h-Y)/(z+1))}else P=R=0}A>1e-12?R>1e-12?(g=t8(G,U,O,L,h,R,m),y=t8(B,k,N,F,h,R,m),l.moveTo(g.cx+g.x01,g.cy+g.y01),R<C?l.arc(g.cx,g.cy,R,tV(g.y01,g.x01),tV(y.y01,y.x01),!m):(l.arc(g.cx,g.cy,R,tV(g.y01,g.x01),tV(g.y11,g.x11),!m),l.arc(0,0,h,tV(g.cy+g.y11,g.cx+g.x11),tV(y.cy+y.y11,y.cx+y.x11),!m),l.arc(y.cx,y.cy,R,tV(y.y11,y.x11),tV(y.y01,y.x01),!m))):(l.moveTo(O,L),l.arc(0,0,h,v,b,!m)):l.moveTo(O,L),d>1e-12&&E>1e-12?P>1e-12?(g=t8(N,F,B,k,d,-P,m),y=t8(O,L,G,U,d,-P,m),l.lineTo(g.cx+g.x01,g.cy+g.y01),P<C?l.arc(g.cx,g.cy,P,tV(g.y01,g.x01),tV(y.y01,y.x01),!m):(l.arc(g.cx,g.cy,P,tV(g.y01,g.x01),tV(g.y11,g.x11),!m),l.arc(0,0,d,tV(g.cy+g.y11,g.cx+g.x11),tV(y.cy+y.y11,y.cx+y.x11),m),l.arc(y.cx,y.cy,P,tV(y.y11,y.x11),tV(y.y01,y.x01),!m))):l.arc(0,0,d,T,x,m):l.lineTo(N,F)}else l.moveTo(0,0);if(l.closePath(),e)return l=null,e+""||null}return c.centroid=function(){var e=(+t.apply(this,arguments)+ +r.apply(this,arguments))/2,n=(+a.apply(this,arguments)+ +s.apply(this,arguments))/2-tY/2;return[tH(n)*e,tj(n)*e]},c.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:tG(+e),c):t},c.outerRadius=function(e){return arguments.length?(r="function"==typeof e?e:tG(+e),c):r},c.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:tG(+e),c):n},c.padRadius=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:tG(+e),c):i},c.startAngle=function(e){return arguments.length?(a="function"==typeof e?e:tG(+e),c):a},c.endAngle=function(e){return arguments.length?(s="function"==typeof e?e:tG(+e),c):s},c.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:tG(+e),c):o},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function t9(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function re(e){return e}function rt(){var e=re,t=t9,r=null,n=tG(0),i=tG(tX),a=tG(0);function s(s){var o,l,u,c,d,h,f=(s="object"==typeof(o=s)&&"length"in o?o:Array.from(o)).length,p=0,_=Array(f),m=Array(f),g=+n.apply(this,arguments),y=Math.min(tX,Math.max(-tX,i.apply(this,arguments)-g)),v=Math.min(Math.abs(y)/f,a.apply(this,arguments)),b=v*(y<0?-1:1);for(l=0;l<f;++l)(h=m[_[l]=l]=+e(s[l],l,s))>0&&(p+=h);for(null!=t?_.sort(function(e,r){return t(m[e],m[r])}):null!=r&&_.sort(function(e,t){return r(s[e],s[t])}),l=0,c=p?(y-f*b)/p:0;l<f;++l,g=d)d=g+((h=m[u=_[l]])>0?h*c:0)+b,m[u]={data:s[u],index:l,value:h,startAngle:g,endAngle:d,padAngle:v};return m}return s.value=function(t){return arguments.length?(e="function"==typeof t?t:tG(+t),s):e},s.sortValues=function(e){return arguments.length?(t=e,r=null,s):t},s.sort=function(e){return arguments.length?(r=e,t=null,s):r},s.startAngle=function(e){return arguments.length?(n="function"==typeof e?e:tG(+e),s):n},s.endAngle=function(e){return arguments.length?(i="function"==typeof e?e:tG(+e),s):i},s.padAngle=function(e){return arguments.length?(a="function"==typeof e?e:tG(+e),s):a},s}function rr(e,t,r){this.k=e,this.x=t,this.y=r}t1.prototype,Array.prototype.slice,rr.prototype={constructor:rr,scale:function(e){return 1===e?this:new rr(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new rr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var rn=new rr(1,0,0);rr.prototype},76438:function(e,t,r){var n=r(66755);let i="bakedVertexAnimationDeclaration",a=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;
#ifdef INSTANCES
attribute vec4 bakedVertexAnimationSettingsInstanced;
#endif
#define inline
mat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)
{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},76600:function(e,t,r){r.d(t,{d:()=>i});let n={mat2:2,mat3:3,mat4:4,mat2x2:2,mat3x3:3,mat4x4:4};class i{static get KnownUBOs(){return i._SimplifiedKnownBindings?i._SimplifiedKnownUBOs:i._KnownUBOs}constructor(e,t=!1){this.vertexBufferKindToNumberOfComponents={},this.shaderLanguage=e,this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeGroupIndex=0,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableBuffers={},this.availableTextures={},this.availableSamplers={},this.orderedAttributes=[],this.bindGroupLayoutEntries=[],this.bindGroupLayoutEntryInfo=[],this.bindGroupEntries=[],this.bufferNames=[],this.textureNames=[],this.samplerNames=[],this.leftOverUniforms=[],t||this._findStartingGroupBinding()}_findStartingGroupBinding(){let e=i.KnownUBOs,t=[];for(let r in e){let n=e[r].binding;-1!==n.groupIndex&&(void 0===t[n.groupIndex]?t[n.groupIndex]=n.bindingIndex:t[n.groupIndex]=Math.max(t[n.groupIndex],n.bindingIndex))}this.freeGroupIndex=t.length-1,0===this.freeGroupIndex?(this.freeGroupIndex++,this.freeBindingIndex=0):this.freeBindingIndex=t[t.length-1]+1}getAttributeNextLocation(e,t=0){let r=this._attributeNextLocation;return this._attributeNextLocation+=(n[e]??1)*(t||1),r}getVaryingNextLocation(e,t=0){let r=this._varyingNextLocation;return this._varyingNextLocation+=(n[e]??1)*(t||1),r}getNextFreeUBOBinding(){return this._getNextFreeBinding(1)}_getNextFreeBinding(e){if(this.freeBindingIndex>65536-e&&(this.freeGroupIndex++,this.freeBindingIndex=0),4===this.freeGroupIndex)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";let t={groupIndex:this.freeGroupIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t}}i._SimplifiedKnownBindings=!0,i._SimplifiedKnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:-1,bindingIndex:-1}},Light1:{binding:{groupIndex:-1,bindingIndex:-1}},Light2:{binding:{groupIndex:-1,bindingIndex:-1}},Light3:{binding:{groupIndex:-1,bindingIndex:-1}},Light4:{binding:{groupIndex:-1,bindingIndex:-1}},Light5:{binding:{groupIndex:-1,bindingIndex:-1}},Light6:{binding:{groupIndex:-1,bindingIndex:-1}},Light7:{binding:{groupIndex:-1,bindingIndex:-1}},Light8:{binding:{groupIndex:-1,bindingIndex:-1}},Light9:{binding:{groupIndex:-1,bindingIndex:-1}},Light10:{binding:{groupIndex:-1,bindingIndex:-1}},Light11:{binding:{groupIndex:-1,bindingIndex:-1}},Light12:{binding:{groupIndex:-1,bindingIndex:-1}},Light13:{binding:{groupIndex:-1,bindingIndex:-1}},Light14:{binding:{groupIndex:-1,bindingIndex:-1}},Light15:{binding:{groupIndex:-1,bindingIndex:-1}},Light16:{binding:{groupIndex:-1,bindingIndex:-1}},Light17:{binding:{groupIndex:-1,bindingIndex:-1}},Light18:{binding:{groupIndex:-1,bindingIndex:-1}},Light19:{binding:{groupIndex:-1,bindingIndex:-1}},Light20:{binding:{groupIndex:-1,bindingIndex:-1}},Light21:{binding:{groupIndex:-1,bindingIndex:-1}},Light22:{binding:{groupIndex:-1,bindingIndex:-1}},Light23:{binding:{groupIndex:-1,bindingIndex:-1}},Light24:{binding:{groupIndex:-1,bindingIndex:-1}},Light25:{binding:{groupIndex:-1,bindingIndex:-1}},Light26:{binding:{groupIndex:-1,bindingIndex:-1}},Light27:{binding:{groupIndex:-1,bindingIndex:-1}},Light28:{binding:{groupIndex:-1,bindingIndex:-1}},Light29:{binding:{groupIndex:-1,bindingIndex:-1}},Light30:{binding:{groupIndex:-1,bindingIndex:-1}},Light31:{binding:{groupIndex:-1,bindingIndex:-1}},Material:{binding:{groupIndex:-1,bindingIndex:-1}},Mesh:{binding:{groupIndex:-1,bindingIndex:-1}},Internals:{binding:{groupIndex:-1,bindingIndex:-1}}},i._KnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:1,bindingIndex:0}},Light1:{binding:{groupIndex:1,bindingIndex:1}},Light2:{binding:{groupIndex:1,bindingIndex:2}},Light3:{binding:{groupIndex:1,bindingIndex:3}},Light4:{binding:{groupIndex:1,bindingIndex:4}},Light5:{binding:{groupIndex:1,bindingIndex:5}},Light6:{binding:{groupIndex:1,bindingIndex:6}},Light7:{binding:{groupIndex:1,bindingIndex:7}},Light8:{binding:{groupIndex:1,bindingIndex:8}},Light9:{binding:{groupIndex:1,bindingIndex:9}},Light10:{binding:{groupIndex:1,bindingIndex:10}},Light11:{binding:{groupIndex:1,bindingIndex:11}},Light12:{binding:{groupIndex:1,bindingIndex:12}},Light13:{binding:{groupIndex:1,bindingIndex:13}},Light14:{binding:{groupIndex:1,bindingIndex:14}},Light15:{binding:{groupIndex:1,bindingIndex:15}},Light16:{binding:{groupIndex:1,bindingIndex:16}},Light17:{binding:{groupIndex:1,bindingIndex:17}},Light18:{binding:{groupIndex:1,bindingIndex:18}},Light19:{binding:{groupIndex:1,bindingIndex:19}},Light20:{binding:{groupIndex:1,bindingIndex:20}},Light21:{binding:{groupIndex:1,bindingIndex:21}},Light22:{binding:{groupIndex:1,bindingIndex:22}},Light23:{binding:{groupIndex:1,bindingIndex:23}},Light24:{binding:{groupIndex:1,bindingIndex:24}},Light25:{binding:{groupIndex:1,bindingIndex:25}},Light26:{binding:{groupIndex:1,bindingIndex:26}},Light27:{binding:{groupIndex:1,bindingIndex:27}},Light28:{binding:{groupIndex:1,bindingIndex:28}},Light29:{binding:{groupIndex:1,bindingIndex:29}},Light30:{binding:{groupIndex:1,bindingIndex:30}},Light31:{binding:{groupIndex:1,bindingIndex:31}},Material:{binding:{groupIndex:2,bindingIndex:0}},Mesh:{binding:{groupIndex:2,bindingIndex:1}},Internals:{binding:{groupIndex:2,bindingIndex:2}}}},77768:function(e,t,r){var n=r(66755);let i="volumetricLightScatteringPassPixelShader",a=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);}
`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a)},77904:function(e,t,r){r.d(t,{d:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("left",i.E.AutoDetect),this.registerInput("right",i.E.AutoDetect),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"MinBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = min(${this.left.associatedVariableName}, ${this.right.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.MinBlock",o)},77959:function(e,t,r){var n=r(90481),i=r(56865),a=r(34504);a.q.prototype._createDepthStencilCubeTexture=function(e,t){let r=new n.l(this,t.generateStencil?12:14);r.isCube=!0,r.label=t.label;let a={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1,depthTextureFormat:t.generateStencil?13:14,...t};r.format=a.depthTextureFormat,this._setupDepthStencilTexture(r,e,a.bilinearFiltering,a.comparisonFunction,a.samples),this._textureHelper.createGPUTextureForInternalTexture(r);let s=r._hardwareTexture;return r.type=i.D.GetTextureTypeFromFormat(s.format),this._internalTexturesCache.push(r),r},a.q.prototype.createCubeTexture=function(e,t,r,n,i=null,a=null,s,o=null,l=!1,u=0,c=0,d=null,h,f=!1,p=null){return this.createCubeTextureBase(e,t,r,!!n,i,a,s,o,l,u,c,d,null,(e,t)=>{let r=t[0].width;this._setCubeMapTextureParams(e,!n),e.format=s??-1;let a=this._textureHelper.createGPUTextureForInternalTexture(e,r,r);this._textureHelper.updateCubeTextures(t,a.underlyingResource,r,r,a.format,!1,!1,0,0),n||this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),i&&i()},!!f,p)},a.q.prototype._setCubeMapTextureParams=function(e,t,r){e.samplingMode=t?3:2,e._cachedWrapU=0,e._cachedWrapV=0,r&&(e._maxLodLevel=r)},a.q.prototype.generateMipMapsForCubemap=function(e){e.generateMipMaps&&(e._hardwareTexture?.underlyingResource||this._textureHelper.createGPUTextureForInternalTexture(e),this._generateMipmaps(e))}},78094:function(e,t,r){r.r(t),r.d(t,{SolidParser:()=>nh,GLTF1:()=>R,MTLFileLoader:()=>nd,GLTFLoaderAnimationStartMode:()=>g,GLTFFileLoader:()=>K,GLTFLoaderState:()=>y,GLTFLoaderCoordinateSystemMode:()=>m,GLTFValidation:()=>G,OBJFileLoader:()=>nf,SPLATFileLoader:()=>nx,GLTF2:()=>w,STLFileLoader:()=>n_});var n,i,a,s,o,l,u,c,d,h,f,p,_,m,g,y,v,b,x,T,E,A,S,I,C,P,R={};r.r(R),r.d(R,{EBlendingFunction:()=>I,EComponentType:()=>v,ECullingType:()=>S,EParameterType:()=>x,EShaderType:()=>b,ETextureFilterType:()=>E,ETextureFormat:()=>A,ETextureWrapMode:()=>T,GLTFBinaryExtension:()=>eJ,GLTFLoader:()=>eq,GLTFLoaderBase:()=>eZ,GLTFLoaderExtension:()=>eQ,GLTFMaterialsCommonExtension:()=>e0,GLTFUtils:()=>ey});var w={};r.r(w),r.d(w,{AddObjectAccessorToKey:()=>tt.xP,AnimationPropertyInfo:()=>to.AnimationPropertyInfo,ArrayItem:()=>ti,EXT_lights_ies:()=>tE,EXT_lights_image_based:()=>td,EXT_materials_diffuse_roughness:()=>t6,EXT_mesh_gpu_instancing:()=>tf,EXT_meshopt_compression:()=>tm,EXT_texture_avif:()=>tb,EXT_texture_webp:()=>ty,ExtrasAsMetadata:()=>nu,FlowGraphGLTFDataProvider:()=>nc.FlowGraphGLTFDataProvider,GLTFFileLoader:()=>K,GLTFLoader:()=>ts,GetMappingForKey:()=>tt.di,GetPathToObjectConverter:()=>tt._k,InteractivityGraphToFlowGraphParser:()=>r5,KHR_animation_pointer:()=>rN,KHR_draco_mesh_compression:()=>tI,KHR_interactivity:()=>r7,KHR_lights:()=>tP,KHR_materials_anisotropy:()=>tk,KHR_materials_clearcoat:()=>tN,KHR_materials_diffuse_transmission:()=>t0,KHR_materials_dispersion:()=>t4,KHR_materials_emissive_strength:()=>tU,KHR_materials_ior:()=>tz,KHR_materials_iridescence:()=>tD,KHR_materials_pbrSpecularGlossiness:()=>tw,KHR_materials_sheen:()=>tH,KHR_materials_specular:()=>tW,KHR_materials_transmission:()=>tQ,KHR_materials_unlit:()=>tO,KHR_materials_variants:()=>tK,KHR_materials_volume:()=>t2,KHR_mesh_quantization:()=>t7,KHR_node_hoverability:()=>no,KHR_node_selectability:()=>nn,KHR_node_visibility:()=>nt,KHR_texture_basisu:()=>re,KHR_texture_transform:()=>rr,KHR_xmp_json_ld:()=>ri,LoadBoundingInfoFromPositionAccessor:()=>ta,MSFT_audio_emitter:()=>rG,MSFT_lod:()=>rV,MSFT_minecraftMesh:()=>r$,MSFT_sRGBFactors:()=>rj,SetInterpolationForKey:()=>tt.eF,TransformNodeAnimationPropertyInfo:()=>to.TransformNodeAnimationPropertyInfo,WeightAnimationPropertyInfo:()=>to.WeightAnimationPropertyInfo,_AddInteractivityObjectModel:()=>r9,addNewInteractivityFlowGraphMapping:()=>rq,getAllSupportedNativeNodeTypes:()=>r2,getMappingForDeclaration:()=>rZ,getMappingForFullOperationName:()=>rX,getQuaternion:()=>to.getQuaternion,getVector3:()=>to.getVector3,getWeights:()=>to.getWeights,gltfTypeToBabylonType:()=>r4,registerGLTFExtension:()=>e9,registeredGLTFExtensions:()=>e7,unregisterGLTFExtension:()=>te});var M=r(85791),O=r(70541),L=r(3566),N=r(93919),F=r(88280),D=r(79790);function B(e,t,r,n){let i={externalResourceFunction:n};return r&&(i.uri="file:"===t?r:t+r),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,i):GLTFValidator.validateString(e,i)}function k(){let e=[];onmessage=t=>{let r=t.data;switch(r.id){case"init":importScripts(r.url);break;case"validate":B(r.data,r.rootUrl,r.fileName,t=>new Promise((r,n)=>{let i=e.length;e.push({resolve:r,reject:n}),postMessage({id:"getExternalResource",index:i,uri:t})})).then(e=>{postMessage({id:"validate.resolve",value:e})},e=>{postMessage({id:"validate.reject",reason:e})});break;case"getExternalResource.resolve":e[r.index].resolve(r.value);break;case"getExternalResource.reject":e[r.index].reject(r.reason)}}}class G{static ValidateAsync(e,t,r,n){return"function"==typeof Worker?new Promise((i,a)=>{let s=`${B}(${k})()`,o=new Worker(URL.createObjectURL(new Blob([s],{type:"application/javascript"}))),l=e=>{o.removeEventListener("error",l),o.removeEventListener("message",u),a(e)},u=e=>{let t=e.data;switch(t.id){case"getExternalResource":n(t.uri).then(e=>{o.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e.buffer])},e=>{o.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})});break;case"validate.resolve":o.removeEventListener("error",l),o.removeEventListener("message",u),i(t.value),o.terminate();break;case"validate.reject":o.removeEventListener("error",l),o.removeEventListener("message",u),a(t.reason),o.terminate()}};if(o.addEventListener("error",l),o.addEventListener("message",u),o.postMessage({id:"init",url:O.w1.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){let n=e.slice();o.postMessage({id:"validate",data:n,rootUrl:t,fileName:r},[n.buffer])}else o.postMessage({id:"validate",data:e,rootUrl:t,fileName:r})}):(this._LoadScriptPromise||(this._LoadScriptPromise=O.w1.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(()=>B(e,t,r,n)))}}G.Configuration={url:`${O.w1._DefaultCdnUrl}/gltf_validator.js`};let U="Z2xURg",V="gltf",H={".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},$=e=>-1!==e.indexOf("asset")&&-1!==e.indexOf("version")||e.startsWith("data:base64,"+U)||e.startsWith("data:;base64,"+U)||e.startsWith("data:application/octet-stream;base64,"+U)||e.startsWith("data:model/gltf-binary;base64,"+U);var W=r(21381),j=r(39208);function z(e,t,r){try{return Promise.resolve(new Uint8Array(e,t,r))}catch(e){return Promise.reject(e)}}(n=m||(m={}))[n.AUTO=0]="AUTO",n[n.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",(i=g||(g={}))[i.NONE=0]="NONE",i[i.FIRST=1]="FIRST",i[i.ALL=2]="ALL",(a=y||(y={}))[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE";class Y{constructor(){this.coordinateSystemMode=m.AUTO,this.animationStartMode=g.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}copyFrom(e){e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=e.loadSkins??this.loadSkins,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.createInstances=e.createInstances??this.createInstances,this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=e.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=e.extensionOptions??this.extensionOptions)}}class K extends Y{constructor(e){super(),this.onParsedObservable=new M.y$,this.onMeshLoadedObservable=new M.y$,this.onSkinLoadedObservable=new M.y$,this.onTextureLoadedObservable=new M.y$,this.onMaterialLoadedObservable=new M.y$,this.onCameraLoadedObservable=new M.y$,this.onCompleteObservable=new M.y$,this.onErrorObservable=new M.y$,this.onDisposeObservable=new M.y$,this.onExtensionLoadedObservable=new M.y$,this.validate=!1,this.onValidatedObservable=new M.y$,this._loader=null,this._state=null,this._requests=[],this.name=V,this.extensions=H,this.onLoaderStateChangedObservable=new M.y$,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(e)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(t=>e(t.node,t.skinnedNode)))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){for(let e of(this._loader&&(this._loader.dispose(),this._loader=null),this._requests))e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(e,t,r,n,i,a,s,o){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,r,n,s,o),null;this._progressCallback=i;let l=t.name||O.w1.GetFilename(t);if(!a)return this._loadFile(e,t,t=>{try{this._validate(e,t,r,l),n({json:this._parseJson(t)})}catch{s&&s()}},!1,s);if(this.useRangeRequests){this.validate&&F.Y.Warn("glTF validation is not supported when range requests are enabled");let r={abort:()=>{},onCompleteObservable:new M.y$};return this._unpackBinaryAsync(new D.d({readAsync:(r,n)=>new Promise((i,a)=>{this._loadFile(e,t,e=>{i(new Uint8Array(e))},!0,e=>{a(e)},e=>{e.setRequestHeader("Range",`bytes=${r}-${r+n-1}`)})}),byteLength:0})).then(e=>{r.onCompleteObservable.notifyObservers(r),n(e)},s?e=>s(void 0,e):void 0),r}return this._loadFile(e,t,t=>{this._validate(e,new Uint8Array(t,0,t.byteLength),r,l),this._unpackBinaryAsync(new D.d({readAsync:(e,r)=>z(t,e,r),byteLength:t.byteLength})).then(e=>{n(e)},s?e=>s(void 0,e):void 0)},!0,s)}_loadBinary(e,t,r,n,i,a){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r,a),this._unpackBinaryAsync(new D.d({readAsync:(e,r)=>(function(e,t,r){try{if(t<0||t>=e.byteLength)throw RangeError("Offset is out of range.");if(t+r>e.byteLength)throw RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+t,r))}catch(e){return Promise.reject(e)}})(t,e,r),byteLength:t.byteLength})).then(e=>{n(e)},i?e=>i(void 0,e):void 0)}importMeshAsync(e,t,r,n,i,a){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(r),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(r),this._loader.importMeshAsync(e,t,null,r,n,i,a)))}loadAsync(e,t,r,n,i){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,r,n,i)))}loadAssetContainerAsync(e,t,r,n,i){return Promise.resolve().then(()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(t);let a=new N.TJ(e),s=[];this.onMaterialLoadedObservable.add(e=>{s.push(e)});let o=[];this.onTextureLoadedObservable.add(e=>{o.push(e)});let l=[];this.onCameraLoadedObservable.add(e=>{l.push(e)});let u=[];return this.onMeshLoadedObservable.add(e=>{e.morphTargetManager&&u.push(e.morphTargetManager)}),this._loader.importMeshAsync(null,e,a,t,r,n,i).then(e=>(Array.prototype.push.apply(a.geometries,e.geometries),Array.prototype.push.apply(a.meshes,e.meshes),Array.prototype.push.apply(a.particleSystems,e.particleSystems),Array.prototype.push.apply(a.skeletons,e.skeletons),Array.prototype.push.apply(a.animationGroups,e.animationGroups),Array.prototype.push.apply(a.materials,s),Array.prototype.push.apply(a.textures,o),Array.prototype.push.apply(a.lights,e.lights),Array.prototype.push.apply(a.transformNodes,e.transformNodes),Array.prototype.push.apply(a.cameras,l),Array.prototype.push.apply(a.morphTargetManagers,u),a))})}canDirectLoad(e){return $(e)}directLoad(e,t){if(t.startsWith("base64,"+U)||t.startsWith(";base64,"+U)||t.startsWith("application/octet-stream;base64,"+U)||t.startsWith("model/gltf-binary;base64,"+U)){let r=(0,W.$K)(t);return this._validate(e,new Uint8Array(r,0,r.byteLength)),this._unpackBinaryAsync(new D.d({readAsync:(e,t)=>z(r,e,t),byteLength:r.byteLength}))}return this._validate(e,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(e){return new K(e[V])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise((e,t)=>{this.onCompleteObservable.addOnce(()=>{e()}),this.onErrorObservable.addOnce(e=>{t(e)})})}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(y[this._state]))}_loadFile(e,t,r,n,i,a){let s=e._loadFile(t,r,e=>{this._onProgress(e,s)},!0,n,i,a);return s.onCompleteObservable.add(()=>{s._lengthComputable=!0,s._total=s._loaded}),this._requests.push(s),s}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let r=!0,n=0,i=0;for(let e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;r=r&&e._lengthComputable,n+=e._loaded,i+=e._total}this._progressCallback({lengthComputable:r,loaded:n,total:r?i:0})}_validate(e,t,r="",n=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),G.ValidateAsync(t,r,n,t=>this.preprocessUrlAsync(r+t).then(t=>e._loadFileAsync(t,void 0,!0,!0).then(e=>new Uint8Array(e,0,e.byteLength)))).then(e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()},e=>{this._endPerformanceCounter("Validate JSON"),O.w1.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()}))}_getLoader(e){let t=e.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);let r=K._parseVersion(t.version);if(!r)throw Error("Invalid version: "+t.version);if(void 0!==t.minVersion){let e=K._parseVersion(t.minVersion);if(!e)throw Error("Invalid minimum version: "+t.minVersion);if(K._compareVersion(e,{major:2,minor:0})>0)throw Error("Incompatible minimum version: "+t.minVersion)}let n={1:K._CreateGLTF1Loader,2:K._CreateGLTF2Loader}[r.major];if(!n)throw Error("Unsupported version: "+t.version);return n(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);let t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then(()=>{let t,r=e.readUint32();if(0x46546c67!==r)throw new j.LH("Unexpected magic: "+r,j.SM.GLTFLoaderUnexpectedMagicError);let n=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);let i=e.readUint32();switch(!this.useRangeRequests&&i!==e.buffer.byteLength&&F.Y.Warn(`Length in header does not match actual data length: ${i} != ${e.buffer.byteLength}`),n){case 1:t=this._unpackBinaryV1Async(e,i);break;case 2:t=this._unpackBinaryV2Async(e,i);break;default:throw Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),t})}_unpackBinaryV1Async(e,t){let r=e.readUint32(),n=e.readUint32();if(0!==n)throw Error(`Unexpected content format: ${n}`);let i=t-e.byteOffset,a={json:this._parseJson(e.readString(r)),bin:null};if(0!==i){let t=e.byteOffset;a.bin={readAsync:(r,n)=>e.buffer.readAsync(t+r,n),byteLength:i}}return Promise.resolve(a)}_unpackBinaryV2Async(e,t){let r={JSON:0x4e4f534a,BIN:5130562},n=e.readUint32();if(e.readUint32()!==r.JSON)throw Error("First chunk format is not JSON");return e.byteOffset+n===t?e.loadAsync(n).then(()=>({json:this._parseJson(e.readString(n)),bin:null})):e.loadAsync(n+8).then(()=>{let i={json:this._parseJson(e.readString(n)),bin:null},a=()=>{let n=e.readUint32();switch(e.readUint32()){case r.JSON:throw Error("Unexpected JSON chunk");case r.BIN:{let t=e.byteOffset;i.bin={readAsync:(r,n)=>e.buffer.readAsync(t+r,n),byteLength:n},e.skipBytes(n);break}default:e.skipBytes(n)}return e.byteOffset!==t?e.loadAsync(8).then(a):Promise.resolve(i)};return a()})}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};let t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){let t=K._logSpaces.substring(0,2*this._logIndentLevel);F.Y.Log(`${t}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){O.w1.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){O.w1.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}K.IncrementalLoading=!0,K.HomogeneousCoordinates=!1,K._logSpaces="                                ",(0,L.oo)(new K),(s=v||(v={}))[s.BYTE=5120]="BYTE",s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.SHORT=5122]="SHORT",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.FLOAT=5126]="FLOAT",(o=b||(b={}))[o.FRAGMENT=35632]="FRAGMENT",o[o.VERTEX=35633]="VERTEX",(l=x||(x={}))[l.BYTE=5120]="BYTE",l[l.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",l[l.SHORT=5122]="SHORT",l[l.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",l[l.INT=5124]="INT",l[l.UNSIGNED_INT=5125]="UNSIGNED_INT",l[l.FLOAT=5126]="FLOAT",l[l.FLOAT_VEC2=35664]="FLOAT_VEC2",l[l.FLOAT_VEC3=35665]="FLOAT_VEC3",l[l.FLOAT_VEC4=35666]="FLOAT_VEC4",l[l.INT_VEC2=35667]="INT_VEC2",l[l.INT_VEC3=35668]="INT_VEC3",l[l.INT_VEC4=35669]="INT_VEC4",l[l.BOOL=35670]="BOOL",l[l.BOOL_VEC2=35671]="BOOL_VEC2",l[l.BOOL_VEC3=35672]="BOOL_VEC3",l[l.BOOL_VEC4=35673]="BOOL_VEC4",l[l.FLOAT_MAT2=35674]="FLOAT_MAT2",l[l.FLOAT_MAT3=35675]="FLOAT_MAT3",l[l.FLOAT_MAT4=35676]="FLOAT_MAT4",l[l.SAMPLER_2D=35678]="SAMPLER_2D",(u=T||(T={}))[u.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",u[u.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",u[u.REPEAT=10497]="REPEAT",(c=E||(E={}))[c.NEAREST=9728]="NEAREST",c[c.LINEAR=9728]="LINEAR",c[c.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",c[c.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",c[c.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",c[c.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",(d=A||(A={}))[d.ALPHA=6406]="ALPHA",d[d.RGB=6407]="RGB",d[d.RGBA=6408]="RGBA",d[d.LUMINANCE=6409]="LUMINANCE",d[d.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",(h=S||(S={}))[h.FRONT=1028]="FRONT",h[h.BACK=1029]="BACK",h[h.FRONT_AND_BACK=1032]="FRONT_AND_BACK",(f=I||(I={}))[f.ZERO=0]="ZERO",f[f.ONE=1]="ONE",f[f.SRC_COLOR=768]="SRC_COLOR",f[f.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",f[f.DST_COLOR=774]="DST_COLOR",f[f.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",f[f.SRC_ALPHA=770]="SRC_ALPHA",f[f.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",f[f.DST_ALPHA=772]="DST_ALPHA",f[f.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",f[f.CONSTANT_COLOR=32769]="CONSTANT_COLOR",f[f.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",f[f.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",f[f.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",f[f.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";var X=r(61834),Z=r(57423),q=r(82961),Q=r(29937),J=r(68763),ee=r(84959),et=r(6027),er=r(34403),en=r(69631),ei=r(40112),ea=r(46658),es=r(76723),eo=r(32160),el=r(91149),eu=r(31913),ec=r(81466),ed=r(70162),eh=r(74549),ef=r(51577),ep=r(88113),e_=r(94518),em=r(84966),eg=r(19218);class ey{static SetMatrix(e,t,r,n,i){let a=null;if("MODEL"===r.semantic?a=t.getWorldMatrix():"PROJECTION"===r.semantic?a=e.getProjectionMatrix():"VIEW"===r.semantic?a=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===r.semantic?a=X.y3.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===r.semantic?a=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===r.semantic?a=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===r.semantic?a=t.getWorldMatrix().invert():"VIEWINVERSE"===r.semantic?a=e.getViewMatrix().invert():"PROJECTIONINVERSE"===r.semantic?a=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===r.semantic?a=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===r.semantic?a=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===r.semantic&&(a=X.y3.Transpose(t.getWorldMatrix().invert())),a)switch(r.type){case x.FLOAT_MAT2:i.setMatrix2x2(n,X.y3.GetAsMatrix2x2(a));break;case x.FLOAT_MAT3:i.setMatrix3x3(n,X.y3.GetAsMatrix3x3(a));break;case x.FLOAT_MAT4:i.setMatrix(n,a)}}static SetUniform(e,t,r,n){switch(n){case x.FLOAT:return e.setFloat(t,r),!0;case x.FLOAT_VEC2:return e.setVector2(t,X.FM.FromArray(r)),!0;case x.FLOAT_VEC3:return e.setVector3(t,X.P.FromArray(r)),!0;case x.FLOAT_VEC4:return e.setVector4(t,X.Lt.FromArray(r)),!0;default:return!1}}static GetWrapMode(e){switch(e){case T.CLAMP_TO_EDGE:return eo.x.CLAMP_ADDRESSMODE;case T.MIRRORED_REPEAT:return eo.x.MIRROR_ADDRESSMODE;case T.REPEAT:default:return eo.x.WRAP_ADDRESSMODE}}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetTextureFilterMode(e){switch(e){case E.LINEAR:case E.LINEAR_MIPMAP_NEAREST:case E.LINEAR_MIPMAP_LINEAR:return eo.x.TRILINEAR_SAMPLINGMODE;case E.NEAREST:case E.NEAREST_MIPMAP_NEAREST:return eo.x.NEAREST_SAMPLINGMODE;default:return eo.x.BILINEAR_SAMPLINGMODE}}static GetBufferFromBufferView(e,t,r,n,i){r=t.byteOffset+r;let a=e.loadedBufferViews[t.buffer];if(r+n>a.byteLength)throw Error("Buffer access is out of range");let s=a.buffer;switch(r+=a.byteOffset,i){case v.BYTE:return new Int8Array(s,r,n);case v.UNSIGNED_BYTE:return new Uint8Array(s,r,n);case v.SHORT:return new Int16Array(s,r,n);case v.UNSIGNED_SHORT:return new Uint16Array(s,r,n);default:return new Float32Array(s,r,n)}}static GetBufferFromAccessor(e,t){let r=e.bufferViews[t.bufferView],n=t.count*ey.GetByteStrideFromType(t);return ey.GetBufferFromBufferView(e,r,t.byteOffset,n,t.componentType)}static DecodeBufferToText(e){let t="",r=e.byteLength;for(let n=0;n<r;++n)t+=String.fromCharCode(e[n]);return t}static GetDefaultMaterial(e){return ey._DefaultMaterial||(er.Q.ShadersStore.GLTFDefaultMaterialVertexShader="precision highp float;\n\nuniform mat4 worldView;\nuniform mat4 projection;\n\nattribute vec3 position;\n\nvoid main(void)\n{\n    gl_Position = projection * worldView * vec4(position, 1.0);\n}",er.Q.ShadersStore.GLTFDefaultMaterialPixelShader="precision highp float;\n\nuniform vec4 u_emission;\n\nvoid main(void)\n{\n    gl_FragColor = u_emission;\n}",ey._DefaultMaterial=new es.j("GLTFDefaultMaterial",e,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},{attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:[],needAlphaBlending:!1}),ey._DefaultMaterial.setColor4("u_emission",new Z.HE(.5,.5,.5,1))),ey._DefaultMaterial}}ey._DefaultMaterial=null;var ev=r(79474);(p=C||(C={}))[p.IDENTIFIER=1]="IDENTIFIER",p[p.UNKNOWN=2]="UNKNOWN",p[p.END_OF_INPUT=3]="END_OF_INPUT";class eb{constructor(e){this._pos=0,this.currentToken=C.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}getNextToken(){if(this.isEnd())return C.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=C.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=C.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}peek(){return this._toParse[this._pos]}read(){return this._toParse[this._pos++]}forward(){this._pos++}isEnd(){return this._pos>=this._maxPos}}let ex=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],eT=["world","view","projection","worldView","worldViewProjection","mBones"],eE=["translation","rotation","scale"],eA=["position","rotationQuaternion","scaling"],eS=(e,t)=>{for(let r in e){let n=e[r];t.buffers[r]=n,t.buffersCount++}},eI=(e,t)=>{for(let r in e){let n=e[r];t.shaders[r]=n,t.shaderscount++}},eC=(e,t,r)=>{for(let n in e){let i=e[n];r[t][n]=i}},eP=e=>{if(e)for(let t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},eR=e=>{if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";else if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){let t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},ew=e=>{for(let t in e.animations){let r=e.animations[t];if(!r.channels||!r.samplers)continue;let n=null;for(let i=0;i<r.channels.length;i++){let a=r.channels[i],s=r.samplers[a.sampler];if(!s)continue;let o=null,l=null;r.parameters?(o=r.parameters[s.input],l=r.parameters[s.output]):(o=s.input,l=s.output);let u=ey.GetBufferFromAccessor(e,e.accessors[o]),c=ey.GetBufferFromAccessor(e,e.accessors[l]),d=a.target.id,h=e.scene.getNodeById(d);if(null===h&&(h=e.scene.getNodeByName(d)),null===h){O.w1.Warn("Creating animation named "+t+". But cannot find node named "+d+" to attach to");continue}let f=h instanceof ee.N,p=a.target.path,_=eE.indexOf(p);-1!==_&&(p=eA[_]);let m=J.fw.ANIMATIONTYPE_MATRIX;f||("rotationQuaternion"===p?(m=J.fw.ANIMATIONTYPE_QUATERNION,h.rotationQuaternion=new X._f):m=J.fw.ANIMATIONTYPE_VECTOR3);let g=null,y=[],v=0,b=!1;f&&n&&n.getKeys().length===u.length&&(g=n,b=!0),b||(e.scene._blockEntityCollection=!!e.assetContainer,g=new J.fw(t,f?"_matrix":p,1,m,J.fw.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(let e=0;e<u.length;e++){let t=null;if("rotationQuaternion"===p?(t=X._f.FromArray([c[v],c[v+1],c[v+2],c[v+3]]),v+=4):(t=X.P.FromArray([c[v],c[v+1],c[v+2]]),v+=3),f){let r=h,i=X.P.Zero(),a=new X._f,s=X.P.Zero(),o=r.getBaseMatrix();b&&n&&(o=n.getKeys()[e].value),o.decompose(s,a,i),"position"===p?i=t:"rotationQuaternion"===p?a=t:s=t,t=X.y3.Compose(s,a,i)}b?n&&(n.getKeys()[e].value=t):y.push({frame:u[e],value:t})}!b&&g&&(g.setKeys(y),h.animations.push(g)),n=g,e.scene.stopAnimation(h),e.scene.beginAnimation(h,0,u[u.length-1],!0,1)}}},eM=e=>{let t=null;if(e.translation||e.rotation||e.scale){let r=X.P.FromArray(e.scale||[1,1,1]),n=X._f.FromArray(e.rotation||[0,0,0,1]),i=X.P.FromArray(e.translation||[0,0,0]);t=X.y3.Compose(r,n,i)}else t=X.y3.FromArray(e.matrix);return t},eO=(e,t,r,n)=>{for(let e=0;e<n.bones.length;e++)if(n.bones[e].name===r)return n.bones[e];let i=e.nodes;for(let a in i){let s=i[a];if(!s.jointName)continue;let o=s.children;for(let i=0;i<o.length;i++){let l=e.nodes[o[i]];if(l.jointName&&l.jointName===r){let r=eM(s),i=new ee.N(s.name||"",n,eO(e,t,s.jointName,n),r);return i.id=a,i}}}return null},eL=(e,t)=>{for(let r=0;r<e.length;r++){let n=e[r];for(let e=0;e<n.node.children.length;e++)if(n.node.children[e]===t)return n.bone}return null},eN=(e,t)=>{let r=e.nodes,n=r[t];if(n)return{node:n,id:t};for(let e in r)if((n=r[e]).jointName===t)return{node:n,id:e};return null},eF=(e,t)=>{for(let r=0;r<e.jointNames.length;r++)if(e.jointNames[r]===t)return!0;return!1},eD=(e,t,r,n)=>{for(let i in e.nodes){let a=e.nodes[i];if(!a.jointName||eF(r,a.jointName))continue;let s=eM(a),o=new ee.N(a.name||"",t,null,s);o.id=i,n.push({bone:o,node:a,id:i})}for(let e=0;e<n.length;e++){let t=n[e],r=t.node.children;for(let e=0;e<r.length;e++){let i=null;for(let t=0;t<n.length;t++)if(n[t].id===r[e]){i=n[t];break}i&&(i.bone._parent=t.bone,t.bone.children.push(i.bone))}}},eB=(e,t,r,n)=>{if(n||(n=new et.O(t.name||"","",e.scene)),!t.babylonSkeleton)return n;let i=[],a=[];eD(e,n,t,i),n.bones=[];for(let r=0;r<t.jointNames.length;r++){let s=eN(e,t.jointNames[r]);if(!s)continue;let o=s.node;if(!o){O.w1.Warn("Joint named "+t.jointNames[r]+" does not exist");continue}let l=s.id,u=e.scene.getBoneById(l);if(u){n.bones.push(u);continue}let c=!1,d=null;for(let i=0;i<r;i++){let r=eN(e,t.jointNames[i]);if(!r)continue;let a=r.node;if(!a){O.w1.Warn("Joint named "+t.jointNames[i]+" does not exist when looking for parent");continue}let s=a.children;if(s){c=!1;for(let r=0;r<s.length;r++)if(s[r]===l){d=eO(e,t,t.jointNames[i],n),c=!0;break}if(c)break}}let h=eM(o);!d&&i.length>0&&(d=eL(i,l))&&-1===a.indexOf(d)&&a.push(d),new ee.N(o.jointName||"",n,d,h).id=l}let s=n.bones;n.bones=[];for(let r=0;r<t.jointNames.length;r++){let i=eN(e,t.jointNames[r]);if(i){for(let e=0;e<s.length;e++)if(s[e].id===i.id){n.bones.push(s[e]);break}}}n.prepare();for(let e=0;e<a.length;e++)n.bones.push(a[e]);return n},ek=(e,t,r,n,i)=>{let a;if(i||(e.scene._blockEntityCollection=!!e.assetContainer,(i=new ef.Kj(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,i.id=n),!t.babylonNode)return i;let s=[],o=null,l=[],u=[],c=[],d=[];for(let t=0;t<r.length;t++){let n=r[t],i=e.meshes[n];if(i)for(let t=0;t<i.primitives.length;t++){let r=new el.x,n=i.primitives[t];n.mode;let a=n.attributes,h=null,f=null;for(let t in a)if(h=e.accessors[a[t]],f=ey.GetBufferFromAccessor(e,h),"NORMAL"===t)r.normals=new Float32Array(f.length),r.normals.set(f);else if("POSITION"===t){if(K.HomogeneousCoordinates){r.positions=new Float32Array(f.length-f.length/4);for(let e=0;e<f.length;e+=4)r.positions[e]=f[e],r.positions[e+1]=f[e+1],r.positions[e+2]=f[e+2]}else r.positions=new Float32Array(f.length),r.positions.set(f);u.push(r.positions.length)}else if(-1!==t.indexOf("TEXCOORD_")){let e=Number(t.split("_")[1]),n=eu.o.UVKind+(0===e?"":e+1),i=new Float32Array(f.length);i.set(f),eP(i),r.set(i,n)}else"JOINT"===t?(r.matricesIndices=new Float32Array(f.length),r.matricesIndices.set(f)):"WEIGHT"===t?(r.matricesWeights=new Float32Array(f.length),r.matricesWeights.set(f)):"COLOR"===t&&(r.colors=new Float32Array(f.length),r.colors.set(f));if(h=e.accessors[n.indices])r.indices=new Int32Array((f=ey.GetBufferFromAccessor(e,h)).length),r.indices.set(f),d.push(r.indices.length);else{let e=[];for(let t=0;t<r.positions.length/3;t++)e.push(t);r.indices=new Int32Array(e),d.push(r.indices.length)}o?o.merge(r):o=r;let p=e.scene.getMaterialById(n.material);s.push(null===p?ey.GetDefaultMaterial(e.scene):p),l.push(0===l.length?0:l[l.length-1]+u[u.length-2]),c.push(0===c.length?0:c[c.length-1]+d[d.length-2])}}e.scene._blockEntityCollection=!!e.assetContainer,s.length>1?(a=new ei.G("multimat"+n,e.scene)).subMaterials=s:a=new ea.K("multimat"+n,e.scene),1===s.length&&(a=s[0]),a._parentContainer=e.assetContainer,i.material||(i.material=a),new ec.Z(n,e.scene,o,!1,i),i.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,i.subMeshes=[];let h=0;for(let t=0;t<r.length;t++){let n=r[t],a=e.meshes[n];if(a)for(let e=0;e<a.primitives.length;e++)a.primitives[e].mode,ed.P.AddToMesh(h,l[h],u[h],c[h],d[h],i,i,!0),h++}return i},eG=(e,t,r,n)=>{e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=r),e.scaling&&(e.scaling=n)},eU=(e,t)=>{if(t.matrix){let r=new X.P(0,0,0),n=new X._f,i=new X.P(0,0,0);X.y3.FromArray(t.matrix).decompose(i,n,r),eG(e,r,n,i)}else t.translation&&t.rotation&&t.scale&&eG(e,X.P.FromArray(t.translation),X._f.FromArray(t.rotation),X.P.FromArray(t.scale));e.computeWorldMatrix(!0)},eV=(e,t,r)=>{let n=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){let i=e.skins[t.skin],a=ek(e,t,t.meshes,r,t.babylonNode);a.skeleton=e.scene.getLastSkeletonById(t.skin),null===a.skeleton&&(a.skeleton=eB(e,i,a,i.babylonSkeleton),i.babylonSkeleton||(i.babylonSkeleton=a.skeleton)),n=a}}else if(t.meshes)n=ek(e,t,t.mesh?[t.mesh]:t.meshes,r,t.babylonNode);else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){let r=e.cameras[t.camera];if(r){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===r.type){let r=new Q.c(t.camera,X.P.Zero(),e.scene,!1);r.name=t.name||"",r.mode=q.V.ORTHOGRAPHIC_CAMERA,r.attachControl(),n=r,r._parentContainer=e.assetContainer}else if("perspective"===r.type){let i=r[r.type],a=new Q.c(t.camera,X.P.Zero(),e.scene,!1);a.name=t.name||"",a.attachControl(),i.aspectRatio||(i.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),i.znear&&i.zfar&&(a.maxZ=i.zfar,a.minZ=i.znear),n=a,a._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{let r=e.lights[t.light];if(r){if("ambient"===r.type){let i=r[r.type],a=new ep.e(t.light,X.P.Zero(),e.scene);a.name=t.name||"",i.color&&(a.diffuse=Z.Wo.FromArray(i.color)),n=a}else if("directional"===r.type){let i=r[r.type],a=new e_.O(t.light,X.P.Zero(),e.scene);a.name=t.name||"",i.color&&(a.diffuse=Z.Wo.FromArray(i.color)),n=a}else if("point"===r.type){let i=r[r.type],a=new em.c(t.light,X.P.Zero(),e.scene);a.name=t.name||"",i.color&&(a.diffuse=Z.Wo.FromArray(i.color)),n=a}else if("spot"===r.type){let i=r[r.type],a=new eg.P(t.light,X.P.Zero(),X.P.Zero(),0,0,e.scene);a.name=t.name||"",i.color&&(a.diffuse=Z.Wo.FromArray(i.color)),i.fallOfAngle&&(a.angle=i.fallOfAngle),i.fallOffExponent&&(a.exponent=i.fallOffExponent),n=a}}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;else if(null===n){e.scene._blockEntityCollection=!!e.assetContainer;let r=new ef.Kj(t.name||"",e.scene);r._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=r,n=r}}if(null!==n){if(t.matrix&&n instanceof ef.Kj)eU(n,t);else{let e=t.translation||[0,0,0],r=t.rotation||[0,0,0,1],i=t.scale||[1,1,1];eG(n,X.P.FromArray(e),X._f.FromArray(r),X.P.FromArray(i))}n.updateCache(!0),t.babylonNode=n}return n},eH=(e,t,r,n=!1)=>{let i=e.nodes[t],a=null;if(n=!e.importOnlyMeshes||!!n||!e.importMeshesNames||-1!==e.importMeshesNames.indexOf(i.name||"")||0===e.importMeshesNames.length,!i.jointName&&n&&null!==(a=eV(e,i,t))&&(a.id=t,a.parent=r),i.children)for(let t=0;t<i.children.length;t++)eH(e,i.children[t],a,n)},e$=e=>{let t=e.currentScene;if(t)for(let r=0;r<t.nodes.length;r++)eH(e,t.nodes[r],null);else for(let r in e.scenes){t=e.scenes[r];for(let r=0;r<t.nodes.length;r++)eH(e,t.nodes[r],null)}ew(e);for(let t=0;t<e.scene.skeletons.length;t++){let r=e.scene.skeletons[t];e.scene.beginAnimation(r,0,Number.MAX_VALUE,!0,1)}},eW=(e,t,r,n,i,a,s)=>{let o=a.values||i.parameters;for(let s in r){let l=r[s],u=l.type;if(u===x.FLOAT_MAT2||u===x.FLOAT_MAT3||u===x.FLOAT_MAT4)if(!l.semantic||l.source||l.node){if(l.semantic&&(l.source||l.node)){let e=t.scene.getNodeByName(l.source||l.node||"");if(null===e&&(e=t.scene.getNodeById(l.source||l.node||"")),null===e)continue;ey.SetMatrix(t.scene,e,l,s,n.getEffect())}}else ey.SetMatrix(t.scene,e,l,s,n.getEffect());else{let e=o[i.uniforms[s]];if(!e)continue;if(u===x.SAMPLER_2D){let r=t.textures[a.values?e:l.value].babylonTexture;if(null==r)continue;n.getEffect().setTexture(s,r)}else ey.SetUniform(n.getEffect(),s,e,u)}}s(n)},ej=(e,t,r,n,i)=>{let a=n.values||r.parameters,s=r.uniforms;for(let r in i){let o=i[r],l=o.type,u=a[s[r]];if(void 0===u&&(u=o.value),!u)continue;let c=e=>r=>{o.value&&e&&(t.setTexture(e,r),delete i[e])};l===x.SAMPLER_2D?eQ.LoadTextureAsync(e,n.values?u:o.value,c(r),()=>c(null)):o.value&&ey.SetUniform(t,r,n.values?u:o.value,l)&&delete i[r]}},ez=(e,t,r)=>(n,i)=>{t.dispose(!0),r("Cannot compile program named "+e.name+". Error: "+i+". Default material will be applied")},eY=(e,t,r,n,i,a)=>s=>{ej(e,t,r,n,i),t.onBind=s=>{eW(s,e,i,t,r,n,a)}},eK=(e,t,r)=>{for(let n in t.uniforms){let i=t.uniforms[n],a=t.parameters[i];if(e.currentIdentifier===n&&a.semantic&&!a.source&&!a.node){let e=ex.indexOf(a.semantic);if(-1!==e)return delete r[n],eT[e]}}return e.currentIdentifier},eX=e=>{for(let t in e.materials)eQ.LoadMaterialAsync(e,t,()=>{},()=>{})};class eZ{static CreateRuntime(e,t,r){let n={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:r,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&eC(e.extensions,"extensions",n),e.extensionsUsed&&eC(e.extensionsUsed,"extensionsUsed",n),e.buffers&&eS(e.buffers,n),e.bufferViews&&eC(e.bufferViews,"bufferViews",n),e.accessors&&eC(e.accessors,"accessors",n),e.meshes&&eC(e.meshes,"meshes",n),e.lights&&eC(e.lights,"lights",n),e.cameras&&eC(e.cameras,"cameras",n),e.nodes&&eC(e.nodes,"nodes",n),e.images&&eC(e.images,"images",n),e.textures&&eC(e.textures,"textures",n),e.shaders&&eI(e.shaders,n),e.programs&&eC(e.programs,"programs",n),e.samplers&&eC(e.samplers,"samplers",n),e.techniques&&eC(e.techniques,"techniques",n),e.materials&&eC(e.materials,"materials",n),e.animations&&eC(e.animations,"animations",n),e.skins&&eC(e.skins,"skins",n),e.scenes&&(n.scenes=e.scenes),e.scene&&e.scenes&&(n.currentScene=e.scenes[e.scene]),n}static LoadBufferAsync(e,t,r,n,i){let a=e.buffers[t];O.w1.IsBase64(a.uri)?setTimeout(()=>r(new Uint8Array(O.w1.DecodeBase64(a.uri)))):O.w1.LoadFile(e.rootUrl+a.uri,e=>r(new Uint8Array(e)),i,void 0,!0,e=>{e&&n(e.status+" "+e.statusText)})}static LoadTextureBufferAsync(e,t,r,n){let i=e.textures[t];if(!i||!i.source)return void n("");if(i.babylonTexture)return void r(null);let a=e.images[i.source];O.w1.IsBase64(a.uri)?setTimeout(()=>r(new Uint8Array(O.w1.DecodeBase64(a.uri)))):O.w1.LoadFile(e.rootUrl+a.uri,e=>r(new Uint8Array(e)),void 0,void 0,!0,e=>{e&&n(e.status+" "+e.statusText)})}static CreateTextureAsync(e,t,r,n){let i=e.textures[t];if(i.babylonTexture)return void n(i.babylonTexture);let a=e.samplers[i.sampler],s=a.minFilter===E.NEAREST_MIPMAP_NEAREST||a.minFilter===E.NEAREST_MIPMAP_LINEAR||a.minFilter===E.LINEAR_MIPMAP_NEAREST||a.minFilter===E.LINEAR_MIPMAP_LINEAR,o=eo.x.BILINEAR_SAMPLINGMODE,l=null==r?new Blob:new Blob([r]),u=URL.createObjectURL(l),c=()=>URL.revokeObjectURL(u),d=new eo.x(u,e.scene,!s,!0,o,c,c);void 0!==a.wrapS&&(d.wrapU=ey.GetWrapMode(a.wrapS)),void 0!==a.wrapT&&(d.wrapV=ey.GetWrapMode(a.wrapT)),d.name=t,i.babylonTexture=d,n(d)}static LoadShaderStringAsync(e,t,r,n){let i=e.shaders[t];if(O.w1.IsBase64(i.uri)){let e=atob(i.uri.split(",")[1]);r&&r(e)}else O.w1.LoadFile(e.rootUrl+i.uri,r,void 0,void 0,!1,e=>{e&&n&&n(e.status+" "+e.statusText)})}static LoadMaterialAsync(e,t,r,n){let i=e.materials[t];if(!i.technique){n&&n("No technique found.");return}let a=e.techniques[i.technique];if(!a){e.scene._blockEntityCollection=!!e.assetContainer;let n=new ea.K(t,e.scene);n._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,n.diffuseColor=new Z.Wo(.5,.5,.5),n.sideOrientation=en.F.CounterClockWiseSideOrientation,r(n);return}let s=e.programs[a.program],o=a.states,l=er.Q.ShadersStore[s.vertexShader+"VertexShader"],u=er.Q.ShadersStore[s.fragmentShader+"PixelShader"],c="",d="",h=new eb(l),f=new eb(u),p={},_=[],m=[],g=[];for(let e in a.uniforms){let t=a.uniforms[e],r=a.parameters[t];if(p[e]=r,!r.semantic||r.node||r.source)r.type===x.SAMPLER_2D?g.push(e):_.push(e);else{let t=ex.indexOf(r.semantic);-1!==t?(_.push(eT[t]),delete p[e]):_.push(e)}}for(let e in a.attributes){let t=a.attributes[e],r=a.parameters[t];if(r.semantic){let e=eR(r);e&&m.push(e)}}for(;!h.isEnd()&&h.getNextToken();){if(h.currentToken!==C.IDENTIFIER){c+=h.currentString;continue}let e=!1;for(let t in a.attributes){let r=a.attributes[t],n=a.parameters[r];if(h.currentIdentifier===t&&n.semantic){c+=eR(n),e=!0;break}}e||(c+=eK(h,a,p))}for(;!f.isEnd()&&f.getNextToken();){if(f.currentToken!==C.IDENTIFIER){d+=f.currentString;continue}d+=eK(f,a,p)}let y={vertex:s.vertexShader+t,fragment:s.fragmentShader+t},v={attributes:m,uniforms:_,samplers:g,needAlphaBlending:o&&o.enable&&-1!==o.enable.indexOf(3042)};er.Q.ShadersStore[s.vertexShader+t+"VertexShader"]=c,er.Q.ShadersStore[s.fragmentShader+t+"PixelShader"]=d;let b=new es.j(t,e.scene,y,v);if(b.onError=ez(s,b,n),b.onCompiled=eY(e,b,a,i,p,r),b.sideOrientation=en.F.CounterClockWiseSideOrientation,o&&o.functions){let e=o.functions;e.cullFace&&e.cullFace[0]!==S.BACK&&(b.backFaceCulling=!1);let t=e.blendFuncSeparate;t&&(t[0]===I.SRC_ALPHA&&t[1]===I.ONE_MINUS_SRC_ALPHA&&t[2]===I.ONE&&t[3]===I.ONE?b.alphaMode=ev.g.ALPHA_COMBINE:t[0]===I.ONE&&t[1]===I.ONE&&t[2]===I.ZERO&&t[3]===I.ONE?b.alphaMode=ev.g.ALPHA_ONEONE:t[0]===I.SRC_ALPHA&&t[1]===I.ONE&&t[2]===I.ZERO&&t[3]===I.ONE?b.alphaMode=ev.g.ALPHA_ADD:t[0]===I.ZERO&&t[1]===I.ONE_MINUS_SRC_COLOR&&t[2]===I.ONE&&t[3]===I.ONE?b.alphaMode=ev.g.ALPHA_SUBTRACT:t[0]===I.DST_COLOR&&t[1]===I.ZERO&&t[2]===I.ONE&&t[3]===I.ONE?b.alphaMode=ev.g.ALPHA_MULTIPLY:t[0]===I.SRC_ALPHA&&t[1]===I.ONE_MINUS_SRC_COLOR&&t[2]===I.ONE&&t[3]===I.ONE&&(b.alphaMode=ev.g.ALPHA_MAXIMIZED))}}}class eq{static RegisterExtension(e){if(eq.Extensions[e.name])return void O.w1.Error('Tool with the same name "'+e.name+'" already exists');eq.Extensions[e.name]=e}dispose(){}_importMeshAsync(e,t,r,n,i,a,s,o){return t.useRightHandedSystem=!0,eQ.LoadRuntimeAsync(t,r,n,t=>{t.assetContainer=i,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],O.w1.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],this._createNodes(t);let r=[],n=[];for(let e in t.nodes){let n=t.nodes[e];n.babylonNode instanceof eh.x&&r.push(n.babylonNode)}for(let e in t.skins){let r=t.skins[e];r.babylonSkeleton instanceof et.O&&n.push(r.babylonSkeleton)}this._loadBuffersAsync(t,()=>{this._loadShadersAsync(t,()=>{eX(t),e$(t),!K.IncrementalLoading&&a&&a(r,n)})}),K.IncrementalLoading&&a&&a(r,n)},o),!0}importMeshAsync(e,t,r,n,i,a){return new Promise((s,o)=>{this._importMeshAsync(e,t,n,i,r,(e,t)=>{s({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})},a,e=>{o(Error(e))})})}_loadAsync(e,t,r,n,i,a){e.useRightHandedSystem=!0,eQ.LoadRuntimeAsync(e,t,r,e=>{eQ.LoadRuntimeExtensionsAsync(e,()=>{this._createNodes(e),this._loadBuffersAsync(e,()=>{this._loadShadersAsync(e,()=>{eX(e),e$(e),K.IncrementalLoading||n()})}),K.IncrementalLoading&&n()},a)},a)}async loadAsync(e,t,r,n){return await new Promise((i,a)=>{this._loadAsync(e,t,r,()=>{i()},n,e=>{a(Error(e))})})}_loadShadersAsync(e,t){let r=!1,n=(r,n)=>{eQ.LoadShaderStringAsync(e,r,i=>{i instanceof ArrayBuffer||(e.loadedShaderCount++,i&&(er.Q.ShadersStore[r+(n.type===b.VERTEX?"VertexShader":"PixelShader")]=i),e.loadedShaderCount===e.shaderscount&&t())},()=>{O.w1.Error("Error when loading shader program named "+r+" located at "+n.uri)})};for(let t in e.shaders){r=!0;let i=e.shaders[t];i?n.bind(this,t,i)():O.w1.Error("No shader named: "+t)}r||t()}_loadBuffersAsync(e,t){let r=!1,n=(r,n)=>{eQ.LoadBufferAsync(e,r,i=>{e.loadedBufferCount++,i&&(i.byteLength!=e.buffers[r].byteLength&&O.w1.Error("Buffer named "+r+" is length "+i.byteLength+". Expected: "+n.byteLength),e.loadedBufferViews[r]=i),e.loadedBufferCount===e.buffersCount&&t()},()=>{O.w1.Error("Error when loading buffer named "+r+" located at "+n.uri)})};for(let t in e.buffers){r=!0;let i=e.buffers[t];i?n.bind(this,t,i)():O.w1.Error("No buffer named: "+t)}r||t()}_createNodes(e){let t=e.currentScene;if(t)for(let r=0;r<t.nodes.length;r++)eH(e,t.nodes[r],null);else for(let r in e.scenes){t=e.scenes[r];for(let r=0;r<t.nodes.length;r++)eH(e,t.nodes[r],null)}}}eq.Extensions={};class eQ{constructor(e){this._name=e}get name(){return this._name}loadRuntimeAsync(e,t,r,n,i){return!1}loadRuntimeExtensionsAsync(e,t,r){return!1}loadBufferAsync(e,t,r,n,i){return!1}loadTextureBufferAsync(e,t,r,n){return!1}createTextureAsync(e,t,r,n,i){return!1}loadShaderStringAsync(e,t,r,n){return!1}loadMaterialAsync(e,t,r,n){return!1}static LoadRuntimeAsync(e,t,r,n,i){eQ._ApplyExtensions(a=>a.loadRuntimeAsync(e,t,r,n,i),()=>{setTimeout(()=>{n&&n(eZ.CreateRuntime(t.json,e,r))})})}static LoadRuntimeExtensionsAsync(e,t,r){eQ._ApplyExtensions(n=>n.loadRuntimeExtensionsAsync(e,t,r),()=>{setTimeout(()=>{t()})})}static LoadBufferAsync(e,t,r,n,i){eQ._ApplyExtensions(a=>a.loadBufferAsync(e,t,r,n,i),()=>{eZ.LoadBufferAsync(e,t,r,n,i)})}static LoadTextureAsync(e,t,r,n){eQ._LoadTextureBufferAsync(e,t,i=>{i&&eQ._CreateTextureAsync(e,t,i,r,n)},n)}static LoadShaderStringAsync(e,t,r,n){eQ._ApplyExtensions(i=>i.loadShaderStringAsync(e,t,r,n),()=>{eZ.LoadShaderStringAsync(e,t,r,n)})}static LoadMaterialAsync(e,t,r,n){eQ._ApplyExtensions(i=>i.loadMaterialAsync(e,t,r,n),()=>{eZ.LoadMaterialAsync(e,t,r,n)})}static _LoadTextureBufferAsync(e,t,r,n){eQ._ApplyExtensions(i=>i.loadTextureBufferAsync(e,t,r,n),()=>{eZ.LoadTextureBufferAsync(e,t,r,n)})}static _CreateTextureAsync(e,t,r,n,i){eQ._ApplyExtensions(a=>a.createTextureAsync(e,t,r,n,i),()=>{eZ.CreateTextureAsync(e,t,r,n)})}static _ApplyExtensions(e,t){for(let t in eq.Extensions)if(e(eq.Extensions[t]))return;t()}}K._CreateGLTF1Loader=()=>new eq;class eJ extends eQ{constructor(){super("KHR_binary_glTF")}loadRuntimeAsync(e,t,r,n){let i=t.json.extensionsUsed;return!!i&&-1!==i.indexOf(this.name)&&!!t.bin&&(this._bin=t.bin,n(eZ.CreateRuntime(t.json,e,r)),!0)}loadBufferAsync(e,t,r,n){return -1!==e.extensionsUsed.indexOf(this.name)&&"binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(r,e=>n(e.message)),!0)}loadTextureBufferAsync(e,t,r){let n=e.textures[t],i=e.images[n.source];if(!i.extensions||!(this.name in i.extensions))return!1;let a=i.extensions[this.name],s=e.bufferViews[a.bufferView];return r(ey.GetBufferFromBufferView(e,s,0,s.byteLength,v.UNSIGNED_BYTE)),!0}loadShaderStringAsync(e,t,r){let n=e.shaders[t];if(!n.extensions||!(this.name in n.extensions))return!1;let i=n.extensions[this.name],a=e.bufferViews[i.bufferView],s=ey.GetBufferFromBufferView(e,a,0,a.byteLength,v.UNSIGNED_BYTE);return setTimeout(()=>{r(ey.DecodeBufferToText(s))}),!0}}eq.RegisterExtension(new eJ);class e0 extends eQ{constructor(){super("KHR_materials_common")}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;let t=e.extensions[this.name];if(!t)return!1;let r=t.lights;if(r)for(let t in r){let n=r[t];switch(n.type){case"ambient":{let t=new ep.e(n.name,new X.P(0,1,0),e.scene),r=n.ambient;r&&(t.diffuse=Z.Wo.FromArray(r.color||[1,1,1]));break}case"point":{let t=new em.c(n.name,new X.P(10,10,10),e.scene),r=n.point;r&&(t.diffuse=Z.Wo.FromArray(r.color||[1,1,1]));break}case"directional":{let t=new e_.O(n.name,new X.P(0,-1,0),e.scene),r=n.directional;r&&(t.diffuse=Z.Wo.FromArray(r.color||[1,1,1]));break}case"spot":{let t=n.spot;t&&(new eg.P(n.name,new X.P(0,10,0),new X.P(0,-1,0),t.fallOffAngle||Math.PI,t.fallOffExponent||0,e.scene).diffuse=Z.Wo.FromArray(t.color||[1,1,1]));break}default:O.w1.Warn('GLTF Material Common extension: light type "'+n.type+"” not supported")}}return!1}loadMaterialAsync(e,t,r,n){let i=e.materials[t];if(!i||!i.extensions)return!1;let a=i.extensions[this.name];if(!a)return!1;let s=new ea.K(t,e.scene);return s.sideOrientation=en.F.CounterClockWiseSideOrientation,"CONSTANT"===a.technique&&(s.disableLighting=!0),s.backFaceCulling=void 0!==a.doubleSided&&!a.doubleSided,s.alpha=void 0===a.values.transparency?1:a.values.transparency,s.specularPower=void 0===a.values.shininess?0:a.values.shininess,"string"==typeof a.values.ambient?this._loadTexture(e,a.values.ambient,s,"ambientTexture",n):s.ambientColor=Z.Wo.FromArray(a.values.ambient||[0,0,0]),"string"==typeof a.values.diffuse?this._loadTexture(e,a.values.diffuse,s,"diffuseTexture",n):s.diffuseColor=Z.Wo.FromArray(a.values.diffuse||[0,0,0]),"string"==typeof a.values.emission?this._loadTexture(e,a.values.emission,s,"emissiveTexture",n):s.emissiveColor=Z.Wo.FromArray(a.values.emission||[0,0,0]),"string"==typeof a.values.specular?this._loadTexture(e,a.values.specular,s,"specularTexture",n):s.specularColor=Z.Wo.FromArray(a.values.specular||[0,0,0]),!0}_loadTexture(e,t,r,n,i){eZ.LoadTextureBufferAsync(e,t,i=>{eZ.CreateTextureAsync(e,t,i,e=>r[n]=e)},i)}}eq.RegisterExtension(new e0);var e1=r(92687),e2=r(92731),e3=r(27987),e4=r(46397),e5=r(58871),e6=r(57271);let e8=new Map,e7=e8;function e9(e,t,r){te(e)&&F.Y.Warn(`Extension with the name '${e}' already exists`),e8.set(e,{isGLTFExtension:t,factory:r})}function te(e){return e8.delete(e)}var tt=r(81453),tr=r(96358),tn=r(37914);class ti{static Get(e,t,r){if(!t||void 0==r||!t[r])throw Error(`${e}: Failed to find index (${r})`);return t[r]}static TryGet(e,t){return e&&void 0!=t&&e[t]?e[t]:null}static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}}function ta(e){if(e.min&&e.max){let t=e.min,r=e.max,n=X.jp.Vector3["0"].copyFromFloats(t[0],t[1],t[2]),i=X.jp.Vector3["1"].copyFromFloats(r[0],r[1],r[2]);if(e.normalized&&5126!==e.componentType){let t=1;switch(e.componentType){case 5120:t=127;break;case 5121:t=255;break;case 5122:t=32767;break;case 5123:t=65535}let r=1/t;n.scaleInPlace(r),i.scaleInPlace(r)}return new e6.j(n,i)}return null}class ts{static RegisterExtension(e,t){e9(e,!1,t)}static UnregisterExtension(e){return te(e)}get gltf(){if(!this._gltf)throw Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=[],this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=[],this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=[],this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(e=>e.dispose&&e.dispose()),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(e,t,r,n,i,a,s=""){return await Promise.resolve().then(async()=>{this._babylonScene=t,this._assetContainer=r,this._loadData(n);let a=null;if(e){let t={};if(this._gltf.nodes)for(let e of this._gltf.nodes)e.name&&(t[e.name]=e.index);a=(e instanceof Array?e:[e]).map(e=>{let r=t[e];if(void 0===r)throw Error(`Failed to find node '${e}'`);return r})}return await this._loadAsync(i,s,a,()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]}))})}async loadAsync(e,t,r,n,i=""){return this._babylonScene=e,this._loadData(t),await this._loadAsync(r,i,null,()=>void 0)}async _loadAsync(e,t,r,n){return await Promise.resolve().then(async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();let i=`${y[y.LOADING]} => ${y[y.READY]}`,a=`${y[y.LOADING]} => ${y[y.COMPLETE]}`;this._parent._startPerformanceCounter(i),this._parent._startPerformanceCounter(a),this._parent._setState(y.LOADING),this._extensionsOnLoading();let s=[],o=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials){if(r)s.push(this.loadSceneAsync("/nodes",{nodes:r,index:-1}));else if(void 0!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){let e=ti.Get("/scene",this._gltf.scenes,this._gltf.scene||0);s.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){let t=this._gltf.materials[e],r="/materials/"+e,n=en.F.TriangleFillMode;s.push(this._loadMaterialAsync(r,t,null,n,()=>{}))}this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=o:this._babylonScene._forceBlockMaterialDirtyMechanism(o),this._parent.compileMaterials&&s.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&s.push(this._compileShadowGeneratorsAsync());let l=Promise.all(s).then(()=>{for(let e of(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0),this._babylonScene.materials))void 0!==e.maxSimultaneousLights&&(e.maxSimultaneousLights=Math.max(e.maxSimultaneousLights,this._babylonScene.lights.length));return this._extensionsOnReady(),this._parent._setState(y.READY),this._skipStartAnimationStep||this._startAnimations(),n()});return await l.then(e=>(this._parent._endPerformanceCounter(i),O.w1.SetImmediate(()=>{this._disposed||Promise.all(this._completePromises).then(()=>{this._parent._endPerformanceCounter(a),this._parent._setState(y.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()},e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()})}),e))}).catch(e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e})}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){let t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){let r=t[0];(r.byteLength<e.bin.byteLength-3||r.byteLength>e.bin.byteLength)&&F.Y.Warn(`Binary buffer length (${r.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else F.Y.Warn("Unexpected BIN chunk")}}_setupData(){if(ti.Assign(this._gltf.accessors),ti.Assign(this._gltf.animations),ti.Assign(this._gltf.buffers),ti.Assign(this._gltf.bufferViews),ti.Assign(this._gltf.cameras),ti.Assign(this._gltf.images),ti.Assign(this._gltf.materials),ti.Assign(this._gltf.meshes),ti.Assign(this._gltf.nodes),ti.Assign(this._gltf.samplers),ti.Assign(this._gltf.scenes),ti.Assign(this._gltf.skins),ti.Assign(this._gltf.textures),this._gltf.nodes){let e={};for(let t of this._gltf.nodes)if(t.children)for(let r of t.children)e[r]=t.index;let t=this._createRootNode();for(let r of this._gltf.nodes){let n=e[r.index];r.parent=void 0===n?t:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){let e=[];if(e7.forEach((t,r)=>{this.parent.extensionOptions[r]?.enabled===!1?t.isGLTFExtension&&this.isExtensionUsed(r)&&F.Y.Warn(`Extension ${r} is used but has been explicitly disabled.`):(!t.isGLTFExtension||this.isExtensionUsed(r))&&e.push((async()=>{let e=await t.factory(this);return e.name!==r&&F.Y.Warn(`The name of the glTF loader extension instance does not match the registered name: ${e.name} !== ${r}`),this._parent.onExtensionLoadedObservable.notifyObservers(e),e})())}),this._extensions.push(...await Promise.all(e)),this._extensions.sort((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE)),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired){for(let e of this._gltf.extensionsRequired)if(!this._extensions.some(t=>t.name===e&&t.enabled)){if(this.parent.extensionOptions[e]?.enabled===!1)throw Error(`Required extension ${e} is disabled`);throw Error(`Required extension ${e} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;let e=new ef.Kj("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);let t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case m.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],ts._LoadTransform(t,this._rootBabylonMesh));break;case m.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),t}loadSceneAsync(e,t){let r=this._extensionsLoadSceneAsync(e,t);if(r)return r;let n=[];if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(let r of t.nodes){let t=ti.Get(`${e}/nodes/${r}`,this._gltf.nodes,r);n.push(this.loadNodeAsync(`/nodes/${t.index}`,t,e=>{e.parent=this._rootBabylonMesh}))}for(let e of this._postSceneLoadActions)e();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then(()=>{})}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(let r of e._primitiveBabylonMeshes)t(r)}_getGeometries(){let e=[],t=this._gltf.nodes;if(t)for(let r of t)this._forEachPrimitive(r,t=>{let r=t.geometry;r&&-1===e.indexOf(r)&&e.push(r)});return e}_getMeshes(){let e=[];this._rootBabylonMesh instanceof eh.x&&e.push(this._rootBabylonMesh);let t=this._gltf.nodes;if(t)for(let r of t)this._forEachPrimitive(r,t=>{e.push(t)});return e}_getTransformNodes(){let e=[],t=this._gltf.nodes;if(t)for(let r of t)r._babylonTransformNode&&"TransformNode"===r._babylonTransformNode.getClassName()&&e.push(r._babylonTransformNode),r._babylonTransformNodeForSkin&&e.push(r._babylonTransformNodeForSkin);return e}_getSkeletons(){let e=[],t=this._gltf.skins;if(t)for(let r of t)r._data&&e.push(r._data.babylonSkeleton);return e}_getAnimationGroups(){let e=[],t=this._gltf.animations;if(t)for(let r of t)r._babylonAnimationGroup&&e.push(r._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case g.NONE:break;case g.FIRST:{let e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case g.ALL:for(let e of this._getAnimationGroups())e.start(!0);break;default:return void F.Y.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,t,r=()=>{}){let n=this._extensionsLoadNodeAsync(e,t,r);if(n)return n;if(t._babylonTransformNode)throw Error(`${e}: Invalid recursive node hierarchy`);let i=[];this.logOpen(`${e} ${t.name||""}`);let a=n=>{if(ts.AddPointerMetadata(n,e),ts._LoadTransform(t,n),void 0!=t.camera){let r=ti.Get(`${e}/camera`,this._gltf.cameras,t.camera);i.push(this.loadCameraAsync(`/cameras/${r.index}`,r,e=>{e.parent=n,this._babylonScene.useRightHandedSystem||(n.scaling.x=-1)}))}if(t.children)for(let r of t.children){let t=ti.Get(`${e}/children/${r}`,this._gltf.nodes,r);i.push(this.loadNodeAsync(`/nodes/${t.index}`,t,e=>{e.parent=n}))}r(n)},s=void 0!=t.mesh,o=this._parent.loadSkins&&void 0!=t.skin;if(!s||o){let e=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;let r=new e3.Y(e,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==t.mesh?t._babylonTransformNode=r:t._babylonTransformNodeForSkin=r,a(r)}if(s)if(o){let r=ti.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);i.push(this._loadMeshAsync(`/meshes/${r.index}`,t,r,r=>{let n=t._babylonTransformNodeForSkin;r.metadata=(0,tr.R)(n.metadata,r.metadata||{});let a=ti.Get(`${e}/skin`,this._gltf.skins,t.skin);i.push(this._loadSkinAsync(`/skins/${a.index}`,t,a,e=>{this._forEachPrimitive(t,t=>{t.skeleton=e}),this._postSceneLoadActions.push(()=>{if(void 0!=a.skeleton){let e=ti.Get(`/skins/${a.index}/skeleton`,this._gltf.nodes,a.skeleton).parent;t.index===e.index?r.parent=n.parent:r.parent=e._babylonTransformNode}else r.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:n,skinnedNode:r})})}))}))}else{let r=ti.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);i.push(this._loadMeshAsync(`/meshes/${r.index}`,t,r,a))}return this.logClose(),Promise.all(i).then(()=>(this._forEachPrimitive(t,e=>{!e.isAnInstance&&e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0,!0)}),t._babylonTransformNode))}_loadMeshAsync(e,t,r,n){let i=r.primitives;if(!i||!i.length)throw Error(`${e}: Primitives are missing`);void 0==i[0].index&&ti.Assign(i);let a=[];this.logOpen(`${e} ${r.name||""}`);let s=t.name||`node${t.index}`;if(1===i.length){let n=r.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${n.index}`,s,t,r,n,e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]}))}else for(let n of(this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new e3.Y(s,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[],i))a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${n.index}`,`${s}_primitive${n.index}`,t,r,n,e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)}));return n(t._babylonTransformNode),this.logClose(),Promise.all(a).then(()=>t._babylonTransformNode)}_loadMeshPrimitiveAsync(e,t,r,n,i,a){let s,o,l=this._extensionsLoadMeshPrimitiveAsync(e,t,r,n,i,a);if(l)return l;this.logOpen(`${e}`);let u=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==r.skin&&!n.primitives[0].targets;if(u&&i._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(s=i._instanceData.babylonSourceMesh.createInstance(t))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o=i._instanceData.promise;else{let a=[];this._babylonScene._blockEntityCollection=!!this._assetContainer;let l=new ef.Kj(t,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.sideOrientation=this._babylonScene.useRightHandedSystem?en.F.CounterClockWiseSideOrientation:en.F.ClockWiseSideOrientation,this._createMorphTargets(e,r,n,i,l),a.push(this._loadVertexDataAsync(e,i,l).then(async t=>await this._loadMorphTargetsAsync(e,i,l,t).then(()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.applyToMesh(l),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})));let c=ts._GetDrawMode(e,i.mode);if(void 0==i.material){let e=this._defaultBabylonMaterialData[c];e||(e=this._createDefaultMaterial("__GLTFLoader._default",c),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[c]=e),l.material=e}else if(!this.parent.skipMaterials){let t=ti.Get(`${e}/material`,this._gltf.materials,i.material);a.push(this._loadMaterialAsync(`/materials/${t.index}`,t,l,c,e=>{l.material=e}))}o=Promise.all(a),u&&(i._instanceData={babylonSourceMesh:l,promise:o}),s=l}return ts.AddPointerMetadata(s,e),this._parent.onMeshLoadedObservable.notifyObservers(s),a(s),this.logClose(),o.then(()=>s)}_loadVertexDataAsync(e,t,r){let n=this._extensionsLoadVertexDataAsync(e,t,r);if(n)return n;let i=t.attributes;if(!i)throw Error(`${e}: Attributes are missing`);let a=[],s=new ec.Z(r.name,this._babylonScene);if(void 0==t.indices)r.isUnIndexed=!0;else{let r=ti.Get(`${e}/indices`,this._gltf.accessors,t.indices);a.push(this._loadIndicesAccessorAsync(`/accessors/${r.index}`,r).then(e=>{s.setIndices(e)}))}let o=(t,n,o)=>{if(void 0==i[t])return;r._delayInfo=r._delayInfo||[],-1===r._delayInfo.indexOf(n)&&r._delayInfo.push(n);let l=ti.Get(`${e}/attributes/${t}`,this._gltf.accessors,i[t]);a.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,n).then(e=>{if(e.getKind()===eu.o.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!r.skeleton){let e=ta(l);e&&(s._boundingInfo=e,s.useBoundingInfoFromGeometry=!0)}s.setVerticesBuffer(e,l.count)})),n==eu.o.MatricesIndicesExtraKind&&(r.numBoneInfluencers=8),o&&o(l)};return o("POSITION",eu.o.PositionKind),o("NORMAL",eu.o.NormalKind),o("TANGENT",eu.o.TangentKind),o("TEXCOORD_0",eu.o.UVKind),o("TEXCOORD_1",eu.o.UV2Kind),o("TEXCOORD_2",eu.o.UV3Kind),o("TEXCOORD_3",eu.o.UV4Kind),o("TEXCOORD_4",eu.o.UV5Kind),o("TEXCOORD_5",eu.o.UV6Kind),o("JOINTS_0",eu.o.MatricesIndicesKind),o("WEIGHTS_0",eu.o.MatricesWeightsKind),o("JOINTS_1",eu.o.MatricesIndicesExtraKind),o("WEIGHTS_1",eu.o.MatricesWeightsExtraKind),o("COLOR_0",eu.o.ColorKind,e=>{"VEC4"===e.type&&(r.hasVertexAlpha=!0)}),Promise.all(a).then(()=>s)}_createMorphTargets(e,t,r,n,i){if(!n.targets||!this._parent.loadMorphTargets)return;if(void 0==t._numMorphTargets)t._numMorphTargets=n.targets.length;else if(n.targets.length!==t._numMorphTargets)throw Error(`${e}: Primitives do not have the same number of targets`);let a=r.extras?r.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,i.morphTargetManager=new e5.O(this._babylonScene),i.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<n.targets.length;e++){let n=t.weights?t.weights[e]:r.weights?r.weights[e]:0,s=a?a[e]:`morphTarget${e}`;i.morphTargetManager.addTarget(new e4.Y(s,n,i.getScene()))}}_loadMorphTargetsAsync(e,t,r,n){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();let i=[],a=r.morphTargetManager;for(let r=0;r<a.numTargets;r++){let s=a.getTarget(r);i.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${r}`,n,t.targets[r],s))}return Promise.all(i).then(()=>{a.areUpdatesFrozen=!1})}async _loadMorphTargetVertexDataAsync(e,t,r,n){let i=[],a=(n,a,s)=>{if(void 0==r[n])return;let o=t.getVertexBuffer(a);if(!o)return;let l=ti.Get(`${e}/${n}`,this._gltf.accessors,r[n]);i.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then(e=>{s(o,e)}))};return a("POSITION",eu.o.PositionKind,(e,t)=>{let r=new Float32Array(t.length);e.forEach(t.length,(e,n)=>{r[n]=t[n]+e}),n.setPositions(r)}),a("NORMAL",eu.o.NormalKind,(e,t)=>{let r=new Float32Array(t.length);e.forEach(r.length,(e,n)=>{r[n]=t[n]+e}),n.setNormals(r)}),a("TANGENT",eu.o.TangentKind,(e,t)=>{let r=new Float32Array(t.length/3*4),i=0;e.forEach(t.length/3*4,(e,n)=>{(n+1)%4!=0&&(r[i]=t[i]+e,i++)}),n.setTangents(r)}),a("TEXCOORD_0",eu.o.UVKind,(e,t)=>{let r=new Float32Array(t.length);e.forEach(t.length,(e,n)=>{r[n]=t[n]+e}),n.setUVs(r)}),a("TEXCOORD_1",eu.o.UV2Kind,(e,t)=>{let r=new Float32Array(t.length);e.forEach(t.length,(e,n)=>{r[n]=t[n]+e}),n.setUV2s(r)}),a("COLOR_0",eu.o.ColorKind,(t,r)=>{let i=null,a=t.getSize();if(3===a){i=new Float32Array(r.length/3*4),t.forEach(r.length,(e,t)=>{let n=Math.floor(t/3),a=t%3;i[4*n+a]=r[3*n+a]+e});for(let e=0;e<r.length/3;++e)i[4*e+3]=1}else if(4===a)i=new Float32Array(r.length),t.forEach(r.length,(e,t)=>{i[t]=r[t]+e});else throw Error(`${e}: Invalid number of components (${a}) for COLOR_0 attribute`);n.setColors(i)}),await Promise.all(i).then(()=>{})}static _LoadTransform(e,t){if(void 0!=e.skin)return;let r=X.P.Zero(),n=X._f.Identity(),i=X.P.One();e.matrix?X.y3.FromArray(e.matrix).decompose(i,n,r):(e.translation&&(r=X.P.FromArray(e.translation)),e.rotation&&(n=X._f.FromArray(e.rotation)),e.scale&&(i=X.P.FromArray(e.scale))),t.position=r,t.rotationQuaternion=n,t.scaling=i}_loadSkinAsync(e,t,r,n){if(!this._parent.loadSkins)return Promise.resolve();let i=this._extensionsLoadSkinAsync(e,t,r);if(i)return i;if(r._data)return n(r._data.babylonSkeleton),r._data.promise;let a=`skeleton${r.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;let s=new et.O(r.name||a,a,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,r,s);let o=this._loadSkinInverseBindMatricesDataAsync(e,r).then(e=>{this._updateBoneMatrices(s,e)});return r._data={babylonSkeleton:s,promise:o},n(s),o}_loadBones(e,t,r){if(void 0==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){let r=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(r)if(void 0===t.skeleton)t.skeleton=r.index;else{let n=ti.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);n===r||((e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1})(n,r)||(F.Y.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=r.index)}else F.Y.Warn(`${e}: Failed to find common root`)}let n={};for(let i of t.joints){let a=ti.Get(`${e}/joints/${i}`,this._gltf.nodes,i);this._loadBone(a,t,r,n)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;let r={};for(let n of t){let t=[],i=ti.Get(`${e}/${n}`,this._gltf.nodes,n);for(;-1!==i.index;)t.unshift(i),i=i.parent;r[n]=t}let n=null;for(let e=0;;++e){let i=r[t[0]];if(e>=i.length)return n;let a=i[e];for(let s=1;s<t.length;++s)if(e>=(i=r[t[s]]).length||a!==i[e])return n;n=a}}_loadBone(e,t,r,n){e._isJoint=!0;let i=n[e.index];if(i)return i;let a=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?a=this._loadBone(e.parent,t,r,n):void 0!==t.skeleton&&F.Y.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));let s=t.joints.indexOf(e.index);return i=new ee.N(e.name||`joint${e.index}`,r,a,this._getNodeMatrix(e),null,null,s),n[e.index]=i,this._postSceneLoadActions.push(()=>{i.linkTransformNode(e._babylonTransformNode)}),i}_loadSkinInverseBindMatricesDataAsync(e,t){if(void 0==t.inverseBindMatrices)return Promise.resolve(null);let r=ti.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)}_updateBoneMatrices(e,t){for(let r of e.bones){let e=X.y3.Identity(),n=r._index;t&&-1!==n&&(X.y3.FromArrayToRef(t,16*n,e),e.invertToRef(e));let i=r.getParent();i&&e.multiplyToRef(i.getAbsoluteInverseBindMatrix(),e),r.updateMatrix(e,!1,!1),r._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?X.y3.FromArray(e.matrix):X.y3.Compose(e.scale?X.P.FromArray(e.scale):X.P.One(),e.rotation?X._f.FromArray(e.rotation):X._f.Identity(),e.translation?X.P.FromArray(e.translation):X.P.Zero())}loadCameraAsync(e,t,r=()=>{}){let n=this._extensionsLoadCameraAsync(e,t,r);if(n)return n;this.logOpen(`${e} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;let i=new Q.c(t.name||`camera${t.index}`,X.P.Zero(),this._babylonScene,!1);switch(i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonCamera=i,i.rotation.set(0,Math.PI,0),t.type){case"perspective":{let r=t.perspective;if(!r)throw Error(`${e}: Camera perspective properties are missing`);i.fov=r.yfov,i.minZ=r.znear,i.maxZ=r.zfar||0;break}case"orthographic":if(!t.orthographic)throw Error(`${e}: Camera orthographic properties are missing`);i.mode=q.V.ORTHOGRAPHIC_CAMERA,i.orthoLeft=-t.orthographic.xmag,i.orthoRight=t.orthographic.xmag,i.orthoBottom=-t.orthographic.ymag,i.orthoTop=t.orthographic.ymag,i.minZ=t.orthographic.znear,i.maxZ=t.orthographic.zfar;break;default:throw Error(`${e}: Invalid camera type (${t.type})`)}return ts.AddPointerMetadata(i,e),this._parent.onCameraLoadedObservable.notifyObservers(i),r(i),this.logClose(),Promise.all([]).then(()=>i)}_loadAnimationsAsync(){let e=this._gltf.animations;if(!e)return Promise.resolve();let t=[];for(let r=0;r<e.length;r++){let n=e[r];t.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then(e=>{0===e.targetedAnimations.length&&e.dispose()}))}return Promise.all(t).then(()=>{})}loadAnimationAsync(e,t){let n=this._extensionsLoadAnimationAsync(e,t);return n||Promise.resolve().then(r.bind(r,32517)).then(({AnimationGroup:r})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;let n=new r(t.name||`animation${t.index}`,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=n;let i=[];for(let r of(ti.Assign(t.channels),ti.Assign(t.samplers),t.channels))i.push(this._loadAnimationChannelAsync(`${e}/channels/${r.index}`,e,t,r,(e,t)=>{e.animations=e.animations||[],e.animations.push(t),n.addTargetedAnimation(t,e)}));return Promise.all(i).then(()=>(n.normalize(0),n))})}async _loadAnimationChannelAsync(e,t,n,i,a){let s,o=this._extensionsLoadAnimationChannelAsync(e,t,n,i,a);if(o)return await o;if(void 0==i.target.node)return await Promise.resolve();let l=ti.Get(`${e}/target/node`,this._gltf.nodes,i.target.node),u=i.target.path,c="weights"===u;if(c&&!l._numMorphTargets||!c&&!l._babylonTransformNode||!this._parent.loadNodeAnimations&&!c&&!l._isJoint)return await Promise.resolve();switch(await Promise.resolve().then(r.bind(r,52842)),u){case"translation":s=(0,tt.di)("/nodes/{}/translation")?.interpolation;break;case"rotation":s=(0,tt.di)("/nodes/{}/rotation")?.interpolation;break;case"scale":s=(0,tt.di)("/nodes/{}/scale")?.interpolation;break;case"weights":s=(0,tt.di)("/nodes/{}/weights")?.interpolation;break;default:throw Error(`${e}/target/path: Invalid value (${i.target.path})`)}if(!s)throw Error(`${e}/target/path: Could not find interpolation properties for target path (${i.target.path})`);let d={object:l,info:s};return await this._loadAnimationChannelFromTargetInfoAsync(e,t,n,i,d,a)}_loadAnimationChannelFromTargetInfoAsync(e,t,r,n,i,a){let s=this.parent.targetFps,o=1/s,l=ti.Get(`${e}/sampler`,r.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${n.sampler}`,l).then(e=>{let t=0,l=i.object;for(let u of i.info){let i=u.getStride(l),c=e.input,d=e.output,h=Array(c.length),f=0;switch(e.interpolation){case"STEP":for(let e=0;e<c.length;e++){let t=u.getValue(l,d,f,1);f+=i,h[e]={frame:c[e]*s,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<c.length;e++){let t=u.getValue(l,d,f,o);f+=i;let r=u.getValue(l,d,f,1);f+=i;let n=u.getValue(l,d,f,o);f+=i,h[e]={frame:c[e]*s,inTangent:t,value:r,outTangent:n}}break;case"LINEAR":for(let e=0;e<c.length;e++){let t=u.getValue(l,d,f,1);f+=i,h[e]={frame:c[e]*s,value:t}}}if(f>0){let e=`${r.name||`animation${r.index}`}_channel${n.index}_${t}`;for(let r of u.buildAnimations(l,e,s,h))t++,a(r.babylonAnimatable,r.babylonAnimation)}}})}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;let r=t.interpolation||"LINEAR";switch(r){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}let n=ti.Get(`${e}/input`,this._gltf.accessors,t.input),i=ti.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)]).then(([e,t])=>({input:e,interpolation:r,output:t})),t._data}loadBufferAsync(e,t,r,n){let i=this._extensionsLoadBufferAsync(e,t,r,n);if(i)return i;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then(t=>{try{return new Uint8Array(t.buffer,t.byteOffset+r,n)}catch(t){throw Error(`${e}: ${t.message}`)}})}loadBufferViewAsync(e,t){let r=this._extensionsLoadBufferViewAsync(e,t);if(r)return r;if(t._data)return t._data;let n=ti.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${n.index}`,n,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(e,t,r){if(t._data)return t._data;let n=ts._GetNumComponents(e,t.type),i=n*eu.o.GetTypeByteLength(t.componentType),a=n*t.count;if(void 0==t.bufferView)t._data=Promise.resolve(new r(a));else{let s=ti.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then(o=>{if(5126===t.componentType&&!t.normalized&&(!s.byteStride||s.byteStride===i))return ts._GetTypedArray(e,t.componentType,o,t.byteOffset,a);{let e=new r(a);return eu.o.ForEach(o,t.byteOffset||0,s.byteStride||i,n,t.componentType,e.length,t.normalized||!1,(t,r)=>{e[r]=t}),e}})}if(t.sparse){let a=t.sparse;t._data=t._data.then(s=>{let o=ti.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,a.indices.bufferView),l=ti.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,a.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${o.index}`,o),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then(([o,l])=>{let u,c=ts._GetTypedArray(`${e}/sparse/indices`,a.indices.componentType,o,a.indices.byteOffset,a.count),d=n*a.count;if(5126!==t.componentType||t.normalized){let s=ts._GetTypedArray(`${e}/sparse/values`,t.componentType,l,a.values.byteOffset,d);u=new r(d),eu.o.ForEach(s,0,i,n,t.componentType,u.length,t.normalized||!1,(e,t)=>{u[t]=e})}else u=ts._GetTypedArray(`${e}/sparse/values`,t.componentType,l,a.values.byteOffset,d);let h=0;for(let e=0;e<c.length;e++){let t=c[e]*n;for(let e=0;e<n;e++)s[t++]=u[h++]}return s})})}return t._data}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_loadIndicesAccessorAsync(e,t){if("SCALAR"!==t.type)throw Error(`${e}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw Error(`${e}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){let r=ts._GetTypedArrayConstructor(`${e}/componentType`,t.componentType);t._data=this._loadAccessorAsync(e,t,r)}else{let r=ti.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then(r=>ts._GetTypedArray(e,t.componentType,r,t.byteOffset,t.count))}return t._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;let t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then(e=>new eu.l(t,e,!1)),e._babylonBuffer}_loadVertexAccessorAsync(e,t,r){if(t._babylonVertexBuffer?.[r])return t._babylonVertexBuffer[r];t._babylonVertexBuffer||(t._babylonVertexBuffer={});let n=this._babylonScene.getEngine();if(t.sparse||void 0==t.bufferView)t._babylonVertexBuffer[r]=this._loadFloatAccessorAsync(e,t).then(e=>new eu.o(n,e,r,!1));else{let i=ti.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[r]=this._loadVertexBufferViewAsync(i).then(a=>{let s=ts._GetNumComponents(e,t.type);return new eu.o(n,a,r,!1,void 0,i.byteStride,void 0,t.byteOffset,s,t.componentType,t.normalized,!0,void 0,!0)})}return t._babylonVertexBuffer[r]}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return t&&(t.baseColorFactor?(r.albedoColor=Z.Wo.FromArray(t.baseColorFactor),r.alpha=t.baseColorFactor[3]):r.albedoColor=Z.Wo.White(),r.metallic=void 0==t.metallicFactor?1:t.metallicFactor,r.roughness=void 0==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,e=>{e.name=`${r.name} (Base Color)`,r.albedoTexture=e})),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,e=>{e.name=`${r.name} (Metallic Roughness)`,r.metallicTexture=e})),r.useMetallnessFromMetallicTextureBlue=!0,r.useRoughnessFromMetallicTextureGreen=!0,r.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then(()=>{})}_loadMaterialAsync(e,t,r,n,i=()=>{}){let a=this._extensionsLoadMaterialAsync(e,t,r,n,i);if(a)return a;t._data=t._data||{};let s=t._data[n];if(!s){this.logOpen(`${e} ${t.name||""}`);let r=this.createMaterial(e,t,n);s={babylonMaterial:r,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,r)},t._data[n]=s,ts.AddPointerMetadata(r,e),this._parent.onMaterialLoadedObservable.notifyObservers(r),this.logClose()}return r&&(s.babylonMeshes.push(r),r.onDisposeObservable.addOnce(()=>{let e=s.babylonMeshes.indexOf(r);-1!==e&&s.babylonMeshes.splice(e,1)})),i(s.babylonMaterial),s.promise.then(()=>s.babylonMaterial)}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;let r=new e2.Y(e,this._babylonScene);return r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.fillMode=t,r.enableSpecularAntiAliasing=!0,r.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,r.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,r.transparencyMode=e2.Y.PBRMATERIAL_OPAQUE,r.metallic=1,r.roughness=1,r}createMaterial(e,t,r){let n=this._extensionsCreateMaterial(e,t,r);if(n)return n;let i=t.name||`material${t.index}`;return this._createDefaultMaterial(i,r)}loadMaterialPropertiesAsync(e,t,r){let n=this._extensionsLoadMaterialPropertiesAsync(e,t,r);if(n)return n;let i=[];return i.push(this.loadMaterialBasePropertiesAsync(e,t,r)),t.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,r)),this.loadMaterialAlphaProperties(e,t,r),Promise.all(i).then(()=>{})}loadMaterialBasePropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.emissiveColor=t.emissiveFactor?Z.Wo.FromArray(t.emissiveFactor):new Z.Wo(0,0,0),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,e=>{e.name=`${r.name} (Normal)`,r.bumpTexture=e})),r.invertNormalMapX=!this._babylonScene.useRightHandedSystem,r.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=t.normalTexture.scale&&r.bumpTexture&&(r.bumpTexture.level=t.normalTexture.scale),r.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,e=>{e.name=`${r.name} (Occlusion)`,r.ambientTexture=e})),r.useAmbientInGrayScale=!0,void 0!=t.occlusionTexture.strength&&(r.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,e=>{e.name=`${r.name} (Emissive)`,r.emissiveTexture=e})),Promise.all(n).then(()=>{})}loadMaterialAlphaProperties(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":r.transparencyMode=e2.Y.PBRMATERIAL_OPAQUE,r.alpha=1;break;case"MASK":r.transparencyMode=e2.Y.PBRMATERIAL_ALPHATEST,r.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0);break;case"BLEND":r.transparencyMode=e2.Y.PBRMATERIAL_ALPHABLEND,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0,r.useAlphaFromAlbedoTexture=!0);break;default:throw Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(e,t,r=()=>{}){let n=this._extensionsLoadTextureInfoAsync(e,t,r);if(n)return n;if(this.logOpen(`${e}`),t.texCoord>=6)throw Error(`${e}/texCoord: Invalid value (${t.texCoord})`);let i=ti.Get(`${e}/index`,this._gltf.textures,t.index);i._textureInfo=t;let a=this._loadTextureAsync(`/textures/${t.index}`,i,n=>{n.coordinatesIndex=t.texCoord||0,ts.AddPointerMetadata(n,e),this._parent.onTextureLoadedObservable.notifyObservers(n),r(n)});return this.logClose(),a}_loadTextureAsync(e,t,r=()=>{}){let n=this._extensionsLoadTextureAsync(e,t,r);if(n)return n;this.logOpen(`${e} ${t.name||""}`);let i=void 0==t.sampler?ts.DefaultSampler:ti.Get(`${e}/sampler`,this._gltf.samplers,t.sampler),a=ti.Get(`${e}/source`,this._gltf.images,t.source),s=this._createTextureAsync(e,i,a,r,void 0,!t._textureInfo.nonColorData);return this.logClose(),s}_createTextureAsync(e,t,r,n=()=>{},i,a){let s=this._loadSampler(`/samplers/${t.index}`,t),o=[],l=new e1.B;this._babylonScene._blockEntityCollection=!!this._assetContainer;let u={noMipmap:s.noMipMaps,invertY:!1,samplingMode:s.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(t,r)=>{this._disposed||l.reject(Error(`${e}: ${r&&r.message?r.message:t||"Failed to load texture"}`))},mimeType:r.mimeType??(0,W.TU)(r.uri??""),loaderOptions:i,useSRGBBuffer:!!a&&this._parent.useSRGBBuffers},c=new eo.x(null,this._babylonScene,u);return c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(l.promise),o.push(this.loadImageAsync(`/images/${r.index}`,r).then(e=>{let t=r.uri||`${this._fileName}#image${r.index}`,n=`data:${this._uniqueRootUrl}${t}`;c.updateURL(n,e);let i=c.getInternalTexture();i&&(i.label=r.name)})),c.wrapU=s.wrapU,c.wrapV=s.wrapV,n(c),this._parent.useGltfTextureNames&&(c.name=r.name||r.uri||`image${r.index}`),Promise.all(o).then(()=>c)}_loadSampler(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:ts._GetTextureSamplingMode(e,t),wrapU:ts._GetTextureWrapMode(`${e}/wrapS`,t.wrapS),wrapV:ts._GetTextureWrapMode(`${e}/wrapT`,t.wrapT)}),t._data}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{let r=ti.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r)}this.logClose()}return t._data}loadUriAsync(e,t,r){let n=this._extensionsLoadUriAsync(e,t,r);if(n)return n;if(!ts._ValidateUri(r))throw Error(`${e}: '${r}' is invalid`);if((0,W.VL)(r)){let t=new Uint8Array((0,W.$K)(r));return this.log(`${e}: Decoded ${r.substring(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${e}: Loading ${r}`),this._parent.preprocessUrlAsync(this._rootUrl+r).then(t=>new Promise((n,i)=>{this._parent._loadFile(this._babylonScene,t,t=>{this._disposed||(this.log(`${e}: Loaded ${r} (${t.byteLength} bytes)`),n(new Uint8Array(t)))},!0,t=>{i(new W.eh(`${e}: Failed to load '${r}'${t?": "+t.status+" "+t.statusText:""}`,t))})}))}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};let r=e._internalMetadata=e._internalMetadata||{},n=r.gltf=r.gltf||{};(n.pointers=n.pointers||[]).push(t)}static _GetTextureWrapMode(e,t){switch(t=void 0==t?10497:t){case 33071:return eo.x.CLAMP_ADDRESSMODE;case 33648:return eo.x.MIRROR_ADDRESSMODE;case 10497:return eo.x.WRAP_ADDRESSMODE;default:return F.Y.Warn(`${e}: Invalid value (${t})`),eo.x.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,t){let r=void 0==t.magFilter?9729:t.magFilter,n=void 0==t.minFilter?9987:t.minFilter;if(9729===r)switch(n){case 9728:return eo.x.LINEAR_NEAREST;case 9729:return eo.x.LINEAR_LINEAR;case 9984:return eo.x.LINEAR_NEAREST_MIPNEAREST;case 9985:return eo.x.LINEAR_LINEAR_MIPNEAREST;case 9986:return eo.x.LINEAR_NEAREST_MIPLINEAR;case 9987:return eo.x.LINEAR_LINEAR_MIPLINEAR;default:return F.Y.Warn(`${e}/minFilter: Invalid value (${n})`),eo.x.LINEAR_LINEAR_MIPLINEAR}switch(9728!==r&&F.Y.Warn(`${e}/magFilter: Invalid value (${r})`),n){case 9728:return eo.x.NEAREST_NEAREST;case 9729:return eo.x.NEAREST_LINEAR;case 9984:return eo.x.NEAREST_NEAREST_MIPNEAREST;case 9985:return eo.x.NEAREST_LINEAR_MIPNEAREST;case 9986:return eo.x.NEAREST_NEAREST_MIPLINEAR;case 9987:return eo.x.NEAREST_LINEAR_MIPLINEAR;default:return F.Y.Warn(`${e}/minFilter: Invalid value (${n})`),eo.x.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,t){try{return(0,tn.f9)(t)}catch(t){throw Error(`${e}: ${t.message}`)}}static _GetTypedArray(e,t,r,n,i){let a=r.buffer;n=r.byteOffset+(n||0);let s=ts._GetTypedArrayConstructor(`${e}/componentType`,t),o=eu.o.GetTypeByteLength(t);return n%o!=0?(F.Y.Warn(`${e}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${o})`),new s(a.slice(n,n+i*o),0)):new s(a,n,i)}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw Error(`${e}: Invalid type (${t})`)}static _ValidateUri(e){return O.w1.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,t){switch(void 0==t&&(t=4),t){case 0:return en.F.PointListDrawMode;case 1:return en.F.LineListDrawMode;case 2:return en.F.LineLoopDrawMode;case 3:return en.F.LineStripDrawMode;case 4:return en.F.TriangleFillMode;case 5:return en.F.TriangleStripDrawMode;case 6:return en.F.TriangleFanDrawMode}throw Error(`${e}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");let e=[];if(this._gltf.materials){for(let t of this._gltf.materials)if(t._data)for(let r in t._data){let n=t._data[r];for(let t of n.babylonMeshes){t.computeWorldMatrix(!0);let r=n.babylonMaterial;e.push(r.forceCompilationAsync(t)),e.push(r.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(r.forceCompilationAsync(t,{clipPlane:!0})),e.push(r.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile materials")})}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");let e=[];for(let t of this._babylonScene.lights){let r=t.getShadowGenerator();r&&e.push(r.forceCompilationAsync())}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile shadow generators")})}_forEachExtensions(e){for(let t of this._extensions)t.enabled&&e(t)}_applyExtensions(e,t,r){for(let n of this._extensions)if(n.enabled){let i=`${n.name}.${t}`;e._activeLoaderExtensionFunctions=e._activeLoaderExtensionFunctions||{};let a=e._activeLoaderExtensionFunctions;if(!a[i]){a[i]=!0;try{let e=r(n);if(e)return e}finally{delete a[i]}}}return null}_extensionsOnLoading(){this._forEachExtensions(e=>e.onLoading&&e.onLoading())}_extensionsOnReady(){this._forEachExtensions(e=>e.onReady&&e.onReady())}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",r=>r.loadSceneAsync&&r.loadSceneAsync(e,t))}_extensionsLoadNodeAsync(e,t,r){return this._applyExtensions(t,"loadNode",n=>n.loadNodeAsync&&n.loadNodeAsync(e,t,r))}_extensionsLoadCameraAsync(e,t,r){return this._applyExtensions(t,"loadCamera",n=>n.loadCameraAsync&&n.loadCameraAsync(e,t,r))}_extensionsLoadVertexDataAsync(e,t,r){return this._applyExtensions(t,"loadVertexData",n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(e,t,r))}_extensionsLoadMeshPrimitiveAsync(e,t,r,n,i,a){return this._applyExtensions(i,"loadMeshPrimitive",s=>s._loadMeshPrimitiveAsync&&s._loadMeshPrimitiveAsync(e,t,r,n,i,a))}_extensionsLoadMaterialAsync(e,t,r,n,i){return this._applyExtensions(t,"loadMaterial",a=>a._loadMaterialAsync&&a._loadMaterialAsync(e,t,r,n,i))}_extensionsCreateMaterial(e,t,r){return this._applyExtensions(t,"createMaterial",n=>n.createMaterial&&n.createMaterial(e,t,r))}_extensionsLoadMaterialPropertiesAsync(e,t,r){return this._applyExtensions(t,"loadMaterialProperties",n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(e,t,r))}_extensionsLoadTextureInfoAsync(e,t,r){return this._applyExtensions(t,"loadTextureInfo",n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(e,t,r))}_extensionsLoadTextureAsync(e,t,r){return this._applyExtensions(t,"loadTexture",n=>n._loadTextureAsync&&n._loadTextureAsync(e,t,r))}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",r=>r.loadAnimationAsync&&r.loadAnimationAsync(e,t))}_extensionsLoadAnimationChannelAsync(e,t,r,n,i){return this._applyExtensions(r,"loadAnimationChannel",a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(e,t,r,n,i))}_extensionsLoadSkinAsync(e,t,r){return this._applyExtensions(r,"loadSkin",n=>n._loadSkinAsync&&n._loadSkinAsync(e,t,r))}_extensionsLoadUriAsync(e,t,r){return this._applyExtensions(t,"loadUri",n=>n._loadUriAsync&&n._loadUriAsync(e,t,r))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",r=>r.loadBufferViewAsync&&r.loadBufferViewAsync(e,t))}_extensionsLoadBufferAsync(e,t,r,n){return this._applyExtensions(t,"loadBuffer",i=>i.loadBufferAsync&&i.loadBufferAsync(e,t,r,n))}static LoadExtensionAsync(e,t,r,n){if(!t.extensions)return null;let i=t.extensions[r];return i?n(`${e}/extensions/${r}`,i):null}static LoadExtraAsync(e,t,r,n){if(!t.extras)return null;let i=t.extras[r];return i?n(`${e}/extras/${r}`,i):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}ts.DefaultSampler={index:-1},K._CreateGLTF2Loader=e=>new ts(e);var to=r(52842),tl=r(49192),tu=r(22491);let tc="EXT_lights_image_based";class td{constructor(e){this.name=tc,this._loader=e,this.enabled=this._loader.isExtensionUsed(tc)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return ts.LoadExtensionAsync(e,t,this.name,async(r,n)=>{this._loader._allMaterialsDirtyRequired=!0;let i=[];i.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${r}`);let a=ti.Get(`${r}/light`,this._lights,n.light);return i.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.light}`,a).then(e=>{this._loader.babylonScene.environmentTexture=e})),this._loader.logClose(),await Promise.all(i).then(()=>{})})}_loadLightAsync(e,t){if(!t._loaded){let r=[];this._loader.logOpen(`${e}`);let n=Array(t.specularImages.length);for(let i=0;i<t.specularImages.length;i++){let a=t.specularImages[i];n[i]=Array(a.length);for(let t=0;t<a.length;t++){let s=`${e}/specularImages/${i}/${t}`;this._loader.logOpen(`${s}`);let o=a[t],l=ti.Get(s,this._loader.gltf.images,o);r.push(this._loader.loadImageAsync(`/images/${o}`,l).then(e=>{n[i][t]=e})),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(r).then(async()=>{let r=new tu.N(this._loader.babylonScene,null,t.specularImageSize);if(r.name=t.name||"environment",t._babylonTexture=r,void 0!=t.intensity&&(r.level=t.intensity),t.rotation){let e=X._f.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=X._f.Inverse(e)),X.y3.FromQuaternionToRef(e,r.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw Error(`${e}: Irradiance coefficients are missing`);let i=tl._.FromArray(t.irradianceCoefficients);i.scaleInPlace(t.intensity),i.convertIrradianceToLambertianRadiance();let a=tl.i.FromHarmonics(i),s=(n.length-1)/Math.log2(t.specularImageSize);return await r.updateRGBDAsync(n,a,s)})}return t._loaded.then(()=>t._babylonTexture)}}te(tc),e9(tc,!0,e=>new td(e)),r(1336);let th="EXT_mesh_gpu_instancing";class tf{constructor(e){this.name=th,this._loader=e,this.enabled=this._loader.isExtensionUsed(th)}dispose(){this._loader=null}loadNodeAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(e,n)=>{this._loader._disableInstancedMesh++;let i=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,r);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return await i;let a=[],s=0,o=t=>{if(void 0==n.attributes[t])return void a.push(Promise.resolve(null));let r=ti.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,n.attributes[t]);if(a.push(this._loader._loadFloatAccessorAsync(`/accessors/${r.bufferView}`,r)),0===s)s=r.count;else if(s!==r.count)throw Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),await i.then(async e=>{let[r,n,i]=await Promise.all(a),o=new Float32Array(16*s);X.jp.Vector3["0"].copyFromFloats(0,0,0),X.jp.Quaternion["0"].copyFromFloats(0,0,0,1),X.jp.Vector3["1"].copyFromFloats(1,1,1);for(let e=0;e<s;++e)r&&X.P.FromArrayToRef(r,3*e,X.jp.Vector3["0"]),n&&X._f.FromArrayToRef(n,4*e,X.jp.Quaternion["0"]),i&&X.P.FromArrayToRef(i,3*e,X.jp.Vector3["1"]),X.y3.ComposeToRef(X.jp.Vector3["1"],X.jp.Quaternion["0"],X.jp.Vector3["0"],X.jp.Matrix["0"]),X.jp.Matrix["0"].copyToArray(o,16*e);for(let e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",o,16,!0);return e})})}}te(th),e9(th,!0,e=>new tf(e));var tp=r(24526);let t_="EXT_meshopt_compression";class tm{constructor(e){this.name=t_,this.enabled=e.isExtensionUsed(t_),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,t){return ts.LoadExtensionAsync(e,t,this.name,async(r,n)=>{if(t._meshOptData)return await t._meshOptData;let i=ti.Get(`${e}/buffer`,this._loader.gltf.buffers,n.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${i.index}`,i,n.byteOffset||0,n.byteLength).then(async e=>await tp.K.Default.decodeGltfBufferAsync(e,n.count,n.byteStride,n.mode,n.filter)),await t._meshOptData})}}te(t_),e9(t_,!0,e=>new tm(e));let tg="EXT_texture_webp";class ty{constructor(e){this.name=tg,this._loader=e,this.enabled=e.isExtensionUsed(tg)}dispose(){this._loader=null}_loadTextureAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=void 0==t.sampler?ts.DefaultSampler:ti.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),s=ti.Get(`${n}/source`,this._loader.gltf.images,i.source);return await this._loader._createTextureAsync(e,a,s,e=>{r(e)},void 0,!t._textureInfo.nonColorData)})}}te(tg),e9(tg,!0,e=>new ty(e));let tv="EXT_texture_avif";class tb{constructor(e){this.name=tv,this._loader=e,this.enabled=e.isExtensionUsed(tv)}dispose(){this._loader=null}_loadTextureAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=void 0==t.sampler?ts.DefaultSampler:ti.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),s=ti.Get(`${n}/source`,this._loader.gltf.images,i.source);return await this._loader._createTextureAsync(e,a,s,e=>{r(e)},void 0,!t._textureInfo.nonColorData)})}}te(tv),e9(tv,!0,e=>new tb(e));var tx=r(40548);let tT="EXT_lights_ies";class tE{constructor(e){this.name=tT,this._loader=e,this.enabled=this._loader.isExtensionUsed(tT)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights,ti.Assign(this._lights)}}loadNodeAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a,s,o;this._loader._allMaterialsDirtyRequired=!0;let l=await this._loader.loadNodeAsync(e,t,e=>{let t=(s=ti.Get(n,this._lights,i.light)).name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,(a=new eg.P(t,X.P.Zero(),X.P.Backward(),0,1,this._loader.babylonScene)).angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=a,a.falloffType=tx._.FALLOFF_GLTF,a.diffuse=i.color?Z.Wo.FromArray(i.color):Z.Wo.White(),a.intensity=i.multiplier||1,a.range=Number.MAX_VALUE,a.parent=e,this._loader._babylonLights.push(a),ts.AddPointerMetadata(a,n),r(e)});if(s.uri)o=await this._loader.loadUriAsync(e,s,s.uri);else{let t=ti.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,s.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return a.iesProfileTexture=new eo.x(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),l})}}te(tT),e9(tT,!0,e=>new tE(e));var tA=r(77137);let tS="KHR_draco_mesh_compression";class tI{constructor(e){this.name=tS,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=tA.I.DefaultAvailable&&this._loader.isExtensionUsed(tS)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{if(void 0!=t.mode&&4!==t.mode&&5!==t.mode)throw Error(`${e}: Unsupported mode ${t.mode}`);let a={},s={},o=(e,n)=>{let o=i.attributes[e];if(void 0!=o&&(r._delayInfo=r._delayInfo||[],-1===r._delayInfo.indexOf(n)&&r._delayInfo.push(n),a[n]=o,this.useNormalizedFlagFromAccessor)){let r=ti.TryGet(this._loader.gltf.accessors,t.attributes[e]);r&&(s[n]=r.normalized||!1)}};o("POSITION",eu.o.PositionKind),o("NORMAL",eu.o.NormalKind),o("TANGENT",eu.o.TangentKind),o("TEXCOORD_0",eu.o.UVKind),o("TEXCOORD_1",eu.o.UV2Kind),o("TEXCOORD_2",eu.o.UV3Kind),o("TEXCOORD_3",eu.o.UV4Kind),o("TEXCOORD_4",eu.o.UV5Kind),o("TEXCOORD_5",eu.o.UV6Kind),o("JOINTS_0",eu.o.MatricesIndicesKind),o("WEIGHTS_0",eu.o.MatricesWeightsKind),o("COLOR_0",eu.o.ColorKind);let l=ti.Get(n,this._loader.gltf.bufferViews,i.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then(async n=>{let i=this.dracoDecoder||tA.I.Default,o=ti.TryGet(this._loader.gltf.accessors,t.attributes.POSITION),l=this._loader.parent.alwaysComputeBoundingBox||r.skeleton||!o?null:ta(o);return await i._decodeMeshToGeometryForGltfAsync(r.name,this._loader.babylonScene,n,a,s,l).catch(t=>{throw Error(`${e}: ${t.message}`)})})),await l._dracoBabylonGeometry})}}te(tS),e9(tS,!0,e=>new tI(e));let tC="KHR_lights_punctual";class tP{constructor(e){this.name=tC,this._loader=e,this.enabled=this._loader.isExtensionUsed(tC)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights,ti.Assign(this._lights)}}loadNodeAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,t,e=>{let t,a=ti.Get(n,this._lights,i.light),s=a.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{let e=new e_.O(s,X.P.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new em.c(s,X.P.Zero(),this._loader.babylonScene);break;case"spot":{let e=new eg.P(s,X.P.Zero(),X.P.Backward(),0,1,this._loader.babylonScene);e.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,Error(`${n}: Invalid light type (${a.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=t,t.falloffType=tx._.FALLOFF_GLTF,t.diffuse=a.color?Z.Wo.FromArray(a.color):Z.Wo.White(),t.intensity=void 0==a.intensity?1:a.intensity,t.range=void 0==a.range?Number.MAX_VALUE:a.range,t.parent=e,this._loader._babylonLights.push(t),ts.AddPointerMetadata(t,n),r(e)})))}}te(tC),e9(tC,!0,e=>new tP(e));let tR="KHR_materials_pbrSpecularGlossiness";class tw{constructor(e){this.name=tR,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(tR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialBasePropertiesAsync(e,t,r)),a.push(this._loadSpecularGlossinessPropertiesAsync(n,i,r)),this._loader.loadMaterialAlphaProperties(e,t,r),await Promise.all(a).then(()=>{})})}_loadSpecularGlossinessPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.metallic=null,r.roughness=null,t.diffuseFactor?(r.albedoColor=Z.Wo.FromArray(t.diffuseFactor),r.alpha=t.diffuseFactor[3]):r.albedoColor=Z.Wo.White(),r.reflectivityColor=t.specularFactor?Z.Wo.FromArray(t.specularFactor):Z.Wo.White(),r.microSurface=void 0==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,e=>{e.name=`${r.name} (Diffuse)`,r.albedoTexture=e})),t.specularGlossinessTexture&&(n.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,e=>{e.name=`${r.name} (Specular Glossiness)`,r.reflectivityTexture=e,r.reflectivityTexture.hasAlpha=!0})),r.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(n).then(()=>{})}}te(tR),e9(tR,!0,e=>new tw(e));let tM="KHR_materials_unlit";class tO{constructor(e){this.name=tM,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(tM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async()=>await this._loadUnlitPropertiesAsync(e,t,r))}_loadUnlitPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];r.unlit=!0;let i=t.pbrMetallicRoughness;return i&&(i.baseColorFactor?(r.albedoColor=Z.Wo.FromArray(i.baseColorFactor),r.alpha=i.baseColorFactor[3]):r.albedoColor=Z.Wo.White(),i.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,i.baseColorTexture,e=>{e.name=`${r.name} (Base Color)`,r.albedoTexture=e}))),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,r),Promise.all(n).then(()=>{})}}te(tM),e9(tM,!0,e=>new tO(e));let tL="KHR_materials_clearcoat";class tN{constructor(e){this.name=tL,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(tL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadClearCoatPropertiesAsync(n,i,r)),await Promise.all(a)})}_loadClearCoatPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.clearCoat.isEnabled=!0,r.clearCoat.useRoughnessFromMainTexture=!1,r.clearCoat.remapF0OnInterfaceChange=!1,void 0!=t.clearcoatFactor?r.clearCoat.intensity=t.clearcoatFactor:r.clearCoat.intensity=0,t.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,e=>{e.name=`${r.name} (ClearCoat)`,r.clearCoat.texture=e})),void 0!=t.clearcoatRoughnessFactor?r.clearCoat.roughness=t.clearcoatRoughnessFactor:r.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,e=>{e.name=`${r.name} (ClearCoat Roughness)`,r.clearCoat.textureRoughness=e}))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,e=>{e.name=`${r.name} (ClearCoat Normal)`,r.clearCoat.bumpTexture=e})),r.invertNormalMapX=!r.getScene().useRightHandedSystem,r.invertNormalMapY=r.getScene().useRightHandedSystem,void 0!=t.clearcoatNormalTexture.scale&&(r.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(n).then(()=>{})}}te(tL),e9(tL,!0,e=>new tN(e));let tF="KHR_materials_iridescence";class tD{constructor(e){this.name=tF,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(tF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadIridescencePropertiesAsync(n,i,r)),await Promise.all(a).then(()=>{})})}_loadIridescencePropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.iridescence.isEnabled=!0,r.iridescence.intensity=t.iridescenceFactor??0,r.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,r.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,r.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,e=>{e.name=`${r.name} (Iridescence)`,r.iridescence.texture=e})),t.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,e=>{e.name=`${r.name} (Iridescence Thickness)`,r.iridescence.thicknessTexture=e})),Promise.all(n).then(()=>{})}}te(tF),e9(tF,!0,e=>new tD(e));let tB="KHR_materials_anisotropy";class tk{constructor(e){this.name=tB,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(tB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadIridescencePropertiesAsync(n,i,r)),await Promise.all(a)})}async _loadIridescencePropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];r.anisotropy.isEnabled=!0,r.anisotropy.intensity=t.anisotropyStrength??0,r.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,e=>{e.name=`${r.name} (Anisotropy Intensity)`,r.anisotropy.texture=e}))),await Promise.all(n)}}te(tB),e9(tB,!0,e=>new tk(e));let tG="KHR_materials_emissive_strength";class tU{constructor(e){this.name=tG,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(tG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>await this._loader.loadMaterialPropertiesAsync(e,t,r).then(()=>{this._loadEmissiveProperties(n,i,r)}))}_loadEmissiveProperties(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);void 0!==t.emissiveStrength&&(r.emissiveIntensity=t.emissiveStrength)}}te(tG),e9(tG,!0,e=>new tU(e));let tV="KHR_materials_sheen";class tH{constructor(e){this.name=tV,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(tV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadSheenPropertiesAsync(n,i,r)),await Promise.all(a).then(()=>{})})}_loadSheenPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.sheen.isEnabled=!0,r.sheen.intensity=1,void 0!=t.sheenColorFactor?r.sheen.color=Z.Wo.FromArray(t.sheenColorFactor):r.sheen.color=Z.Wo.Black(),t.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,e=>{e.name=`${r.name} (Sheen Color)`,r.sheen.texture=e})),void 0!==t.sheenRoughnessFactor?r.sheen.roughness=t.sheenRoughnessFactor:r.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,e=>{e.name=`${r.name} (Sheen Roughness)`,r.sheen.textureRoughness=e}))),r.sheen.albedoScaling=!0,r.sheen.useRoughnessFromMainTexture=!1,Promise.all(n).then(()=>{})}}te(tV),e9(tV,!0,e=>new tH(e));let t$="KHR_materials_specular";class tW{constructor(e){this.name=t$,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(t$)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadSpecularPropertiesAsync(n,i,r)),await Promise.all(a).then(()=>{})})}_loadSpecularPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return void 0!==t.specularFactor&&(r.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(r.metallicReflectanceColor=Z.Wo.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,e=>{e.name=`${r.name} (Specular)`,r.metallicReflectanceTexture=e,r.useOnlyMetallicFromMetallicReflectanceTexture=!0}))),t.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,e=>{e.name=`${r.name} (Specular Color)`,r.reflectanceTexture=e})),Promise.all(n).then(()=>{})}}te(t$),e9(t$,!0,e=>new tW(e));let tj="KHR_materials_ior";class tz{constructor(e){this.name=tj,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(tj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadIorPropertiesAsync(n,i,r)),await Promise.all(a).then(()=>{})})}_loadIorPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);return void 0!==t.ior?r.indexOfRefraction=t.ior:r.indexOfRefraction=tz._DEFAULT_IOR,Promise.resolve()}}tz._DEFAULT_IOR=1.5,te(tj),e9(tj,!0,e=>new tz(e));let tY="KHR_materials_variants";class tK{constructor(e){this.name=tY,this._loader=e,this.enabled=this._loader.isExtensionUsed(tY)}dispose(){this._loader=null}static GetAvailableVariants(e){let t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(e){return tK.GetAvailableVariants(e)}static SelectVariant(e,t){let r=this._GetExtensionMetadata(e);if(!r)throw Error(`Cannot select variant on a glTF mesh that does not have the ${tY} extension`);let n=e=>{let t=r.variants[e];if(t)for(let e of t)e.mesh.material=e.material};if(t instanceof Array)for(let e of t)n(e);else n(t);r.lastSelected=t}selectVariant(e,t){tK.SelectVariant(e,t)}static Reset(e){let t=this._GetExtensionMetadata(e);if(!t)throw Error(`Cannot reset on a glTF mesh that does not have the ${tY} extension`);for(let e of t.original)e.mesh.material=e.material;t.lastSelected=null}reset(e){tK.Reset(e)}static GetLastSelectedVariant(e){let t=this._GetExtensionMetadata(e);if(!t)throw Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tY} extension`);return t.lastSelected}getLastSelectedVariant(e){return tK.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){return e?._internalMetadata?.gltf?.[tY]||null}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._variants=t.variants}}onReady(){let e=this._loader.rootBabylonMesh;if(e){let t=this._loader.parent.extensionOptions[tY];t?.defaultVariant&&tK.SelectVariant(e,t.defaultVariant),t?.onLoaded?.({get variants(){return tK.GetAvailableVariants(e)},get selectedVariant(){let t=tK.GetLastSelectedVariant(e);if(!t)return tK.GetAvailableVariants(e)[0];if(Array.isArray(t))return t[0];return t},set selectedVariant(variantName){tK.SelectVariant(e,variantName)}})}}_loadMeshPrimitiveAsync(e,t,r,n,i,a){return ts.LoadExtensionAsync(e,i,this.name,async(s,o)=>{let l=[];return l.push(this._loader._loadMeshPrimitiveAsync(e,t,r,n,i,t=>{if(a(t),t instanceof ef.Kj){let r=ts._GetDrawMode(e,i.mode),n=this._loader.rootBabylonMesh,a=n?n._internalMetadata=n._internalMetadata||{}:{},u=a.gltf=a.gltf||{},c=u[tY]=u[tY]||{lastSelected:null,original:[],variants:{}};c.original.push({mesh:t,material:t.material});for(let e=0;e<o.mappings.length;++e){let i=o.mappings[e],a=ti.Get(`${s}/mappings/${e}/material`,this._loader.gltf.materials,i.material);l.push(this._loader._loadMaterialAsync(`#/materials/${i.material}`,a,t,r,e=>{for(let r=0;r<i.variants.length;++r){let a=i.variants[r],s=ti.Get(`/extensions/${tY}/variants/${a}`,this._variants,a);c.variants[s.name]=c.variants[s.name]||[],c.variants[s.name].push({mesh:t,material:e}),t.onClonedObservable.add(e=>{let r=null,i=e;do{if(!(i=i.parent))return;r=tK._GetExtensionMetadata(i)}while(null===r);if(n&&r===tK._GetExtensionMetadata(n)){for(let e in i._internalMetadata={},n._internalMetadata)i._internalMetadata[e]=n._internalMetadata[e];for(let e in i._internalMetadata.gltf=[],n._internalMetadata.gltf)i._internalMetadata.gltf[e]=n._internalMetadata.gltf[e];for(let e of(i._internalMetadata.gltf[tY]={lastSelected:null,original:[],variants:{}},r.original))i._internalMetadata.gltf[tY].original.push({mesh:e.mesh,material:e.material});for(let e in r.variants)if(Object.prototype.hasOwnProperty.call(r.variants,e))for(let t of(i._internalMetadata.gltf[tY].variants[e]=[],r.variants[e]))i._internalMetadata.gltf[tY].variants[e].push({mesh:t.mesh,material:t.material});r=i._internalMetadata.gltf[tY]}for(let n of r.original)n.mesh===t&&(n.mesh=e);for(let n of r.variants[s.name])n.mesh===t&&(n.mesh=e)})}}))}}})),await Promise.all(l).then(([e])=>e)})}}te(tY),e9(tY,!0,e=>new tK(e));var tX=r(57716);class tZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ev.g.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...tZ._GetDefaultOptions(),...e},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new M.y$,this._scene.onDisposeObservable.addOnce(()=>{this.dispose()}),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter(t=>this._options[t]!==e[t]).length)return;let t={...this._options,...e},r=this._options;this._options=t,t.renderSize===r.renderSize&&t.renderTargetTextureType===r.renderTargetTextureType&&t.generateMipmaps===r.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return!!e&&e instanceof e2.Y&&!!e.subSurface.isRefractionEnabled}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),O.w1.SetImmediate(()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)})}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),-1!==(t=this._opaqueMeshesCache.indexOf(e))&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){let t=this._transparentMeshesCache.indexOf(e),r=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof e2.Y&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==r?(this._opaqueMeshesCache.splice(r,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===r&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){return this._opaqueRenderTarget?.getInternalTexture()!==null}_setupRenderTargets(){let e;for(let t of(this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new tX._("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=this._options.clearColor?.clone()??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add(t=>{e=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)}),this._opaqueRenderTarget.onAfterUnbindObservable.add(()=>{this._scene.environmentIntensity=e}),this._transparentMeshesCache))this._shouldRenderAsTransmission(t.material)&&(t.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}let tq="KHR_materials_transmission";class tQ{constructor(e){this.name=tq,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(tq),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadTransparentPropertiesAsync(n,t,r,i)),await Promise.all(a).then(()=>{})})}_loadTransparentPropertiesAsync(e,t,r,n){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);if(r.subSurface.isRefractionEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.useAlbedoToTintRefraction=!0,void 0===n.transmissionFactor)return r.subSurface.refractionIntensity=0,r.subSurface.isRefractionEnabled=!1,Promise.resolve();{r.subSurface.refractionIntensity=n.transmissionFactor;let e=r.getScene();r.subSurface.refractionIntensity&&!e._transmissionHelper?new tZ({},r.getScene()):r.subSurface.refractionIntensity&&!e._transmissionHelper?._isRenderTargetValid()&&e._transmissionHelper?._setupRenderTargets()}return(r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,n.transmissionTexture)?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,n.transmissionTexture,void 0).then(e=>{e.name=`${r.name} (Transmission)`,r.subSurface.refractionIntensityTexture=e,r.subSurface.useGltfStyleTextures=!0})):Promise.resolve()}}te(tq),e9(tq,!0,e=>new tQ(e));let tJ="KHR_materials_diffuse_transmission";class t0{constructor(e){this.name=tJ,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(tJ),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadTranslucentPropertiesAsync(n,t,r,i)),await Promise.all(a).then(()=>{})})}_loadTranslucentPropertiesAsync(e,t,r,n){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);if(r.subSurface.isTranslucencyEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,r.subSurface.useAlbedoToTintTranslucency=!1,void 0===n.diffuseTransmissionFactor)return r.subSurface.translucencyIntensity=0,r.subSurface.isTranslucencyEnabled=!1,Promise.resolve();r.subSurface.translucencyIntensity=n.diffuseTransmissionFactor;let i=[];return r.subSurface.useGltfStyleTextures=!0,n.diffuseTransmissionTexture&&(n.diffuseTransmissionTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,n.diffuseTransmissionTexture).then(e=>{e.name=`${r.name} (Diffuse Transmission)`,r.subSurface.translucencyIntensityTexture=e}))),void 0!==n.diffuseTransmissionColorFactor?r.subSurface.translucencyColor=Z.Wo.FromArray(n.diffuseTransmissionColorFactor):r.subSurface.translucencyColor=Z.Wo.White(),n.diffuseTransmissionColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,n.diffuseTransmissionColorTexture).then(e=>{e.name=`${r.name} (Diffuse Transmission Color)`,r.subSurface.translucencyColorTexture=e})),Promise.all(i).then(()=>{})}}te(tJ),e9(tJ,!0,e=>new t0(e));let t1="KHR_materials_volume";class t2{constructor(e){this.name=t1,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(t1),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadVolumePropertiesAsync(n,t,r,i)),await Promise.all(a).then(()=>{})})}_loadVolumePropertiesAsync(e,t,r,n){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);if(!r.subSurface.isRefractionEnabled&&!r.subSurface.isTranslucencyEnabled||!n.thicknessFactor)return Promise.resolve();r.subSurface.volumeIndexOfRefraction=r.indexOfRefraction;let i=void 0!==n.attenuationDistance?n.attenuationDistance:Number.MAX_VALUE;return(r.subSurface.tintColorAtDistance=i,void 0!==n.attenuationColor&&3==n.attenuationColor.length&&r.subSurface.tintColor.copyFromFloats(n.attenuationColor[0],n.attenuationColor[1],n.attenuationColor[2]),r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=n.thicknessFactor,r.subSurface.useThicknessAsDepth=!0,n.thicknessTexture)?(n.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,n.thicknessTexture).then(e=>{e.name=`${r.name} (Thickness)`,r.subSurface.thicknessTexture=e,r.subSurface.useGltfStyleTextures=!0})):Promise.resolve()}}te(t1),e9(t1,!0,e=>new t2(e));let t3="KHR_materials_dispersion";class t4{constructor(e){this.name=t3,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(t3)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadDispersionPropertiesAsync(n,t,r,i)),await Promise.all(a).then(()=>{})})}_loadDispersionPropertiesAsync(e,t,r,n){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);return r.subSurface.isRefractionEnabled&&n.dispersion&&(r.subSurface.isDispersionEnabled=!0,r.subSurface.dispersion=n.dispersion),Promise.resolve()}}te(t3),e9(t3,!0,e=>new t4(e));let t5="EXT_materials_diffuse_roughness";class t6{constructor(e){this.name=t5,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(t5)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=[];return a.push(this._loader.loadMaterialPropertiesAsync(e,t,r)),a.push(this._loadDiffuseRoughnessPropertiesAsync(n,i,r)),await Promise.all(a).then(()=>{})})}_loadDiffuseRoughnessPropertiesAsync(e,t,r){if(!(r instanceof e2.Y))throw Error(`${e}: Material type not supported`);let n=[];return r.brdf.baseDiffuseModel=ev.g.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=t.diffuseRoughnessFactor?r.baseDiffuseRoughness=t.diffuseRoughnessFactor:r.baseDiffuseRoughness=0,t.diffuseRoughnessTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/diffuseRoughnessTexture`,t.diffuseRoughnessTexture,e=>{e.name=`${r.name} (Diffuse Roughness)`,r.baseDiffuseRoughnessTexture=e})),Promise.all(n).then(()=>{})}}te(t5),e9(t5,!0,e=>new t6(e));let t8="KHR_mesh_quantization";class t7{constructor(e){this.name=t8,this.enabled=e.isExtensionUsed(t8)}dispose(){}}te(t8),e9(t8,!0,e=>new t7(e));let t9="KHR_texture_basisu";class re{constructor(e){this.name=t9,this._loader=e,this.enabled=e.isExtensionUsed(t9)}dispose(){this._loader=null}_loadTextureAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>{let a=void 0==t.sampler?ts.DefaultSampler:ti.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),s=ti.Get(`${n}/source`,this._loader.gltf.images,i.source);return await this._loader._createTextureAsync(e,a,s,e=>{r(e)},t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)})}}te(t9),e9(t9,!0,e=>new re(e));let rt="KHR_texture_transform";class rr{constructor(e){this.name=rt,this._loader=e,this.enabled=this._loader.isExtensionUsed(rt)}dispose(){this._loader=null}loadTextureInfoAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(n,i)=>await this._loader.loadTextureInfoAsync(e,t,e=>{if(!(e instanceof eo.x))throw Error(`${n}: Texture type not supported`);i.offset&&(e.uOffset=i.offset[0],e.vOffset=i.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,i.rotation&&(e.wAng=-i.rotation),i.scale&&(e.uScale=i.scale[0],e.vScale=i.scale[1]),void 0!=i.texCoord&&(e.coordinatesIndex=i.texCoord),r(e)}))}}te(rt),e9(rt,!0,e=>new rr(e));let rn="KHR_xmp_json_ld";class ri{constructor(e){this.name=rn,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(rn)}dispose(){this._loader=null}onLoading(){if(null===this._loader.rootBabylonMesh)return;let e=this._loader.gltf.extensions?.KHR_xmp_json_ld,t=this._loader.gltf.asset?.extensions?.KHR_xmp_json_ld;if(e&&t){let r=+t.packet;e.packets&&r<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[r])}}}function ra(e,t,r,n){return Z.Wo.FromArray(t,r).scale(n)}function rs(e,t,r,n){return t[r]*n}function ro(e,t,r,n){return-t[r]*n}function rl(e,t,r,n){return t[r+1]*n}function ru(e,t,r,n){return t[r]*n*2}function rc(e){return{scale:[new rh(J.fw.ANIMATIONTYPE_FLOAT,`${e}.uScale`,rs,()=>2),new rh(J.fw.ANIMATIONTYPE_FLOAT,`${e}.vScale`,rl,()=>2)],offset:[new rh(J.fw.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,rs,()=>2),new rh(J.fw.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,rl,()=>2)],rotation:[new rh(J.fw.ANIMATIONTYPE_FLOAT,`${e}.wAng`,ro,()=>1)]}}te(rn),e9(rn,!0,e=>new ri(e));class rd extends to.AnimationPropertyInfo{buildAnimations(e,t,r,n){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(t,r,n)}]}}class rh extends to.AnimationPropertyInfo{buildAnimations(e,t,r,n){let i=[];for(let a in e._data)i.push({babylonAnimatable:e._data[a].babylonMaterial,babylonAnimation:this._buildAnimation(t,r,n)});return i}}class rf extends to.AnimationPropertyInfo{buildAnimations(e,t,r,n){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(t,r,n)}]}}(0,tt.eF)("/cameras/{}/orthographic/xmag",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"orthoLeft",ro,()=>1),new rd(J.fw.ANIMATIONTYPE_FLOAT,"orthoRight",rl,()=>1)]),(0,tt.eF)("/cameras/{}/orthographic/ymag",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"orthoBottom",ro,()=>1),new rd(J.fw.ANIMATIONTYPE_FLOAT,"orthoTop",rl,()=>1)]),(0,tt.eF)("/cameras/{}/orthographic/zfar",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"maxZ",rs,()=>1)]),(0,tt.eF)("/cameras/{}/orthographic/znear",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"minZ",rs,()=>1)]),(0,tt.eF)("/cameras/{}/perspective/yfov",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"fov",rs,()=>1)]),(0,tt.eF)("/cameras/{}/perspective/zfar",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"maxZ",rs,()=>1)]),(0,tt.eF)("/cameras/{}/perspective/znear",[new rd(J.fw.ANIMATIONTYPE_FLOAT,"minZ",rs,()=>1)]),(0,tt.eF)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"albedoColor",ra,()=>4),new rh(J.fw.ANIMATIONTYPE_FLOAT,"alpha",function(e,t,r,n){return t[r+3]*n},()=>4)]),(0,tt.eF)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"metallic",rs,()=>1)]),(0,tt.eF)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"roughness",rs,()=>1)]);let rp=rc("albedoTexture");(0,tt.eF)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",rp.scale),(0,tt.eF)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",rp.offset),(0,tt.eF)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",rp.rotation);let r_=rc("metallicTexture");(0,tt.eF)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",r_.scale),(0,tt.eF)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",r_.offset),(0,tt.eF)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",r_.rotation),(0,tt.eF)("/materials/{}/emissiveFactor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"emissiveColor",ra,()=>3)]);let rm=rc("bumpTexture");(0,tt.eF)("/materials/{}/normalTexture/scale",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"bumpTexture.level",rs,()=>1)]),(0,tt.eF)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",rm.scale),(0,tt.eF)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",rm.offset),(0,tt.eF)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",rm.rotation),(0,tt.eF)("/materials/{}/occlusionTexture/strength",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",rs,()=>1)]);let rg=rc("ambientTexture");(0,tt.eF)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rg.scale),(0,tt.eF)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rg.offset),(0,tt.eF)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rg.rotation);let ry=rc("emissiveTexture");(0,tt.eF)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ry.scale),(0,tt.eF)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ry.offset),(0,tt.eF)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ry.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"anisotropy.angle",rs,()=>1)]);let rv=rc("anisotropy.texture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",rv.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",rv.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",rv.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",rs,()=>1)]);let rb=rc("clearCoat.texture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",rb.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",rb.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",rb.rotation);let rx=rc("clearCoat.bumpTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",rx.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",rx.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",rx.rotation);let rT=rc("clearCoat.textureRoughness");(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",rT.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",rT.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",rT.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"emissiveIntensity",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_ior/ior",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"indexOfRefraction",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"iridescence.intensity",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",rs,()=>1)]);let rE=rc("iridescence.texture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",rE.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",rE.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",rE.rotation);let rA=rc("iridescence.thicknessTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",rA.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",rA.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",rA.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"sheen.color",ra,()=>3)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"sheen.roughness",rs,()=>1)]);let rS=rc("sheen.texture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",rS.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",rS.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",rS.rotation);let rI=rc("sheen.textureRoughness");(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",rI.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",rI.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",rI.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"metallicF0Factor",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ra,()=>3)]);let rC=rc("metallicReflectanceTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",rC.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",rC.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",rC.rotation);let rP=rc("reflectanceTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",rP.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",rP.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",rP.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",rs,()=>1)]);let rR=rc("subSurface.refractionIntensityTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",rR.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",rR.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",rR.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ra,()=>3)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",rs,()=>1)]),(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",rs,()=>1)]);let rw=rc("subSurface.thicknessTexture");(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",rw.scale),(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",rw.offset),(0,tt.eF)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",rw.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new rh(J.fw.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",rs,()=>1)]);let rM=rc("subSurface.translucencyIntensityTexture");(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",rM.scale),(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",rM.offset),(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",rM.rotation),(0,tt.eF)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new rh(J.fw.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ra,()=>3)]);let rO=rc("subSurface.translucencyColorTexture");(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",rO.scale),(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",rO.offset),(0,tt.eF)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",rO.rotation),(0,tt.eF)("/extensions/KHR_lights_punctual/lights/{}/color",[new rf(J.fw.ANIMATIONTYPE_COLOR3,"diffuse",ra,()=>3)]),(0,tt.eF)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new rf(J.fw.ANIMATIONTYPE_FLOAT,"intensity",rs,()=>1)]),(0,tt.eF)("/extensions/KHR_lights_punctual/lights/{}/range",[new rf(J.fw.ANIMATIONTYPE_FLOAT,"range",rs,()=>1)]),(0,tt.eF)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new rf(J.fw.ANIMATIONTYPE_FLOAT,"innerAngle",ru,()=>1)]),(0,tt.eF)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new rf(J.fw.ANIMATIONTYPE_FLOAT,"angle",ru,()=>1)]),(0,tt.eF)("/nodes/{}/extensions/EXT_lights_ies/color",[new rf(J.fw.ANIMATIONTYPE_COLOR3,"diffuse",ra,()=>3)]),(0,tt.eF)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new rf(J.fw.ANIMATIONTYPE_FLOAT,"intensity",rs,()=>1)]);let rL="KHR_animation_pointer";class rN{constructor(e){this.name=rL,this._loader=e,this._pathToObjectConverter=(0,tt._k)(this._loader.gltf)}get enabled(){return this._loader.isExtensionUsed(rL)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,t,r,n,i){let a=n.target.extensions?.KHR_animation_pointer;if(!a||!this._pathToObjectConverter)return null;"pointer"!==n.target.path&&F.Y.Warn(`${e}/target/path: Value (${n.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=n.target.node&&F.Y.Warn(`${e}/target/node: Value (${n.target.node}) must not be present when using the ${this.name} extension`);let s=`${e}/extensions/${this.name}`,o=a.pointer;if(!o)throw Error(`${s}: Pointer is missing`);try{let a=this._pathToObjectConverter.convert(o);if(!a.info.interpolation)throw Error(`${s}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,r,n,{object:a.object,info:a.info.interpolation},i)}catch(e){return F.Y.Warn(`${s}/pointer: Invalid pointer (${o}) skipped`),null}}}te(rL),e9(rL,!0,e=>new rN(e));var rF=r(13988),rD=r(95212),rB=r(37993);r(95698);let rk="MSFT_audio_emitter";class rG{constructor(e){this.name=rk,this._loader=e,this.enabled=this._loader.isExtensionUsed(rk)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,ti.Assign(this._clips),ti.Assign(this._emitters)}}loadSceneAsync(e,t){return ts.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let i=[];for(let a of(i.push(this._loader.loadSceneAsync(e,t)),n.emitters)){let e=ti.Get(`${r}/emitters`,this._emitters,a);if(void 0!=e.refDistance||void 0!=e.maxDistance||void 0!=e.rolloffFactor||void 0!=e.distanceModel||void 0!=e.innerAngle||void 0!=e.outerAngle)throw Error(`${r}: Direction or Distance properties are not allowed on emitters attached to a scene`);i.push(this._loadEmitterAsync(`${r}/emitters/${e.index}`,e))}await Promise.all(i)})}loadNodeAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(e,n)=>{let i=[],a=await this._loader.loadNodeAsync(e,t,t=>{for(let r of n.emitters){let n=ti.Get(`${e}/emitters`,this._emitters,r);i.push(this._loadEmitterAsync(`${e}/emitters/${n.index}`,n).then(()=>{for(let e of n._babylonSounds)e.attachToMesh(t),(void 0!=n.innerAngle||void 0!=n.outerAngle)&&(e.setLocalDirectionToMesh(X.P.Forward()),e.setDirectionalCone(2*O.w1.ToDegrees(void 0==n.innerAngle?Math.PI:n.innerAngle),2*O.w1.ToDegrees(void 0==n.outerAngle?Math.PI:n.outerAngle),0))}))}r(t)});return await Promise.all(i),a})}loadAnimationAsync(e,t){return ts.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let i=await this._loader.loadAnimationAsync(e,t),a=[];for(let s of(ti.Assign(n.events),n.events))a.push(this._loadAnimationEventAsync(`${r}/events/${s.index}`,e,t,s,i));return await Promise.all(a),i})}_loadClipAsync(e,t){let r;if(t._objectURL)return t._objectURL;if(t.uri)r=this._loader.loadUriAsync(e,t,t.uri);else{let n=ti.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);r=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return t._objectURL=r.then(e=>URL.createObjectURL(new Blob([e],{type:t.mimeType}))),t._objectURL}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){let e=[],r=t.name||`emitter${t.index}`,n={loop:!1,autoplay:!1,volume:void 0==t.volume?1:t.volume};for(let i=0;i<t.clips.length;i++){let a=`/extensions/${this.name}/clips`,s=ti.Get(a,this._clips,t.clips[i].clip);e.push(this._loadClipAsync(`${a}/${t.clips[i].clip}`,s).then(e=>{let a=t._babylonSounds[i]=new rD.$(r,e,this._loader.babylonScene,null,n);a.refDistance=t.refDistance||1,a.maxDistance=t.maxDistance||256,a.rolloffFactor=t.rolloffFactor||1,a.distanceModel=t.distanceModel||"exponential"}))}let i=Promise.all(e).then(()=>{let e=t.clips.map(e=>e.weight||1),r=new rB.s(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(r.directionalConeInnerAngle=2*O.w1.ToDegrees(t.innerAngle)),t.outerAngle&&(r.directionalConeOuterAngle=2*O.w1.ToDegrees(t.outerAngle)),t.volume&&(r.volume=t.volume),t._babylonData.sound=r});t._babylonData={loaded:i}}return t._babylonData.loaded}_getEventAction(e,t,r,n,i){switch(r){case"play":return e=>{t.play((i||0)+(e-n))};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw Error(`${e}: Unsupported action ${r}`)}}_loadAnimationEventAsync(e,t,r,n,i){if(0==i.targetedAnimations.length)return Promise.resolve();let a=i.targetedAnimations[0],s=n.emitter,o=ti.Get(`/extensions/${this.name}/emitters`,this._emitters,s);return this._loadEmitterAsync(e,o).then(()=>{let t=o._babylonData.sound;if(t){let r=new rF.O(n.time,this._getEventAction(e,t,n.action,n.time,n.startOffset));a.animation.addEvent(r),i.onAnimationGroupEndObservable.add(()=>{t.stop()}),i.onAnimationGroupPauseObservable.add(()=>{t.pause()})}})}}te(rk),e9(rk,!0,e=>new rG(e));let rU="MSFT_lod";class rV{constructor(e){this.name=rU,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.y$,this.onMaterialLODsLoadedObservable=new M.y$,this._bufferLODs=[],this._nodeIndexLOD=null,this._nodeSignalLODs=[],this._nodePromiseLODs=[],this._nodeBufferLODs=[],this._materialIndexLOD=null,this._materialSignalLODs=[],this._materialPromiseLODs=[],this._materialBufferLODs=[],this._loader=e,this.maxLODsToLoad=this._loader.parent.extensionOptions[rU]?.maxLODsToLoad??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(rU)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){let t=Promise.all(this._nodePromiseLODs[e]).then(()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())});this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){let t=Promise.all(this._materialPromiseLODs[e]).then(()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())});this._loader._completePromises.push(t)}}loadSceneAsync(e,t){let r=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),r}loadNodeAsync(e,t,r){return ts.LoadExtensionAsync(e,t,this.name,async(e,n)=>{let i,a=this._getLODs(e,t,this._loader.gltf.nodes,n.ids);this._loader.logOpen(`${e}`);for(let e=0;e<a.length;e++){let t=a[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new e1.B);let n=e=>{r(e),e.setEnabled(!1)},s=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,n).then(t=>{if(0!==e){let t=a[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t});this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?i=s:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(s))}return this._loader.logClose(),await i})}_loadMaterialAsync(e,t,r,n,i){return this._nodeIndexLOD?null:ts.LoadExtensionAsync(e,t,this.name,async(e,a)=>{let s,o=this._getLODs(e,t,this._loader.gltf.materials,a.ids);this._loader.logOpen(`${e}`);for(let e=0;e<o.length;e++){let t=o[e];0!==e&&(this._materialIndexLOD=e);let a=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,r,n,t=>{0===e&&i(t)}).then(t=>{if(0!==e){i(t);let r=o[e-1]._data;r[n]&&(this._disposeMaterials([r[n].babylonMaterial]),delete r[n])}return t});this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?s=a:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(a))}return this._loader.logClose(),await s})}_loadUriAsync(e,t,r){if(null!==this._nodeIndexLOD){this._loader.log("deferred");let n=this._nodeIndexLOD-1;return this._nodeSignalLODs[n]=this._nodeSignalLODs[n]||new e1.B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(async()=>await this._loader.loadUriAsync(e,t,r))}if(null!==this._materialIndexLOD){this._loader.log("deferred");let n=this._materialIndexLOD-1;return this._materialSignalLODs[n]=this._materialSignalLODs[n]||new e1.B,this._materialSignalLODs[n].promise.then(async()=>await this._loader.loadUriAsync(e,t,r))}return null}loadBufferAsync(e,t,r,n){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);let t=async(e,t)=>{let i=r+n-1,a=e[t];return a?(a.start=Math.min(a.start,r),a.end=Math.max(a.end,i)):(a={start:r,end:i,loaded:new e1.B},e[t]=a),await a.loaded.promise.then(e=>new Uint8Array(e.buffer,e.byteOffset+r-a.start,n))};return(this._loader.log("deferred"),null!==this._nodeIndexLOD)?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(e,t){let r=e[t];r&&(this._loader.log(`Loading buffer range [${r.start}-${r.end}]`),this._loader.bin.readAsync(r.start,r.end-r.start+1).then(e=>{r.loaded.resolve(e)},e=>{r.loaded.reject(e)}))}_getLODs(e,t,r,n){if(this.maxLODsToLoad<=0)throw Error("maxLODsToLoad must be greater than zero");let i=[];for(let t=n.length-1;t>=0;t--)if(i.push(ti.Get(`${e}/ids/${n[t]}`,r,n[t])),i.length===this.maxLODsToLoad)return i;return i.push(t),i}_disposeTransformNode(e){let t=[],r=e.material;for(let n of(r&&t.push(r),e.getChildMeshes()))n.material&&t.push(n.material);e.dispose();let n=t.filter(e=>this._loader.babylonScene.meshes.every(t=>t.material!=e));this._disposeMaterials(n)}_disposeMaterials(e){let t={};for(let r of e){for(let e of r.getActiveTextures())t[e.uniqueId]=e;r.dispose()}for(let e in t)for(let r of this._loader.babylonScene.materials)r.hasTexture(t[e])&&delete t[e];for(let e in t)t[e].dispose()}}te(rU),e9(rU,!0,e=>new rV(e));let rH="MSFT_minecraftMesh";class r${constructor(e){this.name=rH,this._loader=e,this.enabled=this._loader.isExtensionUsed(rH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtraAsync(e,t,this.name,async(n,i)=>{if(i){if(!(r instanceof e2.Y))throw Error(`${n}: Material type not supported`);let i=this._loader.loadMaterialPropertiesAsync(e,t,r);return r.needAlphaBlending()&&(r.forceDepthWrite=!0,r.separateCullingPass=!0),r.backFaceCulling=r.forceDepthWrite,r.twoSidedLighting=!0,await i}})}}te(rH),e9(rH,!0,e=>new r$(e));let rW="MSFT_sRGBFactors";class rj{constructor(e){this.name=rW,this._loader=e,this.enabled=this._loader.isExtensionUsed(rW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,r){return ts.LoadExtraAsync(e,t,this.name,async(n,i)=>{if(i){if(!(r instanceof e2.Y))throw Error(`${n}: Material type not supported`);let i=this._loader.loadMaterialPropertiesAsync(e,t,r),a=r.getScene().getEngine().useExactSrgbConversions;return r.albedoTexture||r.albedoColor.toLinearSpaceToRef(r.albedoColor,a),r.reflectivityTexture||r.reflectivityColor.toLinearSpaceToRef(r.reflectivityColor,a),await i}})}}te(rW),e9(rW,!0,e=>new rj(e));var rz=r(73683),rY=r(63372),rK=r(82753);function rX(e){let[t,r]=e.split(":");return rZ({op:t,extension:r})}function rZ(e,t=!0){let r=e.extension?rQ[e.extension]?.[e.op]:rJ[e.op];if(!r&&(F.Y.Warn(`No mapping found for operation ${e.op} and extension ${e.extension||"KHR_interactivity"}`),t)){let t={},r={flows:{}};if(e.inputValueSockets)for(let r in t.values={},e.inputValueSockets)t.values[r]={name:r};return e.outputValueSockets&&(r.values={},Object.keys(e.outputValueSockets).forEach(e=>{r.values[e]={name:e}})),{blocks:[],inputs:t,outputs:r}}return r}function rq(e,t,r){rQ[t]||(rQ[t]={}),rQ[t][e]=r}let rQ={BABYLON:{"flow/log":{blocks:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},rJ={"event/onStart":{blocks:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{blocks:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{blocks:["FlowGraphSendCustomEventBlock"],extraProcessor(e,t,r,n,i){if("event/send"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw Error("Receive event should have a single configuration object, the event itself");let a=e.configuration.event.value[0];if("number"!=typeof a)throw Error("Event id should be a number");let s=n.arrays.events[a],o=i[0];return o.config||(o.config={}),o.config.eventId=s.eventId,o.config.eventData=s.eventData,i}},"event/receive":{blocks:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(e,t){if(!e.configuration)return F.Y.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};let r=e.configuration.event;if(!r)return F.Y.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};let n=r.value[0];return"number"!=typeof n?(F.Y.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"}):t.events?.[n]?{valid:!0}:(F.Y.Error(`Event with id ${n} not found`),{valid:!1,error:`Event with id ${n} not found`})},extraProcessor(e,t,r,n,i){if("event/receive"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw Error("Receive event should have a single configuration object, the event itself");let a=e.configuration.event.value[0];if("number"!=typeof a)throw Error("Event id should be a number");let s=n.arrays.events[a],o=i[0];return o.config||(o.config={}),o.config.eventId=s.eventId,o.config.eventData=s.eventData,i}},"math/e":r0("FlowGraphEBlock"),"math/pi":r0("FlowGraphPIBlock"),"math/inf":r0("FlowGraphInfBlock"),"math/nan":r0("FlowGraphNaNBlock"),"math/abs":r0("FlowGraphAbsBlock"),"math/sign":r0("FlowGraphSignBlock"),"math/trunc":r0("FlowGraphTruncBlock"),"math/floor":r0("FlowGraphFloorBlock"),"math/ceil":r0("FlowGraphCeilBlock"),"math/round":{blocks:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,r,n,i)=>(i[0].config=i[0].config||{},i[0].config.roundHalfAwayFromZero=!0,i)},"math/fract":r0("FlowGraphFractBlock"),"math/neg":r0("FlowGraphNegationBlock"),"math/add":r0("FlowGraphAddBlock",["a","b"],!0),"math/sub":r0("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{blocks:["FlowGraphMultiplyBlock"],extraProcessor(e,t,r,n,i){i[0].config=i[0].config||{},i[0].config.useMatrixPerComponent=!0,i[0].config.preventIntegerFloatArithmetic=!0;let a=-1;return Object.keys(e.values||{}).find(t=>e.values?.[t].type!==void 0&&(a=e.values[t].type,!0)),-1!==a&&(i[0].config.type=n.arrays.types[a].flowGraphType),i},validation:e=>e.values?r1(e):{valid:!0}},"math/div":r0("FlowGraphDivideBlock",["a","b"],!0),"math/rem":r0("FlowGraphModuloBlock",["a","b"]),"math/min":r0("FlowGraphMinBlock",["a","b"]),"math/max":r0("FlowGraphMaxBlock",["a","b"]),"math/clamp":r0("FlowGraphClampBlock",["a","b","c"]),"math/saturate":r0("FlowGraphSaturateBlock"),"math/mix":r0("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":r0("FlowGraphEqualityBlock",["a","b"]),"math/lt":r0("FlowGraphLessThanBlock",["a","b"]),"math/le":r0("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":r0("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":r0("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":r0("FlowGraphIsNaNBlock"),"math/isinf":r0("FlowGraphIsInfBlock"),"math/select":{blocks:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{blocks:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":r0("FlowGraphSinBlock"),"math/cos":r0("FlowGraphCosBlock"),"math/tan":r0("FlowGraphTanBlock"),"math/asin":r0("FlowGraphASinBlock"),"math/acos":r0("FlowGraphACosBlock"),"math/atan":r0("FlowGraphATanBlock"),"math/atan2":r0("FlowGraphATan2Block",["a","b"]),"math/sinh":r0("FlowGraphSinhBlock"),"math/cosh":r0("FlowGraphCoshBlock"),"math/tanh":r0("FlowGraphTanhBlock"),"math/asinh":r0("FlowGraphASinhBlock"),"math/acosh":r0("FlowGraphACoshBlock"),"math/atanh":r0("FlowGraphATanhBlock"),"math/exp":r0("FlowGraphExponentialBlock"),"math/log":r0("FlowGraphLogBlock"),"math/log2":r0("FlowGraphLog2Block"),"math/log10":r0("FlowGraphLog10Block"),"math/sqrt":r0("FlowGraphSquareRootBlock"),"math/cbrt":r0("FlowGraphCubeRootBlock"),"math/pow":r0("FlowGraphPowerBlock",["a","b"]),"math/length":r0("FlowGraphLengthBlock"),"math/normalize":r0("FlowGraphNormalizeBlock"),"math/dot":r0("FlowGraphDotBlock",["a","b"]),"math/cross":r0("FlowGraphCrossBlock",["a","b"]),"math/rotate2d":r0("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3d":r0("FlowGraphRotate3DBlock",["a","b","c"]),"math/transform":{blocks:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{blocks:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{blocks:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{blocks:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{blocks:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{blocks:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{blocks:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":r0("FlowGraphTransposeBlock"),"math/determinant":r0("FlowGraphDeterminantBlock"),"math/inverse":r0("FlowGraphInvertMatrixBlock"),"math/matmul":r0("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{blocks:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,i,a){let s=i[0].dataInputs.find(e=>"rotationQuaternion"===e.name);if(!s)throw Error("Rotation quaternion input not found");return a._connectionValues[s.uniqueId]&&(a._connectionValues[s.uniqueId].type="Quaternion"),i}},"math/matDecompose":{blocks:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/combine2x2":{blocks:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,r,n,i)=>(i[0].config=i[0].config||{},i[0].config.inputIsColumnMajor=!0,i)},"math/extract2x2":{blocks:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{blocks:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,r,n,i)=>(i[0].config=i[0].config||{},i[0].config.inputIsColumnMajor=!0,i)},"math/extract3x3":{blocks:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{blocks:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,r,n,i)=>(i[0].config=i[0].config||{},i[0].config.inputIsColumnMajor=!0,i)},"math/extract4x4":{blocks:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/compose":{blocks:["FlowGraphMatrixCompose"],configuration:{},inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"output"}}}},"math/decompose":{blocks:["FlowGraphMatrixDecompose"],configuration:{},inputs:{values:{a:{name:"input"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/not":{blocks:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,i,a){i[0].config=i[0].config||{};let s=i[0].dataInputs[0];return i[0].config.valueType=a._connectionValues[s.uniqueId]?.type??"FlowGraphInteger",i}},"math/and":{blocks:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,i,a){i[0].config=i[0].config||{};let s=i[0].dataInputs[0],o=i[0].dataInputs[1];return i[0].config.valueType=a._connectionValues[s.uniqueId]?.type??a._connectionValues[o.uniqueId]?.type??"FlowGraphInteger",i}},"math/or":{blocks:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,i,a){i[0].config=i[0].config||{};let s=i[0].dataInputs[0],o=i[0].dataInputs[1];return i[0].config.valueType=a._connectionValues[s.uniqueId]?.type??a._connectionValues[o.uniqueId]?.type??"FlowGraphInteger",i}},"math/xor":{blocks:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,i,a){i[0].config=i[0].config||{};let s=i[0].dataInputs[0],o=i[0].dataInputs[1];return i[0].config.valueType=a._connectionValues[s.uniqueId]?.type??a._connectionValues[o.uniqueId]?.type??"FlowGraphInteger",i}},"math/asr":r0("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":r0("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":r0("FlowGraphLeadingZerosBlock"),"math/ctz":r0("FlowGraphTrailingZerosBlock"),"math/popcnt":r0("FlowGraphOneBitsCounterBlock"),"math/rad":r0("FlowGraphDegToRadBlock"),"math/deg":r0("FlowGraphRadToDegBlock"),"type/boolToInt":r0("FlowGraphBooleanToInt"),"type/boolToFloat":r0("FlowGraphBooleanToFloat"),"type/intToBool":r0("FlowGraphIntToBoolean"),"type/intToFloat":r0("FlowGraphIntToFloat"),"type/floatToInt":r0("FlowGraphFloatToInt"),"type/floatToBool":r0("FlowGraphFloatToBoolean"),"flow/sequence":{blocks:["FlowGraphSequenceBlock"],extraProcessor(e,t,r,n,i){let a=i[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(e.flows||[]).length,a.signalOutputs.forEach((e,t)=>{e.name="out_"+t}),i}},"flow/branch":{blocks:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{blocks:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(e){if(e.configuration&&e.configuration.cases){let t=e.configuration.cases.value;if(!t.every(e=>"number"==typeof e&&/^-?\d+$/.test(e.toString())))return F.Y.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};let r=new Set(t);e.configuration.cases.value=Array.from(r)}return{valid:!0}},extraProcessor(e,t,r,n,i){if("flow/switch"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw Error("Switch should have a single configuration object, the cases array");return i[0].signalOutputs.forEach(e=>{"default"!==e.name&&(e.name="out_"+e.name)}),i}},"flow/while":{blocks:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{blocks:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(e,t,r,n,i){let a=i[0];return a.config||(a.config={}),a.config.incrementIndexWhenLoopDone=!0,i}},"flow/doN":{blocks:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{blocks:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(e,t,r,n,i){if("flow/multiGate"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw Error("MultiGate should have a single configuration object, the number of output flows");let a=i[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(e.flows).length,a.signalOutputs.forEach((e,t)=>{e.name="out_"+t}),i}},"flow/waitAll":{blocks:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation:e=>("number"!=typeof e.configuration?.inputFlows?.value[0]&&(e.configuration=e.configuration||{inputFlows:{value:[0]}},e.configuration.inputFlows.value=[0]),{valid:!0})},"flow/throttle":{blocks:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{blocks:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{blocks:["FlowGraphCancelDelayBlock"]},"variable/get":{blocks:["FlowGraphGetVariableBlock"],validation:e=>e.configuration?.variable?.value?{valid:!0}:(F.Y.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"}),configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]}}},"variable/set":{blocks:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]}}},"variable/setMultiple":{blocks:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(e,t)=>[e[0].map(e=>t.getVariableName(e))]}},extraProcessor:(e,t,r,n,i)=>(i[0].dataInputs.forEach(e=>{e.name=n.getVariableName(+e.name)}),i)},"variable/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:e=>!0===e[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(e,t,r,n,i){var a,s;let o=i[0],l=e.configuration?.variable.value[0];if("number"!=typeof l)throw F.Y.Error("Variable index is not defined for variable interpolation block"),Error("Variable index is not defined for variable interpolation block");let u=n.arrays.staticVariables[l];void 0===o.config.animationType.value&&(n.arrays.staticVariables,o.config.animationType.value=(0,rK.Xg)(u.type));let c=i[4];return c.config||(c.config={}),(a=c.config).variable||(a.variable={}),c.config.variable.value=n.getVariableName(l),(s=i[3]).config||(s.config={}),i}},"pointer/get":{blocks:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,r,n,i)=>(i.forEach(e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)}),i)},"pointer/set":{blocks:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,r,n,i)=>(i.forEach(e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)}),i)},"pointer/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,r,n,i)=>(i.forEach(t=>{"FlowGraphJsonPointerParserBlock"===t.className?(t.config||(t.config={}),t.config.outputValue=!0):"FlowGraphInterpolationBlock"===t.className&&(t.config||(t.config={}),Object.keys(e.values||[]).forEach(r=>{let i=e.values?.[r];if("value"===r&&i){let e=i.type;void 0!==e&&(t.config.animationType=n.arrays.types[e].flowGraphType)}}))}),i)},"animation/start":{blocks:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];return o.config||(o.config={}),o.config.glTF=s,i}},"animation/stop":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];return o.config||(o.config={}),o.config.glTF=s,i}},"animation/stopAt":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];return o.config||(o.config={}),o.config.glTF=s,i}},"math/switch":{blocks:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){if(e.configuration&&e.configuration.cases){let t=e.configuration.cases.value;if(!t.every(e=>"number"==typeof e&&/^-?\d+$/.test(e.toString())))return F.Y.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};let r=new Set(t);e.configuration.cases.value=Array.from(r)}return{valid:!0}},extraProcessor(e,t,r,n,i){let a=i[0];return a.dataInputs.forEach(e=>{"default"!==e.name&&"case"!==e.name&&(e.name="in_"+e.name)}),a.config||(a.config={}),a.config.treatCasesAsIntegers=!0,i}},"debug/log":{blocks:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function r0(e,t=["a"],r){return{blocks:[e],inputs:{values:t.reduce((e,t)=>(e[t]={name:t},e),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,i,a){if(r){a[0].config=a[0].config||{},a[0].config.preventIntegerFloatArithmetic=!0;let t=-1;Object.keys(e.values||{}).find(r=>e.values?.[r].type!==void 0&&(t=e.values[r].type,!0)),-1!==t&&(a[0].config.type=i.arrays.types[t].flowGraphType)}return a},validation:e=>r?r1(e):{valid:!0}}}function r1(e){if(e.values){let t=Object.keys(e.values).map(t=>e.values[t].type).filter(e=>void 0!==e);if(!t.every(e=>e===t[0]))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}function r2(){return Object.keys(rJ)}var r3=r(53986);let r4={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class r5{constructor(e,t,r){this._interactivityGraph=e,this._gltf=t,this._loader=r,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(let e of this._interactivityGraph.types)this._types.push(r4[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(let e of this._interactivityGraph.declarations){let t=rZ(e);if(!t)throw F.Y.Error(["No mapping found for declaration",e]),Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(let e of this._interactivityGraph.variables){let t=this._parseVariable(e);this._staticVariables.push(t)}}_parseVariable(e,t){let r=this._types[e.type];if(!r)throw F.Y.Error(["No type found for variable",e]),Error("Error parsing variables");if(e.value&&e.value.length!==r.length)throw F.Y.Error(["Invalid value length for variable",e,r]),Error("Error parsing variables");let n=e.value||[];if(!n.length)switch(r.flowGraphType){case"boolean":n.push(!1);break;case"FlowGraphInteger":n.push(0);break;case"number":n.push(NaN);break;case"Vector2":n.push(NaN,NaN);break;case"Vector3":n.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":n.fill(NaN,0,4);break;case"Matrix":n.fill(NaN,0,16);break;case"Matrix3D":n.fill(NaN,0,9)}return"number"===r.elementType&&"string"==typeof n[0]&&(n[0]=parseFloat(n[0])),{type:r.flowGraphType,value:t?t(n,this):n}}_parseEvents(){if(this._interactivityGraph.events)for(let e of this._interactivityGraph.events){let t={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(t.eventData=Object.keys(e.values).map(t=>{let r=e.values?.[t];if(!r)throw F.Y.Error(["No value found for event key",t]),Error("Error parsing events");let n=this._types[r.type];if(!n)throw F.Y.Error(["No type found for event value",r]),Error("Error parsing events");let i=void 0!==r.value?this._parseVariable(r):void 0;return{id:t,type:n.flowGraphType,eventData:!0,value:i}})),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(let e of this._interactivityGraph.nodes){if("number"!=typeof e.declaration)throw F.Y.Error(["No declaration found for node",e]),Error("Error parsing nodes");let t=this._mappings[e.declaration];if(!t)throw F.Y.Error(["No mapping found for node",e]),Error("Error parsing nodes");if(t.flowGraphMapping.validation){let r=t.flowGraphMapping.validation(e,this._interactivityGraph,this._gltf);if(!r.valid)throw Error(`Error validating interactivity node ${this._interactivityGraph.declarations?.[e.declaration].op} - ${r.error}`)}let r=[];for(let n of t.flowGraphMapping.blocks){let i=this._getEmptyBlock(n,t.fullOperationName);this._parseNodeConfiguration(e,i,t.flowGraphMapping,n),r.push(i)}this._nodes.push({blocks:r,fullOperationName:t.fullOperationName})}}_getEmptyBlock(e,t){return{uniqueId:(0,r3.f)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(e,t,r,n){let i=t.config;if(e.configuration)for(let t of Object.keys(e.configuration)){let a=e.configuration?.[t];if(!a)throw F.Y.Error(["No value found for node configuration",t]),Error("Error parsing node configuration");let s=r.configuration?.[t];if(s&&s.toBlock?s.toBlock===n:0===r.blocks.indexOf(n)){let e=s?.name||t;a&&void 0!==a.value||void 0===s?.defaultValue?a.value.length>=0?i[e]={value:1===a.value.length?a.value[0]:a.value}:F.Y.Warn(["Invalid value for node configuration",a]):i[e]={value:s.defaultValue},s&&s.dataTransformer&&(i[e].value=s.dataTransformer([i[e].value],this)[0])}}}_parseNodeConnections(e){for(let t=0;t<this._nodes.length;t++){let r=this._interactivityGraph.nodes?.[t];if(!r)throw F.Y.Error(["No node found for interactivity node",this._nodes[t]]),Error("Error parsing node connections");let n=this._nodes[t],i=this._mappings[r.declaration];if(!i)throw F.Y.Error(["No mapping found for node",r]),Error("Error parsing node connections");let a=r.flows||{};for(let e of Object.keys(a).sort()){let t=a[e],r=i.flowGraphMapping.outputs?.flows?.[e],s=r?.name||e,o=this._createNewSocketConnection(s,!0);(r&&r.toBlock&&n.blocks.find(e=>e.className===r.toBlock)||n.blocks[0]).signalOutputs.push(o);let l=t.node,u=this._nodes[l];if(!u)throw F.Y.Error(["No node found for input node id",l]),Error("Error parsing node connections");let c=rX(u.fullOperationName);if(!c)throw F.Y.Error(["No mapping found for input node",u]),Error("Error parsing node connections");let d=c.inputs?.flows?.[t.socket||"in"],h=!1;if(!d)for(let e in c.inputs?.flows)e.startsWith("[")&&e.endsWith("]")&&(h=!0,d=c.inputs?.flows?.[e]);let f=d?h?d.name.replace("$1",t.socket||""):d.name:t.socket||"in",p=d&&d.toBlock&&u.blocks.find(e=>e.className===d.toBlock)||u.blocks[0],_=p.signalInputs.find(e=>e.name===f);_||(_=this._createNewSocketConnection(f),p.signalInputs.push(_)),_.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(_.uniqueId)}let s=r.values||{};for(let t of Object.keys(s)){let r=s[t],a=i.flowGraphMapping.inputs?.values?.[t],o=!1;if(!a)for(let e in i.flowGraphMapping.inputs?.values)e.startsWith("[")&&e.endsWith("]")&&(o=!0,a=i.flowGraphMapping.inputs?.values?.[e]);let l=a?o?a.name.replace("$1",t):a.name:t,u=this._createNewSocketConnection(l);if((a&&a.toBlock&&n.blocks.find(e=>e.className===a.toBlock)||n.blocks[0]).dataInputs.push(u),void 0!==r.value){let t=this._parseVariable(r,a&&a.dataTransformer);e._connectionValues[u.uniqueId]=t}else if(void 0!==r.node){let e=r.node,t=r.socket||"value",n=this._nodes[e];if(!n)throw F.Y.Error(["No node found for output socket reference",r]),Error("Error parsing node connections");let i=rX(n.fullOperationName);if(!i)throw F.Y.Error(["No mapping found for output socket reference",r]),Error("Error parsing node connections");let a=i.outputs?.values?.[t],s=!1;if(!a)for(let e in i.outputs?.values)e.startsWith("[")&&e.endsWith("]")&&(s=!0,a=i.outputs?.values?.[e]);let o=a?s?a.name.replace("$1",t):a?.name:t,l=a&&a.toBlock&&n.blocks.find(e=>e.className===a.toBlock)||n.blocks[0],c=l.dataOutputs.find(e=>e.name===o);c||(c=this._createNewSocketConnection(o,!0),l.dataOutputs.push(c)),u.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(u.uniqueId)}else throw F.Y.Error(["Invalid value for value connection",r]),Error("Error parsing node connections")}if(i.flowGraphMapping.interBlockConnectors)for(let e of i.flowGraphMapping.interBlockConnectors){let t=e.input,r=e.output,i=e.isVariable;this._connectFlowGraphNodes(t,r,n.blocks[e.inputBlockIndex],n.blocks[e.outputBlockIndex],i)}if(i.flowGraphMapping.extraProcessor){let t=this._interactivityGraph.declarations?.[r.declaration];if(!t)throw F.Y.Error(["No declaration found for extra processor",r]),Error("Error parsing node connections");n.blocks=i.flowGraphMapping.extraProcessor(r,t,i.flowGraphMapping,this,n.blocks,e,this._gltf)}}}_createNewSocketConnection(e,t){return{uniqueId:(0,r3.f)(),name:e,_connectionType:+!!t,connectedPointIds:[]}}_connectFlowGraphNodes(e,t,r,n,i){let a=i?r.dataInputs:r.signalInputs,s=i?n.dataOutputs:n.signalOutputs,o=a.find(t=>t.name===e)||this._createNewSocketConnection(e),l=s.find(e=>e.name===t)||this._createNewSocketConnection(t,!0);a.find(t=>t.name===e)||a.push(o),s.find(e=>e.name===t)||s.push(l),o.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(o.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){let e={uniqueId:(0,r3.f)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let t=0;t<this._staticVariables.length;t++){let r=this._staticVariables[t];e._userVariables[this.getVariableName(t)]=r}return{rightHanded:!0,allBlocks:this._nodes.reduce((e,t)=>e.concat(t.blocks),[]),executionContexts:[e]}}}var r6=r(64963);let r8="KHR_interactivity";class r7{constructor(e){this._loader=e,this.name=r8,this.enabled=this._loader.isExtensionUsed(r8),this._pathConverter=(0,tt._k)(this._loader.gltf),e._skipStartAnimationStep=!0;let t=e.babylonScene;t&&r9(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;let e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity;if(!t)return;let r=new rz.l({scene:e});r.dispatchEventsSynchronously=!1;let n=t.graphs.map(e=>new r5(e,this._loader.gltf,this._loader).serializeToFlowGraph());await Promise.all(n.map(async e=>await (0,rY.H6)(e,{coordinator:r,pathConverter:this._pathConverter}))),r.start()}}function r9(e){(0,tt.xP)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!e.activeCamera)return new X._f(NaN,NaN,NaN,NaN);let t=X._f.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize();return e.useRightHandedSystem||(t.w*=-1,t.x*=-1),t},type:"Quaternion",getTarget:()=>e.activeCamera}),(0,tt.xP)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!e.activeCamera)return new X.P(NaN,NaN,NaN);let t=e.activeCamera.getWorldMatrix().getTranslation();return e.useRightHandedSystem||(t.x*=-1),t},type:"Vector3",getTarget:()=>e.activeCamera}),(0,tt.xP)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>e._babylonAnimationGroup?.isPlaying??!1,type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,tt.xP)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>(e._babylonAnimationGroup?.from??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,tt.xP)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>(e._babylonAnimationGroup?.to??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,tt.xP)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,tt.xP)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup})}(0,r6.L)(r8,"FlowGraphGLTFDataProvider",async()=>(await Promise.resolve().then(r.bind(r,73207))).FlowGraphGLTFDataProvider),te(r8),e9(r8,!0,e=>new r7(e));let ne="KHR_node_visibility";(0,tt.xP)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.isVisible||t.isVisible},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(e=>{e.inheritVisibility=!0}),t._babylonTransformNode&&(t._babylonTransformNode.isVisible=e),t._primitiveBabylonMeshes?.forEach(t=>{t.isVisible=e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class nt{constructor(e){this.name=ne,this._loader=e,this.enabled=e.isExtensionUsed(ne)}async onReady(){this._loader.gltf.nodes?.forEach(e=>{e._primitiveBabylonMeshes?.forEach(e=>{e.inheritVisibility=!0}),e.extensions?.KHR_node_visibility&&e.extensions?.KHR_node_visibility.visible===!1&&(e._babylonTransformNode&&(e._babylonTransformNode.isVisible=!1),e._primitiveBabylonMeshes?.forEach(e=>{e.isVisible=!1}))})}dispose(){this._loader=null}}te(ne),e9(ne,!0,e=>new nt(e));let nr="KHR_node_selectability";rq("event/onSelect",nr,{blocks:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>["pickedMesh_"+e[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];o.config=o.config||{},o.config.glTF=s;let l=e.configuration?.nodeIndex?.value[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u="pickedMesh_"+l;return i[1].config.variable=u,a._userVariables[u]={className:"Mesh",id:s?.nodes?.[l]._babylonTransformNode?.id,uniqueId:s?.nodes?.[l]._babylonTransformNode?.uniqueId},i}}),(0,tt.xP)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.isPickable||t.isPickable},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(t=>{t.isPickable=e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isPickable"],type:"boolean"});class nn{constructor(e){this.name=nr,this._loader=e,this.enabled=e.isExtensionUsed(nr)}async onReady(){this._loader.gltf.nodes?.forEach(e=>{e.extensions?.KHR_node_selectability&&e.extensions?.KHR_node_selectability.selectable===!1&&e._babylonTransformNode?.getChildMeshes().forEach(e=>{e.isPickable=!1})})}dispose(){this._loader=null}}te(nr),e9(nr,!0,e=>new nn(e));let ni="KHR_node_hoverability",na="targetMeshPointerOver_";rq("event/onHoverIn",ni,{blocks:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>[na+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];o.config=o.config||{},o.config.glTF=s;let l=e.configuration?.nodeIndex?.value[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u=na+l;return i[1].config.variable=u,a._userVariables[u]={className:"Mesh",id:s?.nodes?.[l]._babylonTransformNode?.id,uniqueId:s?.nodes?.[l]._babylonTransformNode?.uniqueId},i}});let ns="targetMeshPointerOut_";rq("event/onHoverOut",ni,{blocks:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>[ns+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,r,n,i,a,s){let o=i[i.length-1];o.config=o.config||{},o.config.glTF=s;let l=e.configuration?.nodeIndex?.value[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u=ns+l;return i[1].config.variable=u,a._userVariables[u]={className:"Mesh",id:s?.nodes?.[l]._babylonTransformNode?.id,uniqueId:s?.nodes?.[l]._babylonTransformNode?.uniqueId},i}}),(0,tt.xP)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.pointerOverDisableMeshTesting||t.pointerOverDisableMeshTesting},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(t=>{t.pointerOverDisableMeshTesting=!e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class no{constructor(e){this.name=ni,this._loader=e,this.enabled=e.isExtensionUsed(ni)}async onReady(){this._loader.gltf.nodes?.forEach(e=>{e.extensions?.KHR_node_hoverability&&e.extensions?.KHR_node_hoverability.hoverable===!1&&e._babylonTransformNode?.getChildMeshes().forEach(e=>{e.pointerOverDisableMeshTesting=!0})})}dispose(){this._loader=null}}te(ni),e9(ni,!0,e=>new no(e));let nl="ExtrasAsMetadata";class nu{_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){let r=e.metadata=e.metadata||{};(r.gltf=r.gltf||{}).extras=t.extras}}constructor(e){this.name=nl,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,t,r){return this._loader.loadNodeAsync(e,t,e=>{this._assignExtras(e,t),r(e)})}loadCameraAsync(e,t,r){return this._loader.loadCameraAsync(e,t,e=>{this._assignExtras(e,t),r(e)})}createMaterial(e,t,r){let n=this._loader.createMaterial(e,t,r);return this._assignExtras(n,t),n}}te(nl),e9(nl,!1,e=>new nu(e));var nc=r(73207);class nd{constructor(){this.materials=[]}parseMTL(e,t,r,n){let i;if(t instanceof ArrayBuffer)return;let a=t.split("\n"),s=/\s+/,o=null;for(let t=0;t<a.length;t++){let l=a[t].trim();if(0===l.length||"#"===l.charAt(0))continue;let u=l.indexOf(" "),c=u>=0?l.substring(0,u):l;c=c.toLowerCase();let d=u>=0?l.substring(u+1).trim():"";if("newmtl"===c)o&&this.materials.push(o),e._blockEntityCollection=!!n,(o=new ea.K(d,e))._parentContainer=n,e._blockEntityCollection=!1;else if("kd"===c&&o)i=d.split(s,3).map(parseFloat),o.diffuseColor=Z.Wo.FromArray(i);else if("ka"===c&&o)i=d.split(s,3).map(parseFloat),o.ambientColor=Z.Wo.FromArray(i);else if("ks"===c&&o)i=d.split(s,3).map(parseFloat),o.specularColor=Z.Wo.FromArray(i);else if("ke"===c&&o)i=d.split(s,3).map(parseFloat),o.emissiveColor=Z.Wo.FromArray(i);else if("ns"===c&&o)o.specularPower=parseFloat(d);else if("d"===c&&o)o.alpha=parseFloat(d);else if("map_ka"===c&&o)o.ambientTexture=nd._GetTexture(r,d,e);else if("map_kd"===c&&o)o.diffuseTexture=nd._GetTexture(r,d,e);else if("map_ks"===c&&o)o.specularTexture=nd._GetTexture(r,d,e);else if("map_ns"===c);else if("map_bump"===c&&o){let t=d.split(s),n=t.indexOf("-bm"),i=null;n>=0&&(i=t[n+1],t.splice(n,2)),o.bumpTexture=nd._GetTexture(r,t.join(" "),e),o.bumpTexture&&null!==i&&(o.bumpTexture.level=parseFloat(i))}else"map_d"===c&&o&&(o.opacityTexture=nd._GetTexture(r,d,e))}o&&this.materials.push(o)}static _GetTexture(e,t,r){if(!t)return null;let n=e;if("file:"===e){let e=t.lastIndexOf("\\");-1===e&&(e=t.lastIndexOf("/")),e>-1?n+=t.substring(e+1):n+=t}else n+=t;return new eo.x(n,r,!1,nd.INVERT_TEXTURE_Y)}}nd.INVERT_TEXTURE_Y=!0;class nh{constructor(e,t,r){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new Z.HE(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=r}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});let r=e[t[0]].normals.indexOf(t[1]);return -1===r?-1:e[t[0]].idx[r]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});let r=e[t[0]].normals.indexOf(t[1]);return 1!=r&&t[2]===e[t[0]].uv[r]?e[t[0]].idx[r]:-1}_setData(e,t,r,n,i,a,s){let o;-1===(o=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,r,t]):this._isInArray(this._tuplePosNorm,[e,r]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(n),i=i??new X.FM(0,0),this._wrappedUvsForBabylon.push(i),this._wrappedNormalsForBabylon.push(a),void 0!==s&&this._wrappedColorsForBabylon.push(s),this._tuplePosNorm[e].normals.push(r),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(o)}_unwrapData(){try{for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch(e){throw Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(e,t){for(let r=t;r<e.length-1;r++)this._pushTriangle(e,r)}_getColor(e){return this._loadingOptions.importVertexColors?this._extColors[e]??this._colors[e]:void 0}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=parseInt(this._triangles[e])-1;this._setData(t,0,0,this._positions[t],X.FM.Zero(),X.P.Up(),this._getColor(t))}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),r=parseInt(t[0])-1,n=parseInt(t[1])-1;this._setData(r,n,0,this._positions[r],this._uvs[n]??X.FM.Zero(),X.P.Up(),this._getColor(r))}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),r=parseInt(t[0])-1,n=parseInt(t[1])-1,i=parseInt(t[2])-1;this._setData(r,n,i,this._positions[r],this._uvs[n]??X.FM.Zero(),this._normals[i]??X.P.Up())}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("//"),r=parseInt(t[0])-1,n=parseInt(t[1])-1;this._setData(r,1,n,this._positions[r],X.FM.Zero(),this._normals[n],this._getColor(r))}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),r=this._positions.length+parseInt(t[0]),n=this._uvs.length+parseInt(t[1]),i=this._normals.length+parseInt(t[2]);this._setData(r,n,i,this._positions[r],this._uvs[n],this._normals[i],this._getColor(r))}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(e){let t=e.getVerticesData(eu.o.PositionKind),r=e.getVerticesData(eu.o.NormalKind),n={};if(!t||!r)return;for(let e=0;e<t.length/3;e++){let r=t[3*e+0],i=r+"_"+t[3*e+1]+"_"+t[3*e+2],a=n[i];a||(a=[],n[i]=a),a.push(e)}let i=new X.P;for(let e in n){let t=n[e];if(t.length<2)continue;let a=t[0];for(let e=1;e<t.length;++e){let n=t[e];r[3*a+0]+=r[3*n+0],r[3*a+1]+=r[3*n+1],r[3*a+2]+=r[3*n+2]}i.copyFromFloats(r[3*a+0],r[3*a+1],r[3*a+2]),i.normalize();for(let e=0;e<t.length;++e){let n=t[e];r[3*n+0]=i.x,r[3*n+1]=i.y,r[3*n+2]=i.z}}e.setVerticesData(eu.o.NormalKind,r)}static _IsLineElement(e){return e.startsWith("l")}static _IsObjectElement(e){return e.startsWith("o")}static _IsGroupElement(e){return e.startsWith("g")}static _GetZbrushMRGB(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];let r=e.match(/[a-z0-9]/g);if(!r||r.length%8!=0)return[];let n=[];for(let e=0;e<r.length/8;e++){let t=r[8*e+2]+r[8*e+3],i=r[8*e+4]+r[8*e+5],a=r[8*e+6]+r[8*e+7];n.push(new Z.HE(parseInt(t,16)/255,parseInt(i,16)/255,parseInt(a,16)/255,1))}return n}parse(e,t,r,n,i){t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=1):r.useRightHandedSystem?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t+1],e[t]),this._handednessSign=1):(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=-1);let a=t.split("\n"),s=[],o=[];s.push(o);for(let e=0;e<a.length;e++){let t=a[e].trim().replace(/\s\s/g," ");if(0!==t.length&&"#"!==t.charAt(0))if((nh._IsGroupElement(t)||nh._IsObjectElement(t))&&(o=[],s.push(o)),nh._IsLineElement(t)){let e=t.split(" ");for(let t=1;t<e.length-1;t++)o.push(`l ${e[t]} ${e[t+1]}`)}else o.push(t)}let l=s.flat();for(let e=0;e<l.length;e++){let t,r=l[e].trim().replace(/\s\s/g," ");if(0!==r.length&&"#"!==r.charAt(0))if(nh.VertexPattern.test(r)){if(t=r.match(/[^ ]+/g),this._positions.push(new X.P(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))),this._loadingOptions.importVertexColors)if(t.length>=7){let e=parseFloat(t[4]),r=parseFloat(t[5]),n=parseFloat(t[6]);this._colors.push(new Z.HE(e>1?e/255:e,r>1?r/255:r,n>1?n/255:n,7===t.length||void 0===t[7]?1:parseFloat(t[7])))}else this._colors.push(this._grayColor)}else if(null!==(t=nh.NormalPattern.exec(r)))this._normals.push(new X.P(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));else if(null!==(t=nh.UVPattern.exec(r)))this._uvs.push(new X.FM(parseFloat(t[1])*this._loadingOptions.UVScaling.x,parseFloat(t[2])*this._loadingOptions.UVScaling.y));else if(null!==(t=nh.FacePattern3.exec(r)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),1);else if(null!==(t=nh.FacePattern4.exec(r)))this._setDataForCurrentFaceWithPattern4(t[1].trim().split(" "),1);else if(null!==(t=nh.FacePattern5.exec(r)))this._setDataForCurrentFaceWithPattern5(t[1].trim().split(" "),1);else if(null!==(t=nh.FacePattern2.exec(r)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),1);else if(null!==(t=nh.FacePattern1.exec(r)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),1);else if(null!==(t=nh.LinePattern1.exec(r)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),0),this._hasLineData=!0;else if(null!==(t=nh.LinePattern2.exec(r)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),0),this._hasLineData=!0;else if(t=nh._GetZbrushMRGB(r,!this._loadingOptions.importVertexColors))for(let e of t)this._extColors.push(e);else if(null!==(t=nh.LinePattern3.exec(r)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),0),this._hasLineData=!0;else if(nh.GroupDescriptor.test(r)||nh.ObjectDescriptor.test(r)){let e={name:r.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:nh.ObjectDescriptor.test(r)};this._addPreviousObjMesh(),this._meshesFromObj.push(e),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(nh.UseMtlDescriptor.test(r)){if(this._materialNameFromObj=r.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();let e={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(e),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else nh.MtlLibGroupDescriptor.test(r)?i(r.substring(7).trim()):nh.SmoothDescriptor.test(r)||F.Y.Log("Unhandled expression at line : "+r)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){let e=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(let e of this._positions)this._unwrappedPositionsForBabylon.push(e.x,e.y,e.z);if(this._normals.length)for(let e of this._normals)this._unwrappedNormalsForBabylon.push(e.x,e.y,e.z);if(this._uvs.length)for(let e of this._uvs)this._unwrappedUVForBabylon.push(e.x,e.y);if(this._extColors.length)for(let e of this._extColors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);else if(this._colors.length)for(let e of this._colors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);!this._materialNameFromObj&&((e=new ea.K(ec.Z.RandomId(),r)).pointsCloud=!0,this._materialNameFromObj=e.name,this._normals.length||(e.disableLighting=!0,e.emissiveColor=Z.Wo.White()))}this._meshesFromObj.push({name:ec.Z.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:e,isObject:!0,hasLines:this._hasLineData})}for(let t=0;t<this._meshesFromObj.length;t++){if(e&&this._meshesFromObj[t].name){if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==e)continue}this._handledMesh=this._meshesFromObj[t],r._blockEntityCollection=!!n;let i=new ef.Kj(this._meshesFromObj[t].name,r);if(i._parentContainer=n,r._blockEntityCollection=!1,this._handledMesh._babylonMesh=i,!this._handledMesh.isObject){for(let e=t-1;e>=0;--e)if(this._meshesFromObj[e].isObject&&this._meshesFromObj[e]._babylonMesh){i.parent=this._meshesFromObj[e]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[t].materialName),this._handledMesh.hasLines&&(i._internalMetadata??(i._internalMetadata={}),i._internalMetadata._isLine=!0),this._handledMesh.positions?.length===0){this._babylonMeshesArray.push(i);continue}let a=new el.x;if(a.uvs=this._handledMesh.uvs,a.indices=this._handledMesh.indices,a.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){let e=[];el.x.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,e),a.normals=e}else a.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(a.colors=this._handledMesh.colors),a.applyToMesh(i),this._loadingOptions.invertY&&(i.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(i),this._babylonMeshesArray.push(i),this._handledMesh.directMaterial&&(i.material=this._handledMesh.directMaterial)}}}nh.ObjectDescriptor=/^o/,nh.GroupDescriptor=/^g/,nh.MtlLibGroupDescriptor=/^mtllib /,nh.UseMtlDescriptor=/^usemtl /,nh.SmoothDescriptor=/^s /,nh.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,nh.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,nh.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,nh.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,nh.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,nh.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,nh.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,nh.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,nh.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,nh.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,nh.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class nf{static get INVERT_TEXTURE_Y(){return nd.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){nd.INVERT_TEXTURE_Y=e}constructor(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions={...nf._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{computeNormals:nf.COMPUTE_NORMALS,optimizeNormals:nf.OPTIMIZE_NORMALS,importVertexColors:nf.IMPORT_VERTEX_COLORS,invertY:nf.INVERT_Y,invertTextureY:nf.INVERT_TEXTURE_Y,UVScaling:nf.UV_SCALING,materialLoadingFailsSilently:nf.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:nf.OPTIMIZE_WITH_UV,skipMaterials:nf.SKIP_MATERIALS,useLegacyBehavior:nf.USE_LEGACY_BEHAVIOR}}_loadMTL(e,t,r,n){let i=t+e;O.w1.LoadFile(i,r,void 0,void 0,!1,(e,t)=>{n(i,t)})}createPlugin(e){return new nf(e.obj)}canDirectLoad(){return!1}importMeshAsync(e,t,r,n){return this._parseSolidAsync(e,t,r,n).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(e,t,r){return this.importMeshAsync(null,e,t,r).then(()=>{})}loadAssetContainerAsync(e,t,r){let n=new N.TJ(e);return this._assetContainer=n,this.importMeshAsync(null,e,t,r).then(e=>(e.meshes.forEach(e=>n.meshes.push(e)),e.meshes.forEach(e=>{let t=e.material;t&&-1==n.materials.indexOf(t)&&(n.materials.push(t),t.getActiveTextures().forEach(e=>{-1==n.textures.indexOf(e)&&n.textures.push(e)}))}),this._assetContainer=null,n)).catch(e=>{throw this._assetContainer=null,e})}_parseSolidAsync(e,t,r,n){let i="",a=new nd,s=[],o=[];r=r.replace(/#.*$/gm,"").trim(),new nh(s,o,this._loadingOptions).parse(e,r,t,this._assetContainer,e=>{i=e});let l=[];return""===i||this._loadingOptions.skipMaterials||l.push(new Promise((e,r)=>{this._loadMTL(i,n,l=>{try{a.parseMTL(t,l,n,this._assetContainer);for(let e=0;e<a.materials.length;e++){let t,r=0,n=[];for(;(t=s.indexOf(a.materials[e].name,r))>-1;)n.push(t),r=t+1;if(-1===t&&0===n.length)a.materials[e].dispose();else for(let t=0;t<n.length;t++){let r=o[n[t]],i=a.materials[e];r.material=i,r.getTotalIndices()||(i.pointsCloud=!0)}}e()}catch(t){O.w1.Warn(`Error processing MTL file: '${i}'`),this._loadingOptions.materialLoadingFailsSilently?e():r(t)}},(t,n)=>{O.w1.Warn(`Error downloading MTL file: '${i}'`),this._loadingOptions.materialLoadingFailsSilently?e():r(n)})})),Promise.all(l).then(()=>{let e=e=>!!e._internalMetadata?._isLine;return o.forEach(r=>{if(e(r)){let n=r.material??new ea.K(r.name+"_line",t);n.getBindedMeshes().filter(t=>!e(t)).length>0&&(n=n.clone(n.name+"_line")??n),n.wireframe=!0,r.material=n,r._internalMetadata&&(r._internalMetadata._isLine=void 0)}}),o})}}nf.OPTIMIZE_WITH_UV=!0,nf.INVERT_Y=!1,nf.IMPORT_VERTEX_COLORS=!1,nf.COMPUTE_NORMALS=!1,nf.OPTIMIZE_NORMALS=!1,nf.UV_SCALING=new X.FM(1,1),nf.SKIP_MATERIALS=!1,nf.MATERIAL_LOADING_FAILS_SILENTLY=!0,nf.USE_LEGACY_BEHAVIOR=!1,(0,L.oo)(new nf);let np={".stl":{isBinary:!0}};class n_{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name="stl",this.extensions=np}importMesh(e,t,r,n,i){let a;if("string"!=typeof r){if(this._isBinary(r)){let e=new ef.Kj("stlmesh",t);return this._parseBinary(e,r),i&&i.push(e),!0}r=new TextDecoder().decode(new Uint8Array(r))}for(;a=this.solidPattern.exec(r);){let r=a[1],n=a[3];if(n&&r!=n)return O.w1.Error("Error in STL, solid name != endsolid name"),!1;if(e&&r){if(e instanceof Array){if(!e.indexOf(r))continue}else if(r!==e)continue}r=r||"stlmesh";let s=new ef.Kj(r,t);this._parseASCII(s,a[2]),i&&i.push(s)}return!0}load(e,t,r){return this.importMesh(null,e,t,r,null)}loadAssetContainer(e,t,r){let n=new N.TJ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,r,n.meshes),e._blockEntityCollection=!1,n}_isBinary(e){let t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;let r=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==r[e])return!0;return!1}_parseBinary(e,t){let r=new DataView(t),n=r.getUint32(80,!0),i=0,a=new Float32Array(3*n*3),s=new Float32Array(3*n*3),o=new Uint32Array(3*n),l=0;for(let e=0;e<n;e++){let t=84+50*e,n=r.getFloat32(t,!0),u=r.getFloat32(t+4,!0),c=r.getFloat32(t+8,!0);for(let e=1;e<=3;e++){let o=t+12*e;a[i]=r.getFloat32(o,!0),s[i]=n,n_.DO_NOT_ALTER_FILE_COORDINATES?(a[i+1]=r.getFloat32(o+4,!0),a[i+2]=r.getFloat32(o+8,!0),s[i+1]=u,s[i+2]=c):(a[i+2]=r.getFloat32(o+4,!0),a[i+1]=r.getFloat32(o+8,!0),s[i+2]=u,s[i+1]=c),i+=3}n_.DO_NOT_ALTER_FILE_COORDINATES?(o[l]=l,o[l+1]=l+2,o[l+2]=l+1,l+=3):(o[l]=l++,o[l]=l++,o[l]=l++)}e.setVerticesData(eu.o.PositionKind,a),e.setVerticesData(eu.o.NormalKind,s),e.setIndices(o),e.computeWorldMatrix(!0)}_parseASCII(e,t){let r,n=[],i=[],a=[],s=0;for(;r=this.facetsPattern.exec(t);){let e,t=r[1],o=this.normalPattern.exec(t);if(this.normalPattern.lastIndex=0,!o)continue;let l=[Number(o[1]),Number(o[5]),Number(o[3])];for(;e=this.vertexPattern.exec(t);)n_.DO_NOT_ALTER_FILE_COORDINATES?(n.push(Number(e[1]),Number(e[3]),Number(e[5])),i.push(l[0],l[2],l[1])):(n.push(Number(e[1]),Number(e[5]),Number(e[3])),i.push(l[0],l[1],l[2]));n_.DO_NOT_ALTER_FILE_COORDINATES?(a.push(s,s+2,s+1),s+=3):a.push(s++,s++,s++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(eu.o.PositionKind,n),e.setVerticesData(eu.o.NormalKind,i),e.setIndices(a),e.computeWorldMatrix(!0)}}n_.DO_NOT_ALTER_FILE_COORDINATES=!1,(0,L.oo)(new n_);let nm="splat",ng={".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}};var ny=r(13231),nv=r(28294),nb=r(5903);(_=P||(P={}))[_.Splat=0]="Splat",_[_.PointCloud=1]="PointCloud",_[_.Mesh=2]="Mesh",_[_.Reject=3]="Reject";class nx{constructor(e=nx._DefaultLoadingOptions){this.name=nm,this._assetContainer=null,this.extensions=ng,this._loadingOptions=e}createPlugin(e){return new nx(e[nm])}async importMeshAsync(e,t,r,n,i,a){return await this._parseAsync(e,t,r,n).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}static _BuildPointCloud(e,t){if(!t.byteLength)return!1;let r=new Uint8Array(t),n=new Float32Array(t),i=r.length/32;return e.addPoints(i,function(e,t){let i=n[8*t+0],a=n[8*t+1],s=n[8*t+2];e.position=new X.P(i,a,s);let o=r[32*t+24+0]/255,l=r[32*t+24+1]/255,u=r[32*t+24+2]/255;e.color=new Z.HE(o,l,u,1)}),!0}static _BuildMesh(e,t){let r=new ef.Kj("PLYMesh",e),n=new Uint8Array(t.data),i=new Float32Array(t.data),a=n.length/32,s=[],o=new el.x;for(let e=0;e<a;e++){let t=i[8*e+0],r=i[8*e+1],n=i[8*e+2];s.push(t,r,n)}if(t.hasVertexColors){let e=new Float32Array(4*a);for(let t=0;t<a;t++){let r=n[32*t+24+0]/255,i=n[32*t+24+1]/255,a=n[32*t+24+2]/255;e[4*t+0]=r,e[4*t+1]=i,e[4*t+2]=a,e[4*t+3]=1}o.colors=e}return o.positions=s,o.indices=t.faces,o.applyToMesh(r),r}_parseSPZAsync(e,t){let r=new Uint8Array(e),n=new Uint32Array(e.slice(0,12)),i=n[2],a=r[12],s=r[13],o=r[14];if(r[15]||0x5053474e!=n[0]||2!=n[1])return new Promise(e=>{e({mode:3,data:l,hasVertexColors:!1})});let l=new ArrayBuffer(32*i),u=1/(1<<s),c=new Int32Array(1),d=new Uint8Array(c.buffer),h=function(e,t){return d[0]=e[t+0],d[1]=e[t+1],d[2]=e[t+2],d[3]=128&e[t+2]?255:0,c[0]*u},f=16,p=new Float32Array(l),_=new Float32Array(l),m=new Uint8ClampedArray(l),g=new Uint8ClampedArray(l),y=1,v=0;this._loadingOptions.flipY||(y=-1,v=255);for(let e=0;e<i;e++)p[8*e+0]=h(r,f+0),p[8*e+1]=y*h(r,f+3),p[8*e+2]=y*h(r,f+6),f+=9;for(let e=0;e<i;e++){for(let t=0;t<3;t++){let n=(r[f+i+3*e+t]-127.5)/38.25;m[32*e+24+t]=nb.R.Clamp((.5+.282*n)*255,0,255)}m[32*e+24+3]=r[f+e]}f+=4*i;for(let e=0;e<i;e++)_[8*e+3+0]=Math.exp(r[f+0]/16-10),_[8*e+3+1]=Math.exp(r[f+1]/16-10),_[8*e+3+2]=Math.exp(r[f+2]/16-10),f+=3;for(let e=0;e<i;e++){let t=r[f+0],n=r[f+1]*y+v,i=r[f+2]*y+v,a=t/127.5-1,s=n/127.5-1,o=i/127.5-1;g[32*e+28+1]=t,g[32*e+28+2]=n,g[32*e+28+3]=i;let l=1-(a*a+s*s+o*o);g[32*e+28+0]=127.5+127.5*Math.sqrt(l<0?0:l),f+=3}if(a){let e=3*((a+1)*(a+1)-1),n=Math.ceil(e/16),s=f,u=[],c=t.getEngine().getCaps().maxTextureSize,d=Math.ceil(i/c);for(let e=0;e<n;e++){let e=new Uint8Array(d*c*16);u.push(e)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){let e=r[s++];u[Math.floor(n/16)][n%16+16*t]=e}return new Promise(e=>{e({mode:0,data:l,hasVertexColors:!1,sh:u,trainedWithAntialiasing:!!o})})}return new Promise(e=>{e({mode:0,data:l,hasVertexColors:!1,trainedWithAntialiasing:!!o})})}_parseAsync(e,t,r,n){let i=[],a=new ReadableStream({start(e){e.enqueue(new Uint8Array(r)),e.close()}}),s=new DecompressionStream("gzip"),o=a.pipeThrough(s);return new Promise(e=>{new Response(o).arrayBuffer().then(r=>{this._parseSPZAsync(r,t).then(r=>{t._blockEntityCollection=!!this._assetContainer;let n=new ny.h("GaussianSplatting",null,t,this._loadingOptions.keepInRam);if(r.trainedWithAntialiasing){let e=n.material;e.kernelSize=.1,e.compensation=!0}n._parentContainer=this._assetContainer,i.push(n),n.updateData(r.data,r.sh),t._blockEntityCollection=!1,e(i)})}).catch(()=>{nx._ConvertPLYToSplat(r).then(async r=>{switch(t._blockEntityCollection=!!this._assetContainer,r.mode){case 0:{let e=new ny.h("GaussianSplatting",null,t,this._loadingOptions.keepInRam);e._parentContainer=this._assetContainer,i.push(e),e.updateData(r.data,r.sh)}break;case 1:{let e=new nv.B("PointCloud",1,t);nx._BuildPointCloud(e,r.data)?await e.buildMeshAsync().then(e=>{i.push(e)}):e.dispose()}break;case 2:if(r.faces)i.push(nx._BuildMesh(t,r));else throw Error("PLY mesh doesn't contain face informations.");break;default:throw Error("Unsupported Splat mode")}t._blockEntityCollection=!1,e(i)})})})}loadAssetContainerAsync(e,t,r){let n=new N.TJ(e);return this._assetContainer=n,this.importMeshAsync(null,e,t,r).then(e=>{for(let t of e.meshes)n.meshes.push(t);return this._assetContainer=null,n}).catch(e=>{throw this._assetContainer=null,e})}loadAsync(e,t,r){return this.importMeshAsync(null,e,t,r).then(()=>{})}static _ConvertPLYToSplat(e){var t;let r,n=new Uint8Array(e),i=new TextDecoder().decode(n.slice(0,10240)),a="end_header\n",s=i.indexOf(a);if(s<0||!i)return new Promise(t=>{t({mode:0,data:e})});let o=parseInt(/element vertex (\d+)\n/.exec(i)[1]),l=/element face (\d+)\n/.exec(i),u=0;l&&(u=parseInt(l[1]));let c=/element chunk (\d+)\n/.exec(i),d=0;c&&(d=parseInt(c[1]));let h=0,f=0,p={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0};(t=r||(r={}))[t.Vertex=0]="Vertex",t[t.Chunk=1]="Chunk",t[t.SH=2]="SH";let _=1,m=[],g=[];for(let e of i.slice(0,s).split("\n"))if(e.startsWith("property ")){let[,t,r]=e.split(" ");1==_?(g.push({name:r,type:t,offset:f}),f+=p[t]):0==_?(m.push({name:r,type:t,offset:h}),h+=p[t]):2==_&&m.push({name:r,type:t,offset:h}),p[t]||F.Y.Warn(`Unsupported property type: ${t}.`)}else if(e.startsWith("element ")){let[,t]=e.split(" ");"chunk"==t?_=1:"vertex"==t?_=0:"sh"==t&&(_=2)}let y=h,v=f;return ny.h.ConvertPLYWithSHToSplatAsync(e).then(async t=>{let r=new DataView(e,s+a.length),n=v*d+y*o,i=[];if(u)for(let e=0;e<u;e++){let e=r.getUint8(n);if(3==e){n+=1;for(let t=0;t<e;t++){let e=r.getUint32(n+(2-t)*4,!0);i.push(e)}n+=12}}if(d)return await new Promise(e=>{e({mode:0,data:t.buffer,sh:t.sh,faces:i,hasVertexColors:!1})});let l=0,c=0,h=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],f=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"];for(let e=0;e<m.length;e++){let t=m[e];h.includes(t.name)&&l++,f.includes(t.name)&&c++}let p=l==h.length&&3==c,_=u?2:+!p;return await new Promise(e=>{e({mode:_,data:t.buffer,sh:t.sh,faces:i,hasVertexColors:!!c})})})}}nx._DefaultLoadingOptions={keepInRam:!1,flipY:!1},(0,L.oo)(new nx)},78683:function(e,t,r){r.d(t,{L:()=>o});var n=r(85791),i=r(88280),a=r(74913),s=r(25146);a.a.AudioEngineFactory=(e,t,r)=>new o(e,t,r);class o{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(e=null,t=null,r=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new n.y$,this.onAudioLockedObservable=new n.y$,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,s.CG)())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);let i=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=r;try{i&&i.canPlayType&&(i.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||i.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{i&&i.canPlayType&&i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}lock(){this._triggerSuspendedState()}unlock(){if(this._audioContext?.state==="running"){this._hideMuteButton(),this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this));return}this._tryToRun?this._audioContext?.suspend().then(()=>{this._tryToRun=!1,this._triggerRunningStateAsync()},()=>{i.Y.Error("Failed to suspend audio context.")}):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",()=>{this.unlocked&&this._audioContext?.state!=="running"&&this._resumeAudioContextAsync()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(e){this.canUseWebAudio=!1,i.Y.Error("Web Audio: "+e.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(e){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";let e=window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png",t=document.createElement("style");t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+e+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",()=>{this._triggerRunningStateAsync()},!0),this._muteButton.addEventListener("click",()=>{this.unlock()},!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),this._audioContext?.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},78685:function(e,t,r){r.d(t,{Q:()=>i});var n=r(60963);class i{constructor(){this._gpuTimeInFrameId=-1,this.counter=new n.z}_addDuration(e,t){e<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==e?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(t,!1),this._gpuTimeInFrameId=e):this.counter.addCount(t,!1))}}},78914:function(e,t,r){var n=r(90481),i=r(88280),a=r(1677);a.f.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,r){r&&r(),this._endCurrentRenderPass(),t||this.generateMipMapsMultiFramebuffer(e),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)},a.f.prototype.createMultipleRenderTarget=function(e,t,r){let a=!1,s=!0,o=!1,l=!1,u=15,c=1,d=1,h=[],f=[],p=[],_=[],m=[],g=[],y=[],v=[],b=[],x=[],T=!1,E=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(a=t.generateMipMaps??!1,s=t.generateDepthBuffer??!0,o=t.generateStencilBuffer??!1,l=t.generateDepthTexture??!1,c=t.textureCount??1,u=t.depthTextureFormat??15,h=t.types||h,f=t.samplingModes||f,p=t.useSRGBBuffers||p,_=t.formats||_,m=t.targetTypes||m,g=t.faceIndex||g,y=t.layerIndex||y,v=t.layerCounts||v,b=t.labels||b,x=t.creationFlags||x,d=t.samples??d,T=t.dontCreateTextures??!1);let A=e.width??e,S=e.height??e,I=[],C=[],P=[];E.label=t?.label??"MultiRenderTargetWrapper",E._generateDepthBuffer=s,E._generateStencilBuffer=o,E._attachments=C,E._defaultAttachments=P;let R=null;(s||o||l)&&!T&&(l||(u=s&&o?13:s?14:19),R=E.createDepthStencilTexture(0,!1,o,1,u,E.label+"-DepthStencil"));let w=void 0!==t&&"object"==typeof t&&t.createMipMaps&&!a;for(let e=0;e<c;e++){let t=f[e]||3,s=h[e]||0,o=_[e]||5,l=(p[e]||!1)&&this._caps.supportSRGBBuffers,u=m[e]||3553,c=v[e]??1,d=x[e];if((1!==s||this._caps.textureFloatLinearFiltering)&&(2!==s||this._caps.textureHalfFloatLinearFiltering)||(t=1),1!==s||this._caps.textureFloat||(s=0,i.Y.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),C.push(e+1),P.push(r?e+1:+(0===e)),-1===u||T)continue;let g=new n.l(this,6);switch(I[e]=g,u){case 34067:g.isCube=!0;break;case 32879:g.is3D=!0,g.baseDepth=g.depth=c;break;case 35866:g.is2DArray=!0,g.baseDepth=g.depth=c}g.baseWidth=A,g.baseHeight=S,g.width=A,g.height=S,g.isReady=!0,g.samples=1,g.generateMipMaps=a,g.samplingMode=t,g.type=s,g._cachedWrapU=0,g._cachedWrapV=0,g._useSRGBBuffer=l,g.format=o,g.label=b[e]??E.label+"-Texture"+e,this._internalTexturesCache.push(g),w&&(g.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(g,void 0,void 0,void 0,d,!0),w&&(g.generateMipMaps=!1)}return R&&(R.incrementReferences(),I[c]=R,this._internalTexturesCache.push(R)),E.setTextures(I),E.setLayerAndFaceIndices(y,g),T?E._samples=d:this.updateMultipleRenderTargetTextureSampleCount(E,d),E},a.f.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||0===e.textures.length||e.textures[0].samples===t)return t;let r=e.textures.length;if(0===r)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(let t=0;t<r;++t){let r=e.textures[t]._hardwareTexture;r?.releaseMSAATexture(e.getBaseArrayLayer(t))}let n=e._depthStencilTexture===e.textures[r-1];for(let n=0;n<r;++n){let r=e.textures[n];this._textureHelper.createMSAATexture(r,t,!1,e.getBaseArrayLayer(n)),r.samples=t}return e._depthStencilTexture&&!n&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),e._samples=t,t},a.f.prototype.generateMipMapsMultiFramebuffer=function(e){if(!e.isMulti)return;let t=e._attachments.length;for(let r=0;r<t;r++){let t=e.textures[r];!t.generateMipMaps||t.isCube||t.is3D||this._generateMipmaps(t)}},a.f.prototype.resolveMultiFramebuffer=function(e){throw Error("resolveMultiFramebuffer is not yet implemented in WebGPU!")},a.f.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},a.f.prototype.buildTextureLayout=function(e){let t=[];for(let r=0;r<e.length;r++)e[r]?t.push(r+1):t.push(0);return t},a.f.prototype.restoreSingleAttachment=function(){},a.f.prototype.restoreSingleAttachmentForRenderTarget=function(){}},79307:function(e,t,r){r.d(t,{L:()=>a});var n=r(80405),i=r(19065);Object.defineProperty(r(72384).x.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){let e=this._getComponent(n.l.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new a(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new i.a}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});class a{constructor(e){this.name=n.l.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(n.l.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)}rebuild(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()}dispose(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()}_gatherRenderTargets(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()}}},79309:function(e,t,r){r.d(t,{GB:()=>l,fv:()=>i,fw:()=>u,kP:()=>o,me:()=>a,nt:()=>d,vr:()=>s});var n=r(56865);class i{constructor(e,t,r,n){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(r),this.h=Math.floor(n)}run(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)}clone(){return new i(this.x,this.y,this.w,this.h)}}class a{constructor(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}run(e){e.setScissorRect(this.x,this.y,this.w,this.h)}clone(){return new a(this.x,this.y,this.w,this.h)}}class s{constructor(e){this.ref=e}run(e){e.setStencilReference(this.ref)}clone(){return new s(this.ref)}}class o{constructor(e){this.color=e}run(e){e.setBlendConstant(this.color)}clone(){return new o(this.color)}}class l{constructor(e){this.query=e}run(e){e.beginOcclusionQuery(this.query)}clone(){return new l(this.query)}}class u{constructor(){}run(e){e.endOcclusionQuery()}clone(){return new u}}class c{constructor(){this.bundles=[]}run(e){e.executeBundles(this.bundles)}clone(){let e=new c;return e.bundles=this.bundles,e}}class d{constructor(e){this.numDrawCalls=0,this._device=e,this._list=Array(10),this._listLength=0}addBundle(e){if(!this._currentItemIsBundle){let e=new c;this._list[this._listLength++]=e,this._currentBundleList=e.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)}_finishBundle(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)}addItem(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1}getBundleEncoder(e,t,r){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:n.D.GetSample(r)})),this._bundleEncoder}close(){this._finishBundle()}run(e){this.close();for(let t=0;t<this._listLength;++t)this._list[t].run(e)}reset(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0}clone(){this.close();let e=new d(this._device);e._list=Array(this._listLength),e._listLength=this._listLength,e.numDrawCalls=this.numDrawCalls;for(let t=0;t<this._listLength;++t)e._list[t]=this._list[t].clone();return e}}},79474:function(e,t,r){r.d(t,{g:()=>n});class n{}n.AUTOSAMPLERSUFFIX="Sampler",n.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",n.ALPHA_DISABLE=0,n.ALPHA_ADD=1,n.ALPHA_COMBINE=2,n.ALPHA_SUBTRACT=3,n.ALPHA_MULTIPLY=4,n.ALPHA_MAXIMIZED=5,n.ALPHA_ONEONE=6,n.ALPHA_PREMULTIPLIED=7,n.ALPHA_PREMULTIPLIED_PORTERDUFF=8,n.ALPHA_INTERPOLATE=9,n.ALPHA_SCREENMODE=10,n.ALPHA_ONEONE_ONEONE=11,n.ALPHA_ALPHATOCOLOR=12,n.ALPHA_REVERSEONEMINUS=13,n.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,n.ALPHA_ONEONE_ONEZERO=15,n.ALPHA_EXCLUSION=16,n.ALPHA_LAYER_ACCUMULATE=17,n.ALPHA_EQUATION_ADD=0,n.ALPHA_EQUATION_SUBSTRACT=1,n.ALPHA_EQUATION_REVERSE_SUBTRACT=2,n.ALPHA_EQUATION_MAX=3,n.ALPHA_EQUATION_MIN=4,n.ALPHA_EQUATION_DARKEN=5,n.DELAYLOADSTATE_NONE=0,n.DELAYLOADSTATE_LOADED=1,n.DELAYLOADSTATE_LOADING=2,n.DELAYLOADSTATE_NOTLOADED=4,n.NEVER=512,n.ALWAYS=519,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATER=516,n.GEQUAL=518,n.NOTEQUAL=517,n.KEEP=7680,n.ZERO=0,n.REPLACE=7681,n.INCR=7682,n.DECR=7683,n.INVERT=5386,n.INCR_WRAP=34055,n.DECR_WRAP=34056,n.TEXTURE_CLAMP_ADDRESSMODE=0,n.TEXTURE_WRAP_ADDRESSMODE=1,n.TEXTURE_MIRROR_ADDRESSMODE=2,n.TEXTURE_CREATIONFLAG_STORAGE=1,n.TEXTUREFORMAT_ALPHA=0,n.TEXTUREFORMAT_LUMINANCE=1,n.TEXTUREFORMAT_LUMINANCE_ALPHA=2,n.TEXTUREFORMAT_RGB=4,n.TEXTUREFORMAT_RGBA=5,n.TEXTUREFORMAT_RED=6,n.TEXTUREFORMAT_R=6,n.TEXTUREFORMAT_R16_UNORM=33322,n.TEXTUREFORMAT_RG16_UNORM=33324,n.TEXTUREFORMAT_RGB16_UNORM=32852,n.TEXTUREFORMAT_RGBA16_UNORM=32859,n.TEXTUREFORMAT_R16_SNORM=36760,n.TEXTUREFORMAT_RG16_SNORM=36761,n.TEXTUREFORMAT_RGB16_SNORM=36762,n.TEXTUREFORMAT_RGBA16_SNORM=36763,n.TEXTUREFORMAT_RG=7,n.TEXTUREFORMAT_RED_INTEGER=8,n.TEXTUREFORMAT_R_INTEGER=8,n.TEXTUREFORMAT_RG_INTEGER=9,n.TEXTUREFORMAT_RGB_INTEGER=10,n.TEXTUREFORMAT_RGBA_INTEGER=11,n.TEXTUREFORMAT_BGRA=12,n.TEXTUREFORMAT_DEPTH24_STENCIL8=13,n.TEXTUREFORMAT_DEPTH32_FLOAT=14,n.TEXTUREFORMAT_DEPTH16=15,n.TEXTUREFORMAT_DEPTH24=16,n.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,n.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,n.TEXTUREFORMAT_STENCIL8=19,n.TEXTUREFORMAT_UNDEFINED=0xffffffff,n.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,n.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,n.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,n.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,n.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,n.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,n.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,n.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,n.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,n.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,n.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,n.TEXTURETYPE_UNSIGNED_BYTE=0,n.TEXTURETYPE_UNSIGNED_INT=0,n.TEXTURETYPE_FLOAT=1,n.TEXTURETYPE_HALF_FLOAT=2,n.TEXTURETYPE_BYTE=3,n.TEXTURETYPE_SHORT=4,n.TEXTURETYPE_UNSIGNED_SHORT=5,n.TEXTURETYPE_INT=6,n.TEXTURETYPE_UNSIGNED_INTEGER=7,n.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,n.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,n.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,n.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,n.TEXTURETYPE_UNSIGNED_INT_24_8=12,n.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,n.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,n.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,n.TEXTURETYPE_UNDEFINED=16,n.TEXTURE_2D=3553,n.TEXTURE_2D_ARRAY=35866,n.TEXTURE_CUBE_MAP=34067,n.TEXTURE_CUBE_MAP_ARRAY=0xdeadbeef,n.TEXTURE_3D=32879,n.TEXTURE_NEAREST_SAMPLINGMODE=1,n.TEXTURE_NEAREST_NEAREST=1,n.TEXTURE_BILINEAR_SAMPLINGMODE=2,n.TEXTURE_LINEAR_LINEAR=2,n.TEXTURE_TRILINEAR_SAMPLINGMODE=3,n.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,n.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,n.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,n.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,n.TEXTURE_NEAREST_LINEAR=7,n.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,n.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,n.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,n.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,n.TEXTURE_LINEAR_NEAREST=12,n.TEXTURE_EXPLICIT_MODE=0,n.TEXTURE_SPHERICAL_MODE=1,n.TEXTURE_PLANAR_MODE=2,n.TEXTURE_CUBIC_MODE=3,n.TEXTURE_PROJECTION_MODE=4,n.TEXTURE_SKYBOX_MODE=5,n.TEXTURE_INVCUBIC_MODE=6,n.TEXTURE_EQUIRECTANGULAR_MODE=7,n.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,n.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,n.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,n.TEXTURE_FILTERING_QUALITY_HIGH=64,n.TEXTURE_FILTERING_QUALITY_MEDIUM=16,n.TEXTURE_FILTERING_QUALITY_LOW=8,n.SCALEMODE_FLOOR=1,n.SCALEMODE_NEAREST=2,n.SCALEMODE_CEILING=3,n.MATERIAL_TextureDirtyFlag=1,n.MATERIAL_LightDirtyFlag=2,n.MATERIAL_FresnelDirtyFlag=4,n.MATERIAL_AttributesDirtyFlag=8,n.MATERIAL_MiscDirtyFlag=16,n.MATERIAL_PrePassDirtyFlag=32,n.MATERIAL_ImageProcessingDirtyFlag=64,n.MATERIAL_AllDirtyFlag=127,n.MATERIAL_TriangleFillMode=0,n.MATERIAL_WireFrameFillMode=1,n.MATERIAL_PointFillMode=2,n.MATERIAL_PointListDrawMode=3,n.MATERIAL_LineListDrawMode=4,n.MATERIAL_LineLoopDrawMode=5,n.MATERIAL_LineStripDrawMode=6,n.MATERIAL_TriangleStripDrawMode=7,n.MATERIAL_TriangleFanDrawMode=8,n.MATERIAL_ClockWiseSideOrientation=0,n.MATERIAL_CounterClockWiseSideOrientation=1,n.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,n.MATERIAL_DIFFUSE_MODEL_BURLEY=1,n.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,n.MATERIAL_DIFFUSE_MODEL_LEGACY=3,n.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,n.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,n.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,n.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,n.ACTION_NothingTrigger=0,n.ACTION_OnPickTrigger=1,n.ACTION_OnLeftPickTrigger=2,n.ACTION_OnRightPickTrigger=3,n.ACTION_OnCenterPickTrigger=4,n.ACTION_OnPickDownTrigger=5,n.ACTION_OnDoublePickTrigger=6,n.ACTION_OnPickUpTrigger=7,n.ACTION_OnPickOutTrigger=16,n.ACTION_OnLongPressTrigger=8,n.ACTION_OnPointerOverTrigger=9,n.ACTION_OnPointerOutTrigger=10,n.ACTION_OnEveryFrameTrigger=11,n.ACTION_OnIntersectionEnterTrigger=12,n.ACTION_OnIntersectionExitTrigger=13,n.ACTION_OnKeyDownTrigger=14,n.ACTION_OnKeyUpTrigger=15,n.PARTICLES_BILLBOARDMODE_Y=2,n.PARTICLES_BILLBOARDMODE_ALL=7,n.PARTICLES_BILLBOARDMODE_STRETCHED=8,n.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,n.MESHES_CULLINGSTRATEGY_STANDARD=0,n.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,n.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,n.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,n.SCENELOADER_NO_LOGGING=0,n.SCENELOADER_MINIMAL_LOGGING=1,n.SCENELOADER_SUMMARY_LOGGING=2,n.SCENELOADER_DETAILED_LOGGING=3,n.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,n.PREPASS_POSITION_TEXTURE_TYPE=1,n.PREPASS_VELOCITY_TEXTURE_TYPE=2,n.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,n.PREPASS_COLOR_TEXTURE_TYPE=4,n.PREPASS_DEPTH_TEXTURE_TYPE=5,n.PREPASS_NORMAL_TEXTURE_TYPE=6,n.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,n.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,n.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,n.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,n.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,n.PREPASS_ALBEDO_TEXTURE_TYPE=12,n.BUFFER_CREATIONFLAG_READ=1,n.BUFFER_CREATIONFLAG_WRITE=2,n.BUFFER_CREATIONFLAG_READWRITE=3,n.BUFFER_CREATIONFLAG_UNIFORM=4,n.BUFFER_CREATIONFLAG_VERTEX=8,n.BUFFER_CREATIONFLAG_INDEX=16,n.BUFFER_CREATIONFLAG_STORAGE=32,n.BUFFER_CREATIONFLAG_INDIRECT=64,n.RENDERPASS_MAIN=0,n.INPUT_ALT_KEY=18,n.INPUT_CTRL_KEY=17,n.INPUT_META_KEY1=91,n.INPUT_META_KEY2=92,n.INPUT_META_KEY3=93,n.INPUT_SHIFT_KEY=16,n.SNAPSHOTRENDERING_STANDARD=0,n.SNAPSHOTRENDERING_FAST=1,n.PERSPECTIVE_CAMERA=0,n.ORTHOGRAPHIC_CAMERA=1,n.FOVMODE_VERTICAL_FIXED=0,n.FOVMODE_HORIZONTAL_FIXED=1,n.RIG_MODE_NONE=0,n.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,n.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,n.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,n.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,n.RIG_MODE_STEREOSCOPIC_INTERLACED=14,n.RIG_MODE_VR=20,n.RIG_MODE_CUSTOM=22,n.MAX_SUPPORTED_UV_SETS=6,n.GL_ALPHA_EQUATION_ADD=32774,n.GL_ALPHA_EQUATION_MIN=32775,n.GL_ALPHA_EQUATION_MAX=32776,n.GL_ALPHA_EQUATION_SUBTRACT=32778,n.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,n.GL_ALPHA_FUNCTION_SRC=768,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,n.GL_ALPHA_FUNCTION_SRC_ALPHA=770,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,n.GL_ALPHA_FUNCTION_DST_ALPHA=772,n.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,n.GL_ALPHA_FUNCTION_DST_COLOR=774,n.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,n.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,n.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,n.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,n.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,n.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,n.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,n.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,n.SnippetUrl="https://snippet.babylonjs.com",n.FOGMODE_NONE=0,n.FOGMODE_EXP=1,n.FOGMODE_EXP2=2,n.FOGMODE_LINEAR=3,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.PositionKind="position",n.NormalKind="normal",n.TangentKind="tangent",n.UVKind="uv",n.UV2Kind="uv2",n.UV3Kind="uv3",n.UV4Kind="uv4",n.UV5Kind="uv5",n.UV6Kind="uv6",n.ColorKind="color",n.ColorInstanceKind="instanceColor",n.MatricesIndicesKind="matricesIndices",n.MatricesWeightsKind="matricesWeights",n.MatricesIndicesExtraKind="matricesIndicesExtra",n.MatricesWeightsExtraKind="matricesWeightsExtra",n.ANIMATIONTYPE_FLOAT=0,n.ANIMATIONTYPE_VECTOR3=1,n.ANIMATIONTYPE_QUATERNION=2,n.ANIMATIONTYPE_MATRIX=3,n.ANIMATIONTYPE_COLOR3=4,n.ANIMATIONTYPE_COLOR4=7,n.ANIMATIONTYPE_VECTOR2=5,n.ANIMATIONTYPE_SIZE=6,n.ShadowMinZ=0,n.ShadowMaxZ=1e4},80014:function(e,t,r){var n=r(66755);let i="fogVertex",a=`#ifdef FOG
#ifdef SCENE_UBO
vertexOutputs.vFogDistance=(scene.view*worldPos).xyz;
#else
vertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},80781:function(e,t,r){r.d(t,{MK:()=>f,Th:()=>_,mE:()=>m,n4:()=>y,ng:()=>p,qB:()=>h});var n=r(32160),i=r(57716),a=r(32519),s=r(88280),o=r(70541),l=r(23207),u=r(60746),c=r(67109);let d=null;function h(e,t,r,n,i="image/png",a=!1,l,u=!1){let{height:c,width:f}=g(e,t,r);return c&&f?t.getScene().activeCamera!==t?void _(e,t,r,e=>{if(a){let t=new Blob([e]);o.w1.DownloadBlob(t),n&&n("")}else n&&n(e)},i,1,e.getCreationOptions().antialias,void 0,void 0,void 0,void 0,l):void e.onEndFrameObservable.addOnce(()=>{d||(d=document.createElement("canvas")),d.width=f,d.height=c;let t=d.getContext("2d"),r=e.getRenderingCanvas();if(!t||!r)return void s.Y.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");let h=r.width,p=r.height,_=d.width,m=d.height,g=_/h,y=m/p,v=u?Math.max(g,y):Math.min(g,y),b=h*v,x=p*v;t.drawImage(r,0,0,h,p,(_-b)/2,(m-x)/2,b,x),a?(o.w1.EncodeScreenshotCanvasData(d,void 0,i,void 0,l),n&&n("")):o.w1.EncodeScreenshotCanvasData(d,n,i,void 0,l)}):void s.Y.Error("Invalid 'size' parameter !")}async function f(e,t,r,n="image/png",i,a=!1){return await new Promise((s,o)=>{h(e,t,r,e=>{void 0!==e?s(e):o(Error("Data is undefined"))},n,void 0,i,a)})}async function p(e,t,r,n,i="image/png",a,s=!1){return await new Promise(o=>{h(e,t,{width:r,height:n},()=>{o()},i,!0,a,s)})}function _(e,t,o,d,h="image/png",f=1,p=!1,m,y=!1,v=!1,b=!0,x,T,E){let{height:A,width:S,finalWidth:I,finalHeight:C}=g(e,t,o);if(!(A&&S))return void s.Y.Error("Invalid 'size' parameter !");e.skipFrameRender=!0;let P=e.getRenderWidth,R=e.getRenderHeight;e.getRenderWidth=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.width:S,e.getRenderHeight=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.height:A,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e);let w=t.getScene(),M=new i._("screenShot",{width:S,height:A},w,!1,!1,0,!1,n.x.BILINEAR_SAMPLINGMODE,void 0,v,void 0,void 0,void 0,f);M.renderList=w.meshes.slice(),M.samples=f,M.renderSprites=y,M.activeCamera=t,M.forceLayerMaskCheck=b,T?.(M);let O=E||l.DumpData,L=()=>{(0,c.l)(()=>M.isReadyForRendering()&&t.isReady(!0),()=>{e.onEndFrameObservable.addOnce(()=>{I===S&&C===A?M.readPixels(void 0,void 0,void 0,!1).then(e=>{O(S,A,e,d,h,m,!0,void 0,x),M.dispose()}):(e.isWebGPU?r.e("1801").then(r.bind(r,45460)):r.e("395").then(r.bind(r,35066))).then(async()=>await (0,u.$0)("pass",M.getInternalTexture(),w,void 0,void 0,void 0,I,C).then(t=>{e._readTexturePixels(t,I,C,-1,0,null,!0,!1,0,0).then(e=>{O(I,C,e,d,h,m,!0,void 0,x),t.dispose()})}))}),w.incrementRenderId(),w.resetCachedMaterial();let n=w.activeCamera,i=w.activeCameras,a=t.outputRenderTarget,s=w.spritesEnabled;w.activeCamera=t,w.activeCameras=null,t.outputRenderTarget=M,w.spritesEnabled=y;let o=w.meshes;w.meshes=M.renderList||w.meshes;try{w.render()}finally{w.activeCamera=n,w.activeCameras=i,t.outputRenderTarget=a,w.spritesEnabled=s,w.meshes=o,e.getRenderWidth=P,e.getRenderHeight=R,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e),t.getProjectionMatrix(!0),e.skipFrameRender=!1}},()=>{e.skipFrameRender=!1,e.getRenderWidth=P,e.getRenderHeight=R})},N=()=>{w.incrementRenderId(),w.resetCachedMaterial(),L()};if(p){let e=new a.P("antialiasing",1,w.activeCamera);M.addPostProcess(e),e.autoClear=!0,e.onEffectCreatedObservable.addOnce(e=>{e.isReady()?N():e.onCompiled=()=>{N()}})}else N()}async function m(e,t,r,n="image/png",i=1,a=!1,s,o=!1,l=!1,u=!0,c,d,h){return await new Promise((f,p)=>{_(e,t,r,e=>{void 0!==e?f(e):p(Error("Data is undefined"))},n,i,a,s,o,l,u,c,d,h)})}function g(e,t,r){let n=0,i=0,a=0,s=0;if("object"==typeof r){let o=r.precision?Math.abs(r.precision):1;r.width&&r.height?(n=r.height*o,i=r.width*o):r.width&&!r.height?n=Math.round((i=r.width*o)/e.getAspectRatio(t)):r.height&&!r.width?i=Math.round((n=r.height*o)*e.getAspectRatio(t)):n=Math.round((i=Math.round(e.getRenderWidth()*o))/e.getAspectRatio(t)),r.finalWidth&&r.finalHeight?(s=r.finalHeight,a=r.finalWidth):r.finalWidth&&!r.finalHeight?s=Math.round((a=r.finalWidth)/e.getAspectRatio(t)):r.finalHeight&&!r.finalWidth?a=Math.round((s=r.finalHeight)*e.getAspectRatio(t)):(a=i,s=n)}else isNaN(r)||(n=r,i=r,a=r,s=r);return i&&(i=Math.floor(i)),n&&(n=Math.floor(n)),a&&(a=Math.floor(a)),s&&(s=Math.floor(s)),{height:0|n,width:0|i,finalWidth:0|a,finalHeight:0|s}}let y={CreateScreenshot:h,CreateScreenshotAsync:f,CreateScreenshotWithResizeAsync:p,CreateScreenshotUsingRenderTarget:_,CreateScreenshotUsingRenderTargetAsync:m};o.w1.CreateScreenshot=h,o.w1.CreateScreenshotAsync=f,o.w1.CreateScreenshotUsingRenderTarget=_,o.w1.CreateScreenshotUsingRenderTargetAsync=m},81453:function(e,t,r){r.d(t,{xP:()=>m,_k:()=>f,di:()=>p,eF:()=>_});var n=r(61834),i=r(79474),a=r(57423),s=r(19218);let o=[{regex:RegExp("^/nodes/\\d+/extensions/")}];class l{constructor(e,t){this._gltf=e,this._infoTree=t}convert(e){let t,r=this._gltf,n=this._infoTree;if(!e.startsWith("/"))throw Error("Path must start with a /");let i=e.split("/");if(i.shift(),i[i.length-1].includes(".length")){let e=i[i.length-1].split(".");i.pop(),i.push(...e)}let a=!1;for(let s of i){let i="length"===s;if(i&&!n.__array__)throw Error(`Path ${e} is invalid`);if(n.__ignoreObjectTree__&&(a=!0),n.__array__&&!i)n=n.__array__;else if(!(n=n[s]))throw Error(`Path ${e} is invalid`);if(!a)if(void 0===r){if(!o.find(t=>t.regex.test(e)))throw Error(`Path ${e} is invalid`)}else i||(r=r?.[s]);(n.__target__||i)&&(t=r)}return{object:t,info:n}}}function u(e,t,r,n){let i=c(e,t);return n?i[r][n]:i[r]}function c(e,t,r){return e._data?.[r?.fillMode??i.g.MATERIAL_TriangleFillMode]?.babylonMaterial}function d(e,t){return{offset:{componentsCount:2,type:"Vector2",get:(r,i,a)=>{let s=u(r,a,e,t);return new n.FM(s?.uOffset,s?.vOffset)},getTarget:c,set:(r,n,i,a)=>{let s=u(n,a,e,t);s.uOffset=r.x,s.vOffset=r.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uOffset`,()=>`${e}${t?"."+t:""}.vOffset`]},rotation:{type:"number",get:(r,n,i)=>u(r,i,e,t)?.wAng,getTarget:c,set:(r,n,i,a)=>u(n,a,e,t).wAng=r,getPropertyName:[()=>`${e}${t?"."+t:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(r,i,a)=>{let s=u(r,a,e,t);return new n.FM(s?.uScale,s?.vScale)},getTarget:c,set:(r,n,i,a)=>{let s=u(n,a,e,t);s.uScale=r.x,s.vScale=r.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uScale`,()=>`${e}${t?"."+t:""}.vScale`]}}}let h={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:e=>new n.FM(e._babylonCamera?.orthoLeft??0,e._babylonCamera?.orthoRight??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoLeft=e.x,t._babylonCamera.orthoRight=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:e=>new n.FM(e._babylonCamera?.orthoBottom??0,e._babylonCamera?.orthoTop??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoBottom=e.x,t._babylonCamera.orthoTop=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}},perspective:{aspectRatio:{type:"number",get:e=>e._babylonCamera?.getEngine().getAspectRatio(e._babylonCamera),getTarget:e=>e,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:e=>e._babylonCamera?.fov,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.fov=e)},getTarget:e=>e,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}}}},nodes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonTransformNode),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vector3",get:e=>e._babylonTransformNode?.position,set:(e,t)=>t._babylonTransformNode?.position.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:e=>e._babylonTransformNode?.rotationQuaternion,set:(e,t)=>t._babylonTransformNode?.rotationQuaternion?.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vector3",get:e=>e._babylonTransformNode?.scaling,set:(e,t)=>t._babylonTransformNode?.scaling.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"scaling"]},weights:{length:{type:"number",get:e=>e._numMorphTargets,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(e,t)=>void 0!==t?e._primitiveBabylonMeshes?.[0].morphTargetManager?.getTarget(t).influence:void 0,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(e,t)=>[0],getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:e=>n.y3.Compose(e._babylonTransformNode?.scaling,e._babylonTransformNode?.rotationQuaternion,e._babylonTransformNode?.position),getTarget:e=>e._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:e=>{let t=n.y3.Identity(),r=e.parent;for(;r&&r.parent;)r=r.parent;let i=e._babylonTransformNode?.position._isDirty||e._babylonTransformNode?.rotationQuaternion?._isDirty||e._babylonTransformNode?.scaling._isDirty;if(r){let n=r._babylonTransformNode?.computeWorldMatrix(!0).invert();n&&e._babylonTransformNode?.computeWorldMatrix(i)?.multiplyToRef(n,t)}else e._babylonTransformNode&&t.copyFrom(e._babylonTransformNode.computeWorldMatrix(i));return t},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:e=>e._babylonTransformNode?.getChildren(e=>e instanceof s.P,!0)[0]?.intensity,getTarget:e=>e._babylonTransformNode?.getChildren(e=>e instanceof s.P,!0)[0],set:(e,t)=>{if(t._babylonTransformNode){let r=t._babylonTransformNode.getChildren(e=>e instanceof s.P,!0)[0];r&&(r.intensity=e)}}},color:{type:"Color3",get:e=>e._babylonTransformNode?.getChildren(e=>e instanceof s.P,!0)[0]?.diffuse,getTarget:e=>e._babylonTransformNode?.getChildren(e=>e instanceof s.P,!0)[0],set:(e,t)=>{if(t._babylonTransformNode){let r=t._babylonTransformNode.getChildren(e=>e instanceof s.P,!0)[0];r&&(r.diffuse=e)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Color3",get:(e,t,r)=>c(e,t,r).emissiveColor,set:(e,t,r,n)=>c(t,r,n).emissiveColor.copyFrom(e),getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:d("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(e,t,r)=>u(e,r,"bumpTexture")?.level,set:(e,t,r,n)=>{let i=u(t,n,"bumpTexture");i&&(i.level=e)},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:d("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(e,t,r)=>c(e,t,r).ambientTextureStrength,set:(e,t,r,n)=>{let i=c(t,r,n);i&&(i.ambientTextureStrength=e)},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:d("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Color4",get:(e,t,r)=>{let n=c(e,t,r);return a.HE.FromColor3(n.albedoColor,n.alpha)},set:(e,t,r,n)=>{let i=c(t,r,n);i.albedoColor.set(e.r,e.g,e.b),i.alpha=e.a},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:d("albedoTexture")}},metallicFactor:{type:"number",get:(e,t,r)=>c(e,t,r).metallic,set:(e,t,r,n)=>{let i=c(t,r,n);i&&(i.metallic=e)},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(e,t,r)=>c(e,t,r).roughness,set:(e,t,r,n)=>{let i=c(t,r,n);i&&(i.roughness=e)},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:d("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(e,t,r)=>c(e,t,r).anisotropy.intensity,set:(e,t,r,n)=>{c(t,r,n).anisotropy.intensity=e},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(e,t,r)=>c(e,t,r).anisotropy.angle,set:(e,t,r,n)=>{c(t,r,n).anisotropy.angle=e},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:d("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(e,t,r)=>c(e,t,r).clearCoat.intensity,set:(e,t,r,n)=>{c(t,r,n).clearCoat.intensity=e},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(e,t,r)=>c(e,t,r).clearCoat.roughness,set:(e,t,r,n)=>{c(t,r,n).clearCoat.roughness=e},getTarget:(e,t,r)=>c(e,t,r),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:d("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(e,t,r)=>c(e,t,r).clearCoat.bumpTexture?.level,getTarget:c,set:(e,t,r,n)=>c(t,r,n).clearCoat.bumpTexture.level=e},extensions:{KHR_texture_transform:d("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:d("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(e,t,r)=>c(e,t,r).subSurface.dispersion,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.dispersion=e}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(e,t,r)=>c(e,t,r).emissiveIntensity,getTarget:c,set:(e,t,r,n)=>c(t,r,n).emissiveIntensity=e}},KHR_materials_ior:{ior:{type:"number",get:(e,t,r)=>c(e,t,r).indexOfRefraction,getTarget:c,set:(e,t,r,n)=>c(t,r,n).indexOfRefraction=e}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(e,t,r)=>c(e,t,r).iridescence.intensity,getTarget:c,set:(e,t,r,n)=>c(t,r,n).iridescence.intensity=e},iridescenceIor:{type:"number",get:(e,t,r)=>c(e,t,r).iridescence.indexOfRefraction,getTarget:c,set:(e,t,r,n)=>c(t,r,n).iridescence.indexOfRefraction=e},iridescenceTexture:{extensions:{KHR_texture_transform:d("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(e,t,r)=>c(e,t,r).iridescence.maximumThickness,getTarget:c,set:(e,t,r,n)=>c(t,r,n).iridescence.maximumThickness=e},iridescenceThicknessMinimum:{type:"number",get:(e,t,r)=>c(e,t,r).iridescence.minimumThickness,getTarget:c,set:(e,t,r,n)=>c(t,r,n).iridescence.minimumThickness=e},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:d("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Color3",get:(e,t,r)=>c(e,t,r).sheen.color,getTarget:c,set:(e,t,r,n)=>c(t,r,n).sheen.color.copyFrom(e)},sheenColorTexture:{extensions:{KHR_texture_transform:d("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(e,t,r)=>c(e,t,r).sheen.intensity,getTarget:c,set:(e,t,r,n)=>c(t,r,n).sheen.intensity=e},sheenRoughnessTexture:{extensions:{KHR_texture_transform:d("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(e,t,r)=>c(e,t,r).metallicF0Factor,getTarget:c,set:(e,t,r,n)=>c(t,r,n).metallicF0Factor=e,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Color3",get:(e,t,r)=>c(e,t,r).metallicReflectanceColor,getTarget:c,set:(e,t,r,n)=>c(t,r,n).metallicReflectanceColor.copyFrom(e),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:d("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:d("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(e,t,r)=>c(e,t,r).subSurface.refractionIntensity,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.refractionIntensity=e,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:d("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(e,t,r)=>c(e,t,r).subSurface.translucencyIntensity,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.translucencyIntensity=e},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:d("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Color3",get:(e,t,r)=>c(e,t,r).subSurface.translucencyColor,getTarget:c,set:(e,t,r,n)=>e&&c(t,r,n).subSurface.translucencyColor?.copyFrom(e)},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:d("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Color3",get:(e,t,r)=>c(e,t,r).subSurface.tintColor,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.tintColor.copyFrom(e)},attenuationDistance:{type:"number",get:(e,t,r)=>c(e,t,r).subSurface.tintColorAtDistance,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.tintColorAtDistance=e},thicknessFactor:{type:"number",get:(e,t,r)=>c(e,t,r).subSurface.maximumThickness,getTarget:c,set:(e,t,r,n)=>c(t,r,n).subSurface.maximumThickness=e},thicknessTexture:{extensions:{KHR_texture_transform:d("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonLight),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"Color3",get:e=>e._babylonLight?.diffuse,set:(e,t)=>t._babylonLight?.diffuse.copyFrom(e),getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},intensity:{type:"number",get:e=>e._babylonLight?.intensity,set:(e,t)=>t._babylonLight?t._babylonLight.intensity=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},range:{type:"number",get:e=>e._babylonLight?.range,set:(e,t)=>t._babylonLight?t._babylonLight.range=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"range"]},spot:{innerConeAngle:{type:"number",get:e=>e._babylonLight?.innerAngle,set:(e,t)=>t._babylonLight?t._babylonLight.innerAngle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"innerConeAngle"]},outerConeAngle:{type:"number",get:e=>e._babylonLight?.angle,set:(e,t)=>t._babylonLight?t._babylonLight.angle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonLight),getPropertyName:[e=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonTexture),getPropertyName:[e=>"length"]},__array__:{__target__:!0,intensity:{type:"number",get:e=>e._babylonTexture?.level,set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.level=e)},getTarget:e=>e._babylonTexture},rotation:{type:"Quaternion",get:e=>e._babylonTexture&&n._f.FromRotationMatrix(e._babylonTexture?.getReflectionTextureMatrix()),set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.getScene()?.useRightHandedSystem||(e=n._f.Inverse(e)),n.y3.FromQuaternionToRef(e,t._babylonTexture.getReflectionTextureMatrix()))},getTarget:e=>e._babylonTexture}}}}},animations:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonAnimationGroup),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e.primitives[0]._instanceData?.babylonSourceMesh),getPropertyName:[()=>"length"]},__array__:{}}};function f(e){return new l(e,h)}function p(e){let t=e.split("/").map(e=>e.replace(/{}/g,"__array__")),r=h;for(let e of t)e&&(r=r[e]);if(r&&r.type&&r.get)return r}function _(e,t){let r=e.split("/").map(e=>e.replace(/{}/g,"__array__")),n=h;for(let e of r)e&&(n=n[e]);n&&n.type&&n.get&&(n.interpolation=t)}function m(e,t){let r=e.split("/").map(e=>e.replace(/{}/g,"__array__")),n=h;for(let e of r)if(e){if(!n[e]){if("?"===e){n.__ignoreObjectTree__=!0;continue}n[e]={},"__array__"===e&&(n[e].__target__=!0)}n=n[e]}Object.assign(n,t)}},81731:function(e,t,r){r.d(t,{u:()=>o});var n=r(58417),i=r(54603),a=r(59942),s=r(46363);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("value",i.E.AutoDetect),this.registerOutput("output",i.E.Float),this._inputs[0].excludedConnectionPointTypes.push(i.E.Float),this._inputs[0].excludedConnectionPointTypes.push(i.E.Matrix)}getClassName(){return"LengthBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = length(${this.value.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.LengthBlock",o)},81893:function(e,t,r){r.d(t,{y:()=>a});var n=r(19956),i=r(20534);class a extends n.H{_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(r.e("6248").then(r.bind(r,90675)))):t.push(r.e("6645").then(r.bind(r,70572)))}constructor(e,t=null,r){super({...r,name:e,engine:t||i.D.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:a.FragmentUrl,samplers:a.Samplers})}}a.FragmentUrl="depthOfFieldMerge",a.Samplers=["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"]},81997:function(e,t,r){r.d(t,{Z:()=>s});var n=r(9787),i=r(10645),a=r(44976);class s extends i.Z{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null);let r=t||{},{x:i,y:s}=r;super(e,(0,n._T)(r,["x","y"])),this.vector2=this.read,this.x=new a.Z(()=>this.read()[0],Object.assign({},i,{parent:this,device:null==t?void 0:t.device})),this.y=new a.Z(()=>this.read()[1],Object.assign({},s,{parent:this,device:null==t?void 0:t.device})),this.children.set("x",this.x),this.children.set("y",this.x);let o=()=>this.emit("change");this.children.forEach(e=>{e.on("change",o)})}magnitude(e=this.read()){return Math.hypot(e[0],e[1])}active(){let e=this.read();return 0!==e[0]||0!==e[1]}}s.defaultValue=[0,0]},83612:function(e,t,r){r.d(t,{F:()=>a});var n=r(46363),i=r(99151);class a extends i.c{constructor(e){super(e)}getClassName(){return"SubtractBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} - ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.SubtractBlock",a)},85116:function(e,t,r){r.r(t),r.d(t,{helperFunctionsWGSL:()=>s});var n=r(66755);let i="helperFunctions",a=`const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; 
const LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}
fn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}
fn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}
fn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}
fn maxEps(x: f32)->f32 {return max(x,Epsilon);}
fn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}
fn absEps(x: f32)->f32 {return abs(x)+Epsilon;}
fn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
fn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,
b11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,
b21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}
#if USE_EXACT_SRGB_CONVERSIONS
fn toLinearSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}
fn toGammaSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}
#endif
fn toLinearSpace(color: f32)->f32
{
#if USE_EXACT_SRGB_CONVERSIONS
var nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
fn toLinearSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3f(LinearEncodePowerApprox));
#endif
}
fn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4f(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpace(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4<f32>(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3f(GammaEncodePowerApprox));
#endif
}
fn squareVec3(value: vec3f)->vec3f
{return value*value;}
fn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}
fn getLuminance(color: vec3f)->f32
{return saturate(dot(color,LuminanceEncodeApprox));}
fn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}
fn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}
const rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}
fn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}
fn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
fn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}
fn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}
fn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},85737:function(e,t,r){t.makeNoise3D=void 0,r(93265);var n=r(33716);Object.defineProperty(t,"makeNoise3D",{enumerable:!0,get:function(){return n.makeNoise3D}}),r(60413)},8586:function(e,t,r){r.d(t,{b:()=>i});var n=r(35038);class i extends n.H{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}},86019:function(e,t,r){var n=r(66755);let i="vertexColorMixing",a=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vColor=vec4(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vColor*=colorUpdated;
#else
vColor.rgb*=colorUpdated.rgb;
#endif
#endif
#ifdef INSTANCESCOLOR
vColor*=instanceColor;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},8605:function(e,t,r){var n=r(34504),i=r(79309);r(3155),n.q.prototype.getGPUFrameTimeCounter=function(){return this._timestampQuery.gpuFrameTimeCounter},n.q.prototype.captureGPUFrameTime=function(e){this._timestampQuery.enable=e&&!!this._caps.timerQuery},n.q.prototype.createQuery=function(){return this._occlusionQuery.createQuery()},n.q.prototype.deleteQuery=function(e){return this._occlusionQuery.deleteQuery(e),this},n.q.prototype.isQueryResultAvailable=function(e){return this._occlusionQuery.isQueryResultAvailable(e)},n.q.prototype.getQueryResult=function(e){return this._occlusionQuery.getQueryResult(e)},n.q.prototype.beginOcclusionQuery=function(e,t){return this.compatibilityMode?!!this._occlusionQuery.canBeginQuery(t)&&(this._currentRenderPass?.beginOcclusionQuery(t),!0):(this._bundleList.addItem(new i.GB(t)),!0)},n.q.prototype.endOcclusionQuery=function(){return this.compatibilityMode?this._currentRenderPass?.endOcclusionQuery():this._bundleList.addItem(new i.fw),this}},8621:function(e,t,r){r.d(t,{V:()=>l});var n=r(20332),i=r(61834),a=r(70541),s=r(29531),o=r(85791);s.a.prototype.addDeviceOrientation=function(e){return this._deviceOrientationInput||(this._deviceOrientationInput=new l,e&&(this._deviceOrientationInput.smoothFactor=e),this.add(this._deviceOrientationInput)),this};class l{static async WaitForOrientationChangeAsync(e){return await new Promise((t,r)=>{let n=!1,i=()=>{window.removeEventListener("deviceorientation",i),n=!0,t()};e&&setTimeout(()=>{n||(window.removeEventListener("deviceorientation",i),r("WaitForOrientationChangeAsync timed out"))},e),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e?window.addEventListener("deviceorientation",i):a.w1.Warn("Permission not granted.")}).catch(e=>{a.w1.Error(e)}):window.addEventListener("deviceorientation",i)})}constructor(){this._screenOrientationAngle=0,this._screenQuaternion=new i._f,this._alpha=0,this._beta=0,this._gamma=0,this.smoothFactor=0,this._onDeviceOrientationChangedObservable=new o.y$,this._orientationChanged=()=>{this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,this._screenOrientationAngle=-a.w1.ToRadians(this._screenOrientationAngle/2),this._screenQuaternion.copyFromFloats(0,Math.sin(this._screenOrientationAngle),0,Math.cos(this._screenOrientationAngle))},this._deviceOrientation=e=>{this.smoothFactor?(this._alpha=null!==e.alpha?a.w1.SmoothAngleChange(this._alpha,e.alpha,this.smoothFactor):0,this._beta=null!==e.beta?a.w1.SmoothAngleChange(this._beta,e.beta,this.smoothFactor):0,this._gamma=null!==e.gamma?a.w1.SmoothAngleChange(this._gamma,e.gamma,this.smoothFactor):0):(this._alpha=null!==e.alpha?e.alpha:0,this._beta=null!==e.beta?e.beta:0,this._gamma=null!==e.gamma?e.gamma:0),null!==e.alpha&&this._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTransform=new i._f(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}get camera(){return this._camera}set camera(e){this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new i._f),this._camera&&this._camera.onDisposeObservable.add(()=>{this._onDeviceOrientationChangedObservable.clear()})}attachControl(){let e=this.camera.getScene().getEngine().getHostWindow();if(e){let t=()=>{e.addEventListener("orientationchange",this._orientationChanged),e.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e?t():a.w1.Warn("Permission not granted.")}).catch(e=>{a.w1.Error(e)}):t()}}detachControl(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0}checkInputs(){this._alpha&&(i._f.RotationYawPitchRollToRef(a.w1.ToRadians(this._alpha),a.w1.ToRadians(this._beta),-a.w1.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTransform),this._camera.getScene().useRightHandedSystem?this._camera.rotationQuaternion.y*=-1:this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)}getClassName(){return"FreeCameraDeviceOrientationInput"}getSimpleName(){return"deviceOrientation"}}n.u.FreeCameraDeviceOrientationInput=l},86459:function(e,t,r){var n=r(66755);let i="logDepthFragment",a=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},86506:function(e,t,r){var n=r(66755);let i="volumetricLightScatteringPixelShader",a=`uniform sampler2D textureSampler;uniform sampler2D lightScatteringSampler;uniform float decay;uniform float exposure;uniform float weight;uniform float density;uniform vec2 meshPositionOnScreen;varying vec2 vUV;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
vec2 tc=vUV;vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;float illuminationDecay=1.0;vec4 color=texture2D(lightScatteringSampler,tc)*0.4;for(int i=0; i<NUM_SAMPLES; i++) {tc-=deltaTexCoord;vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;dataSample*=illuminationDecay*weight;color+=dataSample;illuminationDecay*=decay;}
vec4 realColor=texture2D(textureSampler,vUV);gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),realColor.a))+(realColor*(1.5-0.4)));
#define CUSTOM_FRAGMENT_MAIN_END
}
`;n.v.ShadersStore[i]||(n.v.ShadersStore[i]=a)},86607:function(e,t,r){r.d(t,{w:()=>c});var n=r(69254),i=r(58417),a=r(54603),s=r(59942),o=r(46363),l=r(61834),u=r(16415);class c extends i.k{constructor(e){super(e,s.u.Neutral),this.sourceRange=new l.FM(-1,1),this.targetRange=new l.FM(0,1),this.registerInput("input",a.E.AutoDetect),this.registerInput("sourceMin",a.E.Float,!0),this.registerInput("sourceMax",a.E.Float,!0),this.registerInput("targetMin",a.E.Float,!0),this.registerInput("targetMax",a.E.Float,!0),this.registerOutput("output",a.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"RemapBlock"}get input(){return this._inputs[0]}get sourceMin(){return this._inputs[1]}get sourceMax(){return this._inputs[2]}get targetMin(){return this._inputs[3]}get targetMax(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0],r=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),n=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),i=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),a=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=e._declareOutput(t)+` = ${i} + (${this._inputs[0].associatedVariableName} - ${r}) * (${a} - ${i}) / (${n} - ${r});
`,this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.sourceRange = new BABYLON.Vector2(${this.sourceRange.x}, ${this.sourceRange.y});
`;return e+`${this._codeVariableName}.targetRange = new BABYLON.Vector2(${this.targetRange.x}, ${this.targetRange.y});
`}serialize(){let e=super.serialize();return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e}_deserialize(e,t,r){super._deserialize(e,t,r),this.sourceRange=l.FM.FromArray(e.sourceRange),this.targetRange=l.FM.FromArray(e.targetRange)}}(0,n.gn)([(0,u.p)("From",3)],c.prototype,"sourceRange",void 0),(0,n.gn)([(0,u.p)("To",3)],c.prototype,"targetRange",void 0),(0,o.H7)("BABYLON.RemapBlock",c)},86957:function(e,t,r){r.d(t,{Y:()=>i});var n=r(5716);class i extends n.T{constructor(e,t=null,r,n,i){super(e,t,r,n,{...i,defines:`#define DOF 1
`})}}},87462:function(e,t,r){e.exports=r.p+"2f699b388ca13ffa.wasm"},87480:function(e,t,r){r.r(t),r.d(t,{bonesVertexWGSL:()=>s});var n=r(66755);let i="bonesVertex",a=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
var influence : mat4x4<f32>;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[0])*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[1])*vertexInputs.matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[2])*vertexInputs.matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[3])*vertexInputs.matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[0])*vertexInputs.matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[1])*vertexInputs.matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[2])*vertexInputs.matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[3])*vertexInputs.matricesWeightsExtra[3];
#endif 
#else 
influence=uniforms.mBones[i32(vertexInputs.matricesIndices[0])]*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[1])]*vertexInputs.matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[2])]*vertexInputs.matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[3])]*vertexInputs.matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[0])]*vertexInputs.matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[1])]*vertexInputs.matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[2])]*vertexInputs.matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[3])]*vertexInputs.matricesWeightsExtra[3];
#endif 
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},87889:function(e,t,r){r.r(t),r.d(t,{clipPlaneFragmentDeclarationWGSL:()=>s});var n=r(66755);let i="clipPlaneFragmentDeclaration",a=`#ifdef CLIPPLANE
varying fClipDistance: f32;
#endif
#ifdef CLIPPLANE2
varying fClipDistance2: f32;
#endif
#ifdef CLIPPLANE3
varying fClipDistance3: f32;
#endif
#ifdef CLIPPLANE4
varying fClipDistance4: f32;
#endif
#ifdef CLIPPLANE5
varying fClipDistance5: f32;
#endif
#ifdef CLIPPLANE6
varying fClipDistance6: f32;
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a);let s={name:i,shader:a}},88981:function(e,t,r){r.d(t,{F:()=>i});var n=r(82490);class i extends n.C{constructor(e){super(!1),this._cache=e,this.reset()}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._cache.setStencilCompare(e))}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._cache.setStencilFailOp(e))}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._cache.setStencilDepthFailOp(e))}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._cache.setStencilPassOp(e))}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))}reset(){super.reset(),this._cache.resetStencilState()}apply(){let e=this.stencilMaterial?.enabled;this.enabled=e?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.func=e?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=e?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=e?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=e?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=e?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=e?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=e?this.stencilMaterial.mask:this.stencilGlobal.mask)}}},89309:function(e,t,r){var n=r(2043),i=r(62083);n.Z,i.AS},9262:function(e,t,r){r.d(t,{Ai:()=>a.Ai,Bg:()=>a.Bg,K7:()=>a.K7,XI:()=>a.XI,ZW:()=>a.ZW,a7:()=>a.a7,dv:()=>a.dv,kA:()=>a.kA,mo:()=>a.mo,oE:()=>a.oE,pE:()=>a.pE,yc:()=>a.yc,z9:()=>a.z9,zH:()=>a.zH});var n=r(72384),i=r(82961),a=r(75552);(0,a.Bg)(n.x,i.V),n.x.prototype.createPickingRayToRef=function(e,t,r,n,i,s=!1,o=!1){return(0,a.yc)(this,e,t,r,n,i,s,o)},n.x.prototype.createPickingRayInCameraSpace=function(e,t,r){return(0,a.K7)(this,e,t,r)},n.x.prototype.createPickingRayInCameraSpaceToRef=function(e,t,r,n){return(0,a.kA)(this,e,t,r,n)},n.x.prototype.pickWithBoundingInfo=function(e,t,r,n,i){return(0,a.XI)(this,e,t,r,n,i)},n.x.prototype.pick=function(e,t,r,n,i,s,o=!1){return(0,a.z9)(this,e,t,r,n,i,s,o)},n.x.prototype.pickWithRay=function(e,t,r,n){return(0,a.mo)(this,e,t,r,n)},n.x.prototype.multiPick=function(e,t,r,n,i){return(0,a.dv)(this,e,t,r,n,i)},n.x.prototype.multiPickWithRay=function(e,t,r){return(0,a.pE)(this,e,t,r)}},92712:function(e,t,r){r.d(t,{pp:()=>d,H4:()=>u,oO:()=>c});var n=r(84959),i=r(85791),a=r(72574),s=r(68763),o=r(65698),l=r(61834);class u{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(e){if(-1===e){this._weight=-1;return}this._weight=Math.min(Math.max(e,0),1)}get speedRatio(){return this._speedRatio}set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e);this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(e,t,r=0,n=100,a=!1,s=1,o,l,u,c=!1,d=0){this.target=t,this.fromFrame=r,this.toFrame=n,this.loopAnimation=a,this.onAnimationEnd=o,this.onAnimationLoop=u,this.isAdditive=c,this.playOrder=d,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=[],this._paused=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new i.y$,this.onAnimationLoopObservable=new i.y$,this._scene=e,l&&this.appendAnimations(t,l),this._speedRatio=s,e._activeAnimatables.push(this)}syncWith(e){if(this._syncRoot=e,e){let e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(e,t){for(let r=0;r<t.length;r++){let n=t[r],i=new a.o(e,n,this._scene,this);i._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(i)}}getAnimationByTargetProperty(e){let t=this._runtimeAnimations;for(let r=0;r<t.length;r++)if(t[r].animation.targetProperty===e)return t[r].animation;return null}getRuntimeAnimationByTargetProperty(e){let t=this._runtimeAnimations;for(let r=0;r<t.length;r++)if(t[r].animation.targetProperty===e)return t[r];return null}reset(){let e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(e){let t=this._runtimeAnimations;for(let r=0;r<t.length;r++)t[r].animation.enableBlending=!0,t[r].animation.blendingSpeed=e}disableBlending(){let e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}goToFrame(e,t=!1){let r=this._runtimeAnimations;if(r[0]){let t=r[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??r[0].currentFrame;let n=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/t*1e3/this.speedRatio;this._manualJumpDelay=-n}for(let n=0;n<r.length;n++)r[n].goToFrame(e,t?this._weight:-1);this._goToFrame=e}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(e,t,r=!1,n=!1){if(e||t){let i=this._scene._activeAnimatables.indexOf(this);if(i>-1){let a=this._runtimeAnimations;for(let r=a.length-1;r>=0;r--){let n=a[r];(!e||n.animation.name==e)&&(!t||t(n.target))&&(n.dispose(),a.splice(r,1))}0==a.length&&(r||this._scene._activeAnimatables.splice(i,1),n||this._raiseOnAnimationEnd())}}else{let e=this._scene._activeAnimatables.indexOf(this);if(e>-1){r||this._scene._activeAnimatables.splice(e,1);let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,n||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise(e=>{this.onAnimationEndObservable.add(()=>{e(this)},void 0,void 0,this,!0)})}_animate(e){let t;if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let r=!1,n=this._runtimeAnimations;for(t=0;t<n.length;t++){let i=n[t].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);r=r||i}if(this.animationStarted=r,!r){if(this.disposeOnEnd)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<n.length;t++)n[t].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return r}}function c(e,t,r){let n=t.target;e._registeredForLateAnimationBindings.pushNoDuplicate(n),n._lateAnimationHolders||(n._lateAnimationHolders={}),n._lateAnimationHolders[t.targetPath]||(n._lateAnimationHolders[t.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:r}),t.isAdditive?(n._lateAnimationHolders[t.targetPath].additiveAnimations.push(t),n._lateAnimationHolders[t.targetPath].totalAdditiveWeight+=t.weight):(n._lateAnimationHolders[t.targetPath].animations.push(t),n._lateAnimationHolders[t.targetPath].totalWeight+=t.weight)}function d(e,t){t&&(t.prototype.copyAnimationRange=function(e,t,r,n=!1,i=null){let a,o,l;0===this.animations.length&&(this.animations.push(new s.fw(this.name,"_matrix",e.animations[0].framePerSecond,s.fw.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));let u=e.animations[0].getRange(t);if(!u)return!1;let c=u.from,d=u.to,h=e.animations[0].getKeys(),f=e.length,p=e.getParent(),_=this.getParent(),m=n&&p&&f&&this.length&&f!==this.length,g=m&&_&&p?_.length/p.length:1,y=n&&!_&&i&&(1!==i.x||1!==i.y||1!==i.z),v=this.animations[0].getKeys();for(let e=0,t=h.length;e<t;e++)(a=h[e]).frame>=c&&a.frame<=d&&(n?(l=a.value.clone(),m?(o=l.getTranslation(),l.setTranslation(o.scaleInPlace(g))):y&&i?(o=l.getTranslation(),l.setTranslation(o.multiplyInPlace(i))):l=a.value):l=a.value,v.push({frame:a.frame+r,value:l}));return this.animations[0].createRange(t,c+r,d+r),!0}),e&&(e.prototype._animate=function(e){if(!this.animationsEnabled)return;let t=o.F.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;let r=this._activeAnimatables;if(0===r.length)return;this._animationTime+=this.deltaTime;let n=this._animationTime;for(let e=0;e<r.length;e++){let t=r[e];!t._animate(n)&&t.disposeOnEnd&&e--}!function(e){if(e._registeredForLateAnimationBindings.length){for(let t=0;t<e._registeredForLateAnimationBindings.length;t++){let r=e._registeredForLateAnimationBindings.data[t];for(let e in r._lateAnimationHolders){let t=r._lateAnimationHolders[e],n=t.animations[0],i=t.originalValue;if(null==i)continue;let a=s.fw.AllowMatrixDecomposeForInterpolation&&i.m,o=r[e];if(a)o=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1,r=l.jp.Vector3["0"],n=l.jp.Vector3["1"],i=l.jp.Quaternion["0"],a=0,s=e.animations[0],o=e.originalValue,u=1,c=!1;if(e.totalWeight<1)u=1-e.totalWeight,o.decompose(n,i,r);else{if(a=1,t=e.totalWeight,1==(u=s.weight/t))if(!e.totalAdditiveWeight)return s.currentValue;else c=!0;s.currentValue.decompose(n,i,r)}if(!c){n.scaleInPlace(u),r.scaleInPlace(u),i.scaleInPlace(u);for(let s=a;s<e.animations.length;s++){let a=e.animations[s];if(0===a.weight)continue;u=a.weight/t;let o=l.jp.Vector3["2"],c=l.jp.Vector3["3"],d=l.jp.Quaternion["1"];a.currentValue.decompose(c,d,o),c.scaleAndAddToRef(u,n),d.scaleAndAddToRef(l._f.Dot(i,d)>0?u:-u,i),o.scaleAndAddToRef(u,r)}i.normalize()}for(let t=0;t<e.additiveAnimations.length;t++){let a=e.additiveAnimations[t];if(0===a.weight)continue;let s=l.jp.Vector3["2"],o=l.jp.Vector3["3"],u=l.jp.Quaternion["1"];a.currentValue.decompose(o,u,s),o.multiplyToRef(n,o),l.P.LerpToRef(n,o,a.weight,n),i.multiplyToRef(u,u),l._f.SlerpToRef(i,u,a.weight,i),s.scaleAndAddToRef(a.weight,r)}let d=s?s._animationState.workValue:l.jp.Matrix["0"].clone();return l.y3.ComposeToRef(n,i,r,d),d}(t);else if(void 0!==i.w)o=function(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;let r=e.animations[0],n=e.originalValue,i=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)i.copyFrom(n);else if(1===e.animations.length){if(l._f.SlerpToRef(n,r.currentValue,Math.min(1,e.totalWeight),i),0===e.totalAdditiveWeight)return i}else if(e.animations.length>1){let r,a,s=1;if(e.totalWeight<1){let t=1-e.totalWeight;a=[],(r=[]).push(n),a.push(t)}else{if(2===e.animations.length&&(l._f.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;r=[],a=[],s=e.totalWeight}for(let t=0;t<e.animations.length;t++){let n=e.animations[t];r.push(n.currentValue),a.push(n.weight/s)}let o=0;for(let e=0;e<r.length;){if(!e){l._f.SlerpToRef(r[e],r[e+1],a[e+1]/(a[e]+a[e+1]),t),i=t,o=a[e]+a[e+1],e+=2;continue}o+=a[e],l._f.SlerpToRef(i,r[e],a[e]/o,i),e++}}for(let t=0;t<e.additiveAnimations.length;t++){let r=e.additiveAnimations[t];0!==r.weight&&(i.multiplyToRef(r.currentValue,l.jp.Quaternion["0"]),l._f.SlerpToRef(i,l.jp.Quaternion["0"],r.weight,i))}return i}(t,o||l._f.Identity());else{let e=0,r=1,a=n&&n._animationState.loopMode===s.fw.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(t.totalWeight<1)o=a?i.clone?i.clone():i:n&&i.scale?i.scale(1-t.totalWeight):n?i*(1-t.totalWeight):i.clone?i.clone():i;else if(n){r=t.totalWeight;let s=n.weight/r;o=1!==s?n.currentValue.scale?n.currentValue.scale(s):n.currentValue*s:n.currentValue,a&&(o.addToRef?o.addToRef(i,o):o+=i),e=1}for(let n=e;n<t.animations.length;n++){let e=t.animations[n],i=e.weight/r;i&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(i,o):o+=e.currentValue*i)}for(let e=0;e<t.additiveAnimations.length;e++){let r=t.additiveAnimations[e],n=r.weight;n&&(r.currentValue.scaleAndAddToRef?r.currentValue.scaleAndAddToRef(n,o):o+=r.currentValue*n)}}r[e]=o}r._lateAnimationHolders={}}e._registeredForLateAnimationBindings.reset()}}(this)},e.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort((e,t)=>e.playOrder-t.playOrder)},e.prototype.beginWeightedAnimation=function(e,t,r,n=1,i,a=1,s,o,l,u,c=!1){let d=this.beginAnimation(e,t,r,i,a,s,o,!1,l,u,c);return d.weight=n,d},e.prototype.beginAnimation=function(e,t,r,n,i=1,a,s,o=!0,l,c,d=!1){if(i<0){let e=t;t=r,r=e,i=-i}t>r&&(i=-i),o&&this.stopAnimation(e,void 0,l),s||(s=new u(this,e,t,r,n,i,a,void 0,c,d));let h=!l||l(e);if(e.animations&&h&&s.appendAnimations(e,e.animations),e.getAnimatables){let u=e.getAnimatables();for(let e=0;e<u.length;e++)this.beginAnimation(u[e],t,r,n,i,a,s,o,l,c)}return s.reset(),s},e.prototype.beginHierarchyAnimation=function(e,t,r,n,i,a=1,s,o,l=!0,u,c,d=!1){let h=e.getDescendants(t),f=[];for(let t of(f.push(this.beginAnimation(e,r,n,i,a,s,o,l,u,void 0,d)),h))f.push(this.beginAnimation(t,r,n,i,a,s,o,l,u,void 0,d));return f},e.prototype.beginDirectAnimation=function(e,t,r,n,i,a=1,s,o,l=!1){if(a<0){let e=r;r=n,n=e,a=-a}return r>n&&(a=-a),new u(this,e,r,n,i,a,s,t,o,l)},e.prototype.beginDirectHierarchyAnimation=function(e,t,r,n,i,a,s,o,l,u=!1){let c=e.getDescendants(t),d=[];for(let t of(d.push(this.beginDirectAnimation(e,r,n,i,a,s,o,l,u)),c))d.push(this.beginDirectAnimation(t,r,n,i,a,s,o,l,u));return d},e.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},e.prototype.getAllAnimatablesByTarget=function(e){let t=[];for(let r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r].target===e&&t.push(this._activeAnimatables[r]);return t},e.prototype.stopAnimation=function(e,t,r){for(let n of this.getAllAnimatablesByTarget(e))n.stop(t,r)},e.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(let e of this.animationGroups)e.stop()})}d(r(72384).x,n.N)},93014:function(e,t,r){r.d(t,{Z:()=>n});let n=e=>()=>+!!e()},93265:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise2D=void 0;var r=(3-Math.sqrt(3))/6,n=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[1,0],[-1,0],[0,1],[0,-1],[0,1],[0,-1]];t.makeNoise2D=function(e){void 0===e&&(e=Math.random);for(var t,i,a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;for(var s=255;s>0;s--)t=Math.floor((s+1)*e()),i=a[s],a[s]=a[t],a[t]=i;for(var o=new Uint8Array(512),l=new Uint8Array(512),s=0;s<512;s++)o[s]=a[255&s],l[s]=o[s]%12;return function(e,t){var i=(e+t)*.5*(Math.sqrt(3)-1),a=Math.floor(e+i),s=Math.floor(t+i),u=(a+s)*r,c=e-(a-u),d=t-(s-u),h=+(c>d),f=c>d?0:1,p=c-h+r,_=d-f+r,m=c-1+2*r,g=d-1+2*r,y=255&a,v=255&s,b=n[l[y+o[v]]],x=n[l[y+h+o[v+f]]],T=n[l[y+1+o[v+1]]],E=.5-c*c-d*d,A=E<0?0:Math.pow(E,4)*(b[0]*c+b[1]*d),S=.5-p*p-_*_,I=S<0?0:Math.pow(S,4)*(x[0]*p+x[1]*_),C=.5-m*m-g*g;return 70.14805770653952*(A+I+(C<0?0:Math.pow(C,4)*(T[0]*m+T[1]*g)))}}},9363:function(e,t,r){var n=r(34504);n.q.prototype._readTexturePixels=function(e,t,r,n=-1,i=0,a=null,s=!0,o=!1,l=0,u=0){let c=e._hardwareTexture;return s&&this.flushFramebuffer(),this._textureHelper.readPixels(c.underlyingResource,l,u,t,r,c.format,n,i,a,o)},n.q.prototype._readTexturePixelsSync=function(){throw"_readTexturePixelsSync is unsupported in WebGPU!"}},94257:function(e,t,r){r(34504).q.prototype.setDepthStencilTexture=function(e,t,r,n){r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0,n):this._setTexture(e,null,void 0,void 0,n)}},945:function(e,t,r){r.d(t,{y:()=>m});var n=r(88280),i=r(72384),a=r(61834),s=r(32160),o=r(46658),l=r(92731),u=r(88113),c=r(81385),d=r(29937),h=r(82268),f=r(67748);r(2227),r(10457),r(2037);var p=r(47012),_=r(63947),m=!0;i.x.prototype.createDefaultLight=function(e=!1){if(e&&this.lights)for(let e=0;e<this.lights.length;e++)this.lights[e].dispose();0===this.lights.length&&new u.e("default light",a.P.Up(),this)},i.x.prototype.createDefaultCamera=function(e=!1,t=!1,r=!1){if(t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){let t,n=this.getWorldExtends(e=>e.isVisible&&e.isEnabled()),i=n.max.subtract(n.min),s=n.min.add(i.scale(.5)),o=1.5*i.length();if(isFinite(o)||(o=1,s.copyFromFloats(0,0,0)),e){let e=new h.Yf("default camera",-(Math.PI/2),Math.PI/2,o,s,this);e.lowerRadiusLimit=.01*o,e.wheelPrecision=100/o,t=e}else{let e=new d.c("default camera",new a.P(s.x,s.y,-o),this);e.setTarget(s),t=e}t.minZ=.01*o,t.maxZ=1e3*o,t.speed=.2*o,this.activeCamera=t,r&&t.attachControl()}},i.x.prototype.createDefaultCameraOrLight=function(e=!1,t=!1,r=!1){this.createDefaultLight(t),this.createDefaultCamera(e,t,r)},i.x.prototype.createDefaultSkybox=function(e,t=!1,r=1e3,i=0,a=!0){if(!e)return n.Y.Warn("Can not create default skybox without environment texture."),null;a&&e&&(this.environmentTexture=e);let u=(0,p.NR)("hdrSkyBox",{size:r},this);if(t){let t=new l.Y("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=s.x.SKYBOX_MODE),t.microSurface=1-i,t.disableLighting=!0,t.twoSidedLighting=!0,u.material=t}else{let t=new o.K("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=s.x.SKYBOX_MODE),t.disableLighting=!0,u.material=t}return u.isPickable=!1,u.infiniteDistance=!0,u.ignoreCameraMaxZ=!0,u},i.x.prototype.createDefaultEnvironment=function(e){return c.g?new c.g(e,this):null},i.x.prototype.createDefaultVRExperience=function(e={}){return new f.F(this,e)},i.x.prototype.createDefaultXRExperienceAsync=async function(e={}){return await _.B.CreateAsync(this,e)}},94838:function(e,t,r){var n=r(66755);let i="fogVertexDeclaration",a=`#ifdef FOG
varying vec3 vFogDistance;
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},94896:function(e,t,r){r.d(t,{Pk:()=>s,Pl:()=>o,Wn:()=>l});var n=r(70541),i=r(4146),a=r(10630);function s(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function o(e){return!!(e.wasmUrl&&(e.wasmBinary||e.wasmBinaryUrl)&&"object"==typeof WebAssembly||e.fallbackUrl)}class l{constructor(e){if(e.workerPool){this._workerPoolPromise=Promise.resolve(e.workerPool);return}let t=e.wasmBinary,r=e.numWorkers??s(),o=r&&"function"==typeof Worker&&"function"==typeof URL,l=o||!e.jsModule,u=e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:l?n.w1.GetBabylonScriptURL(e.wasmUrl,!0):"",wasmBinaryPromise:t?Promise.resolve(t):n.w1.LoadFileAsync(n.w1.GetBabylonScriptURL(e.wasmBinaryUrl,!0))}:{url:l?n.w1.GetBabylonScriptURL(e.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};o?this._workerPoolPromise=u.wasmBinaryPromise.then(e=>{let t=this._getWorkerContent(),n=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));return new i.v(r,()=>{let t=new Worker(n);return(0,a.QW)(t,e,u.url)})}):this._modulePromise=u.wasmBinaryPromise.then(async t=>{if(!this._isModuleAvailable()&&!e.jsModule){if(!u.url)throw Error("Draco codec module is not available");await n.w1.LoadBabylonScriptAsync(u.url)}return await this._createModuleAsync(t,e.jsModule)})}async whenReadyAsync(){return this._workerPoolPromise?void await this._workerPoolPromise:this._modulePromise?void await this._modulePromise:void 0}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then(e=>{e.dispose()}),delete this._workerPoolPromise,delete this._modulePromise}}},95277:function(e,t,r){r.r(t),r.d(t,{helperFunctions:()=>s});var n=r(66755);let i="helperFunctions",a=`const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; 
const float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
mat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}
#if USE_EXACT_SRGB_CONVERSIONS
vec3 toLinearSpaceExact(vec3 color)
{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));
#else
return
vec3(
color.r<=0.04045 ? nearZeroSection.r : remainingSection.r,
color.g<=0.04045 ? nearZeroSection.g : remainingSection.g,
color.b<=0.04045 ? nearZeroSection.b : remainingSection.b);
#endif
}
vec3 toGammaSpaceExact(vec3 color)
{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));
#else
return
vec3(
color.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,
color.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,
color.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);
#endif
}
#endif
float toLinearSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
vec3 toLinearSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3(LinearEncodePowerApprox));
#endif
}
vec4 toLinearSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
#endif
}
float toGammaSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;
#else
return pow(color,GammaEncodePowerApprox);
#endif
}
vec3 toGammaSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3(GammaEncodePowerApprox));
#endif
}
vec4 toGammaSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
#endif
}
float square(float value)
{return value*value;}
vec3 square(vec3 value)
{return value*value;}
float pow5(float value) {float sq=value*value;return sq*sq*value;}
float getLuminance(vec3 color)
{return saturate(dot(color,LuminanceEncodeApprox));}
float getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}
float dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}
const float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}
vec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
vec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}
float sqrtClamped(float value) {return sqrt(max(value,0.));}
float avg(vec3 value) {return dot(value,vec3(0.333333333));}`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},95521:function(e,t,r){r.d(t,{T:()=>h});var n=r(95272),i=r(76600),a=r(56865),s=r(6849),o=r(66755);let l="clearQuadVertexShader",u=`uniform depthValue: f32;const pos=array(
vec2f(-1.0,1.0),
vec2f(1.0,1.0),
vec2f(-1.0,-1.0),
vec2f(1.0,-1.0)
);
#define CUSTOM_VERTEX_DEFINITIONS
@vertex
fn main(input : VertexInputs)->FragmentInputs {
#define CUSTOM_VERTEX_MAIN_BEGIN
vertexOutputs.position=vec4f(pos[input.vertexIndex],uniforms.depthValue,1.0);
#define CUSTOM_VERTEX_MAIN_END
}
`;o.v.ShadersStoreWGSL[l]||(o.v.ShadersStoreWGSL[l]=u);let c="clearQuadPixelShader",d=`uniform color: vec4f;@fragment
fn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=uniforms.color;}
`;o.v.ShadersStoreWGSL[c]||(o.v.ShadersStoreWGSL[c]=d);class h{setDepthStencilFormat(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)}setColorFormat(e){this._cacheRenderPipeline.setColorFormat(e)}setMRTAttachments(e,t,r){this._cacheRenderPipeline.setMRT(t,r),this._cacheRenderPipeline.setMRTAttachments(e)}constructor(e,t,r){this._bindGroups={},this._bundleCache={},this._keyTemp=[],this._device=e,this._engine=t,this._cacheRenderPipeline=new n.H(this._device,r),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"],void 0,void 0,void 0,void 0,void 0,void 0,1)}clear(e,t,r,n,o=1){let l,u,c=null,d=!!this._engine._currentRenderTarget;if(e)l=e;else{let e=0;this._keyTemp.length=0;for(let t=0;t<this._cacheRenderPipeline.colorFormats.length;++t)this._keyTemp[e++]=s.U[this._cacheRenderPipeline.colorFormats[t]??""];let i=s.U[this._depthTextureFormat??0];if(this._keyTemp[e]=(t?t.r+256*t.g+256*t.b*256+256*t.a*65536:0)+0x100000000*!!r+0x200000000*!!n+0x400000000*!!this._engine.useReverseDepthBuffer+0x800000000*!!d+0x1000000000*(o>1)+0x2000000000*i,u=this._keyTemp.join("_"),c=this._bundleCache[u])return c;l=this._device.createRenderBundleEncoder({label:"clearQuadRenderBundle",colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:a.D.GetSample(o)})}this._cacheRenderPipeline.setDepthWriteEnabled(!!r),this._cacheRenderPipeline.setStencilEnabled(!!n&&!!this._depthTextureFormat&&a.D.HasStencilAspect(this._depthTextureFormat)),this._cacheRenderPipeline.setStencilWriteMask(255*!!n),this._cacheRenderPipeline.setStencilCompare(n?519:512),this._cacheRenderPipeline.setStencilPassOp(n?7681:7680),this._cacheRenderPipeline.setWriteMask(15*!!t);let h=this._cacheRenderPipeline.getRenderPipeline(7,this._effect,o),f=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),f.uniformBuffer.update();let p=d?this._engine._ubInvertY:this._engine._ubDontInvertY,_=f.uniformBuffer.getBuffer(),m=_.uniqueId+"-"+p.uniqueId,g=this._bindGroups[m];if(!g){let e=f.bindGroupLayouts[0];(g=this._bindGroups[m]=[]).push(this._device.createBindGroup({label:`clearQuadBindGroup0-${m}`,layout:e[0],entries:[]})),i.d._SimplifiedKnownBindings||g.push(this._device.createBindGroup({label:`clearQuadBindGroup1-${m}`,layout:e[1],entries:[]})),g.push(this._device.createBindGroup({label:`clearQuadBindGroup${i.d._SimplifiedKnownBindings?1:2}-${m}`,layout:e[i.d._SimplifiedKnownBindings?1:2],entries:[{binding:0,resource:{buffer:p.underlyingResource,size:p.capacity}},{binding:1,resource:{buffer:_.underlyingResource,size:_.capacity}}]}))}l.setPipeline(h);for(let e=0;e<g.length;++e)l.setBindGroup(e,g[e]);return l.draw(4,1,0,0),e||(c=l.finish(),this._bundleCache[u]=c),c}}},95698:function(e,t,r){r.d(t,{c:()=>d});var n=r(95212),i=r(86610),a=r(61834),s=r(80405),o=r(72384);r(78683);var l=r(65698),u=r(65098),c=r(74913);(0,r(29257).PS)(s.l.NAME_AUDIO,(e,t,r,i)=>{let a,s=[];if(r.sounds=r.sounds||[],void 0!==e.sounds&&null!==e.sounds)for(let o=0,l=e.sounds.length;o<l;o++){let l=e.sounds[o];c.a.audioEngine?.canUseWebAudio?(l.url||(l.url=l.name),s[l.url]?r.sounds.push(n.$.Parse(l,t,i,s[l.url])):(a=n.$.Parse(l,t,i),s[l.url]=a,r.sounds.push(a))):r.sounds.push(new n.$(l.name,null,t))}s=[]}),Object.defineProperty(o.x.prototype,"mainSoundTrack",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new i.t(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),o.x.prototype.getSoundByName=function(e){let t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks){for(let r=0;r<this.soundTracks.length;r++)for(t=0;t<this.soundTracks[r].soundCollection.length;t++)if(this.soundTracks[r].soundCollection[t].name===e)return this.soundTracks[r].soundCollection[t]}return null},Object.defineProperty(o.x.prototype,"audioEnabled",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),e.audioEnabled},set:function(e){let t=this._getComponent(s.l.NAME_AUDIO);t||(t=new d(this),this._addComponent(t)),e?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(o.x.prototype,"headphone",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),e.headphone},set:function(e){let t=this._getComponent(s.l.NAME_AUDIO);t||(t=new d(this),this._addComponent(t)),e?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(o.x.prototype,"audioListenerPositionProvider",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),e.audioListenerPositionProvider},set:function(e){let t=this._getComponent(s.l.NAME_AUDIO);if(t||(t=new d(this),this._addComponent(t)),e&&"function"!=typeof e)throw Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.x.prototype,"audioListenerRotationProvider",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),e.audioListenerRotationProvider},set:function(e){let t=this._getComponent(s.l.NAME_AUDIO);if(t||(t=new d(this),this._addComponent(t)),e&&"function"!=typeof e)throw Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");t.audioListenerRotationProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.x.prototype,"audioPositioningRefreshRate",{get:function(){let e=this._getComponent(s.l.NAME_AUDIO);return e||(e=new d(this),this._addComponent(e)),e.audioPositioningRefreshRate},set:function(e){let t=this._getComponent(s.l.NAME_AUDIO);t||(t=new d(this),this._addComponent(t)),t.audioPositioningRefreshRate=e},enumerable:!0,configurable:!0});class d{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(e){if(this.name=s.l.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new a.P,this._cachedCameraPosition=new a.P,this._lastCheck=0,this._invertMatrixTemp=new a.y3,this._cameraDirectionTemp=new a.P,!(e=e||u.l.LastCreatedScene))return;this.scene=e,e.soundTracks=[],e.sounds=[]}register(){this.scene._afterRenderStage.registerStep(s.l.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(e){if(e.sounds=[],this.scene.soundTracks)for(let t=0;t<this.scene.soundTracks.length;t++){let r=this.scene.soundTracks[t];for(let t=0;t<r.soundCollection.length;t++)e.sounds.push(r.soundCollection[t].serialize())}}addFromContainer(e){if(e.sounds)for(let t of e.sounds)t.play(),t.autoplay=!0,this.scene.mainSoundTrack.addSound(t)}removeFromContainer(e,t=!1){if(e.sounds)for(let r of e.sounds)r.stop(),r.autoplay=!1,this.scene.mainSoundTrack.removeSound(r),t&&r.dispose()}dispose(){let e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].dispose()}disableAudio(){let e,t=this.scene;for(this._audioEnabled=!1,c.a.audioEngine&&c.a.audioEngine.audioContext&&c.a.audioEngine.audioContext.suspend(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let r=0;r<t.soundTracks[e].soundCollection.length;r++)t.soundTracks[e].soundCollection[r].pause()}enableAudio(){let e,t=this.scene;for(this._audioEnabled=!0,c.a.audioEngine&&c.a.audioEngine.audioContext&&c.a.audioEngine.audioContext.resume(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].isPaused&&t.mainSoundTrack.soundCollection[e].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let r=0;r<t.soundTracks[e].soundCollection.length;r++)t.soundTracks[e].soundCollection[r].isPaused&&t.soundTracks[e].soundCollection[r].play()}switchAudioModeForHeadphones(){let e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){let e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToEqualPower()}_afterRender(){let e=l.F.Now;if(this._lastCheck&&e-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=e;let t=this.scene;if(!this._audioEnabled||!t._mainSoundTrack||!t.soundTracks||0===t._mainSoundTrack.soundCollection.length&&1===t.soundTracks.length)return;let r=c.a.audioEngine;if(r&&r.audioContext){let e,n=t.activeCamera;if(t.activeCameras&&t.activeCameras.length>0&&(n=t.activeCameras[0]),this.audioListenerPositionProvider){let e=this.audioListenerPositionProvider();r.audioContext.listener.setPosition(e.x||0,e.y||0,e.z||0)}else n?this._cachedCameraPosition.equals(n.globalPosition)||(this._cachedCameraPosition.copyFrom(n.globalPosition),r.audioContext.listener.setPosition(n.globalPosition.x,n.globalPosition.y,n.globalPosition.z)):r.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){let e=this.audioListenerRotationProvider();r.audioContext.listener.setOrientation(e.x||0,e.y||0,e.z||0,0,1,0)}else n?(n.rigCameras&&n.rigCameras.length>0&&(n=n.rigCameras[0]),n.getViewMatrix().invertToRef(this._invertMatrixTemp),a.P.TransformNormalToRef(d._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.copyFrom(this._cameraDirectionTemp),r.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):r.audioContext.listener.setOrientation(0,0,0,0,1,0);for(e=0;e<t.mainSoundTrack.soundCollection.length;e++){let r=t.mainSoundTrack.soundCollection[e];r.useCustomAttenuation&&r.updateDistanceFromListener()}if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let r=0;r<t.soundTracks[e].soundCollection.length;r++){let n=t.soundTracks[e].soundCollection[r];n.useCustomAttenuation&&n.updateDistanceFromListener()}}}}d._CameraDirection=new a.P(0,0,-1),n.$._SceneComponentInitialization=e=>{let t=e._getComponent(s.l.NAME_AUDIO);t||(t=new d(e),e._addComponent(t))}},96185:function(e,t,r){r.d(t,{g:()=>i});var n=r(11349);class i extends n.F{constructor(e,t){if(super(e),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),t)for(let e of t)this._eventsSignalOutputs[e]=this._registerSignalOutput(e+"Event")}_executeOnTick(e){}_startPendingTasks(e){e._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(e),this._resetAfterCanceled(e)),this._preparePendingTasks(e),e._addPendingBlock(this),this.out._activateSignal(e),e._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(e){e._deleteExecutionVariable(this,"_initialized"),e._removePendingBlock(this)}}},9630:function(e,t,r){var n=r(66755);let i="fresnelFunction",a=`#ifdef FRESNEL
fn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32
{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}
#endif
`;n.v.IncludesShadersStoreWGSL[i]||(n.v.IncludesShadersStoreWGSL[i]=a)},96368:function(e,t,r){r.d(t,{Z:()=>i});var n=r(44976);class i extends n.Z{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null),super(e,t),this.pressPoint=.5,(null==t?void 0:t.pressPoint)!==void 0&&(this.pressPoint=null==t?void 0:t.pressPoint)}pressed(e=this.magnitude()){return e>=this.pressPoint}}},97622:function(e,t,r){r.d(t,{p:()=>u});var n=r(80535),i=r(10666),a=r(88280),s=r(61834),o=r(16891),l=r(69932);class u{constructor(e,t,r={mass:0},s){if(this.transformNode=e,this.type=t,this._options=r,this._scene=s,this._disposeShapeWhenDisposed=!0,!this.transformNode)return void a.Y.Error("No object was provided. A physics object is obligatory");if(this.transformNode.parent&&0!==this._options.mass&&e.hasThinInstances&&a.Y.Warn("A physics body has been created for an object which has a parent and thin instances. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),!this._scene)return;this._options.mass=void 0===r.mass?0:r.mass,this._options.friction=void 0===r.friction?.2:r.friction,this._options.restitution=void 0===r.restitution?.2:r.restitution;let o=2*(0!==this._options.mass),l=this._options.startAsleep??!1;this.body=new n.Q(e,o,l,this._scene),this._addSizeOptions(),t.getClassName&&"PhysicsShape"===t.getClassName()?(this.shape=t,this._disposeShapeWhenDisposed=!1):this.shape=new i.$n({type:t,parameters:this._options},this._scene),this._options.isTriggerShape&&(this.shape.isTrigger=!0),this.material={friction:this._options.friction,restitution:this._options.restitution},this.body.shape=this.shape,this.shape.material=this.material,this.body.setMassProperties({mass:this._options.mass}),this._nodeDisposeObserver=this.transformNode.onDisposeObservable.add(()=>{this.dispose()})}_getObjectBoundingBox(){return this.transformNode.getRawBoundingInfo?this.transformNode.getRawBoundingInfo().boundingBox:new l.k(new s.P(-.5,-.5,-.5),new s.P(.5,.5,.5))}_hasVertices(e){return e?.getTotalVertices()>0}_addSizeOptions(){this.transformNode.computeWorldMatrix(!0);let e=this._getObjectBoundingBox(),t=s.jp.Vector3["0"];t.copyFrom(e.extendSize),t.scaleInPlace(2),t.multiplyInPlace(this.transformNode.absoluteScaling),t.x=Math.abs(t.x),t.y=Math.abs(t.y),t.z=Math.abs(t.z);let r=s.jp.Vector3["1"];if(r.copyFrom(e.minimum),r.multiplyInPlace(this.transformNode.absoluteScaling),!this._options.center){let t=new s.P;t.copyFrom(e.center),t.multiplyInPlace(this.transformNode.absoluteScaling),this._options.center=t}switch(this.type){case 0:!this._options.radius&&(0,o.WithinEpsilon)(t.x,t.y,1e-4)&&(0,o.WithinEpsilon)(t.x,t.z,1e-4)?this._options.radius=t.x/2:this._options.radius||(a.Y.Warn("Non uniform scaling is unsupported for sphere shapes. Setting the radius to the biggest bounding box extent."),this._options.radius=Math.max(t.x,t.y,t.z)/2);break;case 1:{let e=t.x/2;this._options.radius=this._options.radius??e,this._options.pointA=this._options.pointA??new s.P(0,r.y+e,0),this._options.pointB=this._options.pointB??new s.P(0,r.y+t.y-e,0)}break;case 2:{let e=t.x/2;this._options.radius=this._options.radius??e,this._options.pointA=this._options.pointA??new s.P(0,r.y,0),this._options.pointB=this._options.pointB??new s.P(0,r.y+t.y,0)}break;case 6:case 4:case 7:if(!this._options.mesh&&this._hasVertices(this.transformNode))this._options.mesh=this.transformNode;else if(!this._options.mesh||!this._hasVertices(this._options.mesh))throw Error("No valid mesh was provided for mesh or convex hull shape parameter. Please provide a mesh with valid geometry (number of vertices greater than 0).");break;case 3:this._options.extents=this._options.extents??new s.P(t.x,t.y,t.z),this._options.rotation=this._options.rotation??s._f.Identity()}}dispose(){this._nodeDisposeObserver&&(this.body.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this.body.dispose(),this._disposeShapeWhenDisposed&&this.shape.dispose()}}},9787:function(e,t,r){r.d(t,{_T:()=>n});function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}},9858:function(e,t,r){r.r(t),r.d(t,{morphTargetsVertex:()=>s});var n=r(66755);let i="morphTargetsVertex",a=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;
#ifdef MORPHTARGETS_POSITION
positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASPOSITIONS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASNORMALS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUVS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASTANGENTS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated+=(readVector3FromRawSampler(i,vertexID).xy-uv2)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUV2S
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated+=(readVector4FromRawSampler(i,vertexID)-color)*morphTargetInfluences[i];
#endif
}
#endif
#else
#ifdef MORPHTARGETS_POSITION
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated+=(uv2_{X}-uv2)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated+=(color{X}-color)*morphTargetInfluences[{X}];
#endif
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a);let s={name:i,shader:a}},98607:function(e,t,r){function n(e,t,r,n){let i=n,a=0,s="";for(;i<r.length;){let n=r.charAt(i);if(s)n===s?'"'===s||"'"===s?"\\"!==r.charAt(i-1)&&(s=""):s="":"*/"===s&&"*"===n&&i+1<r.length&&("/"===r.charAt(i+1)&&(s=""),""===s&&i++);else switch(n){case e:a++;break;case t:a--;break;case'"':case"'":case"`":s=n;break;case"/":if(i+1<r.length){let e=r.charAt(i+1);"/"===e?s="\n":"*"===e&&(s="*/")}}if(i++,0===a)break}return 0===a?i-1:-1}function i(e,t){for(;t<e.length;){let r=e[t];if(" "!==r&&"\n"!==r&&"\r"!==r&&"	"!==r&&"\n"!==r&&"\xa0"!==r)break;t++}return t}function a(e){let t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95==t}function s(e){let t=0,r="",n=!1,i=[];for(;t<e.length;){let a=e.charAt(t);if(r)a===r?'"'===r||"'"===r?("\\"!==e.charAt(t-1)&&(r=""),i.push(a)):(r="",n=!1):"*/"===r&&"*"===a&&t+1<e.length?("/"===e.charAt(t+1)&&(r=""),""===r&&(n=!1,t++)):n||i.push(a);else{switch(a){case'"':case"'":case"`":r=a;break;case"/":if(t+1<e.length){let i=e.charAt(t+1);"/"===i?(r="\n",n=!0):"*"===i&&(r="*/",n=!0)}}n||i.push(a)}t++}return i.join("")}function o(e,t,r,n){for(;t>=0&&e.charAt(t)!==r&&(!n||e.charAt(t)!==n);)t--;return t}function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function u(e,t,r,n){let i=e.indexOf(t);if(i<0)return e;if(r){for(;i++<e.length&&"{"!=e.charAt(i););i<e.length&&(e=e.substring(0,i+1)+r+e.substring(i+1))}if(n){let t=e.lastIndexOf("}");e=e.substring(0,t)+(n+"\n}")}return e}r.d(t,{AW:()=>l,Kt:()=>s,Pm:()=>i,e0:()=>u,uA:()=>a,vt:()=>n,wm:()=>o})},99046:function(e,t,r){var n=r(66755);let i="instancesDeclaration",a=`#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#ifdef INSTANCESCOLOR
attribute vec4 instanceColor;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;
#ifdef THIN_INSTANCES
uniform mat4 previousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform mat4 previousWorld;
#endif
#endif
`;n.v.IncludesShadersStore[i]||(n.v.IncludesShadersStore[i]=a)},99151:function(e,t,r){r.d(t,{c:()=>s});var n=r(59942),i=r(58417),a=r(54603);class s extends i.k{constructor(e){super(e,n.u.Neutral),this.registerInput("left",a.E.AutoDetect),this.registerInput("right",a.E.AutoDetect),this.registerOutput("output",a.E.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(a.E.Float),this.right.acceptedConnectionPointTypes.push(a.E.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add(()=>this._updateInputOutputTypes()),this.right.onTypeChangedObservable.add(()=>this._updateInputOutputTypes())]}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===a.E.Int||this.left.type===a.E.Float&&this.right.type!==a.E.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(let[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[a.E.Int,a.E.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),(t.type===a.E.Int||t.type===a.E.Float)&&e.acceptedConnectionPointTypes.push(a.E.Vector2,a.E.Vector3,a.E.Vector4,a.E.Color3,a.E.Color4,a.E.Matrix))}dispose(){for(let e of(super.dispose(),this._connectionObservers))e.remove();this._connectionObservers.length=0}}},99174:function(e,t,r){r.d(t,{D:()=>a});var n=r(81951),i=r(20408);class a{get forceBindGroupCreation(){return this._numExternalTextures>0}get hasFloatOrDepthTextures(){return this._numFloatOrDepthTextures>0}constructor(){this.uniqueId=a._Counter++,this.updateId=0,this.textureState=0,this.reset()}reset(){this.samplers={},this.textures={},this.isDirty=!0,this._numFloatOrDepthTextures=0,this._numExternalTextures=0}setSampler(e,t){let r=this.samplers[e],n=-1;r?n=r.hashCode:this.samplers[e]=r={sampler:t,hashCode:0},r.sampler=t,r.hashCode=t?i.W.GetSamplerHashCode(t):0;let a=n!==r.hashCode;a&&this.updateId++,this.isDirty||(this.isDirty=a)}setTexture(e,t){let r=this.textures[e],i=-1;r?i=r.texture?.uniqueId??-1:this.textures[e]=r={texture:t,isFloatOrDepthTexture:!1,isExternalTexture:!1},r.isExternalTexture&&this._numExternalTextures--,r.isFloatOrDepthTexture&&this._numFloatOrDepthTextures--,t?(r.isFloatOrDepthTexture=1===t.type||t.format>=13&&t.format<=18,r.isExternalTexture=n.x.IsExternalTexture(t),r.isFloatOrDepthTexture&&this._numFloatOrDepthTextures++,r.isExternalTexture&&this._numExternalTextures++):(r.isFloatOrDepthTexture=!1,r.isExternalTexture=!1),r.texture=t;let a=i!==(t?.uniqueId??-1);a&&this.updateId++,this.isDirty||(this.isDirty=a)}}a._Counter=0},99530:function(e,t,r){var n=r(31913),i=r(37914);let a=(()=>{let e=new Uint8Array(4);return!!((new Uint32Array(e.buffer)[0]=1)&e[0])})();Object.defineProperty(n.o.prototype,"effectiveByteStride",{get:function(){return this._alignedBuffer&&this._alignedBuffer.byteStride||this.byteStride},enumerable:!0,configurable:!0}),Object.defineProperty(n.o.prototype,"effectiveByteOffset",{get:function(){return this._alignedBuffer?0:this.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(n.o.prototype,"effectiveBuffer",{get:function(){return this._alignedBuffer&&this._alignedBuffer.getBuffer()||this._buffer.getBuffer()},enumerable:!0,configurable:!0}),n.o.prototype._rebuild=function(){this._buffer?._rebuild(),this._alignedBuffer?._rebuild()},n.o.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose(),this._alignedBuffer?.dispose(),this._alignedBuffer=void 0,this._isDisposed=!0},n.o.prototype.getWrapperBuffer=function(){return this._alignedBuffer||this._buffer},n.o.prototype._alignBuffer=function(){let e,t,r=this._buffer.getData();if(!this.engine._features.forceVertexBufferStrideAndOffsetMultiple4Bytes||this.byteStride%4==0&&this.byteOffset%4==0||!r)return;let s=(0,i.N1)(this.type),o=this.byteStride+3&-4,l=o/s,u=this._maxVerticesCount,c=u*o/s;if(Array.isArray(r)){let t=new Float32Array(r);e=new DataView(t.buffer,t.byteOffset,t.byteLength)}else e=r instanceof ArrayBuffer?new DataView(r,0,r.byteLength):new DataView(r.buffer,r.byteOffset,r.byteLength);t=this.type===n.o.BYTE?new Int8Array(c):this.type===n.o.UNSIGNED_BYTE?new Uint8Array(c):this.type===n.o.SHORT?new Int16Array(c):this.type===n.o.UNSIGNED_SHORT?new Uint16Array(c):this.type===n.o.INT?new Int32Array(c):this.type===n.o.UNSIGNED_INT?new Uint32Array(c):new Float32Array(c);let d=this.getSize(),h=this.byteOffset;for(let r=0;r<u;++r){for(let i=0;i<d;++i)switch(this.type){case n.o.BYTE:t[r*l+i]=e.getInt8(h+i);break;case n.o.UNSIGNED_BYTE:t[r*l+i]=e.getUint8(h+i);break;case n.o.SHORT:t[r*l+i]=e.getInt16(h+2*i,a);break;case n.o.UNSIGNED_SHORT:t[r*l+i]=e.getUint16(h+2*i,a);break;case n.o.INT:t[r*l+i]=e.getInt32(h+4*i,a);break;case n.o.UNSIGNED_INT:t[r*l+i]=e.getUint32(h+4*i,a);break;case n.o.FLOAT:t[r*l+i]=e.getFloat32(h+4*i,a)}h+=this.byteStride}this._alignedBuffer?.dispose(),this._alignedBuffer=new n.l(this.engine,t,!1,o,!1,this.getIsInstanced(),!0,this.instanceDivisor,(this._label??"VertexBuffer")+"_aligned")}},99763:function(e,t,r){var n=r(74913);r(93757);var i=r(34504);i.q.prototype.setAlphaMode=function(e,t=!1){if(this._alphaMode===e&&(0===e&&!this._alphaState.alphaBlend||0!==e&&this._alphaState.alphaBlend)){if(!t){let t=0===e;this.depthCullingState.depthMask!==t&&(this.setDepthWrite(t),this._cacheRenderPipeline.setDepthWriteEnabled(t))}return}switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,1),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,771),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(770,1,0,1),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(0,769,1,1),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(774,0,1,1),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(770,769,1,1),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(32769,32770,32771,32772),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(1,769,1,771),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,1),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(772,1,0,0),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(775,769,773,771),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,0),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(775,769,0,1),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,771),this._alphaState.alphaBlend=!0}t||(this.setDepthWrite(0===e),this._cacheRenderPipeline.setDepthWriteEnabled(0===e)),this._alphaMode=e,this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)},i.q.prototype.setAlphaEquation=function(e){n.a.prototype.setAlphaEquation.call(this,e),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)}},99876:function(e,t,r){r(99763);var n=r(88280),i=r(35328),a=r(1677);class s{getBindGroups(e,t,r){if(!r)throw Error("WebGPUComputeContext.getBindGroups: bindingsMapping is required until browsers support reflection for wgsl shaders!");if(0===this._bindGroups.length){let i=this._bindGroupEntries.length>0;for(let t in e){let a=e[t],s=r[t],o=s.group,l=s.binding,u=a.type,c=a.object,d=a.indexInGroupEntries,h=this._bindGroupEntries[o];switch(!h&&(h=this._bindGroupEntries[o]=[]),u){case 5:void 0!==d&&i?h[d].resource=this._cacheSampler.getSampler(c):(a.indexInGroupEntries=h.length,h.push({binding:l,resource:this._cacheSampler.getSampler(c)}));break;case 0:case 4:{let e=c._texture._hardwareTexture;void 0!==d&&i?(0===u&&(h[d++].resource=this._cacheSampler.getSampler(c._texture)),h[d].resource=e.view):(a.indexInGroupEntries=h.length,0===u&&h.push({binding:l-1,resource:this._cacheSampler.getSampler(c._texture)}),h.push({binding:l,resource:e.view}));break}case 1:{let e=c._texture._hardwareTexture;(8&e.textureAdditionalUsages)==0&&n.Y.Error(`computeDispatch: The texture (name=${c.name}, uniqueId=${c.uniqueId}) is not a storage texture!`,50),void 0!==d&&i?h[d].resource=e.viewForWriting:(a.indexInGroupEntries=h.length,h.push({binding:l,resource:e.viewForWriting}));break}case 6:{let e=c.underlyingResource;void 0!==d&&i?h[d].resource=this._device.importExternalTexture({source:e}):(a.indexInGroupEntries=h.length,h.push({binding:l,resource:this._device.importExternalTexture({source:e})}));break}case 2:case 3:case 7:{let e=7===u?c:c.getBuffer(),t=e.underlyingResource;void 0!==d&&i?(h[d].resource.buffer=t,h[d].resource.size=e.capacity):(a.indexInGroupEntries=h.length,h.push({binding:l,resource:{buffer:t,offset:0,size:e.capacity}}))}}}for(let e=0;e<this._bindGroupEntries.length;++e){let r=this._bindGroupEntries[e];if(!r){this._bindGroups[e]=void 0;continue}this._bindGroups[e]=this._device.createBindGroup({layout:t.getBindGroupLayout(e),entries:r})}this._bindGroups.length=this._bindGroupEntries.length}return this._bindGroups}constructor(e,t){this._device=e,this._cacheSampler=t,this.uniqueId=s._Counter++,this._bindGroupEntries=[],this.clear()}clear(){this._bindGroups=[]}}s._Counter=0;class o{get isAsync(){return!1}get isReady(){return this.isAsync,!1}constructor(e){this._name="unnamed",this.engine=e}_getComputeShaderCode(){return this.sources?.compute}dispose(){}}let l={};a.f.prototype.createComputeContext=function(){return new s(this._device,this._cacheSampler)},a.f.prototype.createComputeEffect=function(e,t){let r=("string"==typeof e?e:e.computeToken||e.computeSource||e.computeElement||e.compute)+"@"+t.defines;if(this._compiledComputeEffects[r]){let e=this._compiledComputeEffects[r];return t.onCompiled&&e.isReady()&&t.onCompiled(e),e}let n=new i.n(e,t,this,r);return this._compiledComputeEffects[r]=n,n},a.f.prototype.createComputePipelineContext=function(){return new o(this)},a.f.prototype.areAllComputeEffectsReady=function(){for(let e in this._compiledComputeEffects)if(!this._compiledComputeEffects[e].isReady())return!1;return!0},a.f.prototype.computeDispatch=function(e,t,r,n,i=1,a=1,s,o){this._computeDispatch(e,t,r,n,i,a,void 0,void 0,s,o)},a.f.prototype.computeDispatchIndirect=function(e,t,r,n,i=0,a,s){this._computeDispatch(e,t,r,void 0,void 0,void 0,n,i,a,s)},a.f.prototype._computeDispatch=function(e,t,r,n,i,a,s,o,u,c){this._endCurrentRenderPass();let d=e._pipelineContext;d.computePipeline||(d.computePipeline=this._device.createComputePipeline({layout:"auto",compute:d.stage})),c&&this._timestampQuery.startPass(l,this._timestampIndex);let h=this._renderEncoder.beginComputePass(l);h.setPipeline(d.computePipeline);let f=t.getBindGroups(r,d.computePipeline,u);for(let e=0;e<f.length;++e){let t=f[e];t&&h.setBindGroup(e,t)}void 0!==s?h.dispatchWorkgroupsIndirect(s.underlyingResource,o):n+i+a>0&&h.dispatchWorkgroups(n,i,a),h.end(),c&&(this._timestampQuery.endPass(this._timestampIndex,c),this._timestampIndex+=2)},a.f.prototype.releaseComputeEffects=function(){for(let e in this._compiledComputeEffects){let t=this._compiledComputeEffects[e].getPipelineContext();this._deleteComputePipelineContext(t)}this._compiledComputeEffects={}},a.f.prototype._prepareComputePipelineContext=function(e,t,r,i,a){this.dbgShowShaderCode&&(n.Y.Log(i),n.Y.Log(t)),e.sources={compute:t,rawCompute:r},e.stage=this._createComputePipelineStageDescriptor(t,i,a)},a.f.prototype._releaseComputeEffect=function(e){this._compiledComputeEffects[e._key]&&(delete this._compiledComputeEffects[e._key],this._deleteComputePipelineContext(e.getPipelineContext()))},a.f.prototype._rebuildComputeEffects=function(){for(let e in this._compiledComputeEffects){let t=this._compiledComputeEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}},a.f.prototype._executeWhenComputeStateIsCompiled=function(e,t){e.stage.module.getCompilationInfo().then(e=>{let r={numErrors:0,messages:[]};for(let t of e.messages)"error"===t.type&&r.numErrors++,r.messages.push({type:t.type,text:t.message,line:t.lineNum,column:t.linePos,length:t.length,offset:t.offset});t(r)})},a.f.prototype._deleteComputePipelineContext=function(e){e&&e.dispose()},a.f.prototype._createComputePipelineStageDescriptor=function(e,t,r){return t=t?"//"+t.split("\n").join("\n//")+"\n":"",{module:this._device.createShaderModule({code:t+e}),entryPoint:r}},r(77959),a.f.prototype._debugPushGroup=function(e,t){this._options.enableGPUDebugMarkers&&(0===t||1===t?(1===t&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.pushDebugGroup(e)):this._currentRenderPass?(this._currentRenderPass.pushDebugGroup(e),this._debugStackRenderPass.push(e)):this._pendingDebugCommands.push(["push",e,t]))},a.f.prototype._debugPopGroup=function(e){this._options.enableGPUDebugMarkers&&(0===e||1===e?(1===e&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.popDebugGroup()):this._currentRenderPass?(this._currentRenderPass.popDebugGroup(),this._debugStackRenderPass.pop()):this._pendingDebugCommands.push(["pop",null,e]))},a.f.prototype._debugInsertMarker=function(e,t){this._options.enableGPUDebugMarkers&&(0===t||1===t?(1===t&&(this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._endCurrentRenderPass()),this._renderEncoder.insertDebugMarker(e)):this._currentRenderPass?this._currentRenderPass.insertDebugMarker(e):this._pendingDebugCommands.push(["insert",e,t]))},a.f.prototype._debugFlushPendingCommands=function(){if(0!==this._debugStackRenderPass.length){let e=this._debugStackRenderPass.slice();this._debugStackRenderPass.length=0;for(let t=0;t<e.length;++t)this._debugPushGroup(e[t],2)}for(let e=0;e<this._pendingDebugCommands.length;++e){let[t,r,n]=this._pendingDebugCommands[e];switch(t){case"push":this._debugPushGroup(r,n);break;case"pop":this._debugPopGroup(n);break;case"insert":this._debugInsertMarker(r,n)}}this._pendingDebugCommands.length=0};var u=r(90481),c=r(6838);a.f.prototype.createDynamicTexture=function(e,t,r,n){let i=new u.l(this,4);return i.baseWidth=e,i.baseHeight=t,r&&(e=this.needPOTTextures?(0,c.p7)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,c.p7)(t,this._caps.maxTextureSize):t),i.width=e,i.height=t,i.isReady=!1,i.generateMipMaps=r,i.samplingMode=n,this.updateTextureSamplingMode(n,i),this._internalTexturesCache.push(i),e&&t&&this._textureHelper.createGPUTextureForInternalTexture(i,e,t),i},a.f.prototype.updateDynamicTexture=function(e,t,r,n=!1,i,a,s){if(!e)return;let o=t.width,l=t.height,u=e._hardwareTexture;e._hardwareTexture?.underlyingResource||(u=this._textureHelper.createGPUTextureForInternalTexture(e,o,l)),this._textureHelper.updateTexture(t,e,o,l,e.depth,u.format,0,0,r,n,0,0,s),e.generateMipMaps&&this._generateMipmaps(e),e._dynamicTextureSource=t,e._premulAlpha=n,e.invertY=r||!1,e.isReady=!0},r(78914),r(8605),r(14465),r(9363),r(71460),r(39953),r(94257),a.f.prototype.updateVideoTexture=function(e,t,r){if(!e||e._isDisabled)return;void 0===this._videoTextureSupported&&(this._videoTextureSupported=!0);let n=e._hardwareTexture;if(e._hardwareTexture?.underlyingResource||(n=this._textureHelper.createGPUTextureForInternalTexture(e)),t&&void 0!==t.underlyingResource){if(t.isReady()){try{this._textureHelper.copyVideoToTexture(t,e,n.format,!r),e.generateMipMaps&&this._generateMipmaps(e)}catch(e){}e.isReady=!0}}else t&&this.createImageBitmap(t).then(t=>{this._textureHelper.updateTexture(t,e,e.width,e.height,e.depth,n.format,0,0,!r,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e),e.isReady=!0}).catch(()=>{e.isReady=!0})}}}]);